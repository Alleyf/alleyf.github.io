<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>alleyf</title>
  
  
  <link href="https://alleyf.github.io/atom.xml" rel="self"/>
  
  <link href="https://alleyf.github.io/"/>
  <updated>2023-10-05T07:33:03.726Z</updated>
  <id>https://alleyf.github.io/</id>
  
  <author>
    <name>alleyf</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="https://alleyf.github.io/2023/10/e8c7910f93b8.html"/>
    <id>https://alleyf.github.io/2023/10/e8c7910f93b8.html</id>
    <published>2023-10-05T07:29:23.218Z</published>
    <updated>2023-10-05T07:33:03.726Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-论文主要有那些组成部分及其相应的作用？"><a href="#1-论文主要有那些组成部分及其相应的作用？" class="headerlink" title="1. 论文主要有那些组成部分及其相应的作用？"></a>1. 论文主要有那些组成部分及其相应的作用？</h2><ol><li>论文标题：所有工作的凝练总结</li><li>摘要：包括研究目的，研究方法，研究结果等关键信息</li><li>引言：领域重要性 (研究背景)，国内外研究现状，现存问题，提出的解决方法</li><li>方法论：解决问题所采用的具体实施的方法</li><li>结果：根据方法得到的结果</li><li>引用：文章中对别人文章内容的引用</li></ol><h2 id="2-哪些是重点需要阅读的？"><a href="#2-哪些是重点需要阅读的？" class="headerlink" title="2. 哪些是重点需要阅读的？"></a>2. 哪些是重点需要阅读的？</h2><ul><li>标题：提炼<strong>核心关键词</strong></li><li>摘要：提炼<strong>研究目的，研究方法，研究结果</strong>等</li><li>方法论：提炼<strong>具体解决思路、方法</strong></li><li>结果：提炼<strong>最终研究结果、未来改进和存在的缺陷</strong>等</li></ul><h2 id="3-什么时候泛读，什么时候精读，怎么读？"><a href="#3-什么时候泛读，什么时候精读，怎么读？" class="headerlink" title="3. 什么时候泛读，什么时候精读，怎么读？"></a>3. 什么时候泛读，什么时候精读，怎么读？</h2><ol><li>确定课题前：对课题组的研究<strong>大方向相关领域</strong>的论文进行大范围泛读了解<strong>整个领域的研究进程和研究热点及趋势</strong></li><li>确定课题后：对确定的课题对应的<strong>细分研究领域</strong>的相关论文，选择<strong>引用高且较著名的论文进行精读汇报总结</strong></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-论文主要有那些组成部分及其相应的作用？&quot;&gt;&lt;a href=&quot;#1-论文主要有那些组成部分及其相应的作用？&quot; class=&quot;headerlink&quot; title=&quot;1. 论文主要有那些组成部分及其相应的作用？&quot;&gt;&lt;/a&gt;1. 论文主要有那些组成部分及其相应的作用？</summary>
      
    
    
    
    <category term="科研学习" scheme="https://alleyf.github.io/categories/%E7%A7%91%E7%A0%94%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>DeepLearing</title>
    <link href="https://alleyf.github.io/2023/05/0950da3fc570.html"/>
    <id>https://alleyf.github.io/2023/05/0950da3fc570.html</id>
    <published>2023-05-31T06:27:39.000Z</published>
    <updated>2023-08-12T06:53:00.783Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-引言"><a href="#1-引言" class="headerlink" title="1.引言"></a>1.引言</h1><p><img src="https://s2.loli.net/2023/05/31/mlfBuXI7pt2eCic.png" alt="image.png|400"></p><blockquote><p>特征工程的作用：<br>    - 数据特征决定了模型的上限<br>    - 预处理和特征提取是最核心的<br>    - 算法与参数选择决定了如何逼近这个上限</p></blockquote><h2 id="1-1反向传播"><a href="#1-1反向传播" class="headerlink" title="1.1反向传播"></a>1.1反向传播</h2><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307251455407.png"/><h2 id="1-2正则化"><a href="#1-2正则化" class="headerlink" title="1.2正则化"></a>1.2正则化</h2><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307251607343.png" alt="image.png"></p><h2 id="1-3神经元"><a href="#1-3神经元" class="headerlink" title="1.3神经元"></a>1.3神经元</h2><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307251610745.png" alt="image.png"></p><h2 id="1-4激活函数"><a href="#1-4激活函数" class="headerlink" title="1.4激活函数"></a>1.4激活函数</h2><blockquote><p>引入<strong>非线性特性</strong>，从而逼近任何分布结果。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307251611276.png" alt="image.png"></p></blockquote><p>激活函数对比：</p><blockquote><p><strong>Relu 为为主流，Sigmoid 会出现梯度消失现象</strong><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307251616218.png" alt="image.png"></p></blockquote><h2 id="1-5数据预处理"><a href="#1-5数据预处理" class="headerlink" title="1.5数据预处理"></a>1.5数据预处理</h2><blockquote><p>不同的预处理结果会使得模型的效果发生很大的差异！<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308012100980.png" alt="image.png"></p></blockquote><ol><li>参数初始化</li></ol><ul><li>参数初始化同样非常重要！</li><li>通常我们都使用随机策略来进行参数初始化<br>$$W = 0.01*np.random.randn (D, H)$$</li></ul><h2 id="1-6Drop-Out"><a href="#1-6Drop-Out" class="headerlink" title="1.6Drop-Out"></a>1.6Drop-Out</h2><blockquote><p>过拟合是神经网络非常头疼的一个大问题！<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308012106533.png" alt="image.png"></p></blockquote><h2 id="1-7卷积"><a href="#1-7卷积" class="headerlink" title="1.7卷积"></a>1.7卷积</h2><blockquote><p>计算过程如下图所示：</p><ul><li>分别计算三个通道输入与卷积核进行内积，再将三通道结果求和得到输出（特征图）</li></ul></blockquote><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021949385.png" alt="image.png"></p><blockquote><p>特征图的个数（深度）等于卷积核的个数，如上图所见两个卷积核进行多尺度特征提取得到两个特征图。</p></blockquote><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308121103471.png" alt="image.png"></p><h3 id="1-7-1步长"><a href="#1-7-1步长" class="headerlink" title="1.7.1步长"></a>1.7.1步长</h3><blockquote><p>步长就是卷积时滑动窗口的距离，一般为 1/2.</p></blockquote><h3 id="1-7-2边缘填充"><a href="#1-7-2边缘填充" class="headerlink" title="1.7.2边缘填充"></a>1.7.2边缘填充</h3><blockquote><p>边缘填充是在原输入的数据上加上一层 0 填充，不仅增加了原始边缘数据的卷积次数还保证了 0 填充填充不影响特征提取。</p></blockquote><h3 id="1-7-3卷积计算结果"><a href="#1-7-3卷积计算结果" class="headerlink" title="1.7.3卷积计算结果"></a>1.7.3卷积计算结果</h3><p>长度：$$H_{2}= \frac{H_{1}-F_{H}+2P}{S}+1$$<br>宽度： $$W_{2}= \frac{W_{1}-F_{W}+2P}{S}+1$$</p><blockquote><p>其中 W 1、H 1 表示输入的宽度、长度；W 2、H 2 表示输出特征图的宽度、长度；F 表示卷积核长和宽的大小；S 表示滑动窗口的步长; P 表示边界填充 (加几圈 0)。</p></blockquote><h2 id="1-8池化"><a href="#1-8池化" class="headerlink" title="1.8池化"></a>1.8池化</h2><h3 id="最大池化"><a href="#最大池化" class="headerlink" title="最大池化"></a>最大池化</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308121141086.png" alt="image.png"></p><blockquote><p>在原始特征图上<strong>分块</strong>选择<strong>最大（最重要）的特征值</strong>，从而对特征图进行<strong>下采样压缩大小</strong>，但<strong>特征图个数不变</strong></p></blockquote><h2 id="1-9总体架构"><a href="#1-9总体架构" class="headerlink" title="1.9总体架构"></a>1.9总体架构</h2><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308121153214.png" alt="image.png"></p><blockquote><p>只有带参数的才能称之为一层，卷积层和全连接层属于，而激活函数和池化层不属于。</p></blockquote><p><strong>特征图变化：</strong><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308121157274.png" alt="image.png"></p><h2 id="1-10感受野"><a href="#1-10感受野" class="headerlink" title="1.10感受野"></a>1.10感受野</h2><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308121438899.png" alt="image.png"></p><blockquote><p>卷积后的特征图中的特征值能够感受到的从原始输入数据的大小</p></blockquote><blockquote><p>[!NOTE] Problem</p><ul><li>P:如果堆叠 3 个 3*3 的卷积层，并且保持滑动窗口步长为 1，其感受野就是 7*7 的,<br>这跟一个使用 7*7 卷积核的结果是一样的，那为什么非要堆叠 3 个小卷积呢？</li><li>A: <img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308121452977.png" alt="image.png"></li></ul></blockquote>]]></content>
    
    
    <summary type="html">Deep_learning</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="CV，NLP" scheme="https://alleyf.github.io/tags/CV%EF%BC%8CNLP/"/>
    
  </entry>
  
  <entry>
    <title>Machinelearning DeepLearing</title>
    <link href="https://alleyf.github.io/2023/05/14870b008a81.html"/>
    <id>https://alleyf.github.io/2023/05/14870b008a81.html</id>
    <published>2023-05-31T06:27:39.000Z</published>
    <updated>2023-07-04T14:04:11.688Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h1><p>机器学习主要分为以下两种：</p><p><span style="background:#affad1">1. 监督学习（supervised learning）</span><br><span style="background:#affad1">2. 无监督学习（unsupervised learning）</span></p><h1 id="2-监督学习"><a href="#2-监督学习" class="headerlink" title="2. 监督学习"></a>2. 监督学习</h1><p>分类：</p><p>回归，分类</p><h1 id="3-无监督学习"><a href="#3-无监督学习" class="headerlink" title="3. 无监督学习"></a>3. 无监督学习</h1><p>分类：<br>聚类（clustering）</p>]]></content>
    
    
    <summary type="html">Machine and Deep learning</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="AIGC" scheme="https://alleyf.github.io/tags/AIGC/"/>
    
  </entry>
  
  <entry>
    <title>PyTorch快速入门</title>
    <link href="https://alleyf.github.io/2023/05/891ff30b7b9b.html"/>
    <id>https://alleyf.github.io/2023/05/891ff30b7b9b.html</id>
    <published>2023-05-31T06:27:39.000Z</published>
    <updated>2023-08-26T08:35:18.348Z</updated>
    
    <content type="html"><![CDATA[<ol><li>[[#1.python|1.python]]</li><li>[[#1.数据加载|1.数据加载]]<ol><li>[[#1.数据加载#1.1DataSet|1.1DataSet]]</li></ol></li><li>[[#2.TensorBoard|2.TensorBoard]]<ol><li>[[#2.TensorBoard#2.1 绘图|2.1 绘图]]</li><li>[[#2.TensorBoard#2.2 添加图片|2.2 添加图片]]</li></ol></li><li>[[#3.Transforms|3.Transforms]]<ol><li>[[#3.Transforms#3.1 ToTensor|3.1 ToTensor]]</li><li>[[#3.Transforms#3.2 Compose|3.2 Compose]]</li></ol></li></ol><h1 id="心得体会"><a href="#心得体会" class="headerlink" title="心得体会"></a>心得体会</h1><hr><h2 id="1-python"><a href="#1-python" class="headerlink" title="1. python"></a>1. python</h2><blockquote><p>Python 类中的双下划线 (double underscore)开头的方法通常被称为”魔法方法” (magic methods)。这些方法可以实现一些特殊的功能或对类进行修改。以下是一些常见的双下划线方法及其作用:</p></blockquote><ul><li><p><strong>init</strong>(): 构造函数, 用于初始化类的实例。</p></li><li><p><strong>str</strong>(): 当使用 print 输出对象时, 打印该方法的返回值。</p></li><li><p><strong>repr</strong>(): 返回对象的机器可读字符串表示形式。</p></li><li><p><strong>del</strong>(): 析构函数, 删除对象时被调用。</p></li><li><p><strong>call</strong>(): 允许将对象视为函数调用。</p></li><li><p><strong>getitem</strong>(): 通过索引访问元素的方法, 使得对象可以像列表那样进行切片。</p></li><li><p><strong>len</strong>(): 返回对象长度的方法, 使得对象可以对 len () 函数生效。</p></li><li><p><strong>eq</strong>(): 判断两个对象是否相等的方法, 使得对象可以使用 == 进行比较。</p></li><li><p><strong>lt</strong>(): 小于比较的方法, 可以使用 &lt; 进行比较。</p></li><li><p><strong>add</strong>(): 实现对象的加法运算。</p></li><li><p><strong>iter</strong>(): 实现迭代器接口, 使得对象可以被用于 for 循环。</p></li><li><p><strong>metaclass</strong>: 元类, 用于创建类对象。</p></li></ul><blockquote><p>所以双下划线方法主要是实现一些内置的功能或魔法方法, 让 Python 类拥有一些特殊的行为。我们自己编写类时, 如果需要实现某些特殊功能, 可以通过编写双下划线方法来实现。</p></blockquote><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><hr><h2 id="1-数据加载"><a href="#1-数据加载" class="headerlink" title="1. 数据加载"></a>1. 数据加载</h2><h3 id="1-1-DataSet"><a href="#1-1-DataSet" class="headerlink" title="1.1 DataSet"></a>1.1 DataSet</h3><blockquote><p>继承 DataSet 类并重写__getitem__和 <strong>len</strong> 方法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">import</span> os<br><span class="hljs-comment"># 快捷键ctrl+B快速打开关闭文件编辑区</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, root_dir,label_dir</span>):<br>        self.root_dir = root_dir<br>        self.label_dir = label_dir<br>        self.path = os.path.join(self.root_dir,self.label_dir)<br>        self.img_path = os.listdir(self.path)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, index</span>):<br>        <span class="hljs-comment"># 根据索引index获取数据和标签</span><br>        img_name = self.img_path[index]<br>        img_item_path = os.path.join(self.path,img_name)<br>        img = Image.<span class="hljs-built_in">open</span>(img_item_path)<br>        label = self.label_dir<br>        <span class="hljs-keyword">return</span> img,label<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 返回数据集的长度</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.img_path)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">root_dir = <span class="hljs-string">&#x27;dataset/train&#x27;</span><br>ants_label_dir = <span class="hljs-string">&#x27;ants_image&#x27;</span><br>bees_label_dir = <span class="hljs-string">&#x27;bees_image&#x27;</span><br>ants_dataset = CustomDataset(root_dir,ants_label_dir)<br>bees_dataset = CustomDataset(root_dir,bees_label_dir)<br></code></pre></td></tr></table></figure><blockquote><p><strong>小数据集可以通过➕叠加为大数据集</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">img,label = ants_dataset[<span class="hljs-number">1</span>]<br>img.show()<br>img,label = bees_dataset[<span class="hljs-number">0</span>]<br>img.show()<br>train_dataset = ants_dataset+bees_dataset<br>img,label = train_dataset[<span class="hljs-number">124</span>]<br>img.show()<br></code></pre></td></tr></table></figure><blockquote><p>加载或下载数据集</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torchvision<br>dataset_trans = torchvision.transforms.Compose([<br>    torchvision.transforms.ToTensor()<br>])<br>train_set = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>, train=<span class="hljs-literal">True</span>, transform=dataset_trans, download=<span class="hljs-literal">False</span>)<br>test_set = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>, train=<span class="hljs-literal">False</span>, transform=dataset_trans, download=<span class="hljs-literal">False</span>)<br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    img_tensor, target = test_set[i]<br>    writer.add_image(<span class="hljs-string">&quot;test_set&quot;</span>, img_tensor, i)<br>writer.close()<br></code></pre></td></tr></table></figure><h3 id="1-2-DataLoder"><a href="#1-2-DataLoder" class="headerlink" title="1.2 DataLoder"></a>1.2 DataLoder</h3><blockquote><p>加载数据集将多个数据 Tensor 和和标签分别打包成一个大的整体 batch</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br>train_set = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>,train=<span class="hljs-literal">True</span>,transform=torchvision.transforms.ToTensor(),download=<span class="hljs-literal">False</span>)<br>test_set = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>,train=<span class="hljs-literal">False</span>,transform=torchvision.transforms.ToTensor(),download=<span class="hljs-literal">False</span>)<br>test_loder = DataLoader(dataset=test_set,batch_size=<span class="hljs-number">64</span>,shuffle=<span class="hljs-literal">True</span>,num_workers=<span class="hljs-number">0</span>,drop_last=<span class="hljs-literal">False</span>)<br><span class="hljs-comment"># for data in test_loder:</span><br><span class="hljs-comment">#   imgs,target = data</span><br><span class="hljs-comment">#   print(imgs.shape,target)</span><br><span class="hljs-comment">#   print(type(imgs))</span><br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>  step = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> test_loder:<br>      imgs,targets = data<br>      <span class="hljs-comment"># imgs = imgs.permute(0, 2, 3, 1)</span><br>      writer.add_image(<span class="hljs-string">&quot;epoch_&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch), imgs, step, dataformats=<span class="hljs-string">&#x27;NCHW&#x27;</span>)<br>      step+=<span class="hljs-number">1</span><br>writer.close()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308172314315.png" alt="image.png|400"></p><blockquote><p>[!NOTE] Tip</p><ul><li><code>shuttle = true</code>，则每轮打包成 batch 的数据顺序不同，提高训练效果</li><li><code>writer.add_image(&quot;epoch_&#123;&#125;&quot;.format(epoch), imgs, step, dataformats=&#39;NCHW&#39;)</code> 需要指定图片数据类型 <code>dataformats</code></li></ul></blockquote><h2 id="2-TensorBoard"><a href="#2-TensorBoard" class="headerlink" title="2. TensorBoard"></a>2. TensorBoard</h2><blockquote><p>TensorBoard 是一个用于可视化和监控机器学习模型训练过程的工具。它可以帮助您跟踪实验指标（如损失和准确率）、呈现模型计算图以及将嵌入向量投影到较低维度的空间等[1]。以下是使用 TensorBoard 的一般步骤：</p></blockquote><ol><li><p>安装 TensorBoard：您可以使用 pip 安装 TensorBoard，例如 <code>pip install tensorboard</code>。</p></li><li><p>导入 TensorBoard：在 Python 代码中，导入 TensorBoard 库，例如 <code>import tensorflow as tf</code>。</p></li><li><p>在代码中添加 TensorBoard 回调：在您的机器学习模型训练代码中，添加 TensorBoard 回调函数。这将允许 TensorBoard 在训练过程中记录指定的指标和数据。</p></li><li><p>启动 TensorBoard 服务器：在终端中，使用命令 <code>tensorboard --logdir=&lt;log_directory&gt;</code> 启动 TensorBoard 服务器。其中，<code>&lt;log_directory&gt;</code> 是您保存 TensorBoard 日志文件的目录。</p></li><li><p>在浏览器中查看 TensorBoard：在浏览器中输入 <code>http://localhost:6006</code>，您将能够查看 TensorBoard 的可视化界面。</p></li></ol><blockquote><p>在 TensorBoard 界面中，您可以查看训练过程中的损失曲线、准确率曲线等指标图表。您还可以查看模型计算图、嵌入向量的投影等[1]。</p></blockquote><h3 id="2-1-绘图"><a href="#2-1-绘图" class="headerlink" title="2.1 绘图"></a>2.1 绘图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br>writer  = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    writer.add_scalar(<span class="hljs-string">&quot;y=x&quot;</span>,i,i)<br>writer.close()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308161754456.png" alt="image.png|500"></p><h3 id="2-2-添加图片"><a href="#2-2-添加图片" class="headerlink" title="2.2 添加图片"></a>2.2 添加图片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>writer  = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br>img_path = <span class="hljs-string">&quot;dataset/train/ants_image/1030023514_aad5c608f9.jpg&quot;</span><br>img_pil = Image.<span class="hljs-built_in">open</span>(img_path)<br>img_array = np.array(img_pil)<br>writer.add_image(<span class="hljs-string">&quot;ant_test&quot;</span>,img_array,<span class="hljs-number">2</span>,dataformats=<span class="hljs-string">&#x27;HWC&#x27;</span>)<br>writer.close()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308161755844.png" alt="image.png|400"></p><h2 id="3-Transforms"><a href="#3-Transforms" class="headerlink" title="3. Transforms"></a>3. Transforms</h2><h3 id="3-1-ToTensor"><a href="#3-1-ToTensor" class="headerlink" title="3.1 ToTensor"></a>3.1 ToTensor</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308162052347.png" alt="image.png|500"></p><blockquote><p>通过 transforms. ToTensor 去看两个问题</p><ol><li>transforms 该如何使用 (python)？</li><li>为什么我们需要 Tensor 数据类型？</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> cv2<br>img_path = <span class="hljs-string">&quot;./dataset/train/ants_image/0013035.jpg&quot;</span><br>img_PIL=Image.<span class="hljs-built_in">open</span>(img_path)<br>img_cv = cv2.imread(img_path)<br>transform_tensor = transforms.ToTensor()<br>img_tensor = transform_tensor(img_cv)<br><span class="hljs-built_in">print</span>(img_tensor.shape)<br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br>writer.add_image(<span class="hljs-string">&quot;tensor_image&quot;</span>,img_tensor)<br>writer.close()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308171038445.png" alt="image.png|400"></p><blockquote><p>[!NOTE] Tips</p><ol><li><strong>cv 2 的 imread</strong> 读取的图片类型为 <code>ndarray</code></li><li><strong>PIL 的 Image. open</strong> 读取的图片类型为 <code>JpegImageFile</code></li></ol></blockquote><h3 id="3-2-Compose"><a href="#3-2-Compose" class="headerlink" title="3.2 Compose"></a>3.2 Compose</h3><blockquote><p>Compose 类是将多种 transforms 操作叠加在一起, 初始化 compose 类后, 执行__call__​​方法循环执行组合操作</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">transform_compose = transforms.Compose([transforms.CenterCrop(<span class="hljs-number">10</span>),transforms.ToTensor(),transforms.ConvertImageDtype(torch.<span class="hljs-built_in">float</span>),])<br>img_compose = transform_compose(img_PIL)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(img_compose))<br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br>writer.add_image(<span class="hljs-string">&quot;compose_tensor_image&quot;</span>,img_compose)<br>writer.close()<br></code></pre></td></tr></table></figure><h3 id="3-3-Normalize"><a href="#3-3-Normalize" class="headerlink" title="3.3 Normalize"></a>3.3 Normalize</h3><blockquote><p>对图像进行正则化, 传参包括各通道均值和标准差</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">trans_normalize = transforms.Normalize([<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>],[<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>])<br>img_norm = trans_normalize(img_tensor)<br><span class="hljs-built_in">print</span>(img_norm[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])<br>writer.add_image(<span class="hljs-string">&quot;Normalize&quot;</span>,img_norm)<br></code></pre></td></tr></table></figure><p><img src="!%5B%5D(https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308171425731.png)" alt="image"></p><h3 id="3-4-Resize"><a href="#3-4-Resize" class="headerlink" title="3.4 Resize"></a>3.4 Resize</h3><blockquote><p>改变 PILImage 图像尺寸</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<br><span class="hljs-comment"># 将图像缩放到256x256</span><br>trans_resize= transforms.Resize(<span class="hljs-number">256</span>) <br><span class="hljs-comment"># 将图像按比例缩放,短边为256</span><br>trans_resize= transforms.Resize(size=(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>), interpolation=Image.BICUBIC)<br><span class="hljs-comment"># 最长边不超过256,短边按2:1的比例缩放 </span><br>trans_resize= transforms.Resize(max_size=<span class="hljs-number">256</span>, ratio=<span class="hljs-number">2</span>)<br>img_resize = trans_resize(img_tensor)<br><span class="hljs-built_in">print</span>(img_resize.shape)<br></code></pre></td></tr></table></figure><h3 id="3-5-RandomCrop"><a href="#3-5-RandomCrop" class="headerlink" title="3.5 RandomCrop"></a>3.5 RandomCrop</h3><blockquote><p>随机裁剪图像, 指定裁剪后的图像大小进行随机裁剪, 支持输入格式为 PILImage 和 Tensor​​</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">trans_randomcrop = transforms.RandomCrop(<span class="hljs-number">512</span>)<br>img_randomcrop = trans_randomcrop(img_tensor)<br><span class="hljs-built_in">print</span>(img_randomcrop.shape)<br>writer.add_image(<span class="hljs-string">&quot;randomcrop&quot;</span>,img_randomcrop)<br></code></pre></td></tr></table></figure><p>​​ <img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308171458436.png" alt="|400"> ​<br>​​</p><h2 id="神经网络基本骨架"><a href="#神经网络基本骨架" class="headerlink" title="神经网络基本骨架"></a>神经网络基本骨架</h2><h3 id="4-1-nn-module"><a href="#4-1-nn-module" class="headerlink" title="4.1 nn_module"></a>4.1 nn_module</h3><blockquote><p>module 是是所有网络模块的<strong>基类</strong>，必须继承该类并重写部分方法，构造方法、前向传播等</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch  <br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Simple_Nn</span>(nn.Module):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>) -&gt; <span class="hljs-literal">None</span>:  <br>        <span class="hljs-built_in">super</span>().__init__(*args, **kwargs)  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):  <br>        output = <span class="hljs-built_in">input</span> + <span class="hljs-number">1</span>  <br>        <span class="hljs-keyword">return</span> output  <br>simple_nn = Simple_Nn()  <br><span class="hljs-built_in">input</span> = torch.tensor(<span class="hljs-number">1.0</span>)  <br>output = simple_nn(<span class="hljs-built_in">input</span>)  <br><span class="hljs-built_in">print</span>(output)<br></code></pre></td></tr></table></figure><h3 id="4-2-nn-Conv2d（卷积）"><a href="#4-2-nn-Conv2d（卷积）" class="headerlink" title="4.2 nn.Conv2d（卷积）"></a>4.2 nn.Conv2d（卷积）</h3><blockquote><p>卷积层的使用，Conv2d是神经网络结构中的二维卷积结构，也是最常用的模块之一。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch  <br><span class="hljs-keyword">import</span> torchvision  <br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn  <br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Conv2d, MaxPool2d, ReLU  <br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader  <br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter  <br>  <br>test_sets = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>, train=<span class="hljs-literal">False</span>,  <br>                                         transform=torchvision.transforms.ToTensor(),  <br>                                         download=<span class="hljs-literal">True</span>)  <br>dataloader = DataLoader(test_sets, batch_size=<span class="hljs-number">64</span>, shuffle=<span class="hljs-literal">True</span>)  <br>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">My_Cnn</span>(nn.Module):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, </span>):  <br>        <span class="hljs-built_in">super</span>(My_Cnn, self).__init__()  <br>        self.conv1 = Conv2d(in_channels=<span class="hljs-number">3</span>, out_channels=<span class="hljs-number">6</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)  <br>        <span class="hljs-comment"># self.maxpool1 = MaxPool2d(6, stride=2, padding=0)  </span><br>        <span class="hljs-comment"># self.nonlinear1 = ReLU()  </span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):  <br>        map1 = self.conv1(x)  <br>        output = self.nonlinear1(map1)  <br>        <span class="hljs-keyword">return</span> output  <br>  <br>  <br>mycnn = My_Cnn()  <br><span class="hljs-built_in">print</span>(mycnn)  <br>step = <span class="hljs-number">0</span>  <br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)  <br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:  <br>    imgs, targets = data  <br>    output = mycnn(imgs)  <br>    output = torch.reshape(output, [-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>])  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Batch:&quot;</span> + <span class="hljs-built_in">str</span>(step), imgs.shape)  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Batch:&quot;</span> + <span class="hljs-built_in">str</span>(step), output.shape)  <br>    writer.add_image(<span class="hljs-string">&quot;input_img&quot;</span>, imgs, step, dataformats=<span class="hljs-string">&quot;NCHW&quot;</span>)  <br>    writer.add_image(<span class="hljs-string">&quot;output_img&quot;</span>, output, step, dataformats=<span class="hljs-string">&quot;NCHW&quot;</span>)  <br>    step += <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><p><strong>Tensorboard结果：</strong></p><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308261350971.png" alt="|350"></p><hr><h3 id="4-3-nn-MaxPool2d（最大池化）"><a href="#4-3-nn-MaxPool2d（最大池化）" class="headerlink" title="4.3 nn.MaxPool2d（最大池化）"></a>4.3 nn.MaxPool2d（最大池化）</h3><blockquote><p>最大池化保持特征图通道数不变的前提下，大小减少约一半左右，起到减小网络参数，提取关键特征，加快收敛速度（本身不具备特征提取作用）。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch  <br><span class="hljs-keyword">import</span> torchvision  <br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> MaxPool2d  <br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn  <br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader  <br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter  <br>  <br>test_sets = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>, train=<span class="hljs-literal">False</span>,  <br>                                         transform=torchvision.transforms.ToTensor(),  <br>                                         download=<span class="hljs-literal">True</span>)  <br>dataloader = DataLoader(test_sets, batch_size=<span class="hljs-number">64</span>, shuffle=<span class="hljs-literal">True</span>)  <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NiuMa</span>(nn.Module):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-built_in">super</span>(NiuMa, self).__init__()  <br>        self.maxpool = MaxPool2d(<span class="hljs-number">3</span>, ceil_mode=<span class="hljs-literal">True</span>)  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):  <br>        <span class="hljs-keyword">return</span> self.maxpool(<span class="hljs-built_in">input</span>)  <br>  <br>  <br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)  <br>niuma = NiuMa()  <br>step = <span class="hljs-number">0</span>  <br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:  <br>    imgs, targets = data  <br>    output = niuma(imgs)  <br>    writer.add_image(<span class="hljs-string">&quot;input_maxpool&quot;</span>, imgs, step, dataformats=<span class="hljs-string">&quot;NCHW&quot;</span>)  <br>    writer.add_image(<span class="hljs-string">&quot;output_maxpool&quot;</span>, output, step, dataformats=<span class="hljs-string">&quot;NCHW&quot;</span>)  <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;batch:&quot;</span> + <span class="hljs-built_in">str</span>(step), imgs.shape, output.shape)  <br>    step += <span class="hljs-number">1</span>  <br>  <br>writer.close()<br><br></code></pre></td></tr></table></figure><p><strong>Tensorboard结果：</strong><br><em>输入图像</em><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308261448451.png" alt="image.png | 225"><br><em>最大池化输出图像</em><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308261448510.png" alt="image.png | 250"></p><hr><h3 id="4-4-非线性激活"><a href="#4-4-非线性激活" class="headerlink" title="4.4 非线性激活"></a>4.4 非线性激活</h3><blockquote><p>非线性激活对输入进行非线性处理，从而拟合出需要的模型，非线性越多拟合效果越好，但容易过拟合，<code>ReLU激活函数</code>是最常用的非线性激活函数。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch  <br><span class="hljs-keyword">import</span> torchvision.datasets  <br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn  <br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> ReLU, Sigmoid  <br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader  <br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter  <br>    <br>dataset = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>, train=<span class="hljs-literal">False</span>,  <br>                                       transform=torchvision.transforms.ToTensor(), download=<span class="hljs-literal">True</span>)  <br>dataloader = DataLoader(dataset, batch_size=<span class="hljs-number">64</span>, shuffle=<span class="hljs-literal">True</span>)  <br>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NiuMa</span>(nn.Module):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-built_in">super</span>(NiuMa, self).__init__()  <br>        self.relu = ReLU()  <br>        self.sigmoid = Sigmoid()  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):  <br>        <span class="hljs-keyword">return</span> self.sigmoid(<span class="hljs-built_in">input</span>)  <br>  <br>  <br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)  <br>niuma = NiuMa()  <br>step = <span class="hljs-number">0</span>  <br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:  <br>    imgs, targets = data  <br>    output = niuma(imgs)  <br>    writer.add_image(<span class="hljs-string">&quot;output_sigmoid&quot;</span>, output, global_step=step, dataformats=<span class="hljs-string">&quot;NCHW&quot;</span>)  <br>    step += <span class="hljs-number">1</span>  <br>writer.close()<br><br></code></pre></td></tr></table></figure><p><strong>TensorBoard结果：</strong></p><p><em>Sigmoid非线性激活</em><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308261517218.png" alt="image.png|350"></p><h3 id="4-5-线性层"><a href="#4-5-线性层" class="headerlink" title="4.5 线性层"></a>4.5 线性层</h3><blockquote><p>线性层一般为网络最后的全连接层，分类问题则经过softmax得到各个类别的概率。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch  <br><span class="hljs-keyword">import</span> torchvision.datasets  <br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn  <br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Linear  <br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader  <br>  <br>dataset = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./data/datasets/CIFAR&quot;</span>, train=<span class="hljs-literal">False</span>,  <br>                                       transform=torchvision.transforms.ToTensor(), download=<span class="hljs-literal">True</span>)  <br>dataloader = DataLoader(dataset, batch_size=<span class="hljs-number">64</span>, shuffle=<span class="hljs-literal">True</span>, drop_last=<span class="hljs-literal">True</span>)  <br>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NiuMa</span>(nn.Module):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-built_in">super</span>(NiuMa, self).__init__()  <br>        <span class="hljs-comment"># Linear的参数为输入特征数和输出特征数  </span><br>        self.linear = Linear(<span class="hljs-number">196608</span>, <span class="hljs-number">10</span>)  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):  <br>        <span class="hljs-keyword">return</span> self.linear(<span class="hljs-built_in">input</span>)  <br>  <br>  <br>niuma = NiuMa()  <br>  <br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:  <br>    imgs, targets = data  <br>    imgs = torch.flatten(imgs)  <br>    <span class="hljs-built_in">print</span>(imgs.shape)  <br>    output = niuma(imgs)  <br>    <span class="hljs-built_in">print</span>(output.shape, output)<br><br></code></pre></td></tr></table></figure><h1 id="常用函数手册"><a href="#常用函数手册" class="headerlink" title="常用函数手册"></a>常用函数手册</h1><p>![[pytorch常用函数手册.pdf]]</p><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p><a href="https://www.bilibili.com/video/BV1hE411t7RN?p=6&vd_source=9c896fa9c3f9023797e8efe7be0c113e">PyTorch快速入门（小土堆）</a></p>]]></content>
    
    
    <summary type="html">Machine and Deep learning</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="DL" scheme="https://alleyf.github.io/tags/DL/"/>
    
  </entry>
  
  <entry>
    <title>OS</title>
    <link href="https://alleyf.github.io/2023/05/8e2ac1a55f44.html"/>
    <id>https://alleyf.github.io/2023/05/8e2ac1a55f44.html</id>
    <published>2023-05-21T12:24:20.000Z</published>
    <updated>2023-07-04T14:08:44.088Z</updated>
    
    
    <summary type="html">Some knowledge about os.</summary>
    
    
    
    <category term="CS" scheme="https://alleyf.github.io/categories/CS/"/>
    
    
    <category term="CS" scheme="https://alleyf.github.io/tags/CS/"/>
    
    <category term="OS" scheme="https://alleyf.github.io/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot启示录</title>
    <link href="https://alleyf.github.io/2023/04/218510a8c5b9.html"/>
    <id>https://alleyf.github.io/2023/04/218510a8c5b9.html</id>
    <published>2023-04-28T08:37:54.000Z</published>
    <updated>2023-10-05T07:25:50.738Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-开发环境热部署"><a href="#1-开发环境热部署" class="headerlink" title="1.开发环境热部署"></a>1.开发环境热部署</h1><h2 id="1-说明"><a href="#1-说明" class="headerlink" title="1. 说明"></a>1. 说明</h2><blockquote><ol><li>在实际的项目开发调试过程中会频繁地修改后台类文件，导致需要重新编译、重新启动，整个过程非常麻烦，影响开发效率。</li><li>Spring Boot 提供了 spring-boot-devtools 组件，使得无须手动重启 SpringBoot 应用即可重新编译、启动项目，大大缩短编译启动的时间。devtools 会监听 classpath 下的文件变动，触发 Restart 类加载器重新加载该类,从而实现类文件和属性文件的热部署。</li><li>并不是所有的更改都需要重启应用 (如静态资源、视图模板)，可以通过设置spring. devtools. restart. exclude 属性来指定一些文件或目录的修改不用重启应用</li></ol></blockquote><h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><blockquote><p>在 <strong>pom. xml</strong> 配置文件中添加 <strong>dev-tools 依赖</strong>。<br>使用 <strong>optional=true</strong> 表示依赖<strong>不会传递</strong>，即该项目依赖 devtools; 其他项目如果引入此项目生成的 JAR 包，则不会包含 devtools</p></blockquote><h3 id="1-pom-xml"><a href="#1-pom-xml" class="headerlink" title="1.pom. xml"></a>1.pom. xml</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>&lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h3 id="2-application-properties"><a href="#2-application-properties" class="headerlink" title="2. application. properties"></a>2. application. properties</h3><blockquote><p>在 application. properties 中配置 <strong>devtools.</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">#热部署生效<br>spring.devtools.restart.enabLed=<span class="hljs-literal">true</span><br>#设置重启目录<br>spring.devtooLs.restart.additional-paths=src/main/java<br>#设置classpath目录下的 WEB-INF 文件夹内容修改不重启<br>spring.devtooLs.restart.exclude=<span class="hljs-keyword">static</span><span class="hljs-comment">/**</span><br></code></pre></td></tr></table></figure><ul><li>如果使用了<span style="background:rgba(240, 200, 0, 0.2)"> Eclipse</span>, 那么在修改完代码并保存之后，项目将自动编译并触发重启，而如果使用了 <span style="background:rgba(160, 204, 246, 0.55)">IntelliJ IDEA</span>, 还需要配置项目自动编译。</li><li>打开<font color="#245bdb"> Settings </font>页面，在左边的菜单栏依次找到Build, Execution, Deployment-→Compile, 勾选 <font color="#ffc000">Build project automatically</font></li><li>按 <font color="#4bacc6">Ctrl+ Shift+ Alt+ /</font>快捷键调出 Maintenance 页面，单击 <font color="#9bbb59">Registry</font>, 勾选<font color="#8064a2">compiler.automake.allow.when.app.running </font>复选框 (可能找不到，修改设置为下图即可解决)。</li><li>做完这两步配置之后，若开发者再次在 IntelliJ IDEA 中修改代码，则项目会自动重启。</li></ul><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/20230428173445.png" alt="image.png|425"></p><h1 id="2-控制器"><a href="#2-控制器" class="headerlink" title="2. 控制器"></a>2. 控制器</h1><blockquote><ol><li>Spring Boot 提供了<font color="#f79646">@Controller</font> 和<font color="#c0504d">@RestController</font> 两种注解来标识此类负责<span style="background:rgba(240, 107, 5, 0.2)">接收和处理 HTTP 请求</span>。</li><li>如果请求的是<font color="#00b0f0">页面和数据</font>，使用<font color="#0070c0">@Controller </font>注解即可; 如果只是请求<font color="#ff0000">数据</font>,则可以使用<font color="#c00000">@RestController </font>注解。</li></ol></blockquote><h2 id="1-demo"><a href="#1-demo" class="headerlink" title="1.demo"></a>1.demo</h2><p>@ RestController 的用法<br>默认情况下，@RestController 注解会将返回的对象数据转换为 <strong>JSON 格式</strong>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><span class="hljs-meta">@RequestMapping</span> (<span class="hljs-string">&quot;/user&quot;</span>)<br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span> <span class="hljs-params">()</span>&#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>user.setUsername (<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>user.setPassword (<span class="hljs-string">&quot;123&quot;</span>) ;<br><span class="hljs-keyword">return</span> user;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-路由映射"><a href="#2-路由映射" class="headerlink" title="2.路由映射"></a>2.路由映射</h2><blockquote><p>@RequestMapping 注解主要负责 URL 的路由映射。它可以添加Controller类或者具体的方法上。<br>如果添加在 Controller 类上，则这个 Controller 中的所有路由映射都将会加上此映射规则，如果添加在方法上，则只对当前方法生效。<br>@RequestMapping 注解包含很多属性参数来定义 HTTP 的请求映射规则。常用的属性参数如下:<br><span style="background:#d3f8b6">- value: 请求 URL 的路径, 支持 URL 模板、正则表达式</span><br><span style="background:#d3f8b6">- method: HTTP 请求方法</span></p></blockquote><ul><li>consumes:请求的媒体类型 (Content- Type)，如 application/json</li><li>produces: 响应的媒体类型<br><span style="background:#d3f8b6">- params, headers: 请求的参数及请求头的值</span></li></ul><h3 id="1-路由规则"><a href="#1-路由规则" class="headerlink" title="1. 路由规则"></a>1. 路由规则</h3><ol><li>@RequestMapping 的 <font color="#0070c0">value </font>属性用于<font color="#0070c0">匹配 URL 映射</font>，value 支持简单表达式</li><li>@RequestMapping (“/user”)</li><li>@RequestMapping 支持使用通配符匹配 URL，用于统一映射某些 URL 规则类似的请求: @RequestMapping (“/getJson/*. json”), 当在浏览器中请求/getJson/a.json 或者/getJson/b.json 时都会匹配到后台的 Json 方法</li><li>@RequestMapping 的通配符匹配非常简单实用，支持**<span style="background:#b1ffff">“*“  “?” “**“</span>** 等通配符</li><li>符号<font color="#ffc000"> “*“ </font>匹配<font color="#ffc000">任意字符</font>，符号 <font color="#00b050">“**“</font> 匹配<font color="#00b050">任意路径</font>，符号<font color="#00b0f0"> “?” </font>匹配<font color="#0070c0">单个字符</font>。有通配符的优先级低于没有通配符的，比如/user/addjson 比/user/* .json 优先匹配。有“**” 通配符的优先级低于有”*“ 通配符的。</li></ol><h3 id="2-Method-匹配"><a href="#2-Method-匹配" class="headerlink" title="2. Method 匹配"></a>2. Method 匹配</h3><ul><li>HTTP 请求 Method 有 <span style="background:#affad1">GET、POST、 PUT、DELETE </span>等方式。HTTP 支持的全部Method</li><li>@RequestMapping 注解提供了 method 参数指定请求的 Method 类型，包括<span style="background:rgba(205, 244, 105, 0.55)">RequestMethod. GET、RequestMethod. POST、RequestMethod.DELETE、RequestMethod. PUT</span> 等值，分别对应 HTTP 请求的 Method<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span> (value = <span class="hljs-string">&quot;/getData&quot;</span> , method = RequestMethod.GET)<br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getData</span> <span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>Method 匹配也可以使用<span style="background:rgba(3, 135, 102, 0.2)">@GetMapping、@PostMapping </span>等注解代替。</li></ul><h3 id="3-参数传递"><a href="#3-参数传递" class="headerlink" title="3. 参数传递"></a>3. 参数传递</h3><h4 id="1-get-请求"><a href="#1-get-请求" class="headerlink" title="1. get 请求"></a>1. get 请求</h4><blockquote><p>视图函数定义 query_params 路由参数，函数体内可以直接获取该参数。</p></blockquote><p>demo：</p><p>方式 1 同参（参数可有可无都能成功响应）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;  <br><span class="hljs-comment">// get注解  </span><br><span class="hljs-meta">@RequestMapping(value = &quot;/index1&quot;,method = RequestMethod.GET)</span><br><span class="hljs-comment">// @GetMapping(&quot;/index1&quot;)  </span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello1</span><span class="hljs-params">(String name)</span>&#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;欢迎您：&quot;</span>+name;  <br>&#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>方式 2 不同参（参数必须携带，否则 400 错误响应）</p><blockquote><p>将参数 usrname 映射为 name，默认<font color="#0070c0"> require=true</font>（必须携带参数否则报错），设置为 false 可以<font color="#6425d0">不携带参数访问</font><br><code>public String hello2(@RequestParam(value = &quot;usrname&quot;,required = false) String name)</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/index2&quot;,method = RequestMethod.GET)</span>  <br><span class="hljs-comment">// @GetMapping(&quot;/index&quot;)  </span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello2</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;usrname&quot;)</span> String name)</span>&#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;欢迎您：&quot;</span>+name;  <br>&#125;<br></code></pre></td></tr></table></figure><p>通配符匹配路由：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;test/*&quot;)</span>  <span class="hljs-comment">// 匹配同级任何路由</span><br><span class="hljs-meta">@GetMapping(&quot;test/**&quot;)</span>  <span class="hljs-comment">// 匹配任何路由（包括子级）</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;匹配同级任意路径&quot;</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-Post-请求"><a href="#2-Post-请求" class="headerlink" title="2.Post 请求"></a>2.Post 请求</h4><h5 id="1-urlencode-格式数据"><a href="#1-urlencode-格式数据" class="headerlink" title="1. urlencode 格式数据"></a>1. urlencode 格式数据</h5><p>方式 1 直接传数据：</p><blockquote><p>适合参数少的情景</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;login/&quot;)</span>  <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">(String name,String pwd)</span>&#123;  <br>System.out.println(<span class="hljs-string">&quot;name:&quot;</span>+name);  <br>System.out.println(<span class="hljs-string">&quot;pwd:&quot;</span>+pwd);  <br><span class="hljs-keyword">return</span> name!=<span class="hljs-literal">null</span> &amp;&amp; pwd!=<span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;登陆成功&quot;</span> : <span class="hljs-string">&quot;登陆失败&quot;</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p>方式 2 对象传数据：</p><blockquote><p>适合参数多的情景，<font color="#6425d0">User 为实体类</font></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;login2/&quot;)</span>  <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">login2</span><span class="hljs-params">(User user)</span> &#123;  <br>System.out.println(<span class="hljs-string">&quot;name:&quot;</span> + user.getUsername());  <br>System.out.println(<span class="hljs-string">&quot;pwd:&quot;</span> + user.getPassword());  <br>System.out.println(user);  <br><span class="hljs-keyword">return</span> user.getUsername() != <span class="hljs-literal">null</span> &amp;&amp; user.getPassword() != <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;登陆成功&quot;</span> : <span class="hljs-string">&quot;登陆失败&quot;</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] Tips<br><span style="background:#ff4d4f">上述两种方式，发送的 data 数据必须经过 urlencode 编码，否则接收不到。</span></p></blockquote><h5 id="2-json-格式数据"><a href="#2-json-格式数据" class="headerlink" title="2. json 格式数据"></a>2. json 格式数据</h5><blockquote><p>需要给视图函数形参中添加注解<font color="#245bdb">@RequestBody</font>，且 json data 中的参数键名需要与后端中的实体类的属性并一致。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;login3/&quot;)</span>  <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">login3</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;  <br>System.out.println(<span class="hljs-string">&quot;name:&quot;</span> + user.getUsername());  <br>System.out.println(<span class="hljs-string">&quot;pwd:&quot;</span> + user.getPassword());  <br>System.out.println(user);  <br><span class="hljs-keyword">return</span> user.getUsername() != <span class="hljs-literal">null</span> &amp;&amp; user.getPassword() != <span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;登陆成功&quot;</span> : <span class="hljs-string">&quot;登陆失败&quot;</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/20230428185132.png" alt="image.png|500"></p><h1 id="3-文件上传"><a href="#3-文件上传" class="headerlink" title="3. 文件上传"></a>3. 文件上传</h1><h2 id="1-静态资源访问"><a href="#1-静态资源访问" class="headerlink" title="1. 静态资源访问"></a>1. 静态资源访问</h2><ol><li>使用 IDEA 创建 Spring Boot 项目，会默认创建出 <font color="#245bdb">classpath:/static/</font>目录, 静态资源一般放在这个目录下即可。</li><li>如果默认的静态资源过滤策略不能满足开发需求，也可以自定义静态资源过滤策略。</li><li>在 <span style="background:#d3f8b6">application. properties </span>中直接定义过滤规则和静态资源位置: </li></ol><ul><li><code>spring.mvc.static-path-pattern=/static/\*\*</code> </li><li><code>spring.web.resources.static-locations=classpath:/static/</code></li></ul><ol start="4"><li>过滤规则为<font color="#00b0f0">/static/**</font>，静态资源位置为<font color="#00b0f0"> classpath:/static/</font></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#设置静态路径过滤规则  </span><br><span class="hljs-attr">spring.mvc.static-path-pattern</span>=<span class="hljs-string">images/**  </span><br><span class="hljs-attr">spring.web.resources.static-locations</span>=<span class="hljs-string">classpath:/static/images/</span><br></code></pre></td></tr></table></figure><h2 id="2-文件上传"><a href="#2-文件上传" class="headerlink" title="2. 文件上传"></a>2. 文件上传</h2><h3 id="1-文件上传原理"><a href="#1-文件上传原理" class="headerlink" title="1. 文件上传原理"></a>1. 文件上传原理</h3><ul><li>表单的<font color="#ffff00"> enctype 属性</font>规定在发送到服务器之前对表单数据的<font color="#ffff00">编码方式</font>。</li><li>当表单的 enctype=”<font color="#ffc000">application/x-www-form-urlencoded</font>“ (默认)时,<br>form 表单中的数据格式为: <font color="#ffc000">key=value&amp;key=value</font></li><li>当表单的 enctype=”<font color="#00b0f0">multipart/form-data</font>“时，其传输数据形式如下：<br><img src="https://s2.loli.net/2023/04/28/jh6pWVrx2yZSB43.png" alt="image.png|425"></li></ul><h3 id="2-配置文件大小"><a href="#2-配置文件大小" class="headerlink" title="2. 配置文件大小"></a>2. 配置文件大小</h3><ul><li>Spring Boot 工程嵌入的 tomcat 限制了请求的文件大小，每个文件的配置最大为 1 Mb，单次请求的文件的总数不能大于 10 Mb.</li><li>要更改这个默认值需要在配置文件 (如<font color="#00b0f0"> application.properties</font>) 中加入两个配置<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">spring.servlet.multipart.max-file-size=10MB<br>spring.servlet.multipart.max-request-size=10MB<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>当表单的 enctype= “<font color="#9bbb59">multipart/form-data</font>“时, 可以使用<font color="#9bbb59"> MultipartFile </font>获取上传的文件数据，再通过 <font color="#9bbb59">transferTo </font>方法将其写入到磁盘中</p></blockquote><p>demo：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.helloworld.controller;  <br>  <br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServlet;  <br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;  <br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;  <br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;  <br>  <br><span class="hljs-keyword">import</span> java.io.File;  <br><span class="hljs-keyword">import</span> java.io.IOException;  <br>  <br><span class="hljs-meta">@RestController</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUploadController</span> &#123;  <br><span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span>  <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(String name, MultipartFile avatar, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>System.out.println(name);  <br>System.out.println(<span class="hljs-string">&quot;filename:&quot;</span> + avatar.getOriginalFilename());  <br><span class="hljs-comment">// 获取文件类型  </span><br>System.out.println(avatar.getContentType());  <br><span class="hljs-comment">// 获取当前程序运行路径，部署时动态改变  </span><br><span class="hljs-comment">// String path = request.getServletContext().getRealPath(&quot;/upload/&quot;);  </span><br><span class="hljs-comment">// 固定为本地地址便于测试</span><br><span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\IDEAProjects\\helloworld\\src\\main\\resources\\static\\images\\&quot;</span>;  <br>System.out.println(path);  <br>saveFile(avatar, path);  <br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;上传成功&quot;</span>;  <br>&#125;  <br>  <br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveFile</span><span class="hljs-params">(MultipartFile avatar, String path)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br><span class="hljs-comment">// 获取上传文件夹  </span><br><span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path);  <br><span class="hljs-comment">// 判断文件夹是否存在，不存在则创建  </span><br><span class="hljs-keyword">if</span> (!dir.exists()) &#123;  <br>dir.mkdir();  <br>&#125;  <br><span class="hljs-comment">// 实例化上传文件  </span><br><span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path + avatar.getOriginalFilename());  <br>System.out.println(file.getPath());  <br><span class="hljs-comment">// 保存上传的文件  </span><br>avatar.transferTo(file);  <br>&#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-拦截器"><a href="#3-拦截器" class="headerlink" title="3. 拦截器"></a>3. 拦截器</h2><p>简介：</p><blockquote><ol><li>拦截器在 Web 系统中非常常见，对于某些全局统一-的操作，我们可以把它提取到拦截器中实现。总结起来，拦截器大致有以下几种使用场景:</li><li><font color="#7030a0">权限检查:</font> 如登录检测，进入处理程序检测是否登录，如果没有，则直接返回登录页面。<br>3<font color="#7030a0">. 性能监控: </font>有时系统在某段时间莫名其妙很慢，可以通过拦截器在进入处理程序之前记录开始时间，在处理完后记录结束时间，从而得到该请求的处理时间</li><li><font color="#548dd4">通用行为: </font>读取 cookie 得到用户信息并将用户对象放入请求，从而方便后续流程使用，还有提取 Locale、Theme 信息等，只要是多个处理程序都需要的，即可使用拦截器实现。</li></ol></blockquote><blockquote><p>[!NOTE] tips</p><ol><li>Spring Boot 定义了 <span style="background:#d2cbff">HandlerInterceptor 接口</span>来实现自定义拦截器的功能</li><li>HandlerInterceptor 接口定义了<span style="background:#40a9ff"> preHandle、postHandle、 afterCompletion</span> 三种方法，通过重写这三种方法实现请求前、请求后等操作<br><img src="https://s2.loli.net/2023/04/29/dvnpCAF81RxlBK5.png" alt="image.png|375"></li></ol></blockquote><h3 id="1-拦截器定义"><a href="#1-拦截器定义" class="headerlink" title="1. 拦截器定义"></a>1. 拦截器定义</h3><blockquote><p>类似于 django 的<font color="#4bacc6"> Midleware </font>中间件，控制请求。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">pub1ic <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">*在请求处理之前进行调用(Control1er方法调用之前)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@override</span><br>pub1ic <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServ1etRequest request, HttpServ1etResponse response, object handTer)</span><br><span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-keyword">if</span> (条件) &#123;<br>System.out.print1n(<span class="hljs-string">&quot;通过&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>System.out.print1n(<span class="hljs-string">&quot;不通过&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>返回为 true 则进入下一个拦截器，否则拒绝通过。</p></blockquote><h3 id="2-拦截器注册"><a href="#2-拦截器注册" class="headerlink" title="2. 拦截器注册"></a>2. 拦截器注册</h3><ul><li><span style="background:#affad1"> addPathPatterns </span>方法定义拦截的地址</li><li><span style="background:#b1ffff">excludePathPatterns </span>定义排除某些地址不被拦截</li><li>添加的一个拦截器没有 addPathPattern 任何一个 url 则<font color="#92d050">默认拦截所有请求</font></li><li>如果没有 excludePathPatterns 任何一个请求，则<font color="#92cddc">默认不放过任何一个请求</font></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;  <br><span class="hljs-meta">@Override</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;  <br><span class="hljs-comment">// 只拦截user路由下的所有路由  </span><br><span class="hljs-comment">// registry.addInterceptor(new LoginInterceptor()).addPathPatterns(&quot;/admin/**&quot;);  </span><br><span class="hljs-comment">// 拦截所有路由  </span><br>registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>());  <br>  <br>&#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-RESTful"><a href="#4-RESTful" class="headerlink" title="4. RESTful"></a>4. RESTful</h1><h2 id="1-RESTful-介绍"><a href="#1-RESTful-介绍" class="headerlink" title="1.RESTful 介绍"></a>1.RESTful 介绍</h2><ol><li>HTTP 提供了<font color="#4bacc6"> POST、GET、 PUT、DELETE</font> 等操作类型对某个 Web 资源进行 <font color="#4bacc6">Create、Read、 Update 和 Delete </font>操作。</li><li>一个 HTTP 请求除了利用 URI 标志目标资源之外，还需要通过 HTTP Method 指定针对该资源的操作类型，一些常见的 HTTP 方法及其在 RESTful 风格下的使用:</li></ol><p><img src="https://s2.loli.net/2023/04/29/wokjgHNQVc4TCSW.png" alt="image.png|425"></p><h3 id="HTTP-状态码"><a href="#HTTP-状态码" class="headerlink" title="HTTP 状态码"></a>HTTP 状态码</h3><ul><li>HTTP 状态码就是服务向用户返回的状态码和提示信息，客户端的每一次请求，服务都必须给出回应，回应包括<font color="#8064a2"> HTTP 状态码和数据</font>两部分。</li><li>HTTP 定义了 40 个标准状态码，可用于传达客户端请求的结果。状态码分为以下<br><font color="#f79646">5 个类别:</font><blockquote><p>1 xx: 信息，通信传输协议级信息<br>2 xx: 成功，表示客户端的请求已成功接受<br>3 xx: 重定向，表示客户端必须执行一些其他操作才能完成其请求<br>4 xx: 客户端错误，此类错误状态码指向客户端<br>5 xx: 服务器错误，服务器负责这写错误状态码</p></blockquote></li></ul><h2 id="2-构建-RESTful-应用接口"><a href="#2-构建-RESTful-应用接口" class="headerlink" title="2. 构建 RESTful 应用接口"></a>2. 构建 RESTful 应用接口</h2><p>Spring Boot 提供的<span style="background:rgba(240, 107, 5, 0.2)"> spring-boot-starter-web </span>组件完全支持开发 RESTful API, 提供了与 REST 操作方式 (GET、POST、 PUT、DELETE) 对应的注解。</p><ol><li><code>@GetMapping:</code> 处理 GET 请求，获取资源。</li><li><code>@PostMapping:</code> 处理 POST 请求，新增资源。</li><li><code>@PutMapping:</code> 处理 PUT 请求，更新资源。</li><li><code>@DeleteMapping:</code> 处理 DELETE 请求，删除资源。</li><li><code>@PatchMapping:</code> 处理 PATCH 请求，用于部分更新资源。</li></ol><blockquote><p>类似于 django 的视图装饰器</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> cLass UserController &#123;<br><span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserById</span> <span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> id)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;根据ID获取用户&quot;</span>;<br>&#125;<br><span class="hljs-meta">@PostMapping(&quot;/user&quot; )</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;添加用户&quot;</span>;<br>&#125;<br><span class="hljs-meta">@PutMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">update</span><span class="hljs-params">(User user)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;更新用户&quot;</span>;<br>&#125;<br><span class="hljs-meta">@DeleteMapping(&quot;/user/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> id)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot; 根据ID删除用户&quot;</span>;<br><span class="hljs-number">1</span>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="3-Swagger-生成-API-接口文档"><a href="#3-Swagger-生成-API-接口文档" class="headerlink" title="3. Swagger 生成 API 接口文档"></a>3. Swagger 生成 API 接口文档</h2><blockquote><ol><li>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务，是非常流行的 API 表达工具。</li><li>Swagger 能够自动生成完善的 RESTful API 文档，同时并根据后台代码的修改同步更新，同时提供完整的测试页面来调试 APl。</li></ol></blockquote><p><font color="#f79646">pom. xml 依赖配置:</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- swagger依赖--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>添加配置类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.helloworld.config;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;  <br><span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;  <br><span class="hljs-keyword">import</span> springfox.documentation.builders.PathSelectors;  <br><span class="hljs-keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;  <br><span class="hljs-keyword">import</span> springfox.documentation.service.ApiInfo;  <br><span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;  <br><span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;  <br><span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;  <br>  <br><span class="hljs-meta">@Configuration</span> <span class="hljs-comment">//告诉Spring容器， 这个类是一个配置类  </span><br><span class="hljs-meta">@EnableSwagger2</span> <span class="hljs-comment">//启用Swagger2功能  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;  <br><span class="hljs-meta">@Bean</span>  <br><span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span> &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)  <br>.apiInfo(apiInfo())  <br>.select()  <br><span class="hljs-comment">// com 包下所有API都交给Swagger2管理  </span><br>.apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com&quot;</span>))  <br>.paths(PathSelectors.any()).build();  <br>&#125;  <br>  <br><span class="hljs-comment">// API文档页面显示信息  </span><br><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()  <br>.title(<span class="hljs-string">&quot;演示项目API&quot;</span>) <span class="hljs-comment">//标题  </span><br>.description(<span class="hljs-string">&quot;学习Swagger2的演示项目&quot;</span>) <span class="hljs-comment">//描述  </span><br>.version(<span class="hljs-string">&quot;1.0&quot;</span>)  <br>.build();  <br>&#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>spring 3 的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--spring3版本的swagger依赖--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>配置文件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.helloworld.config;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;  <br>  <br><span class="hljs-keyword">import</span> io.swagger.v3.oas.models.OpenAPI;  <br><span class="hljs-keyword">import</span> io.swagger.v3.oas.models.info.Info;  <br>  <br>  <br><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenApiConfig</span> &#123;  <br>  <br><span class="hljs-meta">@Bean</span>  <br><span class="hljs-keyword">public</span> OpenAPI <span class="hljs-title function_">springOpenAPI</span><span class="hljs-params">()</span> &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAPI</span>().info(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>() <span class="hljs-comment">//  </span><br>.title(<span class="hljs-string">&quot;SpringDoc API Test&quot;</span>) <span class="hljs-comment">//  </span><br>.description(<span class="hljs-string">&quot;SpringDoc Simple Application Test&quot;</span>) <span class="hljs-comment">//  </span><br>.version(<span class="hljs-string">&quot;0.0.1&quot;</span>));  <br>&#125;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-注解"><a href="#1-注解" class="headerlink" title="1.注解"></a>1.注解</h3><p>swagger 常用注解如下图所示：</p><p><img src="https://s2.loli.net/2023/05/02/sgfWcYZxHa2rJKm.png" alt="image.png|375"></p><p>从 Springfox 迁移过来的，需要修改注解：</p><p><span style="background:rgba(3, 135, 102, 0.2)">&gt; 1. @Api → @Tag</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 2. @ApiIgnore → @Parameter (hidden = true) or @Operation (hidden = true) or @Hidden</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 3. @ApiImplicitParam → @Parameter</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 4. @ApiImplicitParams → @Parameters</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 5. @ApiModel → @Schema</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 6. @ApiModelProperty (hidden = true) → @Schema (accessMode = READ_ONLY)</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 7. @ApiModelProperty → @Schema</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 8. @ApiOperation (value = “foo”, notes = “bar”) → @Operation (summary = “foo”, description = “bar”)</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 9. @ApiParam → @Parameter</span><br><span style="background:rgba(3, 135, 102, 0.2)">&gt; 10. @ApiResponse (code = 404, message = “foo”) → @ApiResponse (responseCode = “404”, description = “foo”)</span></p><h3 id="2-访问-swagger"><a href="#2-访问-swagger" class="headerlink" title="2.访问 swagger"></a>2.访问 swagger</h3><ol><li>swagger 2： <a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></li><li>swagger 3: <ul><li><a href="http://localhost:8080/swagger-ui/index.html">http://localhost:8080/swagger-ui/index.html</a></li><li><a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></li></ul></li></ol><h1 id="5-MybatisPlus"><a href="#5-MybatisPlus" class="headerlink" title="5. MybatisPlus"></a>5. MybatisPlus</h1><h2 id="1-ORM-介绍"><a href="#1-ORM-介绍" class="headerlink" title="1.ORM 介绍"></a>1.ORM 介绍</h2><ul><li><p>ORM，（Object Relational Mapping，对象关系映射）是为了解决面向对象与关系数据库存在的互不匹配现象的一种技术。</p></li><li><p>ORM 通过使用描述对象和数据库之间映射的元数据将程序中的对象自动持久化到关系数据库中。</p></li><li><p>ORM 框架的本质是简化编程中操作数据库的编码。</p></li></ul><p><img src="https://s2.loli.net/2023/05/29/PcG5L8ZYouWhyp6.png" alt="image.png|350"></p><h2 id="2-MyBatis-Plus-介绍"><a href="#2-MyBatis-Plus-介绍" class="headerlink" title="2.MyBatis-Plus 介绍"></a>2.MyBatis-Plus 介绍</h2><ul><li>MyBatis 是一款优秀的数据持久层 ORM 框架，被广泛地应用于应用系统。</li><li>MyBatis 能够非常灵活地实现动态 SQL，可以使用 XML 或注解来配置和映射原生信息，能够轻松地将 Java 的 POJO（PlainOrdinaryJavaObject，普通的Java 对象）与数据库中的表和字段进行映射关联。</li><li>MyBatis-Plus 是一个 MyBatis 的增强工具，在 MyBatis 的基础上做了增强，简化了开发。</li></ul><p><font color="#8db3e2">添加依赖：</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;! MyBatisPlus依赖<br>&lt;dependency&gt;<br>   &lt;groupId&gt;com.baomidou&lt;/groupId&gt;<br>    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">3.4</span><span class="hljs-number">.2</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;!--mysql驱动依赖<br>&lt;dependency&gt;<br>    &lt;groupId&gt;mysql&lt;/groupId&gt;<br>     &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">5.1</span><span class="hljs-number">.47</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;!-- 数据连接池druid<br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>    &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">1.1</span><span class="hljs-number">.20</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p><font color="#f79646">全局配置：</font></p><ul><li>配置数据库相关信息（application.properties）：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">spring.datasource.type=com.alibaba.druid.pool.DruidDatasource<br>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver<br>spring.datasource.ur1=jdbc:mysql:<span class="hljs-comment">//1ocalhost:3306/mydb?usessL=false</span><br>spring.datasource.username=root<br>spring.datasource.password=<span class="hljs-number">123456</span><br>mybatis-plus.configuration.1og-impl=org.apache.ibatis.logging.stdout.stdoutImp1<br><br></code></pre></td></tr></table></figure><ul><li>添加@MapperScan 注解：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@springBootApplication</span><br><span class="hljs-meta">@Mapperscan(&quot;com.xx.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisplusDemoApplication</span> <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(string[] args)</span>&#123;<br>       SpringApplication.run(MybatisplusDemoApplication.class,args);<br><br></code></pre></td></tr></table></figure><p>Mybitis CRUD 注解：<br>注解功能<br><font color="#00b0f0">@Insert     实现插入</font><br><font color="#00b0f0">@Update   实现更新</font><br><font color="#00b0f0">@Delete    实现删除</font><br><font color="#00b0f0">@Select    实现查询</font><br><font color="#00b0f0">@Result    实现结果集封装</font><br><font color="#00b0f0">@Results  可以与@Result 一起使用，封装多个结果集</font><br><font color="#00b0f0">@One       实现一对一结果集封装</font><br><font color="#00b0f0">@Many     实现一对多结果集封装</font></p><h2 id="3-MyBatis-Plus-CRUD-操作"><a href="#3-MyBatis-Plus-CRUD-操作" class="headerlink" title="3.MyBatis-Plus CRUD 操作"></a>3.MyBatis-Plus CRUD 操作</h2><p><font color="#ffc000">mybatis 的 Mapper 操作方法</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>   <span class="hljs-meta">@Insert(&quot;insert into user values(#&#123;id),#(username&#125;,#(password),#(birthday)&quot;)//id,username等属性为user对象的属性</span><br><span class="hljs-meta">    int add(User user);</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">   @update(&quot;update user set username=#(username&#125;,password=#(password),birthday=#(birthday&#125; where id=#&#123;id&#125;&quot;)</span><br><span class="hljs-meta">    int update(User user);</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">   @Delete(&quot;delete from user where id=#(id&quot;)</span><br><span class="hljs-meta">    int delete(int id);</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">   @select(&quot;select * from user where id=#(id&quot;)</span><br><span class="hljs-meta">   User findByid(int id);</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">   @select(&quot;select * from user&quot;)</span><br><span class="hljs-meta">   List&lt;User&gt; getA11();</span><br></code></pre></td></tr></table></figure><p><font color="#ff0000">mybatis-plus 的操作方法</font></p><blockquote><p>BaseMapper 泛型类里已经实现了基本的增删改查任务</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;  <br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] 注意<br>Mybatis-plus 有一些对 entity 里的实体类的<strong>注解</strong>，标识对应的表名、主键和字段名等，如果不进行注解则实体类的类名必须与数据表名一致，属性必须与数据表的字段名一致。<br><a href="https://baomidou.com/pages/24112f/#%E7%89%B9%E6%80%A7">注解细节</a></p></blockquote><h2 id="4-多表查询"><a href="#4-多表查询" class="headerlink" title="4. 多表查询"></a>4. 多表查询</h2><blockquote><p>实现复杂关系映射，可以使用@Results 注解，@Result 注解，@One 注解，<br>@Many 注解组合完成复杂关系的配置。</p></blockquote><p><img src="https://s2.loli.net/2023/06/01/Z6TuNLREyqGFazH.png" alt="注解说明|325"></p><p>示例：<br><strong>任务表</strong></p><p>entity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.airesume.entity;  <br>  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;  <br>  <br><span class="hljs-keyword">import</span> java.sql.Date;  <br><span class="hljs-keyword">import</span> java.time.LocalDateTime;  <br>  <br><span class="hljs-meta">@TableName(value = &quot;u_task&quot;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> &#123;  <br>    <span class="hljs-meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> uid;  <br>    <span class="hljs-keyword">private</span> String name;  <br>    <span class="hljs-keyword">private</span> String content;  <br>    <span class="hljs-meta">@TableField(value = &quot;b_date&quot;)</span>  <br>    <span class="hljs-keyword">private</span> LocalDateTime b_date;  <br>    <span class="hljs-meta">@TableField(value = &quot;e_date&quot;)</span>  <br>    <span class="hljs-keyword">private</span> LocalDateTime e_date;  <br>    <span class="hljs-meta">@TableField(exist = false)</span>  <br>    <span class="hljs-keyword">private</span> User user;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>Mapper：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TaskMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Task&gt; &#123;  <br>    <span class="hljs-meta">@Select(&quot;select * from task where uid = #&#123;uid&#125;&quot;)</span>  <br>    List&lt;Task&gt; <span class="hljs-title function_">selectByUid</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span>;  <br><br><span class="hljs-meta">@Select(&quot;select * from task&quot;)</span>  <br><span class="hljs-meta">@Results(  </span><br><span class="hljs-meta">        &#123;  </span><br><span class="hljs-meta">                @Result(column = &quot;id&quot;, property = &quot;id&quot;),  </span><br><span class="hljs-meta">                @Result(column = &quot;name&quot;, property = &quot;name&quot;),  </span><br><span class="hljs-meta">                @Result(column = &quot;content&quot;, property = &quot;content&quot;),  </span><br><span class="hljs-meta">                @Result(column = &quot;b_date&quot;, property = &quot;b_date&quot;, javaType = LocalDateTime.class, jdbcType = JdbcType.TIMESTAMP),  </span><br><span class="hljs-meta">                @Result(column = &quot;e_date&quot;, property = &quot;e_date&quot;, javaType = LocalDateTime.class, jdbcType = JdbcType.TIMESTAMP),  </span><br><span class="hljs-meta">                @Result(column = &quot;uid&quot;, property = &quot;user&quot;, javaType = User.class,  </span><br><span class="hljs-meta">                        one = @One(select = &quot;com.alleyf.airesume.mapper.UserMapper.selectById&quot;)),  </span><br><span class="hljs-meta">        &#125;  </span><br><span class="hljs-meta">)</span>  <br>List&lt;Task&gt; <span class="hljs-title function_">queryAllTaskAndUser</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>用户表</strong></p><p>entity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.airesume.entity;  <br>  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;  <br>  <br><span class="hljs-keyword">import</span> java.util.List;  <br>  <br><span class="hljs-meta">@TableName(value = &quot;user&quot;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;  <br>    <span class="hljs-meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;  <br>    <span class="hljs-keyword">private</span> String username;  <br>    <span class="hljs-keyword">private</span> String password;  <br>    <span class="hljs-meta">@TableField(exist = false)</span>  <br>    <span class="hljs-keyword">private</span> List&lt;Task&gt; tasks;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>mapper：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;  <br>  <br>    <span class="hljs-meta">@Select(&quot;select * from user&quot;)</span>  <br>    <span class="hljs-meta">@Results(  </span><br><span class="hljs-meta">            &#123;  </span><br><span class="hljs-meta">                    @Result(column = &quot;id&quot;, property = &quot;id&quot;),  </span><br><span class="hljs-meta">                    @Result(column = &quot;username&quot;, property = &quot;username&quot;),  </span><br><span class="hljs-meta">                    @Result(column = &quot;password&quot;, property = &quot;password&quot;),  </span><br><span class="hljs-meta">                    @Result(column = &quot;id&quot;, property = &quot;tasks&quot;, javaType = List.class,  </span><br><span class="hljs-meta">                            many = @Many(select = &quot;com.alleyf.airesume.mapper.TaskMapper.selectByUid&quot;)),  </span><br><span class="hljs-meta">            &#125;  </span><br><span class="hljs-meta">    )</span>  <br>    List&lt;User&gt; <span class="hljs-title function_">queryAllUserAndTasks</span><span class="hljs-params">()</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] 注意<br>查询用户的同时查出与用户相关联的所有任务<br>Result 中的 column 的字段为查询到的数据库字段值，用来赋值给后面类对象的属性 property，对应的属性与字段相同，含有不存在的属性则使用外键间接查询。</p></blockquote><h2 id="5-条件查询"><a href="#5-条件查询" class="headerlink" title="5. 条件查询"></a>5. 条件查询</h2><p><span style="background:#affad1">Mybatis 实现：</span></p><blockquote><p>在 mapper 的接口中写 sql 语句进行条件查询。</p></blockquote><p>示例：<br>mapper：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * 按照任务名查询用户 * * <span class="hljs-doctag">@param</span> username 用户名  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> 所有用户列表  </span><br><span class="hljs-comment"> */</span><span class="hljs-meta">@Select(&quot;select * from user where username = #&#123;username&#125;&quot;)</span>  <br><span class="hljs-meta">@Results(&#123;  </span><br><span class="hljs-meta">        @Result(column = &quot;id&quot;, property = &quot;id&quot;),  </span><br><span class="hljs-meta">        @Result(column = &quot;username&quot;, property = &quot;username&quot;),  </span><br><span class="hljs-meta">        @Result(column = &quot;password&quot;, property = &quot;password&quot;),  </span><br><span class="hljs-meta">        @Result(column = &quot;id&quot;, property = &quot;tasks&quot;, javaType = List.class,  </span><br><span class="hljs-meta">                many = @Many(select = &quot;com.alleyf.airesume.mapper.TaskMapper.selectByUid&quot;)),  </span><br><span class="hljs-meta">&#125;)</span>  <br>User <span class="hljs-title function_">selectByName</span><span class="hljs-params">(String username)</span>;<br><br></code></pre></td></tr></table></figure><p>controller：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@ApiOperation(&quot;按照用户名查询用户&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByMName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByMName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;  <br><span class="hljs-comment">//        return userMapper.selectList(null);  </span><br>        <span class="hljs-keyword">return</span> userMapper.selectByName(username);  <br>    &#125;<br><br></code></pre></td></tr></table></figure><p><span style="background:rgba(136, 49, 204, 0.2)">Mybatis-Plus 实现：</span></p><blockquote><ul><li>使用 <strong>QueryWrapper</strong> （条件查询）和 <strong>UpdateWrapper</strong>（条件更新） 两个条件查询类进行条件查询。</li><li>可选条件有：eq（等于），lt（大于），st（小于），le（大于等于），se（小于等于）等</li></ul></blockquote><p>示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation(&quot;按照用户名查询用户(MP)&quot;)</span>  <br><span class="hljs-meta">@GetMapping(&quot;/queryByMPName&quot;)</span>  <br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByMPName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;  <br>    <span class="hljs-keyword">return</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="hljs-string">&quot;username&quot;</span>, username));  <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="6-分页查询"><a href="#6-分页查询" class="headerlink" title="6. 分页查询"></a>6. 分页查询</h2><p>编写配置文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.airesume.config;  <br>  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;  <br>  <br><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaginationConfig</span> &#123;  <br>    <span class="hljs-meta">@Bean</span>  <br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">paginationInterceptor</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();  <br>        <span class="hljs-type">PaginationInnerInterceptor</span> <span class="hljs-variable">paginationInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);  <br>        interceptor.addInnerInterceptor(paginationInterceptor);  <br>        <span class="hljs-keyword">return</span> interceptor;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>controller:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//查询所有用户：1oca1host：8080/findA11</span><br><span class="hljs-meta">@GetMapping(&quot;findAll&quot;)</span><br><span class="hljs-keyword">public</span> IPage <span class="hljs-title function_">findAl1</span><span class="hljs-params">()</span>t<br>   <span class="hljs-comment">//设置起始值及每页条数</span><br>   Page&lt;User&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>);<br>   <span class="hljs-keyword">return</span> userMapper.selectPage(page,nul1);<br><br><span class="hljs-meta">@ApiOperation(&quot;按照页码查询用户(MP)&quot;)</span>  <br><span class="hljs-meta">@GetMapping(&quot;/queryByPage/&#123;page&#125;&quot;)</span>  <br><span class="hljs-keyword">public</span> IPage <span class="hljs-title function_">queryByPage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;page&quot;)</span> <span class="hljs-type">int</span> page)</span> &#123;  <br>    Page&lt;User&gt; page1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, <span class="hljs-number">5</span>);  <br>    <span class="hljs-type">IPage</span> <span class="hljs-variable">iPage</span> <span class="hljs-operator">=</span> userMapper.selectPage(page1, <span class="hljs-literal">null</span>);  <br>    <span class="hljs-keyword">return</span> iPage;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="6-JWT-跨域认证"><a href="#6-JWT-跨域认证" class="headerlink" title="6. JWT 跨域认证"></a>6. JWT 跨域认证</h1><h2 id="1-Session-认证"><a href="#1-Session-认证" class="headerlink" title="1. Session 认证"></a>1. Session 认证</h2><p>互联网服务离不开用户认证。一般流程是下面这样。</p><blockquote><ul><li>用户向服务器发送<strong>用户名和密码</strong>。</li><li>服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等。</li><li>服务器向用户返回一个 session_id，写入用户的 Cookie。</li><li>用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</li><li>服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</li></ul></blockquote><p>session 认证流程：<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307311353929.png" alt="|350"><br>session 认证的方式应用非常普遍，但也存在一些问题，扩展性不好，如果是服务<br>器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能<br>够读取 session，针对此种问题一般有两种方案:</p><blockquote><ol><li><p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。</p></li><li><p>一种方案是服务器不再保存 session 数据，所有数据都保存在客户端，每次请求都发回服务器。Token 认证就是这种方案的一个代表。</p></li></ol></blockquote><h2 id="2-Token-认证"><a href="#2-Token-认证" class="headerlink" title="2. Token 认证"></a>2. Token 认证</h2><p>Token 是在服务端产生的一串字符串, 是客户端访问资源接口（API) 时所需要的资<br>源凭证，流程如下：</p><blockquote><ul><li>客户端使用用户名跟密码请求登录，服务端收到请求，去验证用户名与密码</li><li>验证成功后，服务端会签发一个 token 并把这个 token 发送给客户端</li><li>客户端收到 token 以后，会把它存储起来，比如放在 cookie 里或者 localStorage 里</li><li>客户端每次向服务端请求资源的时候需要带着服务端签发的 token</li><li>服务端收到请求，然后去验证客户端请求里面带着的 token，如果验证成功，就向客户端返回请求的数据</li></ul></blockquote><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307311410745.png" alt="image.png|350"></p><ul><li><p>基于 token 的用户认证是一种服务端无状态的认证方式，服务端不用存放<br>token 数据。</p></li><li><p>用解析 token 的计算时间换取 session 的存储空间，从而减轻服务器的压力<br>减少频繁的查询数据库</p></li><li><p>token 完全由应用管理，所以它可以避开同源策略</p></li></ul><hr><h2 id="3-JWT-的使用"><a href="#3-JWT-的使用" class="headerlink" title="3. JWT 的使用"></a>3. JWT 的使用</h2><blockquote><p>JSON Web Token（简称 JWT）是一个 token 的具体实现方式，是目前最流行<br>的跨域认证解决方案。<br>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，具体如下:</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;姓名&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;张三&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;角色&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;管理员&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;到期时间&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018 年 7 月 1 日 0 点 0 分&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。<br>为了防止用户篡改数据，服务器在生成这个对象的时候，会加上<strong>签名</strong>。</p></blockquote><blockquote><p>JWT 的由三个部分组成，依次如下：<br>  <em><strong>Header (头部)<br>  Payload (负载)<br>  Signature  (签名)</strong></em><br>  三部分最终组合为完整的字符串，中间使用·分隔，如下：<br>  Header.Payload.Signature<br>           <code>eyJhbGci0iJIUzI1NiIsInR5cCI6IkpXVCJ9. eyJzdwIi0iIxMjMoNTY30DkwIiwibmFtzsI6IkpvaG4 gRG91IiwiaXNTb2NpYWwiOnRydwV9. 4pcPyMD09o1PSyXnrXCjTwXyr4BsezdI1AVTmud2fU4</code></p></blockquote><h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><blockquote><p>Header 部分是一个 JSON 对象，描述 JWT 的元数据</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;H256&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JWT&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>alg 属性表示签名的算法（<strong>algorithm</strong>），默认是 HMAC SHA 256 (写成</li></ul><p><strong>HS256</strong>)</p><ul><li>typ 属性表示这个令牌（token）的类型（type），JWT 令牌统一写为 JWT</li><li>最后，将上面的 JSON 对象使用 Base 64 URL 算法转成字符串。</li></ul><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><blockquote><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了 7 个官方字段，供选用。</p></blockquote><ul><li>iss (issuer)：签发人</li><li>exp (expiration time): 过期时间</li><li>sub (subject): 主题</li><li>aud (audience): 受众</li><li>nbf (Not Before): 生效时间</li><li>iat (Issued At)：签发时间</li><li>jti (WT ID): 编号</li></ul><blockquote><p>注意，JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在个部分。<br>   这个 JSON 对象也要使用 <strong>Base 64 URL</strong> 算法转成字符串。</p></blockquote><h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><blockquote><p> Signature 部分是对前两部分的签名，防止数据篡改。<br>    首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户; 然后，使用 Header 里面指定的签名算法 （默认是 HMAC SHA 256），按照下面的公式产生签名。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">HMACSHA <span class="hljs-number">256</span> (<br>base64UrlEncode (header) + <span class="hljs-string">&quot;.&quot;</span> +<br>base64UrlEncode (payload)<span class="hljs-punctuation">,</span><br>secret)<br></code></pre></td></tr></table></figure><p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用”点”（’.’）分隔，就可以返回给用户。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307311433682.png" alt="image.png|450"></p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</li><li>客户端每次与服务器通信，都要带上这个 JWT，可以把它放在 Cookie 里面自动发送，但是这样不能跨域。</li><li>更好的做法是放在 HTTP 请求的头信息’Authorization’字段里面，单独发送。</li></ul><h3 id="请求认证"><a href="#请求认证" class="headerlink" title="请求认证"></a>请求认证</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202309262023932.png" alt="image.png|525"></p><h3 id="JWT验证拦截器"><a href="#JWT验证拦截器" class="headerlink" title="JWT验证拦截器"></a>JWT验证拦截器</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202309272236587.png" alt="image.png|250"></p><p>定义拦截器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.config;  <br>  <br><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON;  <br><span class="hljs-keyword">import</span> com.alleyf.sys.utils.Result;  <br><span class="hljs-keyword">import</span> com.alleyf.common.JwtUtils;  <br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;  <br>  <br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;  <br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;  <br>  <br><span class="hljs-meta">@Component</span>  <br><span class="hljs-meta">@Slf4j</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtValidateInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> JwtUtils jwtUtils;  <br>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;X-Token&quot;</span>);  <br>        log.debug(request.getRequestURI() + <span class="hljs-string">&quot;待验证：&quot;</span> + token);  <br>        <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">try</span> &#123;  <br>                jwtUtils.getClaimsByToken(token);  <br>                log.debug(request.getRequestURI() + <span class="hljs-string">&quot; 验证通过&quot;</span>);  <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;  <br>                e.printStackTrace();  <br>            &#125;  <br>        &#125;  <br>        log.debug(request.getRequestURI() + <span class="hljs-string">&quot; 禁止访问&quot;</span>);  <br>        response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);  <br>        response.getWriter().write(JSON.toJSONString(Result.error().message(<span class="hljs-string">&quot;jwt令牌无效，请重新登录&quot;</span>)));  <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>配置使用拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.config;  <br>  <br><span class="hljs-keyword">import</span> com.alleyf.config.JwtValidateInterceptor;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistration;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;  <br>  <br><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyInterceptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> JwtValidateInterceptor jwtValidateInterceptor;  <br>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;  <br>        <span class="hljs-type">InterceptorRegistration</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> registry.addInterceptor(jwtValidateInterceptor);  <br>        registration.addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>).excludePathPatterns(  <br>                <span class="hljs-string">&quot;/user/login&quot;</span>,  <br>                <span class="hljs-string">&quot;/user/register&quot;</span>,  <br>                <span class="hljs-string">&quot;/user/logout&quot;</span>,  <br>                <span class="hljs-string">&quot;/user/info&quot;</span>,  <br>                <span class="hljs-string">&quot;/error&quot;</span>  <br>        );  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Swagger授权配置"><a href="#Swagger授权配置" class="headerlink" title="Swagger授权配置"></a>Swagger授权配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*  </span><br><span class="hljs-comment"> * Copyright (c) alleyf 2023 - 5 - 29 20:33 * 适度编码益脑，沉迷编码伤身，合理安排时间，享受快乐生活。 * */</span>  <br><span class="hljs-keyword">package</span> com.alleyf.config;  <br>  <br><span class="hljs-keyword">import</span> com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;  <br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.CookieValue;  <br><span class="hljs-keyword">import</span> org.springframework.web.context.request.async.DeferredResult;  <br><span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;  <br><span class="hljs-keyword">import</span> springfox.documentation.builders.PathSelectors;  <br><span class="hljs-keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;  <br><span class="hljs-keyword">import</span> springfox.documentation.oas.annotations.EnableOpenApi;  <br><span class="hljs-keyword">import</span> springfox.documentation.service.*;  <br><span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;  <br><span class="hljs-keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;  <br><span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;  <br><span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;  <br>  <br><span class="hljs-keyword">import</span> java.util.Collections;  <br><span class="hljs-keyword">import</span> java.util.List;  <br>  <br><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-meta">@EnableKnife4j</span>  <br><span class="hljs-meta">@EnableOpenApi</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;  <br>  <br>    <span class="hljs-meta">@Bean</span>  <br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">Api</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.OAS_30)  <br>                .enable(<span class="hljs-literal">true</span>)<span class="hljs-comment">//是否启用：注意生产环境需要关闭  </span><br>                .groupName(<span class="hljs-string">&quot;spring-boot-2.7.12&quot;</span>)  <br>                .genericModelSubstitutes(DeferredResult.class)  <br>                .useDefaultResponseMessages(<span class="hljs-literal">false</span>)  <br>                .forCodeGeneration(<span class="hljs-literal">true</span>)  <br>                .ignoredParameterTypes(CookieValue.class)  <br>                .apiInfo(apiInfo())  <br>                .select()  <br>                <span class="hljs-comment">//以下拦截配置可以三选一，根据需要进行添加,选择扫描哪些接口  </span><br><span class="hljs-comment">//                .apis(RequestHandlerSelectors.basePackage(&quot;com.alleyf.*.controller&quot;))  </span><br>                .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))  <br><span class="hljs-comment">//                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))  </span><br>                .paths(PathSelectors.any())  <br>                .build()  <br>                .securitySchemes(Collections.singletonList(securityScheme()))  <br>                .securityContexts(Collections.singletonList(securityContext()));  <br>  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">private</span> SecurityScheme <span class="hljs-title function_">securityScheme</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-comment">//return new ApiKey(&quot;Authorization&quot;, &quot;Authorization&quot;,&quot;header&quot;);  </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiKey</span>(<span class="hljs-string">&quot;X-Token&quot;</span>, <span class="hljs-string">&quot;X-Token&quot;</span>, <span class="hljs-string">&quot;header&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">private</span> SecurityContext <span class="hljs-title function_">securityContext</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> SecurityContext.builder()  <br>                .securityReferences(defaultAuth())  <br>                .forPaths(PathSelectors.regex(<span class="hljs-string">&quot;^(?!auth).*$&quot;</span>))  <br>                .build();  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">private</span> List&lt;SecurityReference&gt; <span class="hljs-title function_">defaultAuth</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">AuthorizationScope</span> <span class="hljs-variable">authorizationScope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthorizationScope</span>(<span class="hljs-string">&quot;global&quot;</span>, <span class="hljs-string">&quot;accessEverything&quot;</span>);  <br>        AuthorizationScope[] authorizationScopes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthorizationScope</span>[<span class="hljs-number">1</span>];  <br>        authorizationScopes[<span class="hljs-number">0</span>] = authorizationScope;  <br>        <span class="hljs-keyword">return</span> Collections.singletonList(  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityReference</span>(<span class="hljs-string">&quot;X-Token&quot;</span>, authorizationScopes));  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()  <br>                .title(<span class="hljs-string">&quot;WHUT leave Go-Swagger3接口文档&quot;</span>)  <br>                .description(<span class="hljs-string">&quot;WHUT leave Go-前后端分离的接口文档&quot;</span>)  <br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)  <br>                .contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;alleyf&quot;</span>, <span class="hljs-string">&quot;https://fcsy.com&quot;</span>, <span class="hljs-string">&quot;alleyf@qq.com&quot;</span>))  <br>                .build();  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="后端实现"><a href="#后端实现" class="headerlink" title="后端实现"></a>后端实现</h3><h4 id="加入依赖"><a href="#加入依赖" class="headerlink" title="加入依赖"></a>加入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="生成-Token"><a href="#生成-Token" class="headerlink" title="生成 Token"></a>生成 Token</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//7 天过期</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Long</span> <span class="hljs-variable">expire</span> <span class="hljs-operator">=</span> <span class="hljs-number">604800</span>;<br><span class="hljs-comment">//32 位秘钥</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">secret</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdfghiabcdfghiabcdfghiabcdfghi&quot;</span>;<br><br><span class="hljs-comment">//生成 token</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateToken</span><span class="hljs-params">(String username)</span>&#123;<br>   <span class="hljs-type">Date</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>   <span class="hljs-type">Date</span> <span class="hljs-variable">expiration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span> (now.getTime() + <span class="hljs-number">1000</span> * expire);<br>   <span class="hljs-keyword">return</span> Jwts.builder ()<br>            .setHeaderParam(<span class="hljs-string">&quot;type&quot;</span>,<span class="hljs-string">&quot;JWT&quot;</span>)<br>            .setSubject(username)<br>            .setIssuedAt(now)<br>            .setExpiration(expiration)<br>            .signWith(SignatureAlgorithm.HS512, secret)<br>            .compact();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="解析-token"><a href="#解析-token" class="headerlink" title="解析 token"></a>解析 token</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Claims <span class="hljs-title function_">getClaimsByToken</span><span class="hljs-params">(String token)</span> &#123;  <br>    <span class="hljs-keyword">return</span> Jwts.parser()  <br>            .setSigningKey(secret)  <br>            .parseClaimsJws(token)  <br>            .getBody();  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="后端完整部分"><a href="#后端完整部分" class="headerlink" title="后端完整部分"></a>后端完整部分</h4><p><code>UserController. java:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*  </span><br><span class="hljs-comment"> * Copyright (c) alleyf 2023 - 6 - 1 19:56 * 适度编码益脑，沉迷编码伤身，合理安排时间，享受快乐生活。 * */</span>  <br><span class="hljs-keyword">package</span> com.alleyf.airesume.controller;  <br>  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.entity.User;  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.mapper.UserMapper;  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.utils.JwtUtils;  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.utils.Result;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;  <br>  <br><span class="hljs-keyword">import</span> java.util.List;  <br>  <br><span class="hljs-meta">@Api(tags = &quot;用户&quot;, value = &quot;用户&quot;)</span>  <br><span class="hljs-meta">@RestController</span>  <br><span class="hljs-meta">@CrossOrigin</span>  <br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    UserMapper userMapper;  <br><br>    <span class="hljs-meta">@ApiOperation(&quot;用户登录&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtUtils.generateToken(user.getUsername());  <br>        <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;token&quot;</span>, token);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;获取用户信息&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/info&quot;)</span>  <span class="hljs-comment">//&quot;token:xxx&quot;  </span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">info</span><span class="hljs-params">(String token)</span> &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> JwtUtils.getClaimsByToken(token).getSubject();  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://img2.baidu.com/it/u=1325995315,4158780794&amp;fm=26&amp;fmt=auto&amp;gp=0.jpg&quot;</span>;  <br>        <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;name&quot;</span>, username).data(<span class="hljs-string">&quot;avatar&quot;</span>, url);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;注销&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span> <span class="hljs-comment">// &quot;token:xxx&quot;  </span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> Result.ok();  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;查询所有用户&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryAll&quot;)</span>  <br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryAllUser</span><span class="hljs-params">()</span> &#123;  <br><span class="hljs-comment">//        return userMapper.selectList(null);  </span><br>        <span class="hljs-keyword">return</span> userMapper.queryAllUserAndTask();  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照用户名查询用户&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByMName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByMName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;  <br><span class="hljs-comment">//        return userMapper.selectList(null);  </span><br>        <span class="hljs-keyword">return</span> userMapper.selectByName(username);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照用户名查询用户(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByMPName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByMPName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;  <br>        <span class="hljs-keyword">return</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="hljs-string">&quot;username&quot;</span>, username));  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照用户名路径查询用户(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPMPName/&#123;username&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByPMPName</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;username&quot;)</span> String username)</span> &#123;  <br>        <span class="hljs-keyword">return</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="hljs-string">&quot;username&quot;</span>, username));  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照页码查询用户(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPage/&#123;page&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> IPage <span class="hljs-title function_">queryByPage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;page&quot;)</span> <span class="hljs-type">int</span> page)</span> &#123;  <br>        Page&lt;User&gt; page1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, <span class="hljs-number">5</span>);  <br>        <span class="hljs-type">IPage</span> <span class="hljs-variable">iPage</span> <span class="hljs-operator">=</span> userMapper.selectPage(page1, <span class="hljs-literal">null</span>);  <br>        <span class="hljs-keyword">return</span> iPage;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;添加用户&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span> &#123;  <br>        <span class="hljs-keyword">return</span> userMapper.insert(user) &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;添加成功&quot;</span> : <span class="hljs-string">&quot;添加失败&quot;</span>;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Result.java:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*  </span><br><span class="hljs-comment"> * Copyright (c) alleyf 2023 - 5 - 29 &#125;9:52 * 适度编码益脑，沉迷编码伤身，合理安排时间，享受快乐生活。 * */</span>  <br><span class="hljs-keyword">package</span> com.alleyf.airesume.utils;  <br>  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> &#123;  <br>    <span class="hljs-keyword">private</span> Boolean success;  <br>    <span class="hljs-keyword">private</span> Integer code;  <br>    <span class="hljs-keyword">private</span> String message;  <br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Result</span><span class="hljs-params">()</span> &#123;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">ok</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">Result</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();  <br>        r.setCode(ResultCode.Success);  <br>        r.setSuccess(<span class="hljs-literal">true</span>);  <br>        r.setMessage(<span class="hljs-string">&quot;成功&quot;</span>);  <br>        <span class="hljs-keyword">return</span> r;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">error</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">Result</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();  <br>        r.setCode(ResultCode.Error);  <br>        r.setSuccess(<span class="hljs-literal">false</span>);  <br>        r.setMessage(<span class="hljs-string">&quot;失败&quot;</span>);  <br>        <span class="hljs-keyword">return</span> r;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">success</span><span class="hljs-params">(Boolean success)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setSuccess(success);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">message</span><span class="hljs-params">(String message)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setMessage(message);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">code</span><span class="hljs-params">(Integer code)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setCode(code);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">data</span><span class="hljs-params">(String key, Object value)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.data.put(key, value);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">data</span><span class="hljs-params">(Map&lt;String, Object&gt; map)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setData(map);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">getSuccess</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> success;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSuccess</span><span class="hljs-params">(Boolean success)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.success = success;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> code;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(Integer code)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.code = code;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> message;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMessage</span><span class="hljs-params">(String message)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.message = message;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> data;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(Map&lt;String, Object&gt; data)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.data = data;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>JwtUtils.java:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.airesume.utils;  <br>  <br><span class="hljs-keyword">import</span> io.jsonwebtoken.Claims;  <br><span class="hljs-keyword">import</span> io.jsonwebtoken.Jwts;  <br><span class="hljs-keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;  <br>  <br><span class="hljs-keyword">import</span> java.util.Date;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtUtils</span> &#123;  <br>    <span class="hljs-comment">//7 天过期  </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Long</span> <span class="hljs-variable">expire</span> <span class="hljs-operator">=</span> <span class="hljs-number">604800L</span>;  <br>    <span class="hljs-comment">//32 位秘钥  </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">secret</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdfghiabcdfghiabcdfghiabcdfghi&quot;</span>;  <br>  <br>    <span class="hljs-comment">//生成 token  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateToken</span><span class="hljs-params">(String username)</span> &#123;  <br>        <span class="hljs-type">Date</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();  <br>        <span class="hljs-type">Date</span> <span class="hljs-variable">expiration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(now.getTime() + <span class="hljs-number">1000</span> * expire);  <br>        <span class="hljs-keyword">return</span> Jwts.builder()  <br>                .setHeaderParam(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;JWT&quot;</span>)  <br>                .setSubject(username)  <br>                .setIssuedAt(now)  <br>                .setExpiration(expiration)  <br>                .signWith(SignatureAlgorithm.HS512, secret)  <br>                .compact();  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Claims <span class="hljs-title function_">getClaimsByToken</span><span class="hljs-params">(String token)</span> &#123;  <br>        <span class="hljs-keyword">return</span> Jwts.parser()  <br>                .setSigningKey(secret)  <br>                .parseClaimsJws(token)  <br>                .getBody();  <br>  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="项目实战-角色管理"><a href="#项目实战-角色管理" class="headerlink" title="项目实战-角色管理"></a>项目实战-角色管理</h1><h2 id="1-预览效果"><a href="#1-预览效果" class="headerlink" title="1.预览效果"></a>1.预览效果</h2><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202310011258914.png" alt="image.png"></p><h2 id="2-前端"><a href="#2-前端" class="headerlink" title="2.前端"></a>2.前端</h2><p><font color="#ff0000">role.vue:</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;  <br>&lt;div&gt;  <br>&lt;!-- 添加角色--&gt;  <br>&lt;el-dialog  <br>:title=&quot;dialogTitle&quot;  <br>:visible.sync=&quot;dialogFormVisible&quot;  <br>center  <br>width=&quot;32%&quot;  <br>@close=&quot;clearForm&quot;  <br>&gt;  <br>&lt;el-form  <br>ref=&quot;roleForm&quot;  <br>:model=&quot;roleForm&quot;  <br>:rules=&quot;rules&quot;  <br>show-message  <br>status-icon  <br>&gt;  <br>&lt;el-form-item label=&quot;角色名&quot; label-width=&quot;80px&quot; prop=&quot;roleName&quot;&gt;  <br>&lt;el-input  <br>v-model=&quot;roleForm.roleName&quot;  <br>clearable  <br>prefix-icon=&quot;el-icon-user&quot;  <br>/&gt;  <br>&lt;/el-form-item&gt;  <br>&lt;el-form-item label=&quot;角色描述&quot; label-width=&quot;80px&quot; prop=&quot;roleDesc&quot;&gt;  <br>&lt;el-input  <br>v-model=&quot;roleForm.roleDesc&quot;  <br>clearable  <br>prefix-icon=&quot;el-icon-key&quot;  <br>/&gt;  <br>&lt;/el-form-item&gt;  <br>&lt;/el-form&gt;  <br>&lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;  <br>&lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;  <br>&lt;el-button type=&quot;primary&quot; @click=&quot;saveRole(&#x27;roleForm&#x27;)&quot;&gt;确 定  <br>&lt;/el-button&gt;  <br>&lt;/div&gt;  <br>&lt;/el-dialog&gt;  <br>&lt;!-- 角色检索--&gt;  <br>&lt;el-card id=&quot;search&quot; shadow=&quot;hover&quot;&gt;  <br>&lt;el-row :gutter=&quot;5&quot;&gt;  <br>&lt;el-col :span=&quot;18&quot;&gt;  <br>&lt;div class=&quot;grid-content bg-purple&quot;&gt;  <br>&lt;el-input  <br>v-model=&quot;searchModel.queryContent&quot;  <br>clearable  <br>placeholder=&quot;请输入用户名&quot;  <br>suffix-icon=&quot;el-icon-user&quot;  <br>&gt;  <br>&lt;el-button  <br>slot=&quot;append&quot;  <br>icon=&quot;el-icon-search&quot;  <br>type=&quot;success&quot;  <br>@click=&quot;getRoles&quot;  <br>/&gt;  <br>&lt;/el-input&gt;  <br>&lt;/div&gt;  <br>&lt;/el-col&gt;  <br>&lt;el-col :span=&quot;6&quot; align=&quot;right&quot;&gt;  <br>&lt;div class=&quot;grid-content bg-purple&quot;&gt;  <br>&lt;el-button  <br>icon=&quot;el-icon-plus&quot;  <br>size=&quot;medium&quot;  <br>type=&quot;success&quot;  <br>@click=&quot;addRole&quot;  <br>/&gt;  <br>&lt;/div&gt;  <br>&lt;/el-col&gt;  <br>&lt;/el-row&gt;  <br>&lt;/el-card&gt;  <br>&lt;!-- 用户信息--&gt;  <br>&lt;el-card shadow=&quot;hover&quot;&gt;  <br>&lt;el-table  <br>v-loading=&quot;loading&quot;  <br>:cell-style=&quot;&#123; &#x27;text-align&#x27;: &#x27;center&#x27; &#125;&quot;  <br>:data=&quot;tableData&quot;  <br>:default-sort=&quot;&#123; prop: &#x27;id&#x27;, order: &#x27;ascending&#x27; &#125;&quot;  <br>:header-cell-style=&quot;&#123; &#x27;text-align&#x27;: &#x27;center&#x27; &#125;&quot;  <br>border  <br>max-height=&quot;520&quot;  <br>style=&quot;width: 100%&quot;  <br>&gt;  <br>&lt;el-table-column label=&quot;#&quot; type=&quot;index&quot; width=&quot;80&quot;&gt;  <br>&lt;template slot-scope=&quot;scope&quot;&gt;  <br>&lt;!-- (pageNum-1)*pageSize+index+1--&gt;  <br>&#123;&#123;  <br>(searchModel.pageNum - 1) * searchModel.pageSize + scope.$index + 1  <br>&#125;&#125;  <br>&lt;/template&gt;  <br>&lt;/el-table-column&gt;  <br>&lt;el-table-column label=&quot;角色id&quot; prop=&quot;roleId&quot; sortable width=&quot;200&quot;/&gt;  <br>&lt;el-table-column  <br>class=&quot;name-wrapper&quot;  <br>label=&quot;角色名称&quot;  <br>prop=&quot;roleName&quot;  <br>width=&quot;260&quot;  <br>/&gt;  <br>&lt;el-table-column label=&quot;角色描述&quot; prop=&quot;roleDesc&quot; resizable width=&quot;280&quot;/&gt;  <br>&lt;el-table-column fixed=&quot;right&quot; label=&quot;操作&quot; width=&quot;160&quot;&gt;  <br>&lt;template slot-scope=&quot;scope&quot;&gt;  <br>&lt;el-button  <br>circle  <br>icon=&quot;el-icon-delete&quot;  <br>size=&quot;small&quot;  <br>type=&quot;danger&quot;  <br>@click.native.prevent=&quot;deleteRole(scope.$index, tableData)&quot;  <br>&gt;  <br>&lt;/el-button&gt;  <br>&lt;el-button  <br>circle  <br>icon=&quot;el-icon-edit&quot;  <br>size=&quot;small&quot;  <br>type=&quot;primary&quot;  <br>@click=&quot;editRole(scope.row)&quot;  <br>&gt;  <br>&lt;/el-button&gt;  <br>&lt;/template&gt;  <br>&lt;/el-table-column&gt;  <br>&lt;/el-table&gt;  <br>&lt;/el-card&gt;  <br>&lt;!-- 分页组件--&gt;  <br>&lt;el-footer align=&quot;center&quot;&gt;  <br>&lt;div class=&quot;block&quot;&gt;  <br>&lt;el-pagination  <br>:current-page=&quot;searchModel.currentPage&quot;  <br>:page-size=&quot;searchModel.pageNum&quot;  <br>:page-sizes=&quot;pageSizes&quot;  <br>:total=&quot;total&quot;  <br>layout=&quot;total, sizes, prev, pager, next, jumper&quot;  <br>@size-change=&quot;handleSizeChange&quot;  <br>@current-change=&quot;handleCurrentChange&quot;  <br>/&gt;  <br>&lt;/div&gt;  <br>&lt;/el-footer&gt;  <br>&lt;el-backtop target=&quot;.page-component__scroll .el-scrollbar__wrap&quot;&gt;&lt;/el-backtop&gt;  <br>&lt;/div&gt;  <br>&lt;/template&gt;  <br>  <br>&lt;script&gt;  <br>import roleApi from &#x27;@/api/roleManage&#x27;  <br>import current from &#x27;element-ui/packages/table/src/store/current&#x27;  <br>// import &#x27;@/styles/roleManage.css&#x27;  <br>  <br>export default &#123;  <br>name: &#x27;Role&#x27;,  <br>data() &#123;  <br>return &#123;  <br>searchModel: &#123;  <br>queryContent: &#x27;&#x27;,  <br>pageNum: 1,  <br>pageSize: 10  <br>&#125;,  <br>pageSizes: [10, 20, 50, 100],  <br>total: 0,  <br>tableData: [],  <br>loading: true,  <br>dialogFormVisible: false,  <br>dialogTitle: &#x27;添加角色&#x27;,  <br>roleForm: &#123;  <br>roleName: &#x27;&#x27;,  <br>roleDesc: &#x27;&#x27;  <br>&#125;,  <br>rules: &#123;  <br>roleName: [  <br>&#123; required: true, message: &#x27;请输入角色名&#x27;, trigger: &#x27;blur&#x27; &#125;,  <br>&#123;  <br>min: 1,  <br>max: 20,  <br>message: &#x27;长度在 1 到 20 个字符&#x27;,  <br>trigger: &#x27;blur&#x27;  <br>&#125;  <br>],  <br>roleDesc: [  <br>&#123; required: true, message: &#x27;请输入角色描述&#x27;, trigger: &#x27;blur&#x27; &#125;,  <br>&#123;  <br>min: 1,  <br>max: 30,  <br>message: &#x27;长度在 3 到 30 个字符&#x27;,  <br>trigger: &#x27;blur&#x27;  <br>&#125;  <br>]  <br>&#125;  <br>&#125;  <br>&#125;,  <br>computed: &#123;  <br>current() &#123;  <br>return current  <br>&#125;  <br>&#125;,  <br>created() &#123;  <br>this.getRoles()  <br>&#125;,  <br>methods: &#123;  <br>getRoles() &#123;  <br>roleApi  <br>.search(this.searchModel)  <br>.then((res) =&gt; &#123;  <br>// console.log(res)  <br>this.tableData = res.data.data.records  <br>this.total = res.data.data.total  <br>this.searchModel.pageNum = res.data.data.current  <br>this.loading = false  <br>// console.log(this.searchModel.queryContent, this.searchModel.queryItem, this.searchModel.pageSize, this.searchModel.pageNum)  <br>&#125;)  <br>.catch((error) =&gt; &#123;  <br>console.log(error)  <br>&#125;)  <br>&#125;,  <br>saveRole(formName) &#123;  <br>// alert(this.roleForm)  <br>// 提交则触发表单验证  <br>this.$refs[formName].validate((valid) =&gt; &#123;  <br>if (valid) &#123;  <br>console.log(this.roleForm)  <br>// 提交请求到后台  <br>roleApi  <br>.save(this.roleForm)  <br>.then((res) =&gt; &#123;  <br>// console.log(res)  <br>this.dialogFormVisible = false  <br>// 提交结果消息提示  <br>this.notify(res, this.message)  <br>// 刷新表格  <br>this.getRoles()  <br>&#125;)  <br>.catch((error) =&gt; &#123;  <br>console.log(error)  <br>&#125;)  <br>&#125; else &#123;  <br>console.log(&#x27;error submit!!&#x27;)  <br>return false  <br>&#125;  <br>&#125;)  <br>&#125;,  <br>clearForm() &#123;  <br>this.roleForm = &#123;&#125;  <br>this.$refs.roleForm.clearValidate()  <br>&#125;,  <br>handleSizeChange(pageSize) &#123;  <br>this.searchModel.pageSize = pageSize  <br>this.getRoles()  <br>&#125;,  <br>handleCurrentChange(pageNum) &#123;  <br>this.searchModel.pageNum = pageNum  <br>this.getRoles()  <br>&#125;,  <br>addRole() &#123;  <br>this.dialogTitle = &#x27;添加角色&#x27;  <br>this.dialogFormVisible = true  <br>this.message = &#x27;添加角色成功！&#x27;  <br>&#125;,  <br>deleteRole(index, rows) &#123;  <br>// console.log(rows[index])  <br>this.$confirm(`此操作将永久删除角色&lt;strong style=&quot;color: red&quot;&gt;$&#123;rows[index].roleName&#125;&lt;/strong&gt;, 是否继续?`, &#x27;提示&#x27;, &#123;  <br>confirmButtonText: &#x27;确定&#x27;,  <br>cancelButtonText: &#x27;取消&#x27;,  <br>type: &#x27;warning&#x27;,  <br>center: true,  <br>dangerouslyUseHTMLString: true  <br>&#125;).then(() =&gt; &#123;  <br>roleApi.del(rows[index].roleId).then((res) =&gt; &#123;  <br>// console.log(res)  <br>rows.splice(index, 1)  <br>this.$message(&#123;  <br>type: &#x27;success&#x27;,  <br>message: res.message  <br>&#125;)  <br>&#125;)  <br>&#125;).catch(() =&gt; &#123;  <br>this.$message(&#123;  <br>type: &#x27;info&#x27;,  <br>message: &#x27;已取消删除&#x27;  <br>&#125;)  <br>&#125;)  <br>&#125;,  <br>editRole(row) &#123;  <br>roleApi.getById(row.roleId).then(res =&gt; &#123;  <br>this.roleForm = res.data.data  <br>// console.log(this.userForm)  <br>this.dialogTitle = &#x27;编辑角色&#x27;  <br>this.dialogFormVisible = true  <br>this.message = &#x27;更新角色成功！&#x27;  <br>&#125;).catch(error =&gt; &#123;  <br>console.log(error)  <br>&#125;)  <br>&#125;,  <br>notify(res, message = null) &#123;  <br>if (res.code === 20000) &#123;  <br>// 提交结果消息提示  <br>this.$notify(&#123;  <br>title: &#x27;成功&#x27;,  <br>message: message != null ? message : res.message,  <br>type: &#x27;success&#x27;  <br>&#125;)  <br>&#125; else &#123;  <br>this.$notify.error(&#123;  <br>title: &#x27;失败&#x27;,  <br>message: res.message  <br>&#125;)  <br>&#125;  <br>&#125;  <br>&#125;  <br>&#125;  <br>&lt;/script&gt;  <br>  <br>&lt;style scoped&gt;&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><p><font color="#ff0000">roleManage.js:</font></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/request&#x27;</span>  <br>  <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  <br>search (searchModel) &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;  <br><span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/role/search&#x27;</span>,  <br><span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>,  <br><span class="hljs-attr">params</span>: &#123;  <br><span class="hljs-attr">queryContent</span>: searchModel.<span class="hljs-property">queryContent</span>,  <br><span class="hljs-attr">pageSize</span>: searchModel.<span class="hljs-property">pageSize</span>,  <br><span class="hljs-attr">pageNum</span>: searchModel.<span class="hljs-property">pageNum</span>  <br>&#125;  <br>&#125;)  <br>&#125;,  <br>save (roleForm) &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;  <br><span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/role/save&#x27;</span>,  <br><span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,  <br><span class="hljs-attr">data</span>: roleForm  <br>&#125;)  <br>&#125;,  <br>del (id) &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;  <br><span class="hljs-attr">url</span>: <span class="hljs-string">`/role/<span class="hljs-subst">$&#123;id&#125;</span>`</span>,  <br><span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;delete&#x27;</span>  <br>&#125;)  <br>&#125;,  <br>getById (id) &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;  <br><span class="hljs-attr">url</span>: <span class="hljs-string">`/role/<span class="hljs-subst">$&#123;id&#125;</span>`</span>,  <br><span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>  <br>&#125;)  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="3-后端"><a href="#3-后端" class="headerlink" title="3.后端"></a>3.后端</h2><p><font color="#f79646">RoleController:</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.sys.controller;  <br>  <br><span class="hljs-keyword">import</span> com.alleyf.sys.entity.Role;  <br><span class="hljs-keyword">import</span> com.alleyf.sys.service.IRoleService;  <br><span class="hljs-keyword">import</span> com.alleyf.sys.utils.Result;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;  <br><span class="hljs-keyword">import</span> io.swagger.util.Json;  <br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;  <br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * &lt;p&gt;  </span><br><span class="hljs-comment"> * 前端控制器  </span><br><span class="hljs-comment"> * &lt;/p&gt;  </span><br><span class="hljs-comment"> *  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> alleyf  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2023-08-06  </span><br><span class="hljs-comment"> */</span><span class="hljs-meta">@RestController</span>  <br><span class="hljs-meta">@Slf4j</span>  <br><span class="hljs-meta">@RequestMapping(&quot;/role&quot;)</span>  <br><span class="hljs-meta">@Api(tags = &#123;&quot;角色&quot;&#125;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleController</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    IRoleService roleService;  <br>  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照角色名查询角色(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryByName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;roleName&quot;)</span> String roleName)</span> &#123;  <br>        <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.queryByName(roleName);  <br>        <span class="hljs-keyword">if</span> (role != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, role);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(roleName + <span class="hljs-string">&quot;角色不存在&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照角色名路径查询角色(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPName/&#123;roleName&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryByPName</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;roleName&quot;)</span> String roleName)</span> &#123;  <br>        <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.queryByName(roleName);  <br>        <span class="hljs-keyword">if</span> (role != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, role);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(roleName + <span class="hljs-string">&quot;角色不存在&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照id路径查询角色&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;  <br>        <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.getById(id);  <br>        <span class="hljs-keyword">if</span> (role != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, role);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(<span class="hljs-string">&quot;id为:&quot;</span> + id + <span class="hljs-string">&quot;的角色不存在&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照页码查询角色(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPage&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryByPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> Long pageNum,  </span><br><span class="hljs-params">                              <span class="hljs-meta">@RequestParam(&quot;pageSize&quot;)</span> Long pageSize)</span> &#123;  <br>        IPage&lt;Role&gt; roleIPage = roleService.queryByPage(pageNum, pageSize, <span class="hljs-literal">null</span>);  <br>        <span class="hljs-keyword">return</span> roleIPage != <span class="hljs-literal">null</span> ? Result.ok().data(<span class="hljs-string">&quot;page&quot;</span>, roleIPage) : Result.error().message(<span class="hljs-string">&quot;平台没有角色&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;添加或更新角色&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">addRole</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Role role)</span> &#123;  <br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">saveStatus</span> <span class="hljs-operator">=</span> roleService.saveOrUpdate(role);  <br>        <span class="hljs-keyword">return</span> saveStatus ? Result.ok().message(<span class="hljs-string">&quot;添加或更新角色成功&quot;</span>) : Result.error().message(<span class="hljs-string">&quot;添加或更新角色失败&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;删除角色&quot;)</span>  <br>    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delRole</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;  <br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">saveStatus</span> <span class="hljs-operator">=</span> roleService.removeById(id);  <br>        <span class="hljs-keyword">return</span> saveStatus ? Result.ok().message(<span class="hljs-string">&quot;删除角色成功&quot;</span>) : Result.error().message(<span class="hljs-string">&quot;删除角色失败&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;搜索角色&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/search&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;queryContent&quot;, required = false)</span> String queryContent,  </span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;10&quot;)</span> Long pageSize,  </span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Long pageNum)</span> &#123;  <br>        IPage&lt;Role&gt; roles = roleService.search(queryContent, pageSize, pageNum);  <br>        <span class="hljs-keyword">if</span> (roles != <span class="hljs-literal">null</span>) &#123;  <br>            log.debug(<span class="hljs-string">&quot;roles: &quot;</span> + roles);  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, roles);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(<span class="hljs-string">&quot;平台没有该角色&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="角色权限设置"><a href="#角色权限设置" class="headerlink" title="角色权限设置"></a>角色权限设置</h2><h3 id="1-效果预览"><a href="#1-效果预览" class="headerlink" title="1.效果预览"></a>1.效果预览</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202310031214347.png" alt="image.png"></p><h3 id="2-前端-1"><a href="#2-前端-1" class="headerlink" title="2.前端"></a>2.前端</h3><p><font color="#f79646">role.vue:</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;  <br>&lt;div&gt;  <br>&lt;!-- 添加角色--&gt;  <br>&lt;el-dialog  <br>:title=&quot;dialogTitle&quot;  <br>:visible.sync=&quot;dialogFormVisible&quot;  <br>center  <br>width=&quot;32%&quot;  <br>@close=&quot;clearForm&quot;  <br>&gt;  <br>&lt;el-form  <br>ref=&quot;roleForm&quot;  <br>:model=&quot;roleForm&quot;  <br>:rules=&quot;rules&quot;  <br>show-message  <br>status-icon  <br>&gt;  <br>&lt;el-form-item label=&quot;角色名&quot; label-width=&quot;80px&quot; prop=&quot;roleName&quot;&gt;  <br>&lt;el-input  <br>v-model=&quot;roleForm.roleName&quot;  <br>clearable  <br>prefix-icon=&quot;el-icon-user&quot;  <br>/&gt;  <br>&lt;/el-form-item&gt;  <br>&lt;el-form-item label=&quot;角色描述&quot; label-width=&quot;80px&quot; prop=&quot;roleDesc&quot;&gt;  <br>&lt;el-input  <br>v-model=&quot;roleForm.roleDesc&quot;  <br>clearable  <br>prefix-icon=&quot;el-icon-key&quot;  <br>/&gt;  <br>&lt;/el-form-item&gt;  <br>&lt;el-form-item label=&quot;权限设置&quot; label-width=&quot;80px&quot; prop=&quot;menuIdList&quot;&gt;  <br>&lt;el-tree  <br>ref=&quot;menuRef&quot;  <br>:data=&quot;menuList&quot;  <br>:props=&quot;menuProps&quot;  <br>default-expand-all  <br>node-key=&quot;menuId&quot;  <br>show-checkbox  <br>&gt;  <br>&lt;/el-tree&gt;  <br>&lt;/el-form-item&gt;  <br>&lt;/el-form&gt;  <br>&lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;  <br>&lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;  <br>&lt;el-button type=&quot;primary&quot; @click=&quot;saveRole(&#x27;roleForm&#x27;)&quot;&gt;确 定  <br>&lt;/el-button&gt;  <br>&lt;/div&gt;  <br>&lt;/el-dialog&gt;  <br>&lt;!-- 角色检索--&gt;  <br>&lt;el-card id=&quot;search&quot; shadow=&quot;hover&quot;&gt;  <br>&lt;el-row :gutter=&quot;5&quot;&gt;  <br>&lt;el-col :span=&quot;18&quot;&gt;  <br>&lt;div class=&quot;grid-content bg-purple&quot;&gt;  <br>&lt;el-input  <br>v-model=&quot;searchModel.queryContent&quot;  <br>clearable  <br>placeholder=&quot;请输入用户名&quot;  <br>suffix-icon=&quot;el-icon-user&quot;  <br>&gt;  <br>&lt;el-button  <br>slot=&quot;append&quot;  <br>icon=&quot;el-icon-search&quot;  <br>type=&quot;success&quot;  <br>@click=&quot;getRoles&quot;  <br>/&gt;  <br>&lt;/el-input&gt;  <br>&lt;/div&gt;  <br>&lt;/el-col&gt;  <br>&lt;el-col :span=&quot;6&quot; align=&quot;right&quot;&gt;  <br>&lt;div class=&quot;grid-content bg-purple&quot;&gt;  <br>&lt;el-button  <br>icon=&quot;el-icon-plus&quot;  <br>size=&quot;medium&quot;  <br>type=&quot;success&quot;  <br>@click=&quot;addRole&quot;  <br>/&gt;  <br>&lt;/div&gt;  <br>&lt;/el-col&gt;  <br>&lt;/el-row&gt;  <br>&lt;/el-card&gt;  <br>&lt;!-- 用户信息--&gt;  <br>&lt;el-card shadow=&quot;hover&quot;&gt;  <br>&lt;el-table  <br>v-loading=&quot;loading&quot;  <br>:cell-style=&quot;&#123; &#x27;text-align&#x27;: &#x27;center&#x27; &#125;&quot;  <br>:data=&quot;tableData&quot;  <br>:default-sort=&quot;&#123; prop: &#x27;id&#x27;, order: &#x27;ascending&#x27; &#125;&quot;  <br>:header-cell-style=&quot;&#123; &#x27;text-align&#x27;: &#x27;center&#x27; &#125;&quot;  <br>border  <br>max-height=&quot;520&quot;  <br>style=&quot;width: 100%&quot;  <br>&gt;  <br>&lt;el-table-column label=&quot;#&quot; type=&quot;index&quot; width=&quot;80&quot;&gt;  <br>&lt;template slot-scope=&quot;scope&quot;&gt;  <br>&lt;!-- (pageNum-1)*pageSize+index+1--&gt;  <br>&#123;&#123;  <br>(searchModel.pageNum - 1) * searchModel.pageSize + scope.$index + 1  <br>&#125;&#125;  <br>&lt;/template&gt;  <br>&lt;/el-table-column&gt;  <br>&lt;el-table-column label=&quot;角色id&quot; prop=&quot;roleId&quot; sortable width=&quot;200&quot;/&gt;  <br>&lt;el-table-column  <br>class=&quot;name-wrapper&quot;  <br>label=&quot;角色名称&quot;  <br>prop=&quot;roleName&quot;  <br>width=&quot;260&quot;  <br>/&gt;  <br>&lt;el-table-column label=&quot;角色描述&quot; prop=&quot;roleDesc&quot; resizable width=&quot;280&quot;/&gt;  <br>&lt;el-table-column fixed=&quot;right&quot; label=&quot;操作&quot; width=&quot;160&quot;&gt;  <br>&lt;template slot-scope=&quot;scope&quot;&gt;  <br>&lt;el-button  <br>circle  <br>icon=&quot;el-icon-delete&quot;  <br>size=&quot;small&quot;  <br>type=&quot;danger&quot;  <br>@click.native.prevent=&quot;deleteRole(scope.$index, tableData)&quot;  <br>&gt;  <br>&lt;/el-button&gt;  <br>&lt;el-button  <br>circle  <br>icon=&quot;el-icon-edit&quot;  <br>size=&quot;small&quot;  <br>type=&quot;primary&quot;  <br>@click=&quot;editRole(scope.row)&quot;  <br>&gt;  <br>&lt;/el-button&gt;  <br>&lt;/template&gt;  <br>&lt;/el-table-column&gt;  <br>&lt;/el-table&gt;  <br>&lt;/el-card&gt;  <br>&lt;!-- 分页组件--&gt;  <br>&lt;el-footer align=&quot;center&quot;&gt;  <br>&lt;div class=&quot;block&quot;&gt;  <br>&lt;el-pagination  <br>:current-page=&quot;searchModel.currentPage&quot;  <br>:page-size=&quot;searchModel.pageNum&quot;  <br>:page-sizes=&quot;pageSizes&quot;  <br>:total=&quot;total&quot;  <br>layout=&quot;total, sizes, prev, pager, next, jumper&quot;  <br>@size-change=&quot;handleSizeChange&quot;  <br>@current-change=&quot;handleCurrentChange&quot;  <br>/&gt;  <br>&lt;/div&gt;  <br>&lt;/el-footer&gt;  <br>&lt;el-backtop target=&quot;.page-component__scroll .el-scrollbar__wrap&quot;&gt;&lt;/el-backtop&gt;  <br>&lt;/div&gt;  <br>&lt;/template&gt;  <br>  <br>&lt;script&gt;  <br>import roleApi from &#x27;@/api/roleManage&#x27;  <br>import menuApi from &#x27;@/api/menuManage&#x27;  <br>import current from &#x27;element-ui/packages/table/src/store/current&#x27;  <br>// import &#x27;@/styles/roleManage.css&#x27;  <br>  <br>export default &#123;  <br>name: &#x27;Role&#x27;,  <br>data() &#123;  <br>return &#123;  <br>searchModel: &#123;  <br>queryContent: &#x27;&#x27;,  <br>pageNum: 1,  <br>pageSize: 10  <br>&#125;,  <br>pageSizes: [10, 20, 50, 100],  <br>total: 0,  <br>tableData: [],  <br>loading: true,  <br>dialogFormVisible: false,  <br>dialogTitle: &#x27;添加角色&#x27;,  <br>roleForm: &#123;  <br>roleName: &#x27;&#x27;,  <br>roleDesc: &#x27;&#x27;  <br>&#125;,  <br>rules: &#123;  <br>roleName: [  <br>&#123; required: true, message: &#x27;请输入角色名&#x27;, trigger: &#x27;blur&#x27; &#125;,  <br>&#123;  <br>min: 1,  <br>max: 20,  <br>message: &#x27;长度在 1 到 20 个字符&#x27;,  <br>trigger: &#x27;blur&#x27;  <br>&#125;  <br>],  <br>roleDesc: [  <br>&#123; required: true, message: &#x27;请输入角色描述&#x27;, trigger: &#x27;blur&#x27; &#125;,  <br>&#123;  <br>min: 1,  <br>max: 30,  <br>message: &#x27;长度在 3 到 30 个字符&#x27;,  <br>trigger: &#x27;blur&#x27;  <br>&#125;  <br>]  <br>&#125;,  <br>menuProps: &#123;  <br>label: &#x27;title&#x27;,  <br>children: &#x27;children&#x27;  <br>&#125;,  <br>menuList: []  <br>&#125;  <br>&#125;,  <br>computed: &#123;  <br>current() &#123;  <br>return current  <br>&#125;  <br>&#125;,  <br>created() &#123;  <br>this.getRoles()  <br>this.getAllMenu()  <br>&#125;,  <br>methods: &#123;  <br>getAllMenu() &#123;  <br>menuApi.getAllMenu().then(res =&gt; &#123;  <br>this.menuList = res.data.data  <br>&#125;)  <br>&#125;,  <br>getRoles() &#123;  <br>roleApi  <br>.search(this.searchModel)  <br>.then((res) =&gt; &#123;  <br>// console.log(res)  <br>this.tableData = res.data.data.records  <br>this.total = res.data.data.total  <br>this.searchModel.pageNum = res.data.data.current  <br>this.loading = false  <br>// console.log(this.searchModel.queryContent, this.searchModel.queryItem, this.searchModel.pageSize, this.searchModel.pageNum)  <br>&#125;)  <br>.catch((error) =&gt; &#123;  <br>console.log(error)  <br>&#125;)  <br>&#125;,  <br>saveRole(formName) &#123;  <br>// alert(this.roleForm)  <br>// 提交则触发表单验证  <br>this.$refs[formName].validate((valid) =&gt; &#123;  <br>if (valid) &#123;  <br>const checkedKeys = this.$refs.menuRef.getCheckedKeys()  <br>const halfcheckedKeys = this.$refs.menuRef.getHalfCheckedKeys()  <br>this.roleForm.menuIdList = checkedKeys.concat(halfcheckedKeys)  <br>// console.log(this.roleForm.menuIdList)  <br>// console.log(this.roleForm)  <br>// 提交请求到后台  <br>roleApi  <br>.save(this.roleForm)  <br>.then((res) =&gt; &#123;  <br>// console.log(res)  <br>this.dialogFormVisible = false  <br>// 提交结果消息提示  <br>this.notify(res, this.message)  <br>// 刷新表格  <br>this.getRoles()  <br>&#125;)  <br>.catch((error) =&gt; &#123;  <br>console.log(error)  <br>&#125;)  <br>&#125; else &#123;  <br>console.log(&#x27;error submit!!&#x27;)  <br>return false  <br>&#125;  <br>&#125;)  <br>&#125;,  <br>clearForm() &#123;  <br>this.roleForm = &#123;&#125;  <br>this.$refs.roleForm.clearValidate()  <br>this.$refs.menuRef.setCheckedKeys([])  <br>&#125;,  <br>handleSizeChange(pageSize) &#123;  <br>this.searchModel.pageSize = pageSize  <br>this.getRoles()  <br>&#125;,  <br>handleCurrentChange(pageNum) &#123;  <br>this.searchModel.pageNum = pageNum  <br>this.getRoles()  <br>&#125;,  <br>addRole() &#123;  <br>this.dialogTitle = &#x27;添加角色&#x27;  <br>this.dialogFormVisible = true  <br>this.message = &#x27;添加角色成功！&#x27;  <br>this.getAllMenu()  <br>&#125;,  <br>deleteRole(index, rows) &#123;  <br>// console.log(rows[index])  <br>this.$confirm(`此操作将永久删除角色&lt;strong style=&quot;color: red&quot;&gt;$&#123;rows[index].roleName&#125;&lt;/strong&gt;, 是否继续?`, &#x27;提示&#x27;, &#123;  <br>confirmButtonText: &#x27;确定&#x27;,  <br>cancelButtonText: &#x27;取消&#x27;,  <br>type: &#x27;warning&#x27;,  <br>center: true,  <br>dangerouslyUseHTMLString: true  <br>&#125;).then(() =&gt; &#123;  <br>roleApi.del(rows[index].roleId).then((res) =&gt; &#123;  <br>// console.log(res)  <br>rows.splice(index, 1)  <br>this.$message(&#123;  <br>type: &#x27;success&#x27;,  <br>message: res.message  <br>&#125;)  <br>&#125;)  <br>&#125;).catch(() =&gt; &#123;  <br>this.$message(&#123;  <br>type: &#x27;info&#x27;,  <br>message: &#x27;已取消删除&#x27;  <br>&#125;)  <br>&#125;)  <br>&#125;,  <br>editRole(row) &#123;  <br>roleApi.getById(row.roleId).then(res =&gt; &#123;  <br>this.roleForm = res.data.data  <br>console.log(res.data.data.menuIdList)  <br>this.dialogTitle = &#x27;编辑角色&#x27;  <br>this.dialogFormVisible = true  <br>this.$refs.menuRef.setCheckedKeys(res.data.data.menuIdList)  <br>this.message = &#x27;更新角色成功！&#x27;  <br>&#125;).catch(error =&gt; &#123;  <br>console.log(error)  <br>&#125;)  <br>&#125;,  <br>notify(res, message = null) &#123;  <br>if (res.code === 20000) &#123;  <br>// 提交结果消息提示  <br>this.$notify(&#123;  <br>title: &#x27;成功&#x27;,  <br>message: message != null ? message : res.message,  <br>type: &#x27;success&#x27;  <br>&#125;)  <br>&#125; else &#123;  <br>this.$notify.error(&#123;  <br>title: &#x27;失败&#x27;,  <br>message: res.message  <br>&#125;)  <br>&#125;  <br>&#125;  <br>&#125;  <br>&#125;  <br>&lt;/script&gt;  <br>  <br>&lt;style scoped&gt;&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><h3 id="3-后端-1"><a href="#3-后端-1" class="headerlink" title="3.后端"></a>3.后端</h3><p><font color="#ff0000">RoleController.java:</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.sys.controller;  <br>  <br><span class="hljs-keyword">import</span> com.alleyf.sys.entity.Role;  <br><span class="hljs-keyword">import</span> com.alleyf.sys.service.IRoleService;  <br><span class="hljs-keyword">import</span> com.alleyf.sys.utils.Result;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;  <br><span class="hljs-keyword">import</span> io.swagger.util.Json;  <br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;  <br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;  <br>  <br><span class="hljs-keyword">import</span> java.util.List;  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * &lt;p&gt;  </span><br><span class="hljs-comment"> * 前端控制器  </span><br><span class="hljs-comment"> * &lt;/p&gt;  </span><br><span class="hljs-comment"> *  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> alleyf  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2023-08-06  </span><br><span class="hljs-comment"> */</span><span class="hljs-meta">@RestController</span>  <br><span class="hljs-meta">@Slf4j</span>  <br><span class="hljs-meta">@RequestMapping(&quot;/role&quot;)</span>  <br><span class="hljs-meta">@Api(tags = &#123;&quot;角色&quot;&#125;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleController</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    IRoleService roleService;  <br>  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照角色名查询角色(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryByName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;roleName&quot;)</span> String roleName)</span> &#123;  <br>        <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.queryByName(roleName);  <br>        <span class="hljs-keyword">if</span> (role != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, role);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(roleName + <span class="hljs-string">&quot;角色不存在&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照角色名路径查询角色(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPName/&#123;roleName&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryByPName</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;roleName&quot;)</span> String roleName)</span> &#123;  <br>        <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.queryByName(roleName);  <br>        <span class="hljs-keyword">if</span> (role != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, role);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(roleName + <span class="hljs-string">&quot;角色不存在&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照id路径查询角色&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;  <br>        <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.getRoleById(id);  <br>        <span class="hljs-keyword">if</span> (role != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, role);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(<span class="hljs-string">&quot;id为:&quot;</span> + id + <span class="hljs-string">&quot;的角色不存在&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照页码查询角色(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPage&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryByPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> Long pageNum,  </span><br><span class="hljs-params">                              <span class="hljs-meta">@RequestParam(&quot;pageSize&quot;)</span> Long pageSize)</span> &#123;  <br>        IPage&lt;Role&gt; roleIPage = roleService.queryByPage(pageNum, pageSize, <span class="hljs-literal">null</span>);  <br>        <span class="hljs-keyword">return</span> roleIPage != <span class="hljs-literal">null</span> ? Result.ok().data(<span class="hljs-string">&quot;page&quot;</span>, roleIPage) : Result.error().message(<span class="hljs-string">&quot;平台没有角色&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;添加或更新角色&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">addRole</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Role role)</span> &#123;  <br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">saveStatus</span> <span class="hljs-operator">=</span> roleService.addOrUpdate(role);  <br><span class="hljs-comment">//        boolean saveStatus = roleService.saveOrUpdate(role);  </span><br>        <span class="hljs-keyword">return</span> saveStatus ? Result.ok().message(<span class="hljs-string">&quot;添加或更新角色成功&quot;</span>) : Result.error().message(<span class="hljs-string">&quot;添加或更新角色失败&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;删除角色&quot;)</span>  <br>    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delRole</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;  <br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">saveStatus</span> <span class="hljs-operator">=</span> roleService.delete(id);  <br>        <span class="hljs-keyword">return</span> saveStatus ? Result.ok().message(<span class="hljs-string">&quot;删除角色成功&quot;</span>) : Result.error().message(<span class="hljs-string">&quot;删除角色失败&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;搜索角色&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/search&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;queryContent&quot;, required = false)</span> String queryContent,  </span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(value = &quot;pageSize&quot;, defaultValue = &quot;10&quot;)</span> Long pageSize,  </span><br><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(value = &quot;pageNum&quot;, defaultValue = &quot;1&quot;)</span> Long pageNum)</span> &#123;  <br>        IPage&lt;Role&gt; roles = roleService.search(queryContent, pageSize, pageNum);  <br>        <span class="hljs-keyword">if</span> (roles != <span class="hljs-literal">null</span>) &#123;  <br>            log.debug(<span class="hljs-string">&quot;roles: &quot;</span> + roles);  <br>            <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, roles);  <br>        &#125; <span class="hljs-keyword">else</span> &#123;  <br>            <span class="hljs-keyword">return</span> Result.error().message(<span class="hljs-string">&quot;平台没有该角色&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;获取所有角色&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/all&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">getAll</span><span class="hljs-params">()</span> &#123;  <br>        List&lt;Role&gt; roles = roleService.list();  <br>        <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;data&quot;</span>, roles);  <br>    &#125;  <br>  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-数据库"><a href="#4-数据库" class="headerlink" title="4.数据库"></a>4.数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> x_menu;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span>‘x_menu’（<span class="hljs-string">&#x27;menu_id&#x27;</span>，‘component<span class="hljs-string">&#x27;，‘path&#x27;</span>，‘redirect<span class="hljs-string">&#x27;，‘name&#x27;</span>，‘title<span class="hljs-string">&#x27;，‘icon&#x27;</span>，‘parent_id<span class="hljs-string">&#x27;，‘is_leaf&#x27;</span>,<br>&quot;hidden&quot;）<span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;1&quot;,&#x27;</span>Layout<span class="hljs-string">&#x27;,&quot;/sys&#x27;</span>,<span class="hljs-string">&#x27;/sys/user&#x27;</span>,<span class="hljs-string">&#x27;sysManage&#x27;</span>,系统管理<span class="hljs-string">&#x27;,&#x27;</span>userManage<span class="hljs-string">&#x27;,&#x27;</span>o<span class="hljs-string">&#x27;,&#x27;</span>N<span class="hljs-string">&#x27;,&#x27;</span>o<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">insert into‘x_menu&#x27;</span>（menu_id<span class="hljs-string">&#x27;，‘component&#x27;</span>，‘path<span class="hljs-string">&#x27;，‘redirect&#x27;</span>，‘name<span class="hljs-string">&#x27;，‘title&#x27;</span>，‘icon<span class="hljs-string">&#x27;，‘parent_id&#x27;</span>，‘is_leaf<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">&quot;hidden&quot;）values(&#x27;</span><span class="hljs-number">2</span><span class="hljs-string">&#x27;,&#x27;</span>sys<span class="hljs-operator">/</span><span class="hljs-keyword">user</span><span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-keyword">user</span><span class="hljs-string">&#x27;,NULL,&#x27;</span>userList<span class="hljs-string">&#x27;,用户列表&#x27;</span>,<span class="hljs-string">&#x27;user&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;Y&quot;,&#x27;</span>o<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">insert into‘x_menu（&#x27;</span>menu_id<span class="hljs-string">&#x27;，‘component&#x27;</span>，‘path<span class="hljs-string">&#x27;，‘redirect&#x27;</span>，‘name<span class="hljs-string">&#x27;，‘title&#x27;</span>，‘icon<span class="hljs-string">&#x27;，‘parent_id&#x27;</span>，‘is_leaf<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">‘hidden&#x27;</span>）<span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;sys/role&#x27;</span>,<span class="hljs-string">&#x27;role&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;roleList&#x27;</span>，<span class="hljs-string">&#x27;角色列表&#x27;</span>,<span class="hljs-string">&#x27;roleManage&#x27;</span>, ,<span class="hljs-string">&#x27;Y&#x27;&#x27;o&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span>‘x_menu’（menu_id<span class="hljs-string">&#x27;，‘component&#x27;</span>，‘path<span class="hljs-string">&#x27;，‘redirect&#x27;</span>，‘name<span class="hljs-string">&#x27;，‘title&#x27;</span>, ，icon<span class="hljs-string">&#x27;，‘parent_id&#x27;</span>，‘is_leaf<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">&quot;hidden&#x27;</span>）<span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;Layout&#x27;</span>，<span class="hljs-string">&#x27;/test&#x27;</span>,<span class="hljs-string">&#x27;/test/test1&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>,<span class="hljs-string">&#x27;功能测试&#x27;</span>,<span class="hljs-string">&#x27;form&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>  <span class="hljs-number">0</span><span class="hljs-string">&#x27;）;</span><br><span class="hljs-string">insert into‘x_menu’（menu_id&#x27;</span>，‘component<span class="hljs-string">&#x27;，‘path&#x27;</span>，‘redirect<span class="hljs-string">&#x27;，‘name&#x27;</span> <span class="hljs-string">&#x27;title&#x27;</span> &quot;icon&#x27;，‘parent_id&#x27;，‘is_leaf&#x27;,<br>&quot;hidden&quot;）values(&quot;<span class="hljs-number">5</span><span class="hljs-string">&#x27;,&#x27;</span>test<span class="hljs-operator">/</span>test1<span class="hljs-string">&#x27;,&#x27;</span>test1<span class="hljs-string">&#x27;,&quot;&quot;,&#x27;</span>test1<span class="hljs-string">&#x27;,&#x27;</span>测试点<span class="hljs-operator">-</span><span class="hljs-string">&#x27;,&#x27;</span>form<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">insert into‘x_menu’（&#x27;</span>menu_id<span class="hljs-string">&#x27;，‘component&#x27;</span>，‘path<span class="hljs-string">&#x27;，‘redirect&#x27;</span>，‘name&quot;, &#x27;title&#x27; &#x27;icon&#x27;，‘parent_id&#x27;，is_leaf&#x27;,<br>‘hidden&#x27;)values(&#x27;6&#x27;,&#x27;test/test2&#x27;,&#x27;test2&#x27;, ，test2&#x27;，测试点二&quot;，<span class="hljs-string">&#x27;form&#x27;</span>   <span class="hljs-number">0</span><span class="hljs-string">&#x27;）;</span><br><span class="hljs-string">insert into‘x_menu（menu_id&#x27;</span>，‘component<span class="hljs-string">&#x27;，path&#x27;</span>，‘redirect<span class="hljs-string">&#x27;，‘name&#x27;</span>, ，‘title<span class="hljs-string">&#x27;，icon&#x27;</span>，parent_id，‘is_leaf,<br>hidden<span class="hljs-string">&#x27;)values(&#x27;</span><span class="hljs-number">7</span><span class="hljs-string">&#x27;,&#x27;</span>test<span class="hljs-operator">/</span>test3<span class="hljs-string">&#x27;,&#x27;</span>test3<span class="hljs-string">&#x27;, ,&#x27;</span>test3&quot;,&quot;测试点三<span class="hljs-string">&#x27;,&#x27;</span>form<span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-number">4</span><span class="hljs-string">&#x27;&quot;,&#x27;</span>Y&quot;,o&#x27;);<br><br></code></pre></td></tr></table></figure><h1 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h1><h2 id="1-前端"><a href="#1-前端" class="headerlink" title="1.前端"></a>1.前端</h2><h3 id="1-修改原路由配置"><a href="#1-修改原路由配置" class="headerlink" title="1.修改原路由配置"></a>1.修改原路由配置</h3><p>src/router/index.js，保留基础路由，其它的删掉或注释</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>  <br>  <br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Router</span>)  <br>  <br><span class="hljs-comment">/* Layout */</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/layout&#x27;</span>  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment">* Note: sub-menu only appear when route children.length &gt;= 1  </span><br><span class="hljs-comment">* Detail see: https://panjiachen.github.io/vue-element-admin-site/guide/essentials/router-and-nav.html  </span><br><span class="hljs-comment">*  </span><br><span class="hljs-comment">* hidden: true if set true, item will not show in the sidebar(default is false)  </span><br><span class="hljs-comment">* alwaysShow: true if set true, will always show the root menu  </span><br><span class="hljs-comment">* if not set alwaysShow, when item has more than one children route,  </span><br><span class="hljs-comment">* it will becomes nested mode, otherwise not show the root menu  </span><br><span class="hljs-comment">* redirect: noRedirect if set noRedirect will no redirect in the breadcrumb  </span><br><span class="hljs-comment">* name:&#x27;router-name&#x27; the name is used by &lt;keep-alive&gt; (must set!!!)  </span><br><span class="hljs-comment">* meta : &#123;  </span><br><span class="hljs-comment">roles: [&#x27;admin&#x27;,&#x27;editor&#x27;] control the page roles (you can set multiple roles)  </span><br><span class="hljs-comment">title: &#x27;title&#x27; the name show in sidebar and breadcrumb (recommend set)  </span><br><span class="hljs-comment">icon: &#x27;svg-name&#x27;/&#x27;el-icon-x&#x27; the icon show in the sidebar  </span><br><span class="hljs-comment">breadcrumb: false if set false, the item will hidden in breadcrumb(default is true)  </span><br><span class="hljs-comment">activeMenu: &#x27;/example/list&#x27; if set path, the sidebar will highlight the path you set  </span><br><span class="hljs-comment">&#125;  </span><br><span class="hljs-comment">*/</span>  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment">* constantRoutes  </span><br><span class="hljs-comment">* a base page that does not have permission requirements  </span><br><span class="hljs-comment">* all roles can be accessed  </span><br><span class="hljs-comment">*/</span>  <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constantRoutes = [  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/redirect&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,  <br><span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,  <br><span class="hljs-attr">children</span>: [  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/redirect/:path(.*)&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/redirect/index&#x27;</span>)  <br>&#125;  <br>]  <br>&#125;,  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/login&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/login/index&#x27;</span>),  <br><span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>  <br>&#125;,  <br>  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/404&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/404&#x27;</span>),  <br><span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>  <br>&#125;,  <br>  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,  <br><span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/dashboard&#x27;</span>,  <br><span class="hljs-attr">children</span>: [&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;dashboard&#x27;</span>,  <br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Dashboard&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/dashboard/index&#x27;</span>),  <br><span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;首 页&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;dashboard&#x27;</span>, <span class="hljs-attr">affix</span>: <span class="hljs-literal">true</span> &#125;  <br>&#125;]  <br>&#125;,  <br>  <br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;/sys&#x27;,  </span><br><span class="hljs-comment">// component: Layout,  </span><br><span class="hljs-comment">// redirect: &#x27;/sys/user&#x27;,  </span><br><span class="hljs-comment">// name: &#x27;Sys&#x27;,  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;系统管理&#x27;, icon: &#x27;el-icon-s-help&#x27; &#125;,  </span><br><span class="hljs-comment">// children: [  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;user&#x27;,  </span><br><span class="hljs-comment">// name: &#x27;User&#x27;,  </span><br><span class="hljs-comment">// component: () =&gt; import(&#x27;@/views/sys/user&#x27;),  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;系统用户&#x27;, icon: &#x27;user&#x27; &#125;  </span><br><span class="hljs-comment">// &#125;,  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;role&#x27;,  </span><br><span class="hljs-comment">// name: &#x27;Role&#x27;,  </span><br><span class="hljs-comment">// component: () =&gt; import(&#x27;@/views/sys/role&#x27;),  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;系统身份&#x27;, icon: &#x27;tree&#x27; &#125;  </span><br><span class="hljs-comment">// &#125;  </span><br><span class="hljs-comment">// ]  </span><br><span class="hljs-comment">// &#125;,  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;/test&#x27;,  </span><br><span class="hljs-comment">// component: Layout,  </span><br><span class="hljs-comment">// redirect: &#x27;/test/test1&#x27;,  </span><br><span class="hljs-comment">// name: &#x27;Test&#x27;,  </span><br><span class="hljs-comment">// meta: &#123;  </span><br><span class="hljs-comment">// title: &#x27;新品尝鲜&#x27;,  </span><br><span class="hljs-comment">// icon: &#x27;nested&#x27;  </span><br><span class="hljs-comment">// &#125;,  </span><br><span class="hljs-comment">// children: [  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;test1&#x27;,  </span><br><span class="hljs-comment">// component: () =&gt; import(&#x27;@/views/test/test1&#x27;),  </span><br><span class="hljs-comment">// name: &#x27;Test1&#x27;,  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;功能1&#x27; &#125;  </span><br><span class="hljs-comment">// &#125;,  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;test2&#x27;,  </span><br><span class="hljs-comment">// component: () =&gt; import(&#x27;@/views/test/test2&#x27;),  </span><br><span class="hljs-comment">// name: &#x27;Test2&#x27;,  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;功能2&#x27; &#125;  </span><br><span class="hljs-comment">// &#125;,  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;test3&#x27;,  </span><br><span class="hljs-comment">// component: () =&gt; import(&#x27;@/views/test/test3&#x27;),  </span><br><span class="hljs-comment">// name: &#x27;Test3&#x27;,  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;功能3&#x27; &#125;  </span><br><span class="hljs-comment">// &#125;  </span><br><span class="hljs-comment">// ]  </span><br><span class="hljs-comment">// &#125;,  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;external-link&#x27;,  </span><br><span class="hljs-comment">// component: Layout,  </span><br><span class="hljs-comment">// children: [  </span><br><span class="hljs-comment">// &#123;  </span><br><span class="hljs-comment">// path: &#x27;https://panjiachen.github.io/vue-element-admin-site/#/&#x27;,  </span><br><span class="hljs-comment">// meta: &#123; title: &#x27;External Link&#x27;, icon: &#x27;link&#x27; &#125;  </span><br><span class="hljs-comment">// &#125;  </span><br><span class="hljs-comment">// ]  </span><br><span class="hljs-comment">// &#125;,  </span><br>  <br><span class="hljs-comment">// 404 page must be placed at the end !!!  </span><br>&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/404&#x27;</span>, <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> &#125;  <br>]  <br>  <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createRouter</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>(&#123;  <br><span class="hljs-comment">// mode: &#x27;history&#x27;, // require service support  </span><br><span class="hljs-attr">scrollBehavior</span>: <span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;),  <br><span class="hljs-attr">routes</span>: constantRoutes  <br>&#125;)  <br>  <br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>()  <br>  <br><span class="hljs-comment">// Detail see: https://github.com/vuejs/vue-router/issues/1234#issuecomment-357941465  </span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">resetRouter</span>(<span class="hljs-params"></span>) &#123;  <br><span class="hljs-keyword">const</span> newRouter = <span class="hljs-title function_">createRouter</span>()  <br>router.<span class="hljs-property">matcher</span> = newRouter.<span class="hljs-property">matcher</span> <span class="hljs-comment">// reset router  </span><br>&#125;  <br>  <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br><br></code></pre></td></tr></table></figure><h3 id="2-获取菜单数据并保存到Vuex"><a href="#2-获取菜单数据并保存到Vuex" class="headerlink" title="2.获取菜单数据并保存到Vuex"></a>2.获取菜单数据并保存到Vuex</h3><p>src/store/modules/user.js<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202310031453650.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202310031453642.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202310031453615.png" alt="image.png"><br>src/store/getters.js<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202310031454406.png" alt="image.png"></p><h3 id="3-路由转换"><a href="#3-路由转换" class="headerlink" title="3.路由转换"></a>3.路由转换</h3><p>修改src目录下的permiss.js<br>（1）导入Layout</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> layout <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/layout&#x27;</span><br></code></pre></td></tr></table></figure><p>（2）添加动态路由</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//路由转换  </span><br><span class="hljs-keyword">let</span> myRoutes = <span class="hljs-title function_">myFilterAsyncRoutes</span>(store.<span class="hljs-property">getters</span>.<span class="hljs-property">menuList</span>)  <br><span class="hljs-comment">// 404  </span><br>myRoutes.<span class="hljs-title function_">push</span>(&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;*&#x27;</span>,  <br><span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/404&#x27;</span>,  <br><span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>  <br>&#125;)  <br><span class="hljs-comment">//动态添加路由  </span><br>router.<span class="hljs-title function_">addRoutes</span>(myRoutes)  <br><span class="hljs-comment">//存至全局变量  </span><br><span class="hljs-variable language_">global</span>.<span class="hljs-property">myRoutes</span> = myRoutes  <br>  <br><span class="hljs-title function_">next</span>(&#123; ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> &#125;)<span class="hljs-comment">// 防止刷新后页面空白</span><br></code></pre></td></tr></table></figure><p>完整部分：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span>  <br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span>  <br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Message</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-title class_">NProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;nprogress&#x27;</span> <span class="hljs-comment">// progress bar  </span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;nprogress/nprogress.css&#x27;</span> <span class="hljs-comment">// progress bar style  </span><br><span class="hljs-keyword">import</span> &#123; getToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/auth&#x27;</span> <span class="hljs-comment">// get token from cookie  </span><br><span class="hljs-keyword">import</span> getPageTitle <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/get-page-title&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/layout&#x27;</span>  <br>  <br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">configure</span>(&#123; <span class="hljs-attr">showSpinner</span>: <span class="hljs-literal">false</span> &#125;) <span class="hljs-comment">// NProgress Configuration  </span><br>  <br><span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">&#x27;/login&#x27;</span>] <span class="hljs-comment">// no redirect whitelist  </span><br>  <br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-title function_">async</span>(to, <span class="hljs-keyword">from</span>, next) =&gt; &#123;  <br><span class="hljs-comment">// start progress bar  </span><br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">start</span>()  <br>  <br><span class="hljs-comment">// set page title  </span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-title function_">getPageTitle</span>(to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>)  <br>  <br><span class="hljs-comment">// determine whether the user has logged in  </span><br><span class="hljs-keyword">const</span> hasToken = <span class="hljs-title function_">getToken</span>()  <br>  <br><span class="hljs-keyword">if</span> (hasToken) &#123;  <br><span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) &#123;  <br><span class="hljs-comment">// if is logged in, redirect to the home page  </span><br><span class="hljs-title function_">next</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span> &#125;)  <br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br><span class="hljs-keyword">const</span> hasGetUserInfo = store.<span class="hljs-property">getters</span>.<span class="hljs-property">name</span>  <br><span class="hljs-keyword">if</span> (hasGetUserInfo) &#123;  <br><span class="hljs-title function_">next</span>()  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br><span class="hljs-keyword">try</span> &#123;  <br><span class="hljs-comment">// get user info  </span><br><span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/getInfo&#x27;</span>)  <br><span class="hljs-comment">// console.log(store.getters.menuList)  </span><br><span class="hljs-comment">// 路由转换  </span><br><span class="hljs-keyword">const</span> myRoutes = <span class="hljs-title function_">myFilterAsyncRoutes</span>(store.<span class="hljs-property">getters</span>.<span class="hljs-property">menuList</span>)  <br><span class="hljs-comment">// 404  </span><br>myRoutes.<span class="hljs-title function_">push</span>(&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;*&#x27;</span>,  <br><span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/404&#x27;</span>,  <br><span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>  <br>&#125;)  <br><span class="hljs-comment">// 动态添加路由  </span><br>router.<span class="hljs-title function_">addRoutes</span>(myRoutes)  <br><span class="hljs-comment">// 存至全局变量  </span><br><span class="hljs-variable language_">global</span>.<span class="hljs-property">myRoutes</span> = myRoutes  <br>  <br><span class="hljs-title function_">next</span>(&#123; ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> &#125;)<span class="hljs-comment">// 防止刷新后页面空白  </span><br>  <br><span class="hljs-comment">// next()  </span><br>&#125; <span class="hljs-keyword">catch</span> (error) &#123;  <br><span class="hljs-comment">// remove token and go to login page to re-login  </span><br><span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;user/resetToken&#x27;</span>)  <br><span class="hljs-comment">// Message.error(error || &#x27;Has Error&#x27;)  </span><br><span class="hljs-title class_">Message</span>.<span class="hljs-title function_">error</span>(&#123; <span class="hljs-attr">message</span>: error || <span class="hljs-string">&#x27;Has Error&#x27;</span> &#125;)  <br><span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>)  <br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()  <br>&#125;  <br>&#125;  <br>&#125;  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br><span class="hljs-comment">/* has no token*/</span>  <br>  <br><span class="hljs-keyword">if</span> (whiteList.<span class="hljs-title function_">indexOf</span>(to.<span class="hljs-property">path</span>) !== -<span class="hljs-number">1</span>) &#123;  <br><span class="hljs-comment">// in the free login whitelist, go directly  </span><br><span class="hljs-title function_">next</span>()  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br><span class="hljs-comment">// other pages that do not have permission to access are redirected to the login page.  </span><br><span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>)  <br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()  <br>&#125;  <br>&#125;  <br>&#125;)  <br>  <br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> &#123;  <br><span class="hljs-comment">// finish progress bar  </span><br><span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()  <br>&#125;)  <br>  <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">myFilterAsyncRoutes</span>(<span class="hljs-params">menuList</span>) &#123;  <br>menuList.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">menu</span> =&gt;</span> &#123;  <br><span class="hljs-comment">// console.log(menu)  </span><br><span class="hljs-keyword">if</span> (menu.<span class="hljs-property">component</span> === <span class="hljs-string">&#x27;Layout&#x27;</span>) &#123;  <br><span class="hljs-comment">// console.log(menu.component)  </span><br>menu.<span class="hljs-property">component</span> = <span class="hljs-title class_">Layout</span>  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br>menu.<span class="hljs-property">component</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">`@/views/<span class="hljs-subst">$&#123;menu.component&#125;</span>.vue`</span>).<span class="hljs-property">default</span>  <br>&#125;  <br><span class="hljs-comment">// 递归处理子菜单  </span><br><span class="hljs-keyword">if</span> (menu.<span class="hljs-property">children</span> &amp;&amp; menu.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>) &#123;  <br>menu.<span class="hljs-property">children</span> = <span class="hljs-title function_">myFilterAsyncRoutes</span>(menu.<span class="hljs-property">children</span>)  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>  <br>&#125;)  <br><span class="hljs-keyword">return</span> menuList  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-路由合并"><a href="#4-路由合并" class="headerlink" title="4.路由合并"></a>4.路由合并</h3><p>src/layout/components/Sidebar/index.vue</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">routes</span>(<span class="hljs-params"></span>) &#123;  <br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-property">options</span>.<span class="hljs-property">routes</span>.<span class="hljs-title function_">concat</span>(<span class="hljs-variable language_">global</span>.<span class="hljs-property">myRoutes</span>)  <br>&#125;,<br><br></code></pre></td></tr></table></figure><h1 id="Vue-框架快速上手"><a href="#Vue-框架快速上手" class="headerlink" title="Vue 框架快速上手"></a>Vue 框架快速上手</h1><blockquote><p><strong>[[Vue]]</strong></p></blockquote><h2 id="1-前端环境准备"><a href="#1-前端环境准备" class="headerlink" title="1. 前端环境准备"></a>1. 前端环境准备</h2><p>Vscode 或者WebStorm</p><h2 id="2-Vue-框架介绍"><a href="#2-Vue-框架介绍" class="headerlink" title="2.Vue 框架介绍"></a>2.Vue 框架介绍</h2><p>尤雨溪制作的渐进式 js 框架</p><h2 id="3-Vue-快速入门"><a href="#3-Vue-快速入门" class="headerlink" title="3.Vue 快速入门"></a>3.Vue 快速入门</h2><ul><li>导入 vue. js 的 script 脚本文件</li></ul><p> <code>&lt;script src=&quot;https://unpkg.com/vue@next&quot;&gt;&lt;/script&gt;</code></p><ul><li>在页面中声明一个将要被 vue 所控制的 DOM 区域，既 MVVM 中的 View</li></ul><pre><code class="hljs">`&lt;div id=&quot;app&quot;&gt;  &#123;&#123; message &#125;&#125;&lt;/div&gt;`</code></pre><ul><li>创建 vm 实例对象 (vue 实例对象)</li></ul><p><code>const hello = &#123;    //指定数据源，既 MVVM 中的 Mode1    data: function () &#123;       return &#123;          message: &#39;Hello Vue!&#39;       &#125; &#125; const app = Vue.createApp (hello) app. mount（&#39; #app &#39;）/／指定当前 vue 实例要控制页面的哪个区域</code></p><h1 id="7-项目部署"><a href="#7-项目部署" class="headerlink" title="7. 项目部署"></a>7. 项目部署</h1><h2 id="1-云端环境准备"><a href="#1-云端环境准备" class="headerlink" title="1. 云端环境准备"></a>1. 云端环境准备</h2><h3 id="安装-Mysql"><a href="#安装-Mysql" class="headerlink" title="安装 Mysql"></a>安装 Mysql</h3><table><thead><tr><th>环境</th><th>准备</th><th align="center"></th><th></th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021153950.png"/></td><td><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021200042.png"/></td><td align="center"></td><td></td></tr><tr><td><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021206531.png" alt="image.png"></td><td></td><td align="center"></td><td></td></tr><tr><td><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021214865.png" alt="image.png"></td><td></td><td align="center"></td><td></td></tr></tbody></table><h3 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install epel-release<br>yum update<br>yum -y install nginx<br></code></pre></td></tr></table></figure><p>nginx 命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start nginx #开启nginx服务<br>systemctl stop nginx #停止nginx服务<br>systemctl restart nginx #重启nginx服务<br></code></pre></td></tr></table></figure><h3 id="配置-JDK"><a href="#配置-JDK" class="headerlink" title="配置 JDK"></a>配置 JDK</h3><p>下载 JDK，登录官方 <a href="https://www.oracle.com/java/technologies/downloads/java8%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80%E7%89%88%E6%9C%AC%E7%9A%84JDK">https://www.oracle.com/java/technologies/downloads/java8下载所需版本的JDK</a> ，版本为 JDK1.8</p><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021240929.png" alt="image.png"><br>解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zvxf jdk-8u131-linux-x64.tar.gz<br></code></pre></td></tr></table></figure><p>编辑/etc/profile 文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">文件末尾增加</span><br>export JAVA_HOME=/usr/server/jdk1.8.0_131<br></code></pre></td></tr></table></figure><p>执行 source 命令，使配置立即生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /etc/profile<br></code></pre></td></tr></table></figure><p>检查是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -version<br></code></pre></td></tr></table></figure><h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="部署-Vue-项目"><a href="#部署-Vue-项目" class="headerlink" title="部署 Vue 项目"></a>部署 Vue 项目</h3><h4 id="打包-vue-项目"><a href="#打包-vue-项目" class="headerlink" title="打包 vue 项目"></a>打包 vue 项目</h4><p>进入到 Vue 项目目录，执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm run build<br></code></pre></td></tr></table></figure><p>将生成的 dist 目录上传至服务器/usr/vue/dist</p><h4 id="配置-nginx"><a href="#配置-nginx" class="headerlink" title="配置 nginx"></a>配置 nginx</h4><p>进入到/etc/nginx/conf.d 目录，创建 vue.conf 文件，内容如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>   listen  80;<br>   server_name locahost;<br><br>   1ocation / &#123;<br>       root /usr/app/dist;<br>       index index.html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>使配置生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -s reload<br></code></pre></td></tr></table></figure><h3 id="打包-Java-程序"><a href="#打包-Java-程序" class="headerlink" title="打包 Java 程序"></a>打包 Java 程序</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308021501320.png" alt="image.png"><br>因为 springboot 有内置 tomcat 容器，这点比较方便，省去了 tomcat 的部署。我们到时候直接可以直接把 jar 包扔到 linux 上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nohup java -jar demo-0.0.1-SNAPSHOT.jar &gt; logName.1og 2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol><li><a href="https://www.bilibili.com/video/BV1nV4y1s7ZN/">1天搞定SpringBoot+Vue全栈开发_哔哩哔哩_bilibili</a></li><li><a href="https://blog.csdn.net/javaDeveloper2010/article/details/129119489">Springdoc和Springfox</a></li></ol>]]></content>
    
    
    <summary type="html">it is some basic usage of SpringBoot .</summary>
    
    
    
    <category term="Java" scheme="https://alleyf.github.io/categories/Java/"/>
    
    
    <category term="SpringBoot" scheme="https://alleyf.github.io/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>DRF速通</title>
    <link href="https://alleyf.github.io/2023/04/fbae7fa42803.html"/>
    <id>https://alleyf.github.io/2023/04/fbae7fa42803.html</id>
    <published>2023-04-25T11:29:25.000Z</published>
    <updated>2023-04-27T16:31:05.747Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> 其他相关文章-&gt; [[网页开发]]， #DRF #Django</p></blockquote><h1 id="1-api-接口"><a href="#1-api-接口" class="headerlink" title="1. api 接口"></a>1. api 接口</h1><p>目前市面上大部分公司开发人员使用的接口实现规范主要有：restful、RPC。<br>RPC（ Remote Procedure Call ）: 翻译成中文:远程过程调用[远程服务调用]. 从字面上理解就是访问/调用远程服务端提供的api接口。这种接口一般以服务或者过程式代码提供。<br>restful: 翻译成中文: 资源状态转换.(表征性状态转移)</p><ul><li>把服务端提供的所有的数据/文件都看成资源， 那么通过api接口请求数据的操作，本质上来说就是对资源的操作了.  因此，restful中要求，我们把当前接口对外提供哪种资源进行操作，就把<strong>资源的名称写在url地址</strong>。</li><li>  web开发中操作资源，最常见的最通用的无非就是增删查改，所以restful要求在地址栏中声明要操作的资源是什么。然后通过<strong>http请求动词</strong>来说明对该资源进行哪一种操作.</li></ul><blockquote><p>POST <a href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a> 添加学生数据</p><p>GET <a href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a> 获取所有学生</p><p>GET <a href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a>/ 获取id=pk的学生</p><p>DELETE <a href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a>/ 删除id=pk的一个学生</p><p>PUT <a href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a>/ 修改一个学生的全部信息 [id,name,sex,age,]</p><p>PATCH <a href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a> / 修改一个学生的部分信息[age]</p></blockquote><p>请求方式：<em><strong>增删改查查</strong></em></p><ol><li>restful 是以资源为主的 api 接口规范，体现在地址上就是资源就是以名词表达。</li><li>rpc 则以动作为主的 api 接口规范，体现在接口名称上往往附带操作数据的动作。</li></ol><hr><h1 id="2-Django-的-CBV"><a href="#2-Django-的-CBV" class="headerlink" title="2.Django 的 CBV"></a>2.Django 的 CBV</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># CBV模式,views.py</span><br><span class="hljs-keyword">from</span> django.views <span class="hljs-keyword">import</span> View<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookView</span>(<span class="hljs-title class_ inherited__">View</span>) ;<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, reguest</span>):<br><span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;View GET请求...&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self, reguest</span>):<br><span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;View POST请求...&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;View DELETE请求&#x27;&#x27;&#x27;&quot;</span>)<br><span class="hljs-comment"># urls.py</span><br><span class="hljs-keyword">from</span> django. contrib <span class="hljs-keyword">import</span> admin<br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><span class="hljs-keyword">from</span> book <span class="hljs-keyword">import</span> views<br>urlpatterns = [<br>path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin. site.urls) ,<br><span class="hljs-comment"># path( &#x27;book/&#x27;, views.book) ,</span><br>path(<span class="hljs-string">&quot;book/&quot;</span>.views . BookView.asTview()) <span class="hljs-comment">#路由中的“/”不能丢，否则自动重定向为get请求</span><br>]<br></code></pre></td></tr></table></figure><hr><h1 id="3-反射"><a href="#3-反射" class="headerlink" title="3. 反射"></a>3. 反射</h1><p>通过反射 <code>func = getattr(self,func_name_str)</code> 可以将<strong>字符串转变为变量 (函数)<strong>，接着就可以直接调用 func () 从而</strong>动态调用函数</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-title class_ inherited__">object</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name,age,func_str</span>):<br>self.name = name<br>self.age = age<br>func = <span class="hljs-built_in">getattr</span>(self,func_str)<br>func() <span class="hljs-comment"># 等价于self.slepp() </span><br>a = Animal(<span class="hljs-string">&quot;alleyf&quot;</span>,<span class="hljs-number">21</span>,<span class="hljs-string">&quot;sleep&quot;</span>)<br></code></pre></td></tr></table></figure><hr><h1 id="4-Drf"><a href="#4-Drf" class="headerlink" title="4. Drf"></a>4. Drf</h1><blockquote><p>安装 drf：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install djangorestframework<br></code></pre></td></tr></table></figure><blockquote><p>注册 drf app：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">INSTALLED_APPS = [<br>... ,<br><span class="hljs-string">&#x27;rest_framework&#x27;</span>, <br>]<br></code></pre></td></tr></table></figure><hr><h2 id="1-APIView"><a href="#1-APIView" class="headerlink" title="1. APIView"></a>1. APIView</h2><ol><li>重写了 View 的 as_view ()和 dispatch（）方法，构建了新的 request 对象实现<strong>认证、权限和限流</strong>作用。</li><li><code>request. Get ()-&gt;request. Query_params ()</code>获取 get 请求参数</li><li><code>request. Post ()-&gt;request. Data ()</code> 获取 post(put 等)请求体数据，包括 files 都封装在一起反序列化了，支持前端 urlcoded 格式和 json 等其他任何格式。</li></ol><p>路由执行过程：<br><span style="background:#b1ffff">as_view ()-&gt;view ()-&gt;dispatch ()-&gt;get/post· · ·</span></p><hr><h2 id="2-Serializer-（反）序列化器"><a href="#2-Serializer-（反）序列化器" class="headerlink" title="2.Serializer （反）序列化器"></a>2.Serializer （反）序列化器</h2><p><img src="https://s2.loli.net/2023/04/26/VukBIX39lj2Kbx6.png" alt="（反）序列化器|425"></p><blockquote><p>[!NOTE] keys</p><ul><li>序列化：数据表数据-&gt;前端显示的 json 数据 （get 请求，<strong>取数据</strong>）</li><li>反序列化：前端提交的 json 数据-&gt;数据表数据（post、put、patch、delete 等请求，<strong>存数据</strong>）</li></ul></blockquote><h3 id="1-序列化与反序列化"><a href="#1-序列化与反序列化" class="headerlink" title="1.序列化与反序列化"></a>1.序列化与反序列化</h3><p><strong>常用字段类型</strong>：<br>| 字段                    | 构造方式                                                                             |<br>| ———————– | ———————————————————————————— |<br>| <strong>BooleanField</strong>        | BooleanField()                                                                       |<br>| <strong>CharField</strong>           | CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True) |<br>| <strong>EmailField</strong>          | EmailField(max_length=None, min_length=None, allow_blank=False)                      |<br>| <strong>URLField</strong>            | URLField(max_length=200, min_length=None, allow_blank=False)                         |<br>| <strong>IPAddressField</strong>      | IPAddressField(protocol=‘both’, unpack_ipv4=False, options)                          |<br>| <strong>IntegerField</strong>        | IntegerField(max_value=None, min_value=None)                                         |<br>| <strong>FloatField</strong>          | FloatField(max_value=None, min_value=None)                                           |<br>| <strong>DateTimeField</strong>       | DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)               |<br>| <strong>DateField</strong>           | DateField(format=api_settings.DATE_FORMAT, input_formats=None)                       |<br>| <strong>TimeField</strong>           | TimeField(format=api_settings.TIME_FORMAT, input_formats=None)                       |<br>| <strong>ChoiceField</strong>         | ChoiceField(choices) choices 与 Django 的用法相同                                    |<br>| <strong>MultipleChoiceField</strong> | MultipleChoiceField(choices)                                                         |<br>| <strong>FileField</strong>           | FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)   |<br>| <strong>ImageField</strong>          | ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)  |<br>| <strong>ListField</strong>           | ListField(child=, min_length=None, max_length=None)                                  |<br>| <strong>DictField</strong>           | DictField(child=)                                                                    |<br><strong>选项参数：</strong><br>| 参数名称            | 作用             |<br>| ——————- | —————- |<br>| <strong>max_length</strong>      | 最大长度         |<br>| <strong>min_lenght</strong>      | 最小长度         |<br>| <strong>allow_blank</strong>     | 是否允许为空     |<br>| <strong>trim_whitespace</strong> | 是否截断空白字符 |<br>| <strong>max_value</strong>       | 最小值           |<br>| <strong>min_value</strong>       |     最大值             |<br><strong>通用参数：</strong><br>| 参数名称           | 说明                                      |<br>| —————— | —————————————– |<br>| <strong>read_only</strong>      | 表明该字段仅用于序列化输出，默认False     |<br>| <strong>write_only</strong>     | 表明该字段仅用于反序列化输入，默认False   |<br>| <strong>required</strong>       | 表明该字段在反序列化时必须输入，默认True  |<br>| <strong>default</strong>        | 反序列化时使用的默认值                    |<br>| <strong>allow_null</strong>     | 表明该字段是否允许传入 None，默认 False   |<br>| <strong>validators</strong>     | 该字段使用的验证器                        |<br>| <strong>error_messages</strong> | 包含错误编号与错误信息的字典              |<br>| <strong>label</strong>          | 用于 HTML 展示 API 页面时，显示的字段名称 |<br>| <strong>help_text</strong>      |  用于HTML展示API页面时，显示的字段帮助提示信息                                         |</p><ol><li>新建模型（反）序列化器</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> serializers<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookSerializers</span>(serializers.Serializer):<br><span class="hljs-string">&quot;&quot;&quot;Book的(反)序列化器&quot;&quot;&quot;</span><br>title = serializers.CharField (max_length=<span class="hljs-number">3</span>)<br>price = serializers.IntegerField(require=<span class="hljs-literal">True</span>)<br>date = serializers.DateField(source=<span class="hljs-string">&quot;pub_date&quot;</span>)<br><span class="hljs-comment"># 该方法必须被重写否则无法使用serializer.save()新建数据,实现view与serializer解耦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">self,validated_data</span>):<br>new_book = Book.objects.create(**serializer.validated_data)<br><span class="hljs-keyword">return</span> new_book<br><span class="hljs-comment"># 该方法必须被重写否则无法使用serializer.save()更新数据，实现view与serializer解耦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self,validated_data</span>):<br><span class="hljs-comment"># 修改数据</span><br>Book.objects.<span class="hljs-built_in">filter</span>(pk=instance.pk).update(**serializer.validated_data)<br><span class="hljs-comment"># 设置序列化器的实例为更新后的对象</span><br>updated_book = Book.objects.get(pk=instance.pk)<br><span class="hljs-keyword">return</span> updated_book<br></code></pre></td></tr></table></figure><blockquote><ol><li>（反）序列化器的字段名与数据表的字段名必须一致，否则需要指定 <code>source</code> 指向某个字段</li><li>字段规则要根据数据表的规则设置</li></ol></blockquote><ol start="2"><li>新建模型视图类</li></ol><blockquote><ul><li><strong>根据需求重写 get、post、put、delete 等方法</strong></li><li>除了 <strong>delete 返回 none</strong> 外，其他方法都要返回改变的<strong>序列化为 json 后的数据</strong></li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.response <span class="hljs-keyword">import</span> Response<br><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> viewsets<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookView</span>(<span class="hljs-title class_ inherited__">APIView</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-string">&quot;&quot;&quot;序列化&quot;&quot;&quot;</span><br><span class="hljs-comment"># query_params = request.query_params() 获取get的url请求参数 </span><br>queryset = Book.objects.<span class="hljs-built_in">all</span>() <span class="hljs-comment"># 当查询过滤得到一个对象时，many=False</span><br><span class="hljs-comment"># 构建序列化对象</span><br>serializer = BookSerializer(instance=queryset,many=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">return</span> Response(serilaizer.data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-string">&quot;&quot;&quot;反序列化&quot;&quot;&quot;</span><br><span class="hljs-comment"># 构建反序列化对象 </span><br>serializer = BookSerializer(data=request.data)<br><span class="hljs-comment"># 数据校验</span><br><span class="hljs-keyword">if</span> serializer.is_valid():<br><span class="hljs-comment"># 校验通过创建新数据，返回新建的json数据 </span><br>serializer.save()<br><span class="hljs-keyword">return</span> Response(serializer.data)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-comment"># 校验失败，返回错误 </span><br><span class="hljs-keyword">return</span> Response(serializer.errors) <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDetailView</span>(<span class="hljs-title class_ inherited__">APIView</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self,request,<span class="hljs-built_in">id</span></span>):<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">从数据库获取指定id的数据</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>singleBook = Book.objects.get(pk=<span class="hljs-built_in">id</span>)<br><span class="hljs-comment"># 构建序列化器转为json数据</span><br>serializer = Serializer(instance=singleBook,many=<span class="hljs-literal">False</span>)<br><span class="hljs-keyword">return</span> Response(serializer.data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">put</span>(<span class="hljs-params">self,request,<span class="hljs-built_in">id</span></span>):<br><span class="hljs-string">&quot;&quot;&quot;修改指定id的数据&quot;&quot;&quot;</span><br>update_bookobj = Book.objects.get(pk=<span class="hljs-built_in">id</span>)<br><span class="hljs-comment"># 构建反序列化器</span><br>serializer = Serializer(instance=update_bookobj,data=request.data)<br><span class="hljs-comment"># 数据校验</span><br><span class="hljs-keyword">if</span> serializer.is_valid():<br>serializer.save()<br><span class="hljs-comment"># 序列化修改后的对象并返回</span><br><span class="hljs-keyword">return</span> Response(serializer.data)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-comment"># 校验失败，返回错误 </span><br><span class="hljs-keyword">return</span> Response(serializer.errors) <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self,request,<span class="hljs-built_in">id</span></span>):<br>Book.objects.get(pk=<span class="hljs-built_in">id</span>).delete()<br><span class="hljs-comment"># 直接返回空</span><br><span class="hljs-keyword">return</span> Response()<br></code></pre></td></tr></table></figure><ol start="3"><li>路由配置（urls.py）</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path,re_path ,include<br><span class="hljs-keyword">from</span> views <span class="hljs-keyword">import</span> Bookview , BookDetailview<br>urlpatterns = [<br>path(<span class="hljs-string">&#x27;books/&#x27;</span>,Bookview.as_view()),<br>re_path(<span class="hljs-string">&#x27;books/(?P&lt;pk&gt;\d+)/&#x27;</span>,BookDetailview.as_view()),<br>]<br></code></pre></td></tr></table></figure><h3 id="2-Response"><a href="#2-Response" class="headerlink" title="2. Response"></a>2. Response</h3><blockquote><p>drf 重写后的 response<br><code>Response(data, status=None, template_name=None, headers=None, content_type=None)</code></p></blockquote><blockquote><p>[!NOTE] 常用参数概念</p><ol><li><code>data</code> ：python 的基本数据类型或者序列化后的数据</li><li><code>status</code>：返回状态码，eg：200，403 etc</li><li><code>template_name</code>: 模板名称，如果使用 <code>HTMLRenderer</code> 时需指明；</li><li> <code>headers</code>: 用于存放响应头信息的字典；</li><li> <code>content_type</code>: 响应数据的 Content-Type，通常此参数无需传递，REST framework 会根据前端所需类型数据来设置该参数</li></ol></blockquote><h3 id="3-状态码"><a href="#3-状态码" class="headerlink" title="3. 状态码"></a>3. 状态码</h3><blockquote><p>为了方便设置状态码，REST framewrok在<code>rest_framework.status</code>模块中提供了常用http状态码的常量。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1）信息告知 - 1xx </span><br>HTTP_100_CONTINUE <br>HTTP_101_SWITCHING_PROTOCOLS <br><span class="hljs-comment"># 2）成功 - 2xx </span><br>HTTP_200_OK <br>HTTP_201_CREATED <br>HTTP_202_ACCEPTED <br>HTTP_203_NON_AUTHORITATIVE_INFORMATION HTTP_204_NO_CONTENT <br>HTTP_205_RESET_CONTENT <br>HTTP_206_PARTIAL_CONTENT <br>HTTP_207_MULTI_STATUS <br><span class="hljs-comment"># 3）重定向 - 3xx </span><br>HTTP_300_MULTIPLE_CHOICES <br>HTTP_301_MOVED_PERMANENTLY <br>HTTP_302_FOUND <br>HTTP_303_SEE_OTHER <br>HTTP_304_NOT_MODIFIED <br>HTTP_305_USE_PROXY <br>HTTP_306_RESERVED <br>HTTP_307_TEMPORARY_REDIRECT <br><span class="hljs-comment"># 4）客户端错误 - 4xx </span><br>HTTP_400_BAD_REQUEST <br>HTTP_401_UNAUTHORIZED <br>HTTP_402_PAYMENT_REQUIRED <br>HTTP_403_FORBIDDEN <br>HTTP_404_NOT_FOUND <br>HTTP_405_METHOD_NOT_ALLOWED <br>HTTP_406_NOT_ACCEPTABLE HTTP_407_PROXY_AUTHENTICATION_REQUIRED HTTP_408_REQUEST_TIMEOUT <br>HTTP_409_CONFLICT <br>HTTP_410_GONE <br>HTTP_411_LENGTH_REQUIRED <br>HTTP_412_PRECONDITION_FAILED HTTP_413_REQUEST_ENTITY_TOO_LARGE HTTP_414_REQUEST_URI_TOO_LONG HTTP_415_UNSUPPORTED_MEDIA_TYPE HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE HTTP_417_EXPECTATION_FAILED <br>HTTP_422_UNPROCESSABLE_ENTITY <br>HTTP_423_LOCKED <br>HTTP_424_FAILED_DEPENDENCY <br>HTTP_428_PRECONDITION_REQUIRED <br>HTTP_429_TOO_MANY_REQUESTS HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS <br><span class="hljs-comment"># 5）服务器错误 - 5xx </span><br>HTTP_500_INTERNAL_SERVER_ERROR <br>HTTP_501_NOT_IMPLEMENTED <br>HTTP_502_BAD_GATEWAY <br>HTTP_503_SERVICE_UNAVAILABLE <br>HTTP_504_GATEWAY_TIMEOUT HTTP_505_HTTP_VERSION_NOT_SUPPORTED HTTP_507_INSUFFICIENT_STORAGE HTTP_511_NETWORK_AUTHENTICATION_REQUIRED<br></code></pre></td></tr></table></figure><hr><h2 id="3-ModelSerializer"><a href="#3-ModelSerializer" class="headerlink" title="3.ModelSerializer"></a>3.ModelSerializer</h2><blockquote><p>模型类序列化器，根据模型简化序列化过程，根据模型表<strong>自动创建序列化字段</strong>，并且内部实现了 <strong>create 方法和 update 方法</strong>，也可以根据实际需要重写逻辑。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Book<br><span class="hljs-comment"># 对全部字段进行序列化</span><br>fields = <span class="hljs-string">&#x27;__al__&#x27;</span><br><span class="hljs-comment"># 对指定字段进行序列化</span><br>fields = [<span class="hljs-string">&#x27;title&#x27;</span>,<span class="hljs-string">&#x27;id&#x27;</span>,···]<br><span class="hljs-comment"># 排除指定字段不进行序列化</span><br>exclude = [<span class="hljs-string">&#x27;id&#x27;</span>]<br>extra_kwargs = &#123; <span class="hljs-string">&#x27;id&#x27;</span>: &#123;<span class="hljs-string">&#x27;min_value&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;required&#x27;</span>: <span class="hljs-literal">True</span>&#125;, <span class="hljs-string">&#x27;title&#x27;</span>: &#123;<span class="hljs-string">&#x27;min_value&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;required&#x27;</span>: <span class="hljs-literal">True</span>&#125;, &#125;<br></code></pre></td></tr></table></figure><h3 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 全局钩子  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">self, attrs</span>):  <br>    name = attrs.get(<span class="hljs-string">&#x27;name&#x27;</span>)  <br>    <span class="hljs-keyword">if</span> Resume.objects.<span class="hljs-built_in">filter</span>(name=name).exists():  <br>        <span class="hljs-keyword">raise</span> exceptions.ValidationError(name + <span class="hljs-string">&#x27;的简历已存在!&#x27;</span>)  <br>    <span class="hljs-keyword">else</span>:  <br>        <span class="hljs-keyword">return</span> attrs  <br><span class="hljs-comment"># 局部钩子  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_name</span>(<span class="hljs-params">self, value</span>):  <br>     response = &#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&#x27;msg&#x27;</span>: <span class="hljs-string">&#x27;成功&#x27;</span>&#125;  <br>     res = Resume.objects.<span class="hljs-built_in">filter</span>(name=value)  <br>     <span class="hljs-keyword">if</span> res:  <br>         <span class="hljs-keyword">raise</span> exceptions.ValidationError(<span class="hljs-string">&#x27;简历重复!&#x27;</span>)  <br>     <span class="hljs-keyword">else</span>:  <br>         <span class="hljs-keyword">return</span> value<br></code></pre></td></tr></table></figure><hr><h2 id="4-视图"><a href="#4-视图" class="headerlink" title="4. 视图"></a>4. 视图</h2><h3 id="1-GenericAPIView"><a href="#1-GenericAPIView" class="headerlink" title="1. GenericAPIView"></a>1. GenericAPIView</h3><p>导入 <code>GenericAPIView</code></p><blockquote><p><code>from rest_framework.viewsets import generics</code></p></blockquote><blockquote><p>在 APIView 上扩展了一些新方法</p></blockquote><p>可设置的属性变量：</p><ul><li>  <strong>pagination_class</strong> 指明分页控制类</li><li>  <strong>filter_backends</strong> 指明过滤控制后端</li></ul><h4 id="1-常用方法"><a href="#1-常用方法" class="headerlink" title="1. 常用方法"></a>1. 常用方法</h4><h5 id="（1）get-serializer-class-self"><a href="#（1）get-serializer-class-self" class="headerlink" title="（1）get_serializer_class(self)"></a>（1）get_serializer_class(self)</h5><blockquote><p>当出现一个视图类中调用多个序列化器时,那么可以通过条件判断在get_serializer_class方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了。<br>返回序列化器类，默认返回<code>serializer_class</code>，可以重写</p></blockquote><h5 id="（2）get-serializer-self-args-kwargs"><a href="#（2）get-serializer-self-args-kwargs" class="headerlink" title="（2）get_serializer(self, *args, **kwargs)"></a>（2）get_serializer(self, *args, **kwargs)</h5><blockquote><p>返回序列化器对象，主要用来提供给Mixin扩展类使用，如果我们在视图中想要获取序列化器对象，也可以直接调用此方法。</p><p><strong>注意，该方法在提供序列化器对象的时候，会向序列化器对象的context属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用。</strong></p><ul><li>  <strong>request</strong> 当前视图的请求对象</li><li>  <strong>view</strong> 当前请求的类视图对象</li><li>  <strong>format</strong> 当前请求期望返回的数据格式</li></ul></blockquote><h5 id="（3）get-queryset-self"><a href="#（3）get-queryset-self" class="headerlink" title="（3）get_queryset(self)"></a>（3）get_queryset(self)</h5><blockquote><p>返回视图使用的查询集，主要用来提供给 Mixin 扩展类使用，是列表视图与详情视图获取数据的基础，默认返回 <code>queryset</code> 属性，可以重写.</p></blockquote><h5 id="（4）get-object-self"><a href="#（4）get-object-self" class="headerlink" title="（4）get_object(self)"></a>（4）get_object(self)</h5><blockquote><p>返回详情视图所需的模型类数据对象，主要用来提供给Mixin扩展类使用。</p><p>在试图中可以调用该方法获取详情信息的模型类对象。</p><p><strong>若详情访问的模型类对象不存在，会返回404。</strong></p><p>该方法会默认使用APIView提供的check_object_permissions方法检查当前对象是否有权限被访问。</p></blockquote><h4 id="1-方法重写"><a href="#1-方法重写" class="headerlink" title="1. 方法重写"></a>1. 方法重写</h4><p><code>设置urls.py中的普通路由，正则路由指定参数为pk</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>path(<span class="hljs-string">&#x27;books/&#x27;</span>,views.BookView.as_view()),<br>re_path(<span class="hljs-string">&#x27;books/(?P&lt;pk&gt;\d+)&#x27;</span>,views.BookDetailView.as_view()),<br>]<br></code></pre></td></tr></table></figure><p><strong>get：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, request</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;获取所有岗位信息&quot;&quot;&quot;</span>  <br>    serializer = self.get_serializer(instance=self.get_queryset(), many=<span class="hljs-literal">True</span>)  <br>    <span class="hljs-keyword">return</span> Response(serializer.data)<br></code></pre></td></tr></table></figure><p><strong><font color="#f79646">post</font>：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self, request</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">    添加岗位信息  </span><br><span class="hljs-string">    :param request:    :return: 添加后的岗位信息  </span><br><span class="hljs-string">    &quot;&quot;&quot;</span>    serializer = self.get_serializer(data=request.data)  <br>    <span class="hljs-keyword">if</span> serializer.is_valid():  <br>        serializer.save()  <br>        <span class="hljs-keyword">return</span> Response(serializer.data)  <br>    <span class="hljs-keyword">else</span>:  <br>        <span class="hljs-keyword">return</span> Response(serializer.errors)<br></code></pre></td></tr></table></figure><p><strong><font color="#2DC26B">get（单个数据）</font>：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, request, pk</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;获取指定id的岗位信息&quot;&quot;&quot;</span>  <br>    serializer = self.get_serializer(instance=self.get_object(), many=<span class="hljs-literal">True</span>)  <br>    <span class="hljs-keyword">return</span> Response(serializer.data)<br></code></pre></td></tr></table></figure><p><font color="#00b0f0">put（单个数据）：</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">put</span>(<span class="hljs-params">self, request, pk</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">    修改指定id的岗位信息  </span><br><span class="hljs-string">    :param request:    :return: 添加后的岗位信息  </span><br><span class="hljs-string">    &quot;&quot;&quot;</span>    serializer = self.get_serializer(instance=self.get_object(), data=request.data)  <br>    <span class="hljs-keyword">if</span> serializer.is_valid():  <br>        serializer.save()  <br>        <span class="hljs-keyword">return</span> Response(serializer.data)  <br>    <span class="hljs-keyword">else</span>:  <br>        <span class="hljs-keyword">return</span> Response(serializer.errors)<br></code></pre></td></tr></table></figure><p><font color="#7030a0">delete (单个数据)：</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self,request,<span class="hljs-built_in">id</span></span>):<br>self.get_object().delete()<br><span class="hljs-comment"># 直接返回空</span><br><span class="hljs-keyword">return</span> Response()<br></code></pre></td></tr></table></figure><h3 id="2-ViewSet"><a href="#2-ViewSet" class="headerlink" title="2. ViewSet"></a>2. ViewSet</h3><h4 id="1-引言"><a href="#1-引言" class="headerlink" title="1. 引言"></a>1. 引言</h4><p>继承自 <code>APIView</code> 与 <code>ViewSetMixin</code>，作用也与 APIView 基本类似，提供了身份认证、权限校验、流量管理等。<br><strong>ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典{“http请求”：“视图方法”}的映射处理工作，如{‘get’:’list’}，</strong></p><blockquote><ol><li>通过路由指定不同请求执行不同视图函数，从而修改路由分配方法。</li><li>项目加载时执行 <code>as_view ()</code> 函数，当发起请求时才执行 <code>view</code> 函数根据反射获取重写的<strong>函数变量</strong>，设置<strong>请求映射</strong>到该函数变量，进而根据不同请求分发匹配不同的视图函数。</li></ol></blockquote><p>在 ViewSet 中，没有提供任何动作 action 方法，需要我们自己实现 action 方法。<br>使用视图集ViewSet，可以将一系列视图相关的代码逻辑和相关的http请求动作封装到一个类中：<br><font color="#4bacc6">&gt; -   list() 提供一组数据</font><br><font color="#4bacc6">&gt; -   retrieve() 提供单个数据</font><br><font color="#4bacc6">&gt; -   create() 创建数据</font><br><font color="#4bacc6">&gt; -   update() 保存数据</font><br><font color="#4bacc6">&gt; -   destory() 删除数据</font></p><blockquote><p>ViewSet视图集类不再限制视图方法名只允许get()、post()等这种情况了，而是实现允许开发者根据自己的需要定义自定义方法名，例如 list() 、create() 等，然后经过路由中使用http和这些视图方法名进行绑定调用。</p></blockquote><h3 id="3-GenericViewSet"><a href="#3-GenericViewSet" class="headerlink" title="3. GenericViewSet"></a>3. GenericViewSet</h3><blockquote><p>继承了 GenericAPIView 和 ViewSetMixin，即继承了增删改查查方法，也修改了视图分发方法。</p></blockquote><p><strong>GenericViewSet</strong>就帮助我们完成了这样的继承工作，继承自<code>GenericAPIView</code>与<code>ViewSetMixin</code>，在实现了调用as_view()时传入字典（如<code>&#123;&#39;get&#39;:&#39;list&#39;&#125;</code>）的映射处理工作的同时，还提供了<code>GenericAPIView</code>提供的基础方法，可以直接搭配Mixin扩展类使用。<br>url. py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path, re_path <br><span class="hljs-keyword">from</span> vset.views <span class="hljs-keyword">import</span> BookView <br>urlpatterns = [ <br><span class="hljs-comment"># path(&quot;set&quot;, views.BookView.as_view(&#123;&quot;http请求&quot;:&quot;视图方法&quot;&#125;)), </span><br>path(<span class="hljs-string">&quot;books/&quot;</span>, BookView.as_view(&#123; <br> <span class="hljs-string">&quot;get&quot;</span>: <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;post&quot;</span>: <span class="hljs-string">&quot;create&quot;</span> <br> &#125;)), re_path(<span class="hljs-string">&quot;^books/(?P&lt;pk&gt;\d+)$&quot;</span>, BookView.as_view(&#123;<br>  <span class="hljs-string">&quot;get&quot;</span>: <span class="hljs-string">&quot;retrieve&quot;</span>, <br>  <span class="hljs-string">&quot;put&quot;</span>: <span class="hljs-string">&quot;update&quot;</span>, <br>  <span class="hljs-string">&quot;delete&quot;</span>: <span class="hljs-string">&quot;delete&quot;</span>, &#125;)), ]<br></code></pre></td></tr></table></figure><p>views. py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.viewsets <span class="hljs-keyword">import</span> GenericViewSet<br><span class="hljs-keyword">from</span> rest_framework.mixins <span class="hljs-keyword">import</span> ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin, \ DestroyModelMixin<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookView</span>(GenericViewSet, ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin): <br>queryset = Book.objects <br>serializer_class = BookSerializer<br></code></pre></td></tr></table></figure><h3 id="4-ModelViewSet"><a href="#4-ModelViewSet" class="headerlink" title="4. ModelViewSet"></a>4. ModelViewSet</h3><blockquote><p>进一步封装，继承了五个 Mixin 类和 GenericViewSet。</p></blockquote><p>源代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelViewSet</span>(mixins.CreateModelMixin,  <br>                   mixins.RetrieveModelMixin,  <br>                   mixins.UpdateModelMixin,  <br>                   mixins.DestroyModelMixin,  <br>                   mixins.ListModelMixin,  <br>                   GenericViewSet):<br>            <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">A viewset that provides default `create()`, `retrieve()`, `update()`,  </span><br><span class="hljs-string">`partial_update()`, `destroy()` and `list()` actions.  </span><br><span class="hljs-string">&quot;&quot;&quot;</span>  <br><span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] 局限：<br>    不够灵活，直接自带了六个增删改改查查视图函数，需要其他处理需要重写对应方法。</p></blockquote><h3 id="5-扩展视图方法"><a href="#5-扩展视图方法" class="headerlink" title="5. 扩展视图方法"></a>5. 扩展视图方法</h3><blockquote><p>根据需要扩展其他视图函数接口，匹配对应的 get、put、post、delete 等请求，并将接口注册到路由，</p></blockquote><h4 id="1-路由注册"><a href="#1-路由注册" class="headerlink" title="1. 路由注册"></a>1. 路由注册</h4><p><font color="#6425d0">views. py:</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">函数名</span>(<span class="hljs-params">self, request</span>):  <br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        自定义action  </span><br><span class="hljs-string">        return: JSON数据  </span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span>        <span class="hljs-keyword">pass</span><span class="hljs-comment">#示例：  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">latest</span>(<span class="hljs-params">self, request</span>):  <br>    <span class="hljs-string">&#x27;&#x27;&#x27;获取最后一条记录&#x27;&#x27;&#x27;</span>  <br>    <span class="hljs-comment"># 获取模型数据  </span><br>    book = BookInfo.objects.latest(<span class="hljs-string">&#x27;id&#x27;</span>)    <span class="hljs-comment"># 获取序列化器对象  </span><br>    s = BookInfoModelSerializer(instance=book)    <span class="hljs-keyword">return</span> Response(s.data)<br></code></pre></td></tr></table></figure><p><font color="#4bacc6">urls. py:</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>   <span class="hljs-comment"># url(r&#x27;^books/$&#x27;,views.BookInfoViewSet.as_view(&#123;&#x27;get&#x27;:&#x27;action函数名&#x27;&#125;)),  </span><br><span class="hljs-comment">#示例：  </span><br>url(<span class="hljs-string">r&#x27;^books/$&#x27;</span>, views.BookInfoViewSet.as_view(&#123;<span class="hljs-string">&#x27;get&#x27;</span>:<span class="hljs-string">&#x27;latest&#x27;</span>&#125;)),  <br>]<br></code></pre></td></tr></table></figure><h4 id="装饰器注册"><a href="#装饰器注册" class="headerlink" title="装饰器注册"></a>装饰器注册</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.decorators <span class="hljs-keyword">import</span> action<br><span class="hljs-meta">@action(<span class="hljs-params">methods=[<span class="hljs-string">&#x27;get&#x27;</span>,<span class="hljs-string">&#x27;post&#x27;</span>], detail=<span class="hljs-literal">False</span>, url_path=<span class="hljs-string">&#x27;test&#x27;</span></span>)  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">self, request</span>):  <br>    <span class="hljs-built_in">print</span>(request.data)  <br>    <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;成功了&quot;</span>&#125;)<br></code></pre></td></tr></table></figure><p><strong>参数说明：</strong></p><ul><li>methods: 声明该 action 对应的请求方式，列表传递  </li><li>detail: 声明该 action 路径是否为单一资源对应(False 查询所有数据接口，True 查询单条数据接口)，生成路由时是否拼接 <strong>pk</strong> 参数，detail为<code>True</code>，表示路径名格式应该为 <code>book/&#123;pk&#125;/login/</code></li><li>url_path：<strong>路由名称</strong>，不设置默认为函数名</li></ul><h2 id="5-路由"><a href="#5-路由" class="headerlink" title="5. 路由"></a>5. 路由</h2><blockquote><p>对于视图集 ViewSet，我们除了可以自己手动指明请求方式与动作 action 之间的对应关系外，还可以使用 Routers 来帮助我们快速实现路由信息。</p></blockquote><p>REST framework提供了两个router</p><ul><li>  <strong>SimpleRouter</strong></li><li>  <strong>DefaultRouter</strong></li></ul><h3 id="1-用法"><a href="#1-用法" class="headerlink" title="1. 用法"></a>1. 用法</h3><p><span style="background:rgba(240, 200, 0, 0.2)">1. 创建 router 对象，并注册视图集</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> routers <br>router = routers.DefaultRouter() router.register(<span class="hljs-string">&#x27;book&#x27;</span>, BookView, base_name=<span class="hljs-string">&#x27;book&#x27;</span>)<br></code></pre></td></tr></table></figure><p>register(prefix, viewset, base_name)</p><blockquote><ul><li>  prefix 该视图集的路由前缀</li><li>  viewset 视图集</li><li>  base_name 路由别名的前缀</li></ul></blockquote><p>如上述代码会形成的路由如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">^book/$    name: book-<span class="hljs-built_in">list</span><br>^book/&#123;pk&#125;/$   name: book-detail<br></code></pre></td></tr></table></figure><p><span style="background:rgba(136, 49, 204, 0.2)">2. 添加路由数据：</span></p><ul><li><p>方式 1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>    ...<br>]<br>urlpatterns += router.urls<br></code></pre></td></tr></table></figure></li><li><p>方式 2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>    ...<br>    path(<span class="hljs-string">&#x27;^&#x27;</span>, include(router.urls))<br>]<br></code></pre></td></tr></table></figure></li></ul><p><span style="background:#40a9ff">3. 完整 demo：</span></p><blockquote><p>附带了 <code>swagger</code> 的接口路由和 <code>django-admin</code> 后台管理路由</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url  <br><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin  <br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> include, path, re_path  <br><span class="hljs-keyword">from</span> django.views.static <span class="hljs-keyword">import</span> serve  <br><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> routers  <br><span class="hljs-keyword">from</span> rest_framework.documentation <span class="hljs-keyword">import</span> include_docs_urls  <br><span class="hljs-keyword">from</span> rest_framework.schemas <span class="hljs-keyword">import</span> get_schema_view  <br><span class="hljs-keyword">from</span> rest_framework_swagger.renderers <span class="hljs-keyword">import</span> SwaggerUIRenderer, OpenAPICodec  <br><span class="hljs-keyword">from</span> AIResume <span class="hljs-keyword">import</span> settings  <br><span class="hljs-keyword">from</span> smartresume.views <span class="hljs-keyword">import</span> auth_user_api, platform_user_api, resume_api, job_api  <br>  <br>schema_view = get_schema_view(title=<span class="hljs-string">&#x27;智能简历平台接口文档&#x27;</span>, renderer_classes=[SwaggerUIRenderer, OpenAPICodec])  <br>  <br>router = routers.DefaultRouter()  <br>  <br>router.register(<span class="hljs-string">r&#x27;users&#x27;</span>, auth_user_api.UserViewSet, basename=<span class="hljs-string">&quot;auth_users_api&quot;</span>)  <br>router.register(<span class="hljs-string">r&#x27;groups&#x27;</span>, auth_user_api.GroupViewSet, basename=<span class="hljs-string">&quot;auth_groups_api&quot;</span>)  <br>router.register(<span class="hljs-string">r&#x27;platform_users&#x27;</span>, platform_user_api.PuserViewSet, basename=<span class="hljs-string">&quot;platform_users_api&quot;</span>)  <br>router.register(<span class="hljs-string">r&#x27;resumes&#x27;</span>, resume_api.ResumeViewSet, basename=<span class="hljs-string">&quot;resume_api&quot;</span>)  <br>router.register(<span class="hljs-string">r&#x27;jobs&#x27;</span>, job_api.JobViewSet, basename=<span class="hljs-string">&quot;job_api&quot;</span>)  <br>urlpatterns = [  <br>    re_path(<span class="hljs-string">r&quot;^static/(?P&lt;path&gt;.*)$&quot;</span>, serve, &#123;<span class="hljs-string">&quot;document_root&quot;</span>: settings.STATIC_ROOT&#125;, name=<span class="hljs-string">&#x27;static&#x27;</span>),  <span class="hljs-comment"># 新增的路径  </span><br>    re_path(<span class="hljs-string">r&#x27;^media/(?P&lt;path&gt;.*)$&#x27;</span>, serve, &#123;<span class="hljs-string">&#x27;document_root&#x27;</span>: settings.MEDIA_ROOT&#125;, name=<span class="hljs-string">&#x27;media&#x27;</span>),  <br>    path(<span class="hljs-string">r&#x27;&#x27;</span>, include(router.urls)),  <br>    path(<span class="hljs-string">r&#x27;api-auth/&#x27;</span>, include(<span class="hljs-string">&#x27;rest_framework.urls&#x27;</span>)),  <br>    url(<span class="hljs-string">r&#x27;^admin/&#x27;</span>, admin.site.urls),  <br>    path(<span class="hljs-string">&#x27;docs2/&#x27;</span>, schema_view, name=<span class="hljs-string">&#x27;docs&#x27;</span>),  <br>    path(<span class="hljs-string">&#x27;docs/&#x27;</span>, include_docs_urls(title=<span class="hljs-string">&#x27;智能简历平台接口文档&#x27;</span>)),  <br>]  <br>  <br>urlpatterns += router.urls<br></code></pre></td></tr></table></figure><h2 id="2-视图集中附加-action-的声明"><a href="#2-视图集中附加-action-的声明" class="headerlink" title="2. 视图集中附加 action 的声明"></a>2. 视图集中附加 action 的声明</h2><blockquote><p>在视图集中，如果想要让 Router 自动帮助我们为自定义的动作生成路由信息，需要使用 <code>rest_framework.decorators.action</code> 装饰器。</p></blockquote><pre><code class="hljs">以 action 装饰器装饰的方法名会作为 action 动作名，与 list、retrieve 等同。</code></pre><p>action装饰器可以接收两个参数：</p><ul><li><strong>methods</strong>: 声明该action对应的请求方式，列表传递</li><li><strong>detail</strong>: 声明该action的路径是否与单一资源对应  <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">路由前缀/&lt;pk&gt;<span class="hljs-regexp">/action方法名/</span><br></code></pre></td></tr></table></figure><ul><li>  True 表示路径格式是<code>xxx/&lt;pk&gt;/action方法名/</code></li><li>  False 表示路径格式是<code>xxx/action方法名/</code></li></ul></li><li>  url_path：声明该 action 的路由尾缀。</li></ul><p>demo：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.viewsets <span class="hljs-keyword">import</span> ModelViewSet<br><span class="hljs-keyword">from</span> rest_framework.decorators <span class="hljs-keyword">import</span> action<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookView</span>(<span class="hljs-title class_ inherited__">ModelViewSet</span>):<br>    queryset = Book.objects<br>    serializer_class = BookSerializer<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    action装饰器的作用：告诉路由类给视图集的自定义方法生成路由信息</span><br><span class="hljs-string">    methods, 列表，允许哪些http请求能访问当前视图方法</span><br><span class="hljs-string">    detail，布尔，生成路由时是否拼接pk参数</span><br><span class="hljs-string">            detail为True，表示路径名格式应该为 book/&#123;pk&#125;/login/</span><br><span class="hljs-string">    url_path，字符串，生成路由时末尾路由路径，如果没有声明，则自动以当前方法名作为路由尾缀</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-meta">    @action(<span class="hljs-params">methods=[<span class="hljs-string">&#x27;get&#x27;</span>], detail=<span class="hljs-literal">True</span>,url_path=<span class="hljs-string">&quot;login&quot;</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self, request,pk</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;登录&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&quot;msg&quot;</span>:request.method&#125;)<br><br>    <span class="hljs-comment"># detail为False 表示路径名格式应该为 book/get_new_5/</span><br><span class="hljs-meta">    @action(<span class="hljs-params">methods=[<span class="hljs-string">&#x27;get&#x27;</span>], detail=<span class="hljs-literal">False</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_new_5</span>(<span class="hljs-params">self, request</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;获取最新添加的5本书&quot;&quot;&quot;</span><br>        ...<br></code></pre></td></tr></table></figure><p>上述方法自动为此视图集自定义 action 方法形成的路由会是如下内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">^book/get_new_5/$    name: book-get_new_5<br>^book/&#123;pk&#125;/login/$   name: book-login<br></code></pre></td></tr></table></figure><hr><h2 id="6-其它组件"><a href="#6-其它组件" class="headerlink" title="6. 其它组件"></a>6. 其它组件</h2><h3 id="1-认证"><a href="#1-认证" class="headerlink" title="1. 认证"></a>1. 认证</h3><h4 id="1-全局认证"><a href="#1-全局认证" class="headerlink" title="1. 全局认证"></a>1. 全局认证</h4><blockquote><p>没有设置用户配置认证时，默认认证为以下两个认证。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">REST_FRAMEWORK = &#123;  <br><span class="hljs-string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [  <br>    <span class="hljs-string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,  <br>    <span class="hljs-string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>  <br>],<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-局部认证"><a href="#2-局部认证" class="headerlink" title="2. 局部认证"></a>2. 局部认证</h4><ol><li><p>继承认证基类, 写自己的认证类，并重写 authenticate（）方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAuthentication</span>(<span class="hljs-title class_ inherited__">SessionAuthentication</span>):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate</span>(<span class="hljs-params">self, request</span>):  <br>        token = request.query_params.get(<span class="hljs-string">&#x27;token&#x27;</span>)  <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:  <br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1001</span>, <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;认证失败&quot;</span>&#125;)  <br>        user_obj = Puser.objects.<span class="hljs-built_in">filter</span>(token=token).first()  <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_obj:  <br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(&#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1001</span>, <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;认证失败&quot;</span>&#125;)  <br>        <span class="hljs-keyword">return</span> user_obj, token<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate_header</span>(<span class="hljs-params">self, request</span>):  <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&quot;MyAPI&quot;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>视图函数设置 authentication_classes</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">authentication_classes = [MyAuthentication,]<br></code></pre></td></tr></table></figure></li></ol><h3 id="2-权限"><a href="#2-权限" class="headerlink" title="2. 权限"></a>2. 权限</h3><h3 id="3-限流"><a href="#3-限流" class="headerlink" title="3. 限流"></a>3. 限流</h3><blockquote><p>控制用户或管理员等访问接口的频次，减轻服务压力</p></blockquote><p>1） AnonRateThrottle</p><p>限制所有匿名未认证用户，使用IP区分用户。【很多公司这样的，IP结合设备信息来判断，当然比IP要靠谱一点点而已】</p><p>使用<code>DEFAULT_THROTTLE_RATES[&#39;anon&#39;]</code> 来设置频次</p><p>2）UserRateThrottle</p><p>限制认证用户，使用User模型的 id主键 来区分。</p><p>使用<code>DEFAULT_THROTTLE_RATES[&#39;user&#39;]</code> 来设置频次</p><p>3）ScopedRateThrottle</p><p>限制用户对于每个视图的访问频次，使用 ip 或 user id。</p><p>settings.py，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">REST_FRAMEWORK = &#123;<br>    <span class="hljs-comment"># 限流全局配置</span><br>    <span class="hljs-string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>:[ <span class="hljs-comment"># 限流配置类</span><br>    <span class="hljs-comment">#     &#x27;rest_framework.throttling.AnonRateThrottle&#x27;, # 未认证用户[未登录用户]</span><br>    <span class="hljs-comment">#     &#x27;rest_framework.throttling.UserRateThrottle&#x27;, # 已认证用户[已登录用户]</span><br>        <span class="hljs-string">&#x27;rest_framework.throttling.ScopedRateThrottle&#x27;</span>, <span class="hljs-comment"># 自定义限流</span><br>    ],<br>    <span class="hljs-string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>:&#123; <span class="hljs-comment"># 频率配置</span><br>        <span class="hljs-string">&#x27;anon&#x27;</span>: <span class="hljs-string">&#x27;2/day&#x27;</span>,  <span class="hljs-comment"># 针对游客的访问频率进行限制，实际上，drf只是识别首字母，但是为了提高代码的维护性，建议写完整单词</span><br>        <span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;5/day&#x27;</span>, <span class="hljs-comment"># 针对会员的访问频率进行限制，</span><br>        <span class="hljs-string">&#x27;vip&#x27;</span>: <span class="hljs-string">&#x27;10/day&#x27;</span>, <span class="hljs-comment"># 针对会员的访问频率进行限制，</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>视图代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.throttling <span class="hljs-keyword">import</span> UserRateThrottle<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student2ModelViewSet</span>(<span class="hljs-title class_ inherited__">ModelViewSet</span>):<br>    queryset = Student.objects<br>    serializer_class = StudentModelSerializer<br>    <span class="hljs-comment"># 限流局部配置[这里需要配合在全局配置中的DEFAULT_THROTTLE_RATES来设置频率]</span><br>    <span class="hljs-comment"># throttle_classes = [UserRateThrottle] # 使用drf限流类来配置频率</span><br>    throttle_scope = <span class="hljs-string">&quot;vip&quot;</span> <span class="hljs-comment"># 自定义频率</span><br></code></pre></td></tr></table></figure><h3 id="4-过滤"><a href="#4-过滤" class="headerlink" title="4. 过滤"></a>4. 过滤</h3><blockquote><p>安装过滤器：<br><code>pip install django-filter </code></p></blockquote><p>在配置文件中增加过滤后端的设置：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">INSTALLED_APPS = [<br>    ...<br>    <span class="hljs-string">&#x27;django_filters&#x27;</span>,  <span class="hljs-comment"># 需要注册应用，</span><br>]<br><br>REST_FRAMEWORK = &#123;<br>    ...<br>    <span class="hljs-string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: (<span class="hljs-string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,)<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>可通过过滤字段检索数据</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentListView</span>(<span class="hljs-title class_ inherited__">ListAPIView</span>): queryset = Student.objects.<span class="hljs-built_in">all</span>() serializer_class = StudentSerializer filter_fields = [<span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-string">&#x27;sex&#x27;</span>]<br></code></pre></td></tr></table></figure><h3 id="5-排序"><a href="#5-排序" class="headerlink" title="5. 排序"></a>5. 排序</h3><blockquote><p>对于列表数据，REST framework 提供了<strong>OrderingFilter</strong>过滤器来帮助我们快速指明数据按照指定字段进行排序。</p></blockquote><p>使用方法：</p><p>在类视图中设置filter_backends，使用<code>rest_framework.filters.OrderingFilter</code>过滤器，REST framework会在请求的查询字符串参数中检查是否包含了ordering参数，如果包含了ordering参数，则按照ordering参数指明的排序字段对数据集进行排序。</p><p>前端可以传递的ordering参数的可选字段值需要在ordering_fields中指明。</p><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentListView</span>(<span class="hljs-title class_ inherited__">ListAPIView</span>):<br>    queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>    serializer_class = StudentModelSerializer<br>    filter_backends = [OrderingFilter]<br>    ordering_fields = [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>]<br><br><span class="hljs-comment"># 127.0.0.1:8000/books/?ordering=-age</span><br><span class="hljs-comment"># -id 表示针对id字段进行倒序排序</span><br><span class="hljs-comment"># id  表示针对id字段进行升序排序</span><br></code></pre></td></tr></table></figure><p>如果需要在过滤以后再次进行排序，则需要两者结合!</p><blockquote><p>全局配置下的过滤组件不能和排序组件一起使用，只支持局部配置的过滤组件和排序组件一起使用。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.generics <span class="hljs-keyword">import</span> ListAPIView<br><span class="hljs-keyword">from</span> students.models <span class="hljs-keyword">import</span> Student<br><span class="hljs-keyword">from</span> .serializers <span class="hljs-keyword">import</span> StudentModelSerializer<br><span class="hljs-keyword">from</span> django_filters.rest_framework <span class="hljs-keyword">import</span> DjangoFilterBackend<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student3ListView</span>(<span class="hljs-title class_ inherited__">ListAPIView</span>):<br>    queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>    serializer_class = StudentModelSerializer<br>    filter_fields = [<span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-string">&#x27;sex&#x27;</span>]<br>    <span class="hljs-comment"># 因为局部配置会覆盖全局配置,所以需要重新把过滤组件核心类再次声明,</span><br>    <span class="hljs-comment"># 否则过滤功能会失效</span><br>    filter_backends = [OrderingFilter,DjangoFilterBackend]<br>    ordering_fields = [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>]<br></code></pre></td></tr></table></figure><h3 id="6-分页"><a href="#6-分页" class="headerlink" title="6. 分页"></a>6. 分页</h3><blockquote><p>因为 django 默认提供的分页器主要使用于前后端不分离的业务场景，所以 REST framework 也提供了分页的支持。</p></blockquote><p>我们可以在配置文件中设置全局的分页方式，如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">REST_FRAMEWORK = &#123;<br>    <span class="hljs-string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>:  <span class="hljs-string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,<br>    <span class="hljs-string">&#x27;PAGE_SIZE&#x27;</span>: <span class="hljs-number">100</span>  <span class="hljs-comment"># 每页数目</span><br>&#125;<br>``````<br><br>```python<br><span class="hljs-comment"># 如果在配置settings.py文件中， 设置了全局分页，那么在drf中凡是调用了ListModelMixin的list()，都会自动分页。如果项目中出现大量需要分页的数据，只有少数部分的分页，则可以在少部分的视图类中关闭分页功能。</span><br><span class="hljs-comment"># 另外，视图类在使用过分页以后，务必在编写queryset属性时，模型.objects后面调用结果。例如：</span><br><span class="hljs-comment"># Student.objects.all()</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student3ModelViewSet</span>(<span class="hljs-title class_ inherited__">ListAPIView</span>):<br>    pagination_class = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><p>也可通过自定义 Pagination 类，来为视图添加不同分页行为。在视图中通过 <code>pagination_clas</code> 属性来指明。</p><p>可选分页器：</p><p>1） <strong>PageNumberPagination</strong></p><p>前端访问网址形式：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">1<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">GET  http://127.0.0.1:8000/students/?page=4<br></code></pre></td></tr></table></figure><p>可以在子类中定义的属性：</p><ul><li>  page_size 每页数目</li><li>  page_query_param 前端发送的页数关键字名，默认为”page”</li><li>  page_size_query_param 前端发送的每页数目关键字名，默认为None</li><li>  max_page_size 前端最多能设置的每页数量</li></ul><p>分页器类，<code>paginations</code>，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span>  rest_framework.pagination <span class="hljs-keyword">import</span> PageNumberPagination,LimitOffsetPagination<br><span class="hljs-comment"># PageNumberPagination，以页码作为分页条件</span><br><span class="hljs-comment"># page=1&amp;size=10      第1页</span><br><span class="hljs-comment"># page=2&amp;size=10      第2页</span><br><span class="hljs-comment"># ...</span><br><span class="hljs-comment"># LimitOffsetPagination，以数据库查询的limit和offset数值作为分页条件</span><br><span class="hljs-comment"># limit=10&amp;offset=0   第1页</span><br><span class="hljs-comment"># limit=10&amp;offset=10  第2页</span><br><span class="hljs-comment"># ...</span><br><br><span class="hljs-comment"># PageNumberPagination</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentPageNumberPagination</span>(<span class="hljs-title class_ inherited__">PageNumberPagination</span>):<br>    page_query_param = <span class="hljs-string">&quot;page&quot;</span> <span class="hljs-comment"># 查询字符串中代表页码的变量名</span><br>    page_size_query_param = <span class="hljs-string">&quot;size&quot;</span> <span class="hljs-comment"># 查询字符串中代表每一页数据的变量名</span><br>    page_size = <span class="hljs-number">2</span> <span class="hljs-comment"># 每一页的数据量</span><br>    max_page_size = <span class="hljs-number">4</span> <span class="hljs-comment"># 允许客户端通过查询字符串调整的最大单页数据量</span><br></code></pre></td></tr></table></figure><p>视图，<code>views</code> ，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> .paginations <span class="hljs-keyword">import</span> StudentPageNumberPagination,StudentLimitOffsetPagination<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student3ModelViewSet</span>(<span class="hljs-title class_ inherited__">ModelViewSet</span>):<br>    queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>    serializer_class = StudentModelSerializer<br>    <span class="hljs-comment"># 取消当前视图类的分页效果</span><br>    <span class="hljs-comment"># pagination_class = None</span><br>    <span class="hljs-comment"># 局部分页</span><br>    pagination_class = StudentPageNumberPagination<br></code></pre></td></tr></table></figure><p>2）<strong>LimitOffsetPagination</strong></p><p>前端访问网址形式：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">GET http://127.0.0.1/four/students/?limit=100&amp;offset=100<br></code></pre></td></tr></table></figure><p>可以在子类中定义的属性：</p><ul><li>  default_limit 默认限制，默认值与<code>PAGE_SIZE</code>设置一直</li><li>  limit_query_param limit参数名，默认’limit’</li><li>  offset_query_param offset参数名，默认’offset’</li><li>  max_limit 最大limit限制，默认None</li></ul><p>分页类，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span>  rest_framework.pagination <span class="hljs-keyword">import</span> PageNumberPagination,LimitOffsetPagination<br><span class="hljs-comment"># PageNumberPagination，以页码作为分页条件</span><br><span class="hljs-comment"># page=1&amp;size=10      第1页</span><br><span class="hljs-comment"># page=2&amp;size=10      第2页</span><br><span class="hljs-comment"># LimitOffsetPagination，以数据库查询的limit和offset数值作为分页条件</span><br><span class="hljs-comment"># limit=10&amp;offset=0   第1页</span><br><span class="hljs-comment"># limit=10&amp;offset=10  第2页</span><br><br><span class="hljs-comment"># LimitOffsetPagination</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentLimitOffsetPagination</span>(<span class="hljs-title class_ inherited__">LimitOffsetPagination</span>):<br>    limit_query_param = <span class="hljs-string">&quot;limit&quot;</span> <span class="hljs-comment"># 查询字符串中代表每一页数据的变量名</span><br>    offset_query_param = <span class="hljs-string">&quot;offset&quot;</span> <span class="hljs-comment"># 查询字符串中代表页码的变量名</span><br>    default_limit = <span class="hljs-number">2</span> <span class="hljs-comment"># 每一页的数据量</span><br>    max_limit = <span class="hljs-number">4</span> <span class="hljs-comment"># 允许客户端通过查询字符串调整的最大单页数据量</span><br></code></pre></td></tr></table></figure><p>视图，<code>views</code>，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> .paginations <span class="hljs-keyword">import</span> StudentPageNumberPagination,StudentLimitOffsetPagination<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student3ModelViewSet</span>(<span class="hljs-title class_ inherited__">ModelViewSet</span>):<br>    queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>    serializer_class = StudentModelSerializer<br>    <span class="hljs-comment"># 取消当前视图类的分页效果</span><br>    <span class="hljs-comment"># pagination_class = None</span><br>    <span class="hljs-comment"># 局部分页</span><br>    pagination_class = StudentLimitOffsetPagination<br></code></pre></td></tr></table></figure><h3 id="7-异常处理"><a href="#7-异常处理" class="headerlink" title="7. 异常处理"></a>7. 异常处理</h3><blockquote><p>REST framework 提供了异常处理，我们可以自定义异常处理函数。例如我们想在要创建一个自定义异常函数，</p><p>这个函数，我们保存到当前子应用opt中[注意，开发时，我们会找个独立的公共目录来保存这种公共的函数/工具/类库]。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.views <span class="hljs-keyword">import</span> exception_handler<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_exception_handler</span>(<span class="hljs-params">exc, context</span>):<br>    <span class="hljs-comment"># 先调用REST framework默认的异常处理方法获得标准错误响应对象</span><br>    response = exception_handler(exc, context)<br><br>    <span class="hljs-comment"># 在此处补充自定义的异常处理</span><br>    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        response.data[<span class="hljs-string">&#x27;status_code&#x27;</span>] = response.status_code<br><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><p>在配置文件中声明自定义的异常处理，<code>settings</code>，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">REST_FRAMEWORK = &#123;<br>    <span class="hljs-string">&#x27;EXCEPTION_HANDLER&#x27;</span>: <span class="hljs-string">&#x27;drfdemo.exceptions.custom_excetion_handle&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>如果未声明，会采用默认的方式，如下</p><p>rest_frame/settings.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">REST_FRAMEWORK = &#123;<br>    <span class="hljs-string">&#x27;EXCEPTION_HANDLER&#x27;</span>: <span class="hljs-string">&#x27;rest_framework.views.exception_handler&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>例如：</p><p>补充上处理关于数据库的异常，这里使用其他异常来举例：</p><p><code>主应用.exceptions</code>，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 自定义异常函数: 在drf本身提供的异常函数基础上，我们增加更多的异常处理就可以了。</span><br><span class="hljs-keyword">from</span> rest_framework.views <span class="hljs-keyword">import</span> exception_handler<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> DatabaseError<br><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> status<br><span class="hljs-keyword">from</span> rest_framework.response <span class="hljs-keyword">import</span> Response<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_excetion_handle</span>(<span class="hljs-params">exc, context</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    自定义异常函数，必须要在配置文件中注册才能被drf使用</span><br><span class="hljs-string">    exc: 异常对象，本次发生的异常对象</span><br><span class="hljs-string">    context: 字典，本次发生异常时，python解析器提供的执行上下文</span><br><span class="hljs-string">    所谓的执行上下文[context]，就是程序执行到当前一行代码时，能提供给开发者调用的环境信息异常发生时，代码所在的路径，时间，视图，客户端http请求等等...]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 先让drf处理它能识别的异常</span><br>    response = exception_handler(exc, context)<br>    <span class="hljs-comment"># 在经过了drf的异常处理以后，还是返回None则表示有2种情况:</span><br>    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># 异常发生时的视图对象</span><br>        view = context[<span class="hljs-string">&#x27;view&#x27;</span>]<br>        <span class="hljs-comment"># 异常发生时的http请求</span><br>        request = context[<span class="hljs-string">&quot;request&quot;</span>]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(exc, DatabaseError):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[%s]: %s&#x27;</span> % (view, exc))<br>            response = Response(&#123;<span class="hljs-string">&#x27;detail&#x27;</span>: <span class="hljs-string">&#x27;服务器内部错误&#x27;</span>&#125;, status=status.HTTP_507_INSUFFICIENT_STORAGE)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(exc, TypeError):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;0不能作为除数~&quot;</span>)<br>            <span class="hljs-built_in">print</span>(request)<br>            response = Response(&#123;<span class="hljs-string">&#x27;detail&#x27;</span>: <span class="hljs-string">&#x27;0不能作为除数&#x27;</span>&#125;, status=status.HTTP_500_INTERNAL_SERVER_ERROR)<br><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><p>视图中，故意报错：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> .paginations <span class="hljs-keyword">import</span> StudentPageNumberPagination,StudentLimitOffsetPagination<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student3ModelViewSet</span>(<span class="hljs-title class_ inherited__">ModelViewSet</span>):<br>    queryset = Student.objects  <span class="hljs-comment"># 去掉 .all()，就会报错。</span><br>    serializer_class = StudentModelSerializer<br>    pagination_class = StudentPageNumberPagination<br></code></pre></td></tr></table></figure><h4 id="REST-framework定义的异常"><a href="#REST-framework定义的异常" class="headerlink" title="REST framework定义的异常"></a>REST framework定义的异常</h4><blockquote><ul><li>  APIException 所有异常的父类</li><li>  ParseError 解析错误</li><li>  AuthenticationFailed 认证失败</li><li>  NotAuthenticated 尚未认证</li><li>  PermissionDenied 权限决绝</li><li>  NotFound 未找到</li><li>  MethodNotAllowed 请求方式不支持</li><li>  NotAcceptable 要获取的数据格式不支持</li><li>  Throttled 超过限流次数</li><li>  ValidationError 校验失败</li></ul></blockquote><p>也就是说，很多的没有在上面列出来的异常，就需要我们在自定义异常中自己处理了。</p><h3 id="8-自动生成接口文档"><a href="#8-自动生成接口文档" class="headerlink" title="8. 自动生成接口文档"></a>8. 自动生成接口文档</h3><blockquote><p>REST framework 可以自动帮助我们生成接口文档。</p><p>接口文档以网页的方式呈现。</p><p>自动接口文档能生成的是继承自<code>APIView</code>及其子类的视图。</p></blockquote><h4 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h4><p>REST framewrok生成接口文档需要<code>coreapi</code>库的支持。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install coreapi<br></code></pre></td></tr></table></figure><h4 id="2-设置接口文档访问路径"><a href="#2-设置接口文档访问路径" class="headerlink" title="2. 设置接口文档访问路径"></a>2. 设置接口文档访问路径</h4><p>在总路由中添加接口文档路径。</p><p>文档路由对应的视图配置为<code>rest_framework.documentation.include_docs_urls</code>，</p><p>参数<code>title</code>为接口文档网站的标题。总路由，代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.documentation <span class="hljs-keyword">import</span> include_docs_urls<br><br>urlpatterns = [<br>    ...<br>    path(<span class="hljs-string">&#x27;docs/&#x27;</span>, include_docs_urls(title=<span class="hljs-string">&#x27;站点页面标题&#x27;</span>))<br>]<br></code></pre></td></tr></table></figure><p>在settings.py中配置接口文档。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">REST_FRAMEWORK = &#123;<br>    <span class="hljs-comment"># 。。。 其他选项</span><br>    <span class="hljs-comment"># 接口文档</span><br>    <span class="hljs-string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="hljs-string">&#x27;rest_framework.schemas.AutoSchema&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-文档描述说明的定义位置"><a href="#3-文档描述说明的定义位置" class="headerlink" title="3. 文档描述说明的定义位置"></a>3. 文档描述说明的定义位置</h4><p>1） 单一方法的视图，可直接使用类视图的文档字符串，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookListView</span>(generics.ListAPIView):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    返回所有图书信息.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>2）包含多个方法的视图，在类视图的文档字符串中，分开方法定义，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookListCreateView</span>(generics.ListCreateAPIView):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    get:</span><br><span class="hljs-string">    返回所有图书信息.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    post:</span><br><span class="hljs-string">    新建图书.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>3）对于视图集ViewSet，仍在类视图的文档字符串中封开定义，但是应使用action名称区分，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BookInfoViewSet</span>(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    list:</span><br><span class="hljs-string">    返回图书列表数据</span><br><span class="hljs-string"></span><br><span class="hljs-string">    retrieve:</span><br><span class="hljs-string">    返回图书详情数据</span><br><span class="hljs-string"></span><br><span class="hljs-string">    latest:</span><br><span class="hljs-string">    返回最新的图书数据</span><br><span class="hljs-string"></span><br><span class="hljs-string">    read:</span><br><span class="hljs-string">    修改图书的阅读量</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><h4 id="4-访问接口文档网页"><a href="#4-访问接口文档网页" class="headerlink" title="4. 访问接口文档网页"></a>4. 访问接口文档网页</h4><p>浏览器访问 127.0.0.1:8000/docs/，即可看到自动生成的接口文档。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/20230427154626.png" alt="image.png"></p><p>swagger 接口文档<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/20230427154712.png" alt="image.png"></p><p>两点说明：</p><p>1） 视图集ViewSet中的retrieve名称，在接口文档网站中叫做read</p><p>2）参数的Description需要在模型类或序列化器类的字段中以help_text选项定义，如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(models.Model):<br>    ...<br>    age = models.IntegerField(default=<span class="hljs-number">0</span>, verbose_name=<span class="hljs-string">&#x27;年龄&#x27;</span>, help_text=<span class="hljs-string">&#x27;年龄&#x27;</span>)<br>    ...<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentSerializer</span>(serializers.ModelSerializer):<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>        model = Student<br>        fields = <span class="hljs-string">&quot;__all__&quot;</span><br>        extra_kwargs = &#123;<br>            <span class="hljs-string">&#x27;age&#x27;</span>: &#123;<br>                <span class="hljs-string">&#x27;required&#x27;</span>: <span class="hljs-literal">True</span>,<br>                <span class="hljs-string">&#x27;help_text&#x27;</span>: <span class="hljs-string">&#x27;年龄&#x27;</span><br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><blockquote><p><font color="#ff0000">本文参考了以下文档和视频结合个人感悟记录，若有侵权无意冒犯，及时联系进行处理。如果有看不懂本文的，可以移步查看更加详细的教程文档或者观看相关视频，支持原创作者。 </font></p></blockquote><ol><li><a href="http://www.yuan316.com/post/DRF/">DRF | YUAN</a></li><li><a href="https://www.bilibili.com/video/BV1z5411D7BQ/?p=21&spm_id_from=pageDriver&vd_source=9c896fa9c3f9023797e8efe7be0c113e">21 DRF应用的认证组件_哔哩哔哩_bilibili</a></li></ol><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js metin="meting" auto=" https://y.qq.com/n/ryqq/song/003kIhRR4Vr0cV.html" autoplay=" true" ></meting-js>]]></content>
    
    
    <summary type="html">it is some basic usage of drf .</summary>
    
    
    
    <category term="Front_end_development" scheme="https://alleyf.github.io/categories/Front-end-development/"/>
    
    
    <category term="Django" scheme="https://alleyf.github.io/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>初识 uni-app</title>
    <link href="https://alleyf.github.io/2023/04/5d72eb9cc9af.html"/>
    <id>https://alleyf.github.io/2023/04/5d72eb9cc9af.html</id>
    <published>2023-04-16T08:49:22.000Z</published>
    <updated>2023-04-20T16:23:25.932Z</updated>
    
    <content type="html"><![CDATA[<h1 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h1><blockquote><p>知识点：网络请求、模板语法、打开页面和页面传参。</p></blockquote><h1 id="基础组件"><a href="#基础组件" class="headerlink" title="基础组件"></a>基础组件</h1><blockquote><p>基础组件分为以下十几大类：</p></blockquote><h2 id="视图容器（View-Container）："><a href="#视图容器（View-Container）：" class="headerlink" title="视图容器（View Container）："></a>视图容器（View Container）：</h2><blockquote><p>[!NOTE] 组件</p><p><a href="https://uniapp.dcloud.net.cn/component/view">view</a></p><p>视图容器，类似于HTML中的div</p><p><a href="https://uniapp.dcloud.net.cn/component/scroll-view">scroll-view</a></p><p>可滚动视图容器</p><p><a href="https://uniapp.dcloud.net.cn/component/swiper">swiper</a></p><p>滑块视图容器，比如用于轮播banner</p><p><a href="https://uniapp.dcloud.net.cn/component/match-media">match-media</a></p><p>屏幕动态适配组件，比如窄屏上不显示某些内容</p><p><a href="https://uniapp.dcloud.net.cn/component/movable-view#movable-area">movable-area</a></p><p>可拖动区域</p><p><a href="https://uniapp.dcloud.net.cn/component/movable-view#movable-view">movable-view</a></p><p>可移动的视图容器，在页面中可以拖拽滑动或双指缩放。movable-view必须在movable-area组件中</p><p><a href="https://uniapp.dcloud.net.cn/component/cover-view#cover-view">cover-view</a></p><p>可覆盖在原生组件的上的文本组件</p><p><a href="https://uniapp.dcloud.net.cn/component/cover-view#cover-image">cover-image</a></p><p>可覆盖在原生组件的上的图片组件</p></blockquote><h2 id="基础内容（Basic-Content）："><a href="#基础内容（Basic-Content）：" class="headerlink" title="基础内容（Basic Content）："></a>基础内容（Basic Content）：</h2><blockquote><p>[!NOTE] 组件</p><p><a href="https://uniapp.dcloud.net.cn/component/icon">icon</a></p><p>图标</p><p><a href="https://uniapp.dcloud.net.cn/component/text">text</a></p><p>文字</p><p><a href="https://uniapp.dcloud.net.cn/component/rich-text">rich-text</a></p><p>富文本显示组件</p><p><a href="https://uniapp.dcloud.net.cn/component/progress">progress</a></p><p>进度条</p></blockquote><h2 id="表单组件（Form）："><a href="#表单组件（Form）：" class="headerlink" title="表单组件（Form）："></a>表单组件（Form）：</h2><blockquote><p>[!NOTE] 组件</p><p><a href="https://uniapp.dcloud.net.cn/component/button">button</a></p><p>按钮</p><p><a href="https://uniapp.dcloud.net.cn/component/checkbox">checkbox</a></p><p>多项选择器</p><p><a href="https://uniapp.dcloud.net.cn/component/editor">editor</a></p><p>富文本输入框</p><p><a href="https://uniapp.dcloud.net.cn/component/form">form</a></p><p>表单</p><p><a href="https://uniapp.dcloud.net.cn/component/input">input</a></p><p>输入框</p><p><a href="https://uniapp.dcloud.net.cn/component/label">label</a></p><p>标签</p><p><a href="https://uniapp.dcloud.net.cn/component/picker">picker</a></p><p>弹出式列表选择器</p><p><a href="https://uniapp.dcloud.net.cn/component/picker-view">picker-view</a></p><p>窗体内嵌式列表选择器</p><p><a href="https://uniapp.dcloud.net.cn/component/radio">radio</a></p><p>单项选择器</p><p><a href="https://uniapp.dcloud.net.cn/component/slider">slider</a></p><p>滑动选择器</p><p><a href="https://uniapp.dcloud.net.cn/component/switch">switch</a></p><p>开关选择器</p><p><a href="https://uniapp.dcloud.net.cn/component/textarea">textarea</a></p><p>多行文本输入框</p></blockquote><h2 id="路由与页面跳转（Navigation）："><a href="#路由与页面跳转（Navigation）：" class="headerlink" title="路由与页面跳转（Navigation）："></a>路由与页面跳转（Navigation）：</h2><blockquote><p>[!NOTE] 组件<br><a href="https://uniapp.dcloud.net.cn/component/navigator">navigator</a></p><p>页面链接。类似于HTML中的a标签</p><h2 id="媒体组件（Media）："><a href="#媒体组件（Media）：" class="headerlink" title="媒体组件（Media）："></a>媒体组件（Media）：</h2><p><a href="https://uniapp.dcloud.net.cn/component/audio">audio</a></p><p>音频</p><p><a href="https://uniapp.dcloud.net.cn/component/camera">camera</a></p><p>相机</p><p><a href="https://uniapp.dcloud.net.cn/component/image">image</a></p><p>图片</p><p><a href="https://uniapp.dcloud.net.cn/component/video">video</a></p><p>视频</p><p><a href="https://uniapp.dcloud.net.cn/component/live-player">live-player</a></p><p>直播播放</p><p><a href="https://uniapp.dcloud.net.cn/component/live-pusher">live-pusher</a></p><p>实时音视频录制，也称直播推流</p></blockquote><h2 id="地图（Map）："><a href="#地图（Map）：" class="headerlink" title="地图（Map）："></a>地图（Map）：</h2><blockquote><p><a href="https://uniapp.dcloud.net.cn/component/map">map</a></p><p>地图</p></blockquote><h2 id="画布（Canvas）："><a href="#画布（Canvas）：" class="headerlink" title="画布（Canvas）："></a>画布（Canvas）：</h2><blockquote><p><a href="https://uniapp.dcloud.net.cn/component/canvas">canvas</a></p><p>画布</p></blockquote><h2 id="webview（Web-view）："><a href="#webview（Web-view）：" class="headerlink" title="webview（Web-view）："></a>webview（Web-view）：</h2><blockquote><p><a href="https://uniapp.dcloud.net.cn/component/web-view">web-view</a></p><p>web浏览器组件</p></blockquote><blockquote><h2 id="广告"><a href="#广告" class="headerlink" title="广告"></a>广告</h2><p><a href="https://uniapp.dcloud.net.cn/component/ad">ad</a></p><p>广告组件</p><p><a href="https://uniapp.dcloud.net.cn/component/ad-draw">ad-draw</a></p><p>沉浸视频流广告组件</p></blockquote><h2 id="页面属性配置"><a href="#页面属性配置" class="headerlink" title="页面属性配置"></a>页面属性配置</h2><blockquote><p><a href="https://uniapp.dcloud.net.cn/component/custom-tab-bar">custom-tab-bar</a></p><p>底部tabbar自定义组件</p><p><a href="https://uniapp.dcloud.net.cn/component/navigation-bar">navigation-bar</a></p><p>页面顶部导航</p><p><a href="https://uniapp.dcloud.net.cn/component/page-meta">page-meta</a></p><p>页面属性配置节点</p></blockquote><h2 id="uniCloud"><a href="#uniCloud" class="headerlink" title="uniCloud"></a>uniCloud</h2><blockquote><p><a href="https://uniapp.dcloud.net.cn/uniCloud/unicloud-db">unicloud-db组件</a></p><p>uniCloud数据库访问和操作组件</p></blockquote>]]></content>
    
    
    <summary type="html">it is some basic usage of uni-app .</summary>
    
    
    
    <category term="Front_end_development" scheme="https://alleyf.github.io/categories/Front-end-development/"/>
    
    
    <category term="uni-app" scheme="https://alleyf.github.io/tags/uni-app/"/>
    
  </entry>
  
  <entry>
    <title>初识Vue</title>
    <link href="https://alleyf.github.io/2023/04/3dbbbdf5122f.html"/>
    <id>https://alleyf.github.io/2023/04/3dbbbdf5122f.html</id>
    <published>2023-04-16T08:29:16.000Z</published>
    <updated>2023-09-27T14:36:46.157Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-生命周期函数"><a href="#1-生命周期函数" class="headerlink" title="1. 生命周期函数"></a>1. 生命周期函数</h1><table><thead><tr><th>生命周期钩子函数</th><th>实例处于阶段</th><th>描述</th><th>能否获取到 el (this.$el)</th><th>能否获取到 data (this. Xxx)</th><th>能否使用 methods 中的方法 (this. Xxx ())</th></tr></thead><tbody><tr><td>beforeCreate</td><td>创建前</td><td>实例已初始化,但数据观测,watch/event 事件回调还未配置</td><td>获取不到</td><td>不能</td><td>不能</td></tr><tr><td>created</td><td>创建后</td><td>已完成如下配置,数据观测 (data observer),property 和方法的运算,watch/event 事件回调</td><td>获取不到</td><td>能</td><td>能</td></tr><tr><td>beforeMount</td><td>挂载前</td><td>dom 已初始化,但并未挂载和渲染</td><td>能</td><td>能</td><td>能</td></tr><tr><td>mounted</td><td>挂载后</td><td>dom 已完成挂载和渲染</td><td>能</td><td>能</td><td>能</td></tr><tr><td>beforeUpdate</td><td>更新前</td><td>数据已改变,但 dom 未更新</td><td>能</td><td>能</td><td>能</td></tr><tr><td>updated</td><td>更新后</td><td>dom 已更新</td><td>能</td><td>能</td><td>能</td></tr><tr><td>beforeDestroy</td><td>销毁前</td><td>实例销毁前,实例仍然可用</td><td>能</td><td>能</td><td>能</td></tr><tr><td>destroyed</td><td>销毁后</td><td>实例已销毁,所有指令被解绑,事件监听器被移除,子实例都被销毁</td><td>能</td><td>能</td><td>能</td></tr></tbody></table><h1 id="2-API"><a href="#2-API" class="headerlink" title="2. API"></a>2. API</h1><h2 id="声明式-API"><a href="#声明式-API" class="headerlink" title="声明式 API"></a>声明式 API</h2><blockquote><p>Vue 的核心功能是<em><strong>声明式渲染</strong></em>:通过扩展于标准 HTML 的模板语法,我们可以根据 JavaScript 的状态来描述 HTML 应该是什么样子的。当状态改变时,HTML 会自动更新。</p></blockquote><p>我们可以使用 <code>data</code> 组件选项来声明响应式状态,该选项应该是一个返回对象的函数:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello World!&#x27;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>message</code> 属性可以在模板中使用。下面展示了我们如何使用双花括号法,根据 <code>message</code> 的值来渲染动态文本:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>在双花括号中的内容并<strong>不只限于标识符或路径</strong>——我们可以使用任何<em><strong>有效的 JavaScript 表达式</strong></em>。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="组合式-API"><a href="#组合式-API" class="headerlink" title="组合式 API"></a>组合式 API</h2><p>我们可以使用 Vue 的 <code>reactive()</code> API 来声明响应式状态。由 <code>reactive()</code> 创建的对象都是 JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>,其行为与普通对象一样:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; reactive &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span><br>&#125;)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-property">count</span>) <span class="hljs-comment">// 0</span><br>counter.<span class="hljs-property">count</span>++<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] Tips<br><code>reactive()</code> 只适用于对象 (包括数组和内置类型,如 <code>Map</code> 和 <code>Set</code>)。而另一个 API <code>ref()</code> 则可以接受任何值类型。<code>ref</code> 会返回一个包裹对象,并在 <code>.value</code> 属性下暴露内部值。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">const</span> message = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;Hello World!&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message.<span class="hljs-property">value</span>) <span class="hljs-comment">// &quot;Hello World!&quot;</span><br>message.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;Changed&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>在组件的 <code>&lt;script setup&gt;</code> 块中声明的响应式状态,可以直接在模板中使用</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>count is: &#123;&#123; counter.count &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>使用任何<em><strong>有效的 JavaScript 表达式</strong></em></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h1 id="3-基础语法"><a href="#3-基础语法" class="headerlink" title="3. 基础语法"></a>3. 基础语法</h1><h2 id="1-属性绑定"><a href="#1-属性绑定" class="headerlink" title="1. 属性绑定"></a>1. 属性绑定</h2><blockquote><p>双大括号只能进行文本插值,为了给 attribute 绑定一个动态值,需要使用 <code>v-bind</code> 指令, 可以缩写只用 <code>:</code> 表示属性绑定</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-bind:id</span>=<span class="hljs-string">&quot;dynamicId&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:id</span>=<span class="hljs-string">&quot;dynamicId&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="动态绑定多个属性"><a href="#动态绑定多个属性" class="headerlink" title="动态绑定多个属性"></a>动态绑定多个属性</h3><h4 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> objectOfAttrs = &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;container&#x27;</span>,<br>  <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;wrapper&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>通过不带参数的 <code>v-bind</code>,你可以将它们绑定到单个元素上</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">&quot;objectOfAttrs&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;&#123;info:info,danger:danger&#125;&quot;</span>&gt;</span>我叫:&#123;&#123;name&#125;&#125;,年龄:&#123;&#123;age&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">data</span>: &#123;<br><span class="hljs-attr">info</span>: <span class="hljs-literal">true</span>,  <br><span class="hljs-attr">danger</span>: <span class="hljs-literal">false</span>,  <br>&#125;,<br></code></pre></td></tr></table></figure><h4 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;[info,danger]&quot;</span>&gt;</span>我叫:&#123;&#123;name&#125;&#125;,年龄:&#123;&#123;age&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">info</span>: <span class="hljs-string">&quot;c1&quot;</span>, <br><span class="hljs-attr">danger</span>: <span class="hljs-string">&quot;c2&quot;</span>,  <br>&#125;,<br></code></pre></td></tr></table></figure><h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><blockquote><p>可以在绑定的表达式中使用一个组件暴露的方法</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">&quot;toTitleDate(date)&quot;</span>&gt;</span><br>  &#123;&#123; formatDate(date) &#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-事件监听"><a href="#2-事件监听" class="headerlink" title="2. 事件监听"></a>2. 事件监听</h2><blockquote><p>使用 <code>v-on</code> 指令监听 DOM 事件,可以简写为 <code>@</code>,表示事件监听</p></blockquote><h3 id="不带参数"><a href="#不带参数" class="headerlink" title="不带参数"></a>不带参数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 更新组件状态</span><br>  count.<span class="hljs-property">value</span>++<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="带传参"><a href="#带传参" class="headerlink" title="带传参"></a>带传参</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> @<span class="hljs-attr">mouseover</span>=<span class="hljs-string">&quot;dosomething(&#x27;过来了&#x27;)&quot;</span> @<span class="hljs-attr">mouseout</span>=<span class="hljs-string">&quot;dosomething(&#x27;离开了&#x27;)&quot;</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;  <br><span class="hljs-attr">dosomething</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>)&#123;  <br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg)  <br>&#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-表单绑定"><a href="#3-表单绑定" class="headerlink" title="3. 表单绑定"></a>3. 表单绑定</h2><blockquote><p>同时使用 <code>v-bind</code> 和 <code>v-on</code> 来在表单的输入元素上创建双向绑定</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;text&quot;</span> @<span class="hljs-attr">input</span>=<span class="hljs-string">&quot;onInput&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">onInput</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-comment">// v-on 处理函数会接收原生 DOM 事件</span><br>  <span class="hljs-comment">// 作为其参数。</span><br>  text.<span class="hljs-property">value</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>简化双向绑定,Vue 提供了一个 <code>v-model</code> 指令,它实际上是上述操作的语法糖</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] Tips</p><ol><li><code>v-model</code> 会将被绑定的值与 <code>&lt;input&gt;</code> 的值自动同步</li><li><code>v-model</code> 不仅支持文本输入框,也支持诸如多选框、单选框、下拉框之类的输入类型</li></ol></blockquote><p><strong>完整 demo</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>const text = ref(&#x27;&#x27;)<br>&lt;/script&gt;<br>&lt;template&gt;<br>  &lt;input v-model=&quot;text&quot; placeholder=&quot;Type here&quot;&gt;<br>  &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="常用标签"><a href="#常用标签" class="headerlink" title="常用标签"></a>常用标签</h3><blockquote><p>demo</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>VueDemo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-comment">&lt;!-- &lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.global.min.js&quot;&gt;&lt;/script&gt;--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">  </span><br><span class="language-css"><span class="hljs-selector-class">.info</span> &#123;  </span><br><span class="language-css"><span class="hljs-attribute">color</span>: aquamarine;  </span><br><span class="language-css">&#125;  </span><br><span class="language-css"><span class="hljs-selector-class">.danger</span> &#123;  </span><br><span class="language-css"><span class="hljs-attribute">color</span>: red;  </span><br><span class="language-css">&#125;  </span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.username&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.pwd&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br>男:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span>  <br>女:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br>篮球:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;h1&quot;</span>&gt;</span>  <br>足球:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;h2&quot;</span>&gt;</span>  <br>排球:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.hobby&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;h3&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.city&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;c1&quot;</span>&gt;</span>北京<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;c2&quot;</span>&gt;</span>上海<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;c3&quot;</span>&gt;</span>广州<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;c4&quot;</span>&gt;</span>深圳<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.field&quot;</span> <span class="hljs-attr">multiple</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;f1&quot;</span>&gt;</span>前端<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;f2&quot;</span>&gt;</span>后端<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;f3&quot;</span>&gt;</span>运维<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;f4&quot;</span>&gt;</span>算法<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.other&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;注册&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;clickme&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span><br><span class="language-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;  </span><br><span class="language-javascript">info : &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">username</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">pwd</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">gender</span>: <span class="hljs-string">&quot;1&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">hobby</span>: [<span class="hljs-string">&quot;h1&quot;</span>],  </span><br><span class="language-javascript"><span class="hljs-attr">city</span>: <span class="hljs-string">&quot;c1&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">field</span>: [<span class="hljs-string">&quot;f1&quot;</span>],  </span><br><span class="language-javascript"><span class="hljs-attr">other</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">clickme</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>)  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="4-条件渲染"><a href="#4-条件渲染" class="headerlink" title="4. 条件渲染"></a>4. 条件渲染</h2><h3 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h3><blockquote><p>使用 <code>v-if</code> 指令来==<strong>有条件地渲染元素</strong>==（不一定渲染）, 也可以使用 <code>v-else</code> 和 <code>v-else-if</code> 来表示其他的条件分支</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;h1 v-<span class="hljs-keyword">if</span>=<span class="hljs-string">&quot;awesome&quot;</span>&gt;<span class="hljs-title class_">Vue</span> is awesome!&lt;/h1&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-else</span>&gt;</span>Oh no 😢<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h3 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h3><blockquote><p>v-show 根据**==变量的真假==<strong>决定是否显示该标签（</strong><em>一定会渲染但不一定显示</em>**）</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>VueDemo3<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;issms=false&quot;</span>&gt;</span>用户名登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;issms=true&quot;</span>&gt;</span>手机号登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!issms&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;pwd&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;issms&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>手机号<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;手机号&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;phone&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;pwd&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span><br><span class="language-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">issms</span>: <span class="hljs-literal">false</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">username</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">phone</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">pwd</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;&#125;  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="5-列表渲染"><a href="#5-列表渲染" class="headerlink" title="5. 列表渲染"></a>5. 列表渲染</h2><blockquote><p>使用 <code>v-for</code> 指令来渲染一个基于源数组的列表</p></blockquote><h3 id="无索引"><a href="#无索引" class="headerlink" title="无索引"></a>无索引</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;todo in todos&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;todo.id&quot;</span>&gt;</span><br>    &#123;&#123; todo.text &#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><ol><li><code>todo</code> 是一个局部变量,表示当前正在迭代的数组元素。它只能在 <code>v-for</code> 所绑定的元素上或是其内部访问,就像函数的作用域一样.</li><li>key 属性将它（唯一标识主键）作为<a href="https://cn.vuejs.org/api/built-in-special-attributes.html#key">特殊的 <code>key</code> attribute</a> 绑定到每个 <code>&lt;li&gt;</code></li></ol></blockquote><blockquote><p>更新列表有两种方式:<br>    1. 在源数组上调用变更方法:<br>        <code>todos.value.push(newTodo)</code><br>      2. 使用新的数组替代原数组:<br>        <code>todos.value = todos.value.filter(/* ... */)</code> </p></blockquote><p>完整 demo（实现列表动态增删）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-comment">// 给每个 todo 对象一个唯一的 id</span></span><br><span class="language-javascript"><span class="hljs-keyword">let</span> id = <span class="hljs-number">0</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> newTodo = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> todos = <span class="hljs-title function_">ref</span>([</span><br><span class="language-javascript">  &#123; <span class="hljs-attr">id</span>: id++, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Learn HTML&#x27;</span> &#125;,</span><br><span class="language-javascript">  &#123; <span class="hljs-attr">id</span>: id++, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Learn JavaScript&#x27;</span> &#125;,</span><br><span class="language-javascript">  &#123; <span class="hljs-attr">id</span>: id++, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Learn Vue&#x27;</span> &#125;</span><br><span class="language-javascript">])</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">addTodo</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-comment">// ...</span></span><br><span class="language-javascript">  todos.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-attr">id</span>:id++,<span class="hljs-attr">text</span>:newTodo.<span class="hljs-property">value</span>&#125;)</span><br><span class="language-javascript">  newTodo.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">removeTodo</span>(<span class="hljs-params">todo</span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-comment">// 方法1</span></span><br><span class="language-javascript">  todos.<span class="hljs-property">value</span>.<span class="hljs-title function_">pop</span>(todo)</span><br><span class="language-javascript">  <span class="hljs-comment">// 方法2</span></span><br><span class="language-javascript">  todos.<span class="hljs-property">value</span> = todos.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t !== todo)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">&quot;addTodo&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;newTodo&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>Add Todo<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;todo in todos&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;todo.id&quot;</span>&gt;</span><br>      &#123;&#123; todo.text &#125;&#125;<br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;removeTodo(todo)&quot;</span>&gt;</span>X<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="有索引"><a href="#有索引" class="headerlink" title="有索引"></a>有索引</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(todo,index) in todos&quot;</span> <span class="hljs-attr">:id</span>=<span class="hljs-string">&#123;&#123;index&#125;&#125;</span>&gt;</span><br>    &#123;&#123; todo &#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="有键值"><a href="#有键值" class="headerlink" title="有键值"></a>有键值</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(value,key) in item&quot;</span>&gt;</span><br>    &#123;&#123; key &#125;&#125;:&#123;&#123;value&#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="6-计算属性"><a href="#6-计算属性" class="headerlink" title="6. 计算属性"></a>6. 计算属性</h2><blockquote><ol><li><a href="https://cn.vuejs.org/guide/essentials/computed.html"><code>computed()</code></a>。它可以让我们创建一个计算属性 ref,这个 ref 会动态地根据其他响应式数据源来计算其 <code>.value</code></li><li>computed <code>(计算属性)</code> 可用于快速计算视图（View）中显示的属性。这些计算将被<strong>缓存</strong>,并且只在需要时更新。computed 设置的初衷是能够<strong>解决复杂的计算</strong>,而不是直接在模板字符串里进行运算。</li></ol></blockquote><p>实现显示（隐藏）已完成的 todos</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref, computed &#125; from &#x27;vue&#x27;<br>let id = 0<br>const newTodo = ref(&#x27;&#x27;)<br>const hideCompleted = ref(false)<br>const todos = ref([<br>  &#123; id: id++, text: &#x27;Learn HTML&#x27;, done: true &#125;,<br>  &#123; id: id++, text: &#x27;Learn JavaScript&#x27;, done: true &#125;,<br>  &#123; id: id++, text: &#x27;Learn Vue&#x27;, done: false &#125;<br>])<br>const filteredTodos = computed(() =&gt; &#123;<br>  return hideCompleted.value<br>    ? todos.value.filter((t) =&gt; !t.done)<br>    : todos.value<br>&#125;)<br>function addTodo() &#123;<br>  todos.value.push(&#123; id: id++, text: newTodo.value, done: false &#125;)<br>  newTodo.value = &#x27;&#x27;<br>&#125;<br>function removeTodo(todo) &#123;<br>  todos.value = todos.value.filter((t) =&gt; t !== todo)<br>&#125;<br>&lt;/script&gt;<br>&lt;template&gt;<br>  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;<br>    &lt;input v-model=&quot;newTodo&quot;&gt;<br>    &lt;button&gt;Add Todo&lt;/button&gt;<br>  &lt;/form&gt;<br>  &lt;ul&gt;<br>    &lt;li v-for=&quot;todo in filteredTodos&quot; :key=&quot;todo.id&quot;&gt;<br>      &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;<br>      &lt;span :class=&quot;&#123; done: todo.done &#125;&quot;&gt;&#123;&#123; todo.text &#125;&#125;&lt;/span&gt;<br>      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;<br>    &lt;/li&gt;<br>  &lt;/ul&gt;<br>  &lt;button @click=&quot;hideCompleted = !hideCompleted&quot;&gt;<br>    &#123;&#123; hideCompleted ? &#x27;Show all&#x27; : &#x27;Hide completed&#x27; &#125;&#125;<br>  &lt;/button&gt;<br>&lt;/template&gt;<br>&lt;style&gt;<br>.done &#123;<br>  text-decoration: line-through;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h2 id="7-文本插值"><a href="#7-文本插值" class="headerlink" title="7. 文本插值"></a>7. 文本插值</h2><blockquote><p>最基本的数据绑定形式是文本插值,它使用的是“Mustache”语法 (即双大括号)</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Message: &#123;&#123; msg &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>双大括号标签会被替换为<a href="https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html#declaring-reactive-state">相应组件实例中</a> <code>msg</code> 属性的值。同时每次 <code>msg</code> 属性更改时它也会同步更新。</p></blockquote><h2 id="8-原始-HTML"><a href="#8-原始-HTML" class="headerlink" title="8. 原始 HTML"></a>8. 原始 HTML</h2><blockquote><p>双大括号会将数据解释为纯文本,而不是 HTML。若想插入 HTML,需要使用 <a href="https://cn.vuejs.org/api/built-in-directives.html#v-html"><code>v-html</code> 指令</a></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Using text interpolation: &#123;&#123; rawHtml &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Using v-html directive: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;rawHtml&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="4-Demo-1-表格增删"><a href="#4-Demo-1-表格增删" class="headerlink" title="4. Demo 1 表格增删"></a>4. Demo 1 表格增删</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vuedemo2<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;添加&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;adduser&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(user,uid) in users&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;user.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;user.pwd&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;user.name!=&#x27;&#x27; &amp;&amp; user.pwd!=&#x27;&#x27;&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;deluser(uid)&quot;</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span><br><span class="language-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">username</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">pwd</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">users</span>: [  </span><br><span class="language-javascript">&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-attr">pwd</span>:<span class="hljs-string">&quot;&quot;</span>&#125;,  </span><br><span class="language-javascript">],  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">adduser</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-keyword">let</span> userinfo = &#123;<span class="hljs-attr">name</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span>,<span class="hljs-attr">pwd</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">pwd</span>&#125;;  </span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>.<span class="hljs-title function_">push</span>(userinfo);  </span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span>=<span class="hljs-string">&quot;&quot;</span>;  </span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">pwd</span>=<span class="hljs-string">&quot;&quot;</span>;  </span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userinfo);  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">deluser</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">uid</span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>.<span class="hljs-title function_">splice</span>(uid,<span class="hljs-number">1</span>);  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="5-Demo-2-登录（axios）"><a href="#5-Demo-2-登录（axios）" class="headerlink" title="5. Demo 2 登录（axios）"></a>5. Demo 2 登录（axios）</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>VueDemo3<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/1.3.6/axios.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;issms=false&quot;</span>&gt;</span>用户名登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;issms=true&quot;</span>&gt;</span>手机号登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!issms&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.username&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;info.pwd&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;issms&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>手机号<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;手机号&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;sms.phone&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>验证码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;验证码&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;sms.code&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;登录&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span><br><span class="language-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">issms</span>: <span class="hljs-literal">false</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">info</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">username</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">pwd</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">sms</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">phone</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">code</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">login</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-keyword">let</span> dataobj = <span class="hljs-variable language_">this</span>.<span class="hljs-property">issms</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">sms</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>;  </span><br><span class="language-javascript"><span class="hljs-title function_">axios</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://localhost/login&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">parameters</span>: <span class="hljs-string">&quot;&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: dataobj,  </span><br><span class="language-javascript"><span class="hljs-attr">headers</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript">&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);  </span><br><span class="language-javascript">&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);  </span><br><span class="language-javascript"><span class="hljs-title function_">alert</span>(error.<span class="hljs-property">message</span>)  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="6-组件"><a href="#6-组件" class="headerlink" title="6. 组件"></a>6. 组件</h1><blockquote><p>提高相同代码的复用率。</p></blockquote><h2 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h2><blockquote><pre><code class="hljs">局部组件需要挂载到 Vue 根组件上,***components: &#123;  alias: component&#125;  </code></pre></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vuedemo4<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-comment">&lt;!-- 引入局部子组件--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">login</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">login</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">  </span></span><br><span class="language-xml"><span class="language-handlebars">const login = &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">data: function () &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">return &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">msg: &quot;局部组件&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">username: &quot;&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">pwd: &quot;&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;,  </span></span><br><span class="language-xml"><span class="language-handlebars">template: `  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars">`,  </span></span><br><span class="language-xml"><span class="language-handlebars">methods: &#123;&#125;  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;;  </span></span><br><span class="language-xml"><span class="language-handlebars">var app = new Vue(&#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">el: &quot;#app&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">data: &#123;&#125;,  </span></span><br><span class="language-xml"><span class="language-handlebars">methods: &#123;&#125;,  </span></span><br><span class="language-xml"><span class="language-handlebars">components: &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">login: login,  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;)  </span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h2><blockquote><pre><code class="hljs">全局子组件不用挂载到 Vue 上,直接用***Vue. Component (&#39;component_name&#39;,&#123;&#125;）***</code></pre></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vuedemo5<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-comment">&lt;!-- 引入全局子组件--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">login</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">login</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">  </span></span><br><span class="language-xml"><span class="language-handlebars">Vue.component(&#x27;login&#x27;, &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">data: function () &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">return &#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">msg: &quot;局部组件&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">username: &quot;&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">pwd: &quot;&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;,  </span></span><br><span class="language-xml"><span class="language-handlebars">template: `  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  </span></span><br><span class="language-xml"><span class="language-handlebars">`,  </span></span><br><span class="language-xml"><span class="language-handlebars">methods: &#123;&#125;  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;);  </span></span><br><span class="language-xml"><span class="language-handlebars">var app = new Vue(&#123;  </span></span><br><span class="language-xml"><span class="language-handlebars">el: &quot;#app&quot;,  </span></span><br><span class="language-xml"><span class="language-handlebars">data: &#123;&#125;,  </span></span><br><span class="language-xml"><span class="language-handlebars">methods: &#123;&#125;,  </span></span><br><span class="language-xml"><span class="language-handlebars">&#125;)  </span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="7-路由"><a href="#7-路由" class="headerlink" title="7. 路由"></a>7. 路由</h1><blockquote><p>引入 vue-router:<br><code> &lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/vue-router/4.1.6/vue-router.global.min.js&quot;&gt;&lt;/script&gt;</code></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vuedemo6<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/vue-router@3.5.3/dist/vue-router.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Logo<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/home&quot;</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/course&quot;</span>&gt;</span>课程<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;首页组件&quot;</span>,  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">template</span>: <span class="hljs-string">`  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">`</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;&#125;  </span><br><span class="language-javascript">&#125;;  </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Course</span> = &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;课程组件&quot;</span>,  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">template</span>: <span class="hljs-string">`  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">`</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;&#125;  </span><br><span class="language-javascript">&#125;;  </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">routes</span>: [  </span><br><span class="language-javascript">&#123;<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>&#125;,  </span><br><span class="language-javascript">&#123;<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/home&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>&#125;,  </span><br><span class="language-javascript">&#123;<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/course&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Course</span>&#125;,  </span><br><span class="language-javascript">],  </span><br><span class="language-javascript">&#125;);  </span><br><span class="language-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">components</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-title class_">Home</span>: <span class="hljs-title class_">Home</span>,  </span><br><span class="language-javascript"><span class="hljs-title class_">Course</span>: <span class="hljs-title class_">Course</span>,  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">router</span>: router  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="8-路由使用"><a href="#8-路由使用" class="headerlink" title="8. 路由使用"></a>8. 路由使用</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vuedemo6<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/1.3.6/axios.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/vue-router@3.5.3/dist/vue-router.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Logo<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/home&quot;</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-keyword">return</span> &#123;  </span><br><span class="language-javascript"><span class="hljs-attr">imgls</span>: [],  </span><br><span class="language-javascript">&#125;  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">created</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-title function_">axios</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">url</span>: <span class="hljs-string">&quot;https://picsum.photos/v2/list&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">method</span>: <span class="hljs-string">&quot;get&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">headers</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>  </span><br><span class="language-javascript">&#125;,</span><br><span class="language-javascript">&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;  </span><br><span class="language-javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">imgls</span> = res.<span class="hljs-property">data</span>;  </span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgls</span>, res.<span class="hljs-property">data</span>);  </span><br><span class="language-javascript">&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;  </span><br><span class="language-javascript"><span class="hljs-comment">// console.log(error);  </span></span><br><span class="language-javascript"><span class="hljs-title function_">alert</span>(error.<span class="hljs-property">message</span>)  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">mounted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;  </span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgls</span>)  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">template</span>: <span class="hljs-string">`  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;div class=&quot;red&quot;&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;div v-for=&quot;img in imgls&quot;&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;a :href=&quot;img.download_url&quot;&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;img :src=&quot;img.url&quot; style=&quot;align-content: center&quot; alt=&quot;加载图片失败&quot;&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;/a&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;/div&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">&lt;/div&gt;  </span></span><br><span class="hljs-string"><span class="language-javascript">`</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;&#125;,  </span><br><span class="language-javascript">&#125;;  </span><br><span class="language-javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">routes</span>: [  </span><br><span class="language-javascript">&#123;<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>&#125;,  </span><br><span class="language-javascript">&#123;<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/home&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>&#125;,  </span><br><span class="language-javascript">],  </span><br><span class="language-javascript">&#125;);  </span><br><span class="language-javascript"><span class="hljs-keyword">var</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;  </span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,  </span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">methods</span>: &#123;&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">components</span>: &#123;  </span><br><span class="language-javascript"><span class="hljs-title class_">Home</span>: <span class="hljs-title class_">Home</span>,  </span><br><span class="language-javascript">&#125;,  </span><br><span class="language-javascript"><span class="hljs-attr">router</span>: router,  </span><br><span class="language-javascript">&#125;)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="9-Element-UI-使用"><a href="#9-Element-UI-使用" class="headerlink" title="9. Element-UI 使用"></a>9. Element-UI 使用</h1><blockquote><p>Element 是国内饿了么公司提供的一套开源前端框架,简洁优雅,提供了 Vue、React、Angular 等多个版本。<br>文档地址: <a href="https://element-plus.org/zh-CN/#/zh-CN">一个 Vue 3 UI 框架 | Element Plus</a><br>安装: npm i element-ui<br>引入 Element:<br>main. js (vue 2):</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementUI</span>);<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>:#app,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)<br>);<br></code></pre></td></tr></table></figure><p>main. js (vue 3):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// main.ts</span><br><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-plus/dist/index.css&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)<br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="第三方图标库"><a href="#第三方图标库" class="headerlink" title="第三方图标库"></a>第三方图标库</h2><p>由于 Element UI 提供的字体图符较少,一般会采用其他图表库,如著名的 Font<br>Awesome<br>Font Awesome 提供了 675 个可缩放的矢量图标,可以使用 cSS 所提供的所有特<br>性对它们进行更改,包括大小、颜色、阴影或者其他任何支持的效果。<br>文档地址: <a href="http://fontawesome.dashgame.com/">http://fontawesome.dashgame.com/</a><br>安装: <code>npm i font-awesome</code><br>使用: <code>import &#39;font-awesome/css/font-awesome.min.css&#39;</code></p><h1 id="10-Axios"><a href="#10-Axios" class="headerlink" title="10. Axios"></a>10. Axios</h1><h2 id="1-使用方法"><a href="#1-使用方法" class="headerlink" title="1. 使用方法"></a>1. 使用方法</h2><blockquote><p>Axios 是一个基于 promise 网络请求库,作用于 node. js 和浏览器中。<br>Axios 在浏览器端使用 XMLHttpRequests 发送网络请求,并能自动完成 JSON<br>数据的转换。<br>安装: npm install axios<br>地址: <a href="https://www.axios-http.cn/">https://www.axios-http.cn/</a></p></blockquote><ol><li>Get 请求:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//向给定ID的用户发起请求</span><br>axios.<span class="hljs-title function_">get</span>(/user?<span class="hljs-variable constant_">ID</span>=<span class="hljs-number">12345</span><span class="hljs-string">&#x27;)</span><br><span class="hljs-string"> .then(function(response)&#123;</span><br><span class="hljs-string">   //处理成功情况</span><br><span class="hljs-string">   console.log(response);</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string"> .catch(function (error)(</span><br><span class="hljs-string">   //处理错误情况</span><br><span class="hljs-string">   console.log(error);</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string"> .then(function （）&#123; </span><br><span class="hljs-string">  //总是会执行</span><br><span class="hljs-string"> &#125;);</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">/／上述请求也可以按以下方式完成（可选）<br>axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/user&#x27;,&#123;</span><br><span class="hljs-string">   params:&#123;</span><br><span class="hljs-string">    ID:12345</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string"> .then(function (response)&#123;</span><br><span class="hljs-string">   console.log(response);</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string"> .catch(function (error)&#123;</span><br><span class="hljs-string">   console.log(error);</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string"> .then(function ()&#123; </span><br><span class="hljs-string">  //总是会执行</span><br><span class="hljs-string"> &#125;);</span><br></code></pre></td></tr></table></figure><ol start="2"><li>POST 请求:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/user&#x27;</span>, &#123;<br>   <span class="hljs-attr">firstName</span>:<span class="hljs-string">&#x27;Fred&#x27;</span>,<br>   <span class="hljs-attr">lastName</span>:<span class="hljs-string">&#x27;Flintstone&#x27;</span><br>&#125;)<br> .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>&#125;)<br> .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br> &#125;);<br></code></pre></td></tr></table></figure><ol start="3"><li>异步回调问题（async/await）:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//支持async/await用法</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params"></span>) (<br> <span class="hljs-keyword">try</span> (<br>   <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user?ID=12345&#x27;</span>);<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response)<br> &#125; <span class="hljs-keyword">catch</span> (error)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);<br></code></pre></td></tr></table></figure><ol start="4"><li>其他请求方式:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//发起一个post请求</span><br><span class="hljs-title function_">axios</span>(&#123;<br> <span class="hljs-attr">method</span>:<span class="hljs-string">&#x27;post&#x27;</span>,<br> <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;/user/12345&#x27;,</span><br><span class="hljs-string"> data: &#123;</span><br><span class="hljs-string">   firstName: &quot;</span><span class="hljs-title class_">Fred</span><span class="hljs-string">&#x27;,</span><br><span class="hljs-string">   lastName:&quot;Flintstone&#x27;</span><br> &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><pre><code class="hljs">axios.get (url, configl)axios.delete (url[, config])axios.head (uri[, config))axios.options (url, config])axios.post (url, datal, configl)axios.put (url, datal, config]l)axios.patch (url, datal, config]l)</code></pre><h2 id="2-与-Vue-整合"><a href="#2-与-Vue-整合" class="headerlink" title="2. 与 Vue 整合"></a>2. 与 Vue 整合</h2><h2 id="3-跨域"><a href="#3-跨域" class="headerlink" title="3. 跨域"></a>3. 跨域</h2><blockquote><ol><li>为了保证浏览器的安全,不同源的客户端脚本在没有明确授权的情况下,不能读写对方资源,称为同源策略,同源策略是浏览器安全的基石</li><li>同源策略 （Sameoriginpolicy）是一种约定,它是浏览器最核心也最基本的安全功能</li><li>所谓同源 (即指在同一个域) 就是两个页面具有相同的协议（protocol）,主机 (host) 和端口号  (port)</li><li>当一个请求 url 的协议、域名、端口三者之间任意一个与当前页面 url 不同即为跨域,此时无法读取非同源网页的 Cookie,无法向非同源地址发送 AJAX 请求</li></ol></blockquote><p>解决方案:</p><ul><li>CORS（Cross-Origin Resource Sharing）是由 W 3 C 制定的一种跨域资源共享技术标准,其目的就是为了解决前端的跨域请求。</li><li>CORS 可以在不破坏即有规则的情况下,通过后端服务器实现 CORS 接口,从而实现跨域通信。</li><li>CORS 将请求分为两类:简单请求和非简单请求,分别对跨域通信提供了支持。</li></ul><h3 id="1-Spring-Boot-中配置-CORS"><a href="#1-Spring-Boot-中配置-CORS" class="headerlink" title="1. Spring Boot 中配置 CORS"></a>1. Spring Boot 中配置 CORS</h3><p>在传统的 Java EE 开发中,可以通过过滤器统一配置,而 Spring Boot 中对此则提供了更加简洁的解决方案<br><strong>方法 1:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> (<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> (<br>     registry.addMapping（<span class="hljs-string">&quot;/**&quot;</span>）<span class="hljs-comment">//允许跨域访问的路径</span><br>      .allowedorigins（<span class="hljs-string">&quot;*&quot;</span>）<span class="hljs-comment">//允许跨域访问的源</span><br>.allowedMethods(<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;PUT&quot;</span>,<span class="hljs-string">&quot;OPTIONS&quot;</span>,<span class="hljs-string">&quot;DELETE&quot;</span>）<span class="hljs-comment">//允许请求方法</span><br>      .maxAge（<span class="hljs-number">168000</span>）/／预检间隔时间<br>      .allowedHeaders（<span class="hljs-string">&quot;*&quot;</span>）<span class="hljs-comment">//允许头部设置</span><br>      .allowCredentials（<span class="hljs-literal">true</span>）；<span class="hljs-comment">//是否发送cookie</span><br></code></pre></td></tr></table></figure><p><strong>方法 2:</strong><br>给控制器类前加 CrossOrigin 注解使用默认跨域配置<br><font color="#ff0000">@CrossOrigin</font></p><h2 id="4-全局配置-Axios"><a href="#4-全局配置-Axios" class="headerlink" title="4. 全局配置 Axios"></a>4. 全局配置 Axios</h2><blockquote><p>在实际项目开发中,几乎每个组件中都会用到 axios 发起数据请求。此时会遇到如下两个问题:<br>每个组件中都需要导入 axios<br>每次发请求都需要填写完整的请求路径<br>可以通过全局配置的方式解决上述问题:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//配置请求根路径</span><br>axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">baseURL</span> = <span class="hljs-string">&#x27;http://api.com&#x27;</span><br><span class="hljs-comment">//将 axios 作为全局的自定义属性,每个组件可以在内部直接访问 (Vue3)</span><br>app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$http</span> = axios<br><span class="hljs-comment">//将 axios 作为全局的自定义属性,每个组件可以在内部直接访问 (Vue2)</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$http</span> = axios<br></code></pre></td></tr></table></figure><hr><h1 id="11-VueRouter"><a href="#11-VueRouter" class="headerlink" title="11. VueRouter"></a>11. VueRouter</h1><h2 id="1-安装与使用"><a href="#1-安装与使用" class="headerlink" title="1. 安装与使用"></a>1. 安装与使用</h2><blockquote><ul><li>Vue 路由 vue-router 是官方的路由插件,能够轻松的管理 SPA 项目中组件的切换。</li><li>Vue 的单页面应用是基于路由和组件的,路由用于设定访问路径,并将路径和组件映射起来</li><li>vue-router 目前有 3. x 的版本和 4. x 的版本,vue-router 3. x 只能结合 vue 2 进行使用,vue-router 4. x 只能结合 vue 3 进行使用</li><li>安装: **npm install vue-router@4 **</li></ul></blockquote><h3 id="创建路由组件"><a href="#创建路由组件" class="headerlink" title="创建路由组件"></a>创建路由组件</h3><p>在项目中定义 Discover. vue、Friends. vue、MyMusic. vue 三个组件,将来要使用 vue-router 来控制它们的展示与切换:<br>Discover. vue:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>发现音乐<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  <br>&lt;/template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Discover&quot;</span>  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure> <template>     <div>        <h1>发现音乐</h1>     </div> </template>Friends. vue :<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>关注<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  <br>&lt;/template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Friends&quot;</span>  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure> <template>     <div>         <h1>关注</h1>     </div> </template>MyMusic. vue:<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我的音乐<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  <br>&lt;/template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>: <span class="hljs-string">&quot;MyMusic&quot;</span>  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure>---### 声明路由链接和占位标签> 可以使用 `<router-link>` 标签来声明路由链接,并使用 `<router-view>` 标签来声明路由占位符。示例代码如下:<p>App. vue:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>APP 组件<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!--声明路由链接--&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/discover&quot;</span>&gt;</span>发现音乐<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/mymusic&quot;</span>&gt;</span>我的音乐<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/friend&quot;</span>&gt;</span>关注<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-comment">&lt;!--声明路由占位标签--&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="创建路由模块"><a href="#创建路由模块" class="headerlink" title="创建路由模块"></a>创建路由模块</h3><p>在项目中创建 index. js 路由模块,加入以下代码:<br>vue 2 路由的使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Discover</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/Discover. vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Friends</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/Friends. vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">MyMusic</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/MyMusic. vue&#x27;</span><br><span class="hljs-comment">//将 VueRouter 设置为 Vue 的插件</span><br><span class="hljs-title class_">Vue</span>. use (<span class="hljs-title class_">VueRouter</span>)<br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span> (&#123;<br>     <span class="hljs-regexp">/ /</span>指定 hash 属性与组件的对应关系<br>     <span class="hljs-attr">routes</span>: [<br>       &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/discover&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Discover</span> &#125;,<br>       &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/friends&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Friends</span> &#125;,<br>       &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/mymusic&#x27;, component: MyMusic&#125;,</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">&#125;)</span><br><span class="hljs-string">export default router</span><br></code></pre></td></tr></table></figure><p>vue 3 路由的使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-title class_">HomeView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../views/HomeView. vue&#x27;</span>  <br><span class="hljs-keyword">const</span> router = createRouter (&#123;  <br><span class="hljs-attr">history</span>: createWebHistory (<span class="hljs-keyword">import</span>. meta. env. <span class="hljs-variable constant_">BASE_URL</span>),  <br><span class="hljs-attr">routes</span>: [  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,  <br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;home&#x27;</span>,  <br><span class="hljs-attr">component</span>: <span class="hljs-title class_">HomeView</span>  <br>&#125;,  <br>&#123;  <br><span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/about&#x27;</span>,  <br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;about&#x27;</span>,  <br><span class="hljs-comment">// route level code-splitting  </span><br><span class="hljs-comment">// this generates a separate chunk (About.[hash]. js) for this route  </span><br><span class="hljs-comment">// which is lazy-loaded when the route is visited.  </span><br><span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span> (<span class="hljs-string">&#x27;../views/AboutView. vue&#x27;</span>)  <br>&#125;  <br>]  <br>&#125;)  <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></figure><hr><h3 id="挂载路由模块"><a href="#挂载路由模块" class="headerlink" title="挂载路由模块"></a>挂载路由模块</h3><p>在 main. js 中导入并挂载 router</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App. vue&#x27;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><span class="hljs-title class_">Vue</span>. config. productionTip = <span class="hljs-literal">false</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span> (&#123;<br><span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> h (<span class="hljs-title class_">App</span>),<br>router<br>&#125;).<span class="hljs-property">$mount</span> (<span class="hljs-string">&#x27; #app &#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="路由重定向"><a href="#路由重定向" class="headerlink" title="路由重定向"></a>路由重定向</h3><blockquote><p>路由重定向指的是:用户在访问地址 A 的时候,强制用户跳转到地址 C,从而展示特定的组件页面。</p><p>通过路由规则的 redirect 属性,指定一个新的路由地址,可以很方便地设置路由的重定向:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span> (t<br>    / /指定 hash 属性与组件的对应关系<br>    <span class="hljs-attr">routes</span>: [<br>       <span class="hljs-comment">//当用户访问／时,跳转到/discover</span><br>      &#123;<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/, redirect: &#x27;</span>/discover<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">      &#123;path: &#x27;</span>/discover<span class="hljs-string">&#x27;, component: Discover&#125;,</span><br><span class="hljs-string">      &#123;path: &#x27;</span>/friends<span class="hljs-string">&#x27;, component: Friends&#125;,</span><br><span class="hljs-string">      &#123;path: &#x27;</span>/my<span class="hljs-string">&#x27;, component: MyMusic&#125;</span><br><span class="hljs-string">   ]</span><br><span class="hljs-string">&#125;)</span><br></code></pre></td></tr></table></figure><hr><h2 id="2-子路由"><a href="#2-子路由" class="headerlink" title="2. 子路由"></a>2. 子路由</h2><h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><blockquote><p>在 Discover. vue 组件中,声明 toplist 和 playlist 的子路由链接以及子路由占位符。示例代码如下:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>   <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>发现音乐<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-comment">&lt;!--子路由链接--&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/discover/toplist&quot;</span>&gt;</span>推荐<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/discover/playlist&quot;</span>&gt;</span>歌单<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE] Tips<br>在 <code>src/router/index. js</code> 路由模块中,导入需要的组件,并使用 children 属性声明子路由规则:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span> (t<br>     / /指定 hash 属性与组件的对应关系<br>     <span class="hljs-attr">routes</span>:[<br>       &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&#x27;, redirect: &quot;</span>/discover<span class="hljs-string">&#x27;&#125;,</span><br><span class="hljs-string">       &#123;</span><br><span class="hljs-string">           path: &#x27;</span>/discover<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">           component: Discover,</span><br><span class="hljs-string">           //通过 chi 1 dren 属性,嵌套声明子路由</span><br><span class="hljs-string">           chiidren: [</span><br><span class="hljs-string">               &#123; path: &quot;toplist&quot;, component: TopList &#125;,</span><br><span class="hljs-string">               &#123; path: &quot;playlist&quot;, component: PlayList &#125;,</span><br><span class="hljs-string">          ]</span><br><span class="hljs-string">       &#125;,</span><br><span class="hljs-string">&#123; path: &#x27;</span>/friends<span class="hljs-string">&#x27;, component: Friends &#125;,</span><br><span class="hljs-string">&#123; path: &#x27;</span>/mymusic<span class="hljs-string">&#x27;, component: MyMusic &#125;,</span><br><span class="hljs-string">   1</span><br><span class="hljs-string">3)</span><br></code></pre></td></tr></table></figure><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>思考:有如下 3 个路由链接:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"> &lt;router-link to=<span class="hljs-string">&quot;/product/1&quot;</span>&gt;商品 <span class="hljs-number">1</span>&lt;/router-link&gt;<br> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/product/2&quot;</span>&gt;</span>商品 2<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/product/3&quot;</span>&gt;</span>商品 3<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span></span><br> <span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span> (t<br>    / /指定 hash 属性与组件的对应关系<br>    <span class="hljs-attr">routes</span>: [<br>       <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/product/1&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Product</span>,<br>       <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/product/2&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Product</span>,<br>       <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/product/3&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Product</span>,<br>   ]<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>上述方式复用性非常差。<br>动态路由指的是:把 Hash 地址中可变的部分定义为参数项,从而提高路由规则的复用性。在 vue-router 中使用英文的冒号（:）来定义路由的参数项。示例代码如下:<br><code>&#123;path: &quot;/product/: id&#39;, component: Product&#125;</code><br>通过动态路由匹配的方式染出来的组件中,可以使用 <code>$route. params</code> 对象访问到动态匹配的参数值,比如在商品详情组件的内部,<strong>根据 id 值,请求不同的商品数据</strong>。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"> &lt;template&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Product 组件<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>    ！--获取动态的 id 值--&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>($route. params. id)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br> &lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"> <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> t</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">//组件的名称</span></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Product&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><blockquote><p>为了简化路由参数的获取形式,vue-router 允许在路由规则中开启 <strong>props</strong> 传参。示例代码如下: <code>&#123; path:/: id&#39;, component: Product, props: true&#125;</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;<br>   <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Product 组件<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>   &lt;!--获取动态的id值--&gt;<br>   <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> &#123;&#123;id&#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">//组件的名称</span></span></span><br><span class="language-javascript"><span class="language-xml"> <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Product&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml"> props : [<span class="hljs-string">&quot;id&quot;</span>]</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><hr><h3 id="编程式导航"><a href="#编程式导航" class="headerlink" title="编程式导航"></a>编程式导航</h3><table><thead><tr><th align="center">声明式</th><th align="center">编程式</th></tr></thead><tbody><tr><td align="center"><code>&lt;router-link :to=&quot;...&quot; &gt;</code></td><td align="center"><code>router. push (...)</code></td></tr></tbody></table><blockquote><ul><li><p>除了使用 <code>&lt;router-link&gt;</code> 创建 a 标签来定义导航链接,我们还可以借助 router 的实例方法,通过编写代码来实现。</p></li><li><p>想要导航到不同的 URL,则使用 <code>router. push</code> 方法。这个方法会向 history 栈添加一个新的记录,所以,当用户点击浏览器后退按钮时,则回到之前的 URL。</p></li><li><p>当你点击 <code>&lt;router-link&gt;</code> 时,这个方法会在内部调用,所以说,点击<a href="router-link:to=&quot;...&quot;">router-link:to=&quot;...&quot;</a>等同于调用 router. push（…）。</p></li></ul></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"> &lt;template&gt;<br>    <span class="language-xml">&lt;button@click=&quot;gotoProduct(2)&quot;&gt;跳转到商品 2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br> &lt;/template&gt;<br> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"> <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    methods : &#123;</span></span><br><span class="language-javascript"><span class="language-xml">       <span class="hljs-attr">gotoProduct</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>)&#123;</span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>. push (<span class="hljs-string">&#x27;/production/$&#123;id&#125;&#x27;</span>)</span></span><br><span class="language-javascript"><span class="language-xml">          &#125;</span></span><br><span class="language-javascript"><span class="language-xml">      &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"> </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><hr><h2 id="3-导航守卫"><a href="#3-导航守卫" class="headerlink" title="3. 导航守卫"></a>3. 导航守卫</h2><blockquote><p>导航守卫可以控制路由的访问权限。示意图如下:<br>全局导航守卫会拦截每个路由规则,从而对每个路由进行访问权限的控制。<br>你可以使用 <code>router. beforeEach</code> 注册一个全局前置守卫:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">router. beforeEach (<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span>&#123;<br>   <span class="hljs-keyword">if</span> (to. path ===<span class="hljs-string">&#x27;/main&#x27;</span> &amp;&amp; ! isAuthenticated) &#123;<br>      next (<span class="hljs-string">&#x27;/login&#x27;</span>)<br>   &#125;<br>   <span class="hljs-keyword">else</span> &#123;<br>      next ()<br>   &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><ul><li>to:即将要进入的目标</li><li>from:当前导航正要离开的路由</li><li>在守卫方法中如果声明了 next 形参,则必须调用 next () 函数,否则不允许用户访问任何一个路由！<ol><li>直接放行:<code>next ()</code></li><li>强制其停留在当前页面:<code>next (false)</code></li><li>强制其跳转到登录页面:<code>next (&#39;/login&#39;)</code></li></ol></li></ul><h1 id="12-VueX"><a href="#12-VueX" class="headerlink" title="12 VueX"></a>12 VueX</h1><h2 id="1-VueX-介绍"><a href="#1-VueX-介绍" class="headerlink" title="1 VueX 介绍"></a>1 VueX 介绍</h2><blockquote><p>对于组件化开发来说,大型应用的状态往往跨越多个组件。在多层嵌套的父子<br>组件之间传递状态已经十分麻烦,而 Vue 更是没有为兄弟组件提供直接共享数<br>据的办法。</p><p>基于这个问题,许多框架提供了解决方案使用全局的状态管理器,将所有<br>分散的共享数据交由状态管理器保管,Vue 也不例外。</p><p>Vuex 是一个专为 Vuejs 应用程序开发的状态管理库,采用集中式存储管理应<br>用的所有组件的状态。</p><p>简单的说,Vuex 用于管理分散在 Vue 各个组件中的数据。</p><p>安装: <code>npm install vuex@next</code></p></blockquote><h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><blockquote><p>每一个 Vuex 应用的核心都是一个 store,与普通的全局对象不同的是,基于 Vue 数据与视图绑定的特点,当 store 中的状态发生变化时,与之绑定的视图也会被重新渲染。</p></blockquote><blockquote><p>store 中的状态不允许被直接修改,改变 store 中的状态的唯一途径就是显式地提交 (commit）mutation,这可以让我们方便地跟踪每一个状态的变化。</p><p>在大型复杂应用中,如果无法有效地跟踪到状态的变化,将会对理解和维护代&gt; 码带来极大的困扰。</p><p>Vuex 中有 5 个重要的概念:<strong>State、Getter、Mutation、Action、Module</strong>。</p></blockquote><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307272110993.png" alt="image.png|400"></p><h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><blockquote><p>State 用于维护所有应用层的状态,并确保应用只有唯一的数据源</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;createStore&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-comment">//创建一个新的 store 实例</span><br><span class="hljs-keyword">const</span> store = createstore (&#123;<br>  state () &#123;<br>   <span class="hljs-keyword">return</span>  &#123;<br>    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span><br>   &#125;<br> &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;<br>   increment (state) &#123;<br>    state.<span class="hljs-property">count</span>++<br>   &#125;<br> &#125;<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store<br></code></pre></td></tr></table></figure><blockquote><p>在组件中,可以直接使用 <code>this.$store.state.count</code> 访问数据,也可以先用 <strong>mapState</strong> 辅助函数将其映射下来</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//在单独构建的版本中辅助函数为 Vuex.mapstate</span><br><span class="hljs-keyword">import</span> &#123; mapState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br> <span class="hljs-comment">// ...</span><br> <span class="hljs-attr">computed</span>: mapState (&#123;<br>  <span class="hljs-comment">//箭头函数可使代码更简练</span><br>   <span class="hljs-attr">count</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">count</span>,<br>  <span class="hljs-comment">//传字符串参数‘count&#x27;等同于‘state =&gt; state. count&#x27;</span><br>  <span class="hljs-attr">countAlias</span>: <span class="hljs-string">&#x27;count&#x27;</span>,<br>   <span class="hljs-comment">//为了能够使用‘this＇获取局部状态,必须使用常规函数</span><br>   countplusLocalState (state) &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">count</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">localcount</span><br>    &#125;<br>&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h3><blockquote><p>Mutation 提供修改 State 状态的方法。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-comment">//创建一个新的 store 实例</span><br> <span class="hljs-keyword">const</span> store = createstore (&#123;<br>  state <span class="hljs-keyword">return</span> &#123; <br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;<br>    increment (state) &#123;<br>      state.<span class="hljs-property">count</span>++<br>&#125;<br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>在组件中,可以直接使用 store.commit 来提交 mutation</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;<br>  increment () &#123;<br>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;increment&#x27;</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>也可以先用 mapMutation 辅助函数将其映射下来</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-attr">methods</span>: &#123;<br>   ...mapMutations ([<br>    <span class="hljs-string">&#x27;increment&#x27;</span>, <span class="hljs-comment">//将‘this.increment ()&#x27;映射为‘this.$store.commit (&#x27;increment&#x27;）</span><br>    <span class="hljs-comment">//‘mapMutations＇也支持载荷:</span><br>    <span class="hljs-string">&#x27;incrementBy&#x27;</span><span class="hljs-comment">//将‘this.incrementBy(amount)’映射为‘this.$store.commit(&#x27;increment&#x27;, amount)</span><br>]),<br></code></pre></td></tr></table></figure><h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><blockquote><p>Action 类似 Mutation,不同在于:</p></blockquote><blockquote><p>Action 不能直接修改状态,只能通过提交 mutation 来修改,<strong>Action 可以包含异步操作</strong></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> store = createstore (&#123;<br> <span class="hljs-attr">state</span>: &#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span><br>&#125;,<br> <span class="hljs-attr">mutations</span>: &#123;<br>  increment (state) &#123;<br>    state. count++<br>  &#125;<br>&#125;,<br> <span class="hljs-attr">actions</span>: &#123;<br>  increment (context) <br>    context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;increment&#x27;</span>)<br>&#125;<br>&#125;<br> &#125;)<br></code></pre></td></tr></table></figure><blockquote><p>在组件中,可以直接使用 <code>this.$store.dispatch (xxx&#39;)</code> 分发 action,或者使用 <code>mapActions</code> 辅助函数先将其映射下来</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ...</span><br>methods : &#123;<br>  ...<span class="hljs-title function_">mapActions</span>([<br>   <span class="hljs-string">&#x27;increment&#x27;</span>,<span class="hljs-comment">//将‘this.increment ()映射为‘this.$store.dispatch (&#x27;increment&#x27;)</span><br>   <span class="hljs-comment">//mapActions＇也支持载荷:</span><br>   <span class="hljs-string">&#x27;incrementBy&#x27;</span><span class="hljs-comment">//将‘this.incrementBy (amount)’映射为&#x27;this.$store.dispatch (&#x27;incrementBy&#x27;,amount)&#x27;</span><br> ]),<br></code></pre></td></tr></table></figure><h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><blockquote><p>Getter 维护由 State 派生的一些状态,这些状态随着 State 状态的变化而变化</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> store = createstore (&#123;<br>  <span class="hljs-attr">state</span>: &#123;<br>    <span class="hljs-attr">todos</span>:[<br>     &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;...&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> &#125;,<br>     &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;...&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> &#125;<br>   ]<br>  &#125;,<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-attr">doneTodos</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> &#123;<br>     <span class="hljs-keyword">return</span> state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">done</span>)<br>     &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>在组件中,可以直接使用 <code>this.$store.getters.doneTodos</code>,也可以先用 <code>mapGetters</code> 辅助函数将其映射下来,代码如下:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; mapGetters &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br> <span class="hljs-comment">// ...</span><br> <span class="hljs-attr">computed</span>: &#123;<br>  <span class="hljs-comment">//使用对象展开运算符将 getter 混入 computed 对象中</span><br>    ...mapGetters ([<br>     <span class="hljs-string">&#x27;doneTodosCount&#x27;</span><br>     <span class="hljs-string">&quot;anotherGetter&#x27;,</span><br><span class="hljs-string">    // ...</span><br><span class="hljs-string">  ])</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="通过属性访问"><a href="#通过属性访问" class="headerlink" title="通过属性访问"></a>通过属性访问</h4><blockquote><p>Getter 会暴露为 <code>store.getters</code> 对象,你可以以属性的形式访问这些值:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">store.<span class="hljs-property">getters</span>.<span class="hljs-property">doneTodos</span> <span class="hljs-comment">// -&gt; [&#123; id: 1, text: &#x27;...&#x27;, done: true &#125;]</span><br></code></pre></td></tr></table></figure><blockquote><p>Getter 也可以接受其他 getter 作为第二个参数:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">getters</span>: &#123;<br>  <span class="hljs-comment">// ...</span><br>  doneTodosCount (state, getters) &#123;<br>    <span class="hljs-keyword">return</span> getters.<span class="hljs-property">doneTodos</span>.<span class="hljs-property">length</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">store.<span class="hljs-property">getters</span>.<span class="hljs-property">doneTodosCount</span> <span class="hljs-comment">// -&gt; 1</span><br></code></pre></td></tr></table></figure><blockquote><p>我们可以很容易地在任何组件中使用它:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: &#123;<br>  doneTodosCount () &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>.<span class="hljs-property">doneTodosCount</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>注意,getter 在通过属性访问时是作为 Vue 的响应式系统的一部分缓存其中的。</p></blockquote><h4 id="通过方法访问"><a href="#通过方法访问" class="headerlink" title="通过方法访问"></a>通过方法访问</h4><blockquote><p>你也可以通过让 getter 返回一个函数,来实现给 getter 传参。在你对 store 里的数组进行查询时非常有用。</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">getters</span>: &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">getTodoById</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === id)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">store.<span class="hljs-property">getters</span>.<span class="hljs-title function_">getTodoById</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// -&gt; &#123; id: 2, text: &#x27;...&#x27;, done: false &#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>注意,getter 在通过方法访问时,每次都会去进行调用,而不会缓存结果。</p></blockquote><h4 id="mapGetters-辅助函数"><a href="#mapGetters-辅助函数" class="headerlink" title="mapGetters 辅助函数"></a><code>mapGetters</code> 辅助函数</h4><p><code>mapGetters</code> 辅助函数仅仅是将 store 中的 getter 映射到局部计算属性:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; mapGetters &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">computed</span>: &#123;<br>  <span class="hljs-comment">// 使用对象展开运算符将 getter 混入 computed 对象中</span><br>    ...<span class="hljs-title function_">mapGetters</span>([<br>      <span class="hljs-string">&#x27;doneTodosCount&#x27;</span>,<br>      <span class="hljs-string">&#x27;anotherGetter&#x27;</span>,<br>      <span class="hljs-comment">// ...</span><br>    ])<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>如果你想将一个 getter 属性另取一个名字,使用对象形式:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">...<span class="hljs-title function_">mapGetters</span>(&#123;<br>  <span class="hljs-comment">// 把 `this.doneCount` 映射为 `this.$store.getters.doneTodosCount`</span><br>  <span class="hljs-attr">doneCount</span>: <span class="hljs-string">&#x27;doneTodosCount&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></figure><hr><h2 id="2-Vuex-安装与使用"><a href="#2-Vuex-安装与使用" class="headerlink" title="2 Vuex 安装与使用"></a>2 Vuex 安装与使用</h2><blockquote><p>当一个组件需要获取多个状态的时候,将这些状态都声明为计算属性会有些重复和冗余。为了解决这个问题,我们可以使用 <code>mapState</code> 辅助函数帮助我们生成计算属性,让你少按几次键:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 在单独构建的版本中辅助函数为 Vuex.mapState</span><br><span class="hljs-keyword">import</span> &#123; mapState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">computed</span>: <span class="hljs-title function_">mapState</span>(&#123;<br>    <span class="hljs-comment">// 箭头函数可使代码更简练</span><br>    <span class="hljs-attr">count</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">count</span>,<br>    <span class="hljs-comment">// 传字符串参数 &#x27;count&#x27; 等同于 `state =&gt; state.count`</span><br>    <span class="hljs-attr">countAlias</span>: <span class="hljs-string">&#x27;count&#x27;</span>,<br>    <span class="hljs-comment">// 为了能够使用 `this` 获取局部状态,必须使用常规函数</span><br>    countPlusLocalState (state) &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">count</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">localCount</span><br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>当映射的计算属性的名称与 state 的子节点名称相同时,我们也可以给 <code>mapState</code> 传一个字符串数组。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: <span class="hljs-title function_">mapState</span>([<br>  <span class="hljs-comment">// 映射 this.count 为 store.state.count</span><br>  <span class="hljs-string">&#x27;count&#x27;</span><br>])<br></code></pre></td></tr></table></figure><hr><p><strong>eg:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我的音乐<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;murl&quot;</span>&gt;</span>音乐&#123;&#123; mid &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">&quot;nmurl&quot;</span>&gt;</span>音乐&#123;&#123; mid + 1 &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;nextMusic&quot;</span>&gt;</span>下一首<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  <br>&lt;/template&gt;  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123;mapState&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">name</span>: <span class="hljs-string">&quot;MyMusic&quot;</span>,  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// computed: &#123;  </span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// getMid() &#123;  </span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// return this.$store.state.mid  </span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// &#125;  </span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// &#125;,  </span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">computed</span>: <span class="hljs-title function_">mapState</span>([  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-string">&#x27;mid&#x27;</span>,  </span></span><br><span class="language-javascript"><span class="language-xml">]),  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">return</span> &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">murl</span>: <span class="hljs-string">&quot;/mymusic/0&quot;</span>,  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">nmurl</span>: <span class="hljs-string">&quot;/mymusic/1&quot;</span>,  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;,  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">methods</span>: &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">nextMusic</span>(<span class="hljs-params"></span>) &#123;  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;increment&#x27;</span>)  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">this</span>.<span class="hljs-property">murl</span> = <span class="hljs-string">&quot;/mymusic/&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">mid</span>  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">this</span>.<span class="hljs-property">nmurl</span> = <span class="hljs-string">&quot;/mymusic/&quot;</span> + (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mid</span> + <span class="hljs-number">1</span>)  </span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">state</span>.<span class="hljs-property">mid</span>)  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml">&#125;  </span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>  <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><strong>getter—eg:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;createStore&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span>  <br><span class="hljs-comment">// 创建一个新的 store 实例  </span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(&#123;  <br><span class="hljs-attr">state</span>: &#123;  <br><span class="hljs-attr">mid</span>: <span class="hljs-number">0</span>,  <br><span class="hljs-attr">todos</span>: [  <br>&#123;<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;学习&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;,  <br>&#123;<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;吃饭&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;,  <br>&#123;<span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;睡觉&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;  <br>]  <br>&#125;,  <br><span class="hljs-attr">getters</span>: &#123;  <br><span class="hljs-title function_">doneTodos</span>(<span class="hljs-params">state</span>) &#123;  <br><span class="hljs-keyword">return</span> state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">done</span>)  <br>&#125;,  <br><span class="hljs-title function_">doneTodosCount</span>(<span class="hljs-params">state, getters</span>) &#123;  <br><span class="hljs-keyword">return</span> getters.<span class="hljs-property">doneTodos</span>.<span class="hljs-property">length</span>  <br>&#125;,  <br><span class="hljs-attr">getTodoById</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123;  <br><span class="hljs-keyword">return</span> state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === id)  <br>&#125;  <br>&#125;,  <br><span class="hljs-attr">mutations</span>: &#123;  <br><span class="hljs-title function_">increment</span>(<span class="hljs-params">state</span>) &#123;  <br>state.<span class="hljs-property">mid</span>++  <br>&#125;  <br>&#125;  <br>&#125;)  <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store<br></code></pre></td></tr></table></figure><h1 id="13-MockJS"><a href="#13-MockJS" class="headerlink" title="13 MockJS"></a>13 MockJS</h1><h2 id="MockJs-介绍"><a href="#MockJs-介绍" class="headerlink" title="MockJs 介绍"></a>MockJs 介绍</h2><blockquote><p>Mock.js 是一款前端开发中<strong>拦截 Ajax 请求再生成随机数据响应</strong>的工具,可以用来模拟服务器响应</p><p>优点是非常简单方便,无侵入性,基本覆盖常用的接口数据类型.</p><p>支持生成随机的==文本、数字、布尔值、日期、邮箱、链接、图片、颜色==等。<br>安装: <code>npm install mockjs</code></p></blockquote><h2 id="MockJs-使用"><a href="#MockJs-使用" class="headerlink" title="MockJs 使用"></a>MockJs 使用</h2><blockquote><p>在项目中创建 mock 目录,新建 index.js 文件</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//引入 mockjs</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Mock</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mockjs&#x27;</span><br><span class="hljs-comment">//使用 mockjs 模拟数据</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> (<span class="hljs-string">&#x27;/product/search&#x27;</span>, &#123;<br>    <span class="hljs-string">&quot;ret&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;data&quot;</span>:<br>&#123;<br>       <span class="hljs-string">&quot;mtime&quot;</span>: <span class="hljs-string">&quot;@datetime&quot;</span>,<span class="hljs-comment">//随机生成日期时间</span><br>       <span class="hljs-string">&quot;score|1-800&quot;</span>: <span class="hljs-number">800</span>,<span class="hljs-comment">//随机生成1-800的数字</span><br>       <span class="hljs-string">&quot;rank|1-100&quot;</span>:  <span class="hljs-number">100</span>,<span class="hljs-comment">//随机生成1-100的数字</span><br>       <span class="hljs-string">&quot;stars|1-5&quot;</span>: <span class="hljs-number">5</span>,<span class="hljs-comment">//随机生成1-5的数字</span><br>       <span class="hljs-string">&quot;nickname&quot;</span>: <span class="hljs-string">&quot;@cname&quot;</span>,<span class="hljs-comment">//随机生成中文名字</span><br>       <span class="hljs-comment">//生成图片</span><br><span class="hljs-string">&quot;img&quot;</span>:<span class="hljs-string">&quot;@image(&#x27;200x100&#x27;,&#x27;#ffcc33&#x27;, &#x27;#FFF&#x27;,&#x27;png&#x27;,&#x27;Fast Mock&#x27;)&quot;</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>在 main. js 中导入 mock 下的 index.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;createApp&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span>  <br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span>  <br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./mock&#x27;</span>  <br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./assets/main.css&#x27;</span>  <br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)  <br>app.<span class="hljs-title function_">use</span>(router)  <br>app.<span class="hljs-title function_">use</span>(store)  <br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>组件中调用 <strong>mock. js</strong> 中模拟的数据接口,这时返回的 response 就是 mock.js 中用==Mock.mock (‘url’, data)中设置的 data==</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">mounted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;<br>axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/prduct/search&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>   &#125;)<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="核心方法"><a href="#核心方法" class="headerlink" title="核心方法"></a>核心方法</h2><p><code>Mock.mock(rurl?, rtype?, template|function ( options ) )</code></p><blockquote><p> rurl,表示需要拦截的 URL,可以是 <strong>URL 字符串或 URL 正则</strong><br> rtype,表示需要拦截的 <strong>Ajax 请求类型</strong>。例如 GET、POST、PUT、DELETE 等。<br> template,表示数据模板,可以是<strong>对象或字符串</strong><br> function,表示用于<strong>生成响应数据的函数</strong>。</p></blockquote><blockquote><p>设置延时请求到数据</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-comment">//延时 400 ms 请求到数据</span><br> <span class="hljs-title class_">Mock</span>.<span class="hljs-property">setup</span> (&#123;<br>   <span class="hljs-attr">timeout</span>: <span class="hljs-number">400</span><br>&#125;)<br> <span class="hljs-comment">//延时 200-600 毫秒请求到数据</span><br> <span class="hljs-title class_">Mock</span>.<span class="hljs-property">setup</span> (&#123;<br>   <span class="hljs-attr">timeout</span>: <span class="hljs-string">&#x27;200-600&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="数据生成规则"><a href="#数据生成规则" class="headerlink" title="数据生成规则"></a>数据生成规则</h2><blockquote><ul><li>mock 的语法规范包含两层规范:数据模板 （DTD）、数据占位符 (DPD)</li><li>数据模板中的每个属性由 3 部分构成:**属性名 name、生成规则 rule、属性值<br>  value: ‘name|rule’: value</li></ul></blockquote><blockquote><p>属性名和生成规则之间用竖线<code>|</code>分隔,生成规则是可选的,有 7 种格式:</p></blockquote><p><font color="#ff0000">‘name|min-max’: value</font><br><font color="#ff0000">‘namelcount’: value</font><br><font color="#ff0000">‘name|min-max.dmin-dmax’: value</font><br><font color="#ff0000">‘name|min-max.dcount’: value</font><br><font color="#ff0000">‘name|count.dmin-dmax’: value</font><br><font color="#ff0000">‘name|count.dcount’: value</font><br><font color="#ff0000">‘name|+step’: value</font></p><h2 id="生成规则与示例"><a href="#生成规则与示例" class="headerlink" title="生成规则与示例"></a>生成规则与示例</h2><ol><li>属性值是字符串 String</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//通过重复 string 生成一个字符串,重复次数大于等于 min,小于等于 max。</span><br><span class="hljs-string">&#x27;name|min-max&#x27;</span>: string<br><span class="hljs-comment">//通过重复 string 生成一个字符串,重复次数等于 count。</span><br><span class="hljs-string">&#x27;name|count&#x27;</span>: string<br><span class="hljs-keyword">var</span> data = <span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> (&#123;<br>   <span class="hljs-string">&#x27;name 1|1-3&#x27;</span>: <span class="hljs-string">&#x27;a&#x27;</span>,  <span class="hljs-comment">//重复生成 1 到 3 个 a（随机）</span><br>   <span class="hljs-string">&#x27;name 2|2&#x27;</span>: <span class="hljs-string">&#x27;b&#x27;</span>   / /生成 bb<br>&#125;)<br></code></pre></td></tr></table></figure><ol start="2"><li>属性值是数字 Number</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js">/ /属性值自动加 <span class="hljs-number">1</span>,初始值为 number。<br><span class="hljs-string">&#x27;name|+1&#x27;</span>: number<br><span class="hljs-comment">//生成一个大于等于 min、小于等于 max 的整数,属性值 number 只是用来确定类型。</span><br><span class="hljs-string">&#x27;name|min-max&#x27;</span>: number<br><span class="hljs-comment">//生成一个浮点数,整数部分大于等于 min、小于等于 max,小数部分保留 dmin 到 dmax 位。</span><br><span class="hljs-string">&#x27;name|min-max.dmin-dmax&#x27;</span>: number<br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(&#123;<br>     <span class="hljs-string">&#x27;number1|1-100.1-10&#x27;</span>: <span class="hljs-number">1</span>,<br>     <span class="hljs-string">&#x27;number2|123.1-10&#x27;</span>: <span class="hljs-number">1</span>,<br>     <span class="hljs-string">&#x27;number3|123.3&#x27;</span>: <span class="hljs-number">1</span>,<br>     <span class="hljs-string">&#x27;number4|123.10&#x27;</span>: <span class="hljs-number">1</span> <span class="hljs-number">123</span><br>&#125;)<br><span class="hljs-comment">//结果:</span><br>&#123;<br>    <span class="hljs-string">&quot;number1&quot;</span>: <span class="hljs-number">12.92</span>,<br>    <span class="hljs-string">&quot;number2&quot;</span>: <span class="hljs-number">123.51</span>,<br>    <span class="hljs-string">&quot;number3&quot;</span>: <span class="hljs-number">123.777</span>,<br>    <span class="hljs-string">&quot;number4&quot;</span>:<span class="hljs-number">123.1231091814</span><br>&#125;<br><span class="hljs-keyword">var</span> data = <span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(&#123;<br>    <span class="hljs-string">&#x27;name1|+1&#x27;</span>:<span class="hljs-number">4</span>,   <span class="hljs-comment">//生成4,如果循环每次加1</span><br>    <span class="hljs-string">&#x27;name2|1-7&#x27;</span>:<span class="hljs-number">2</span>,   <span class="hljs-comment">//生成一个数字,1到7之间</span><br>    <span class="hljs-string">&#x27;name3|1-4.5-8&#x27;</span>:<span class="hljs-number">1</span> <span class="hljs-comment">////生成一个小数,整数部分1到4,小数部分5到8位,数字1只是为了确定类型</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="3"><li>属性值是布尔型 Boolean</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//随机生成一个布尔值,值为 true 的概率是 1/2,值为 false 的概率同样是1/2。</span><br><span class="hljs-string">&#x27;namel1&#x27;</span>: bolean<br><span class="hljs-comment">//随机生成一个布尔值,值为 value 的概率是 min/（min+max),值为!value 的概率是 max／（min+max）。</span><br><span class="hljs-string">&#x27;name|min-max&#x27;</span>: value<br><span class="hljs-keyword">var</span> data = <span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(&#123;<br>    <span class="hljs-string">&#x27;name|1&#x27;</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">//生成一个布尔值,各一半</span><br>    <span class="hljs-string">&#x27;name1|1-3&#x27;</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">//1/4 是 true,3/4 是 false</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="4"><li>属性值是对象 Object</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//从属性值 object 中随机选取 count 个属性。</span><br><span class="hljs-string">&#x27;name|count&#x27;</span>: object<br><span class="hljs-comment">//从属性值 object 中随机选取 min 到 max 个属性。</span><br><span class="hljs-string">&#x27;name|min-max&#x27;</span>: object<br><span class="hljs-keyword">var</span> obj = &#123;<br>   <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>   <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>,<br>   <span class="hljs-attr">c</span>: <span class="hljs-number">3</span>,<br>   <span class="hljs-attr">d</span>: <span class="hljs-number">4</span><br>&#125;<br><span class="hljs-keyword">var</span> data = <span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> (&#123;<br>    <span class="hljs-string">&#x27;name|1-3&#x27;</span>: obj,  <span class="hljs-comment">//随机从 obj 中寻找 1 到 3 个属性,新对象</span><br>    <span class="hljs-string">&#x27;name|2&#x27;</span>: obj   <span class="hljs-comment">//随机从 onj 中找到两个属性,新对象</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="5"><li>属性值是数组 Array</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//从属性值 array 中随机选取 1 个元素,作为最终值。</span><br><span class="hljs-string">&#x27;name|1&#x27;</span>: array<br><span class="hljs-comment">//从属性值 array 中顺序选取 1 个元素,作为最终值。</span><br><span class="hljs-string">&#x27;name|+1&#x27;</span>: array<br><span class="hljs-comment">//通过重复属性值 array 生成一个新数组,重复次数大于等于 min,小于等于 max。</span><br><span class="hljs-string">&#x27;name|min-max&#x27;</span>: array<br><span class="hljs-comment">//通过重复属性值 array 生成一个新数组,重复次数为 count。</span><br><span class="hljs-string">&#x27;name|count&#x27;</span>: array<br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(&#123;<br>   <span class="hljs-comment">//通过重复属性值 array 生成一个新数组,重复次数为 1-3次。</span><br>   <span class="hljs-string">&quot;favorite_games|1-3&quot;</span>: [<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">23</span>,<span class="hljs-number">28</span>,<span class="hljs-number">42</span>,<span class="hljs-number">45</span>],<br>&#125;); <br><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br><span class="hljs-keyword">var</span> data = <span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> (&#123;<br>   <span class="hljs-string">&#x27;namel|1&#x27;</span>: arr,   <span class="hljs-comment">//从数组里随机取出 1 个值</span><br>   <span class="hljs-string">&#x27;name2|2&#x27;</span>: arr,   <span class="hljs-comment">//数组重复 count 次,这里 count 为2</span><br>   <span class="hljs-string">&#x27;name3|1-3&#x27;</span>: arr,  <span class="hljs-comment">//数组重复 1 到 3 次</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="6"><li>属性值是函数 Function</li></ol><p>执行函数 function,取其返回值作为最终的属性值,函数的上下文为属性’name’所在的对象。<br>‘name’: function</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fun = <span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>)<br>   <span class="hljs-keyword">return</span> x+<span class="hljs-number">10</span>;<br><span class="hljs-number">1</span><br><span class="hljs-keyword">var</span> data = <span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> (&#123;<br>   <span class="hljs-string">&#x27;name&#x27;</span>: fun (<span class="hljs-number">10</span>)   <span class="hljs-comment">//返回函数的返回值 20</span><br>&#125;)<br></code></pre></td></tr></table></figure><ol start="7"><li>属性值是正则表达式 RegExp</li></ol><p>根据正则表达式 regexp 反向生成可以匹配它的字符串。用于生成自定义格式的字符串。<br>‘name’: regexp</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Mock</span>.<span class="hljs-property">mock</span> (&#123;<br>    <span class="hljs-string">&#x27;regexp 1&#x27;</span>: <span class="hljs-regexp">/[a-z][A-z][0-9]/</span>,<br>    <span class="hljs-string">&#x27;regexp 2&#x27;</span>: <span class="hljs-regexp">/\w\w\s|s\d\D/</span>,<br>    <span class="hljs-string">&#x27;regexp 3&#x27;</span>: <span class="hljs-regexp">/d[5,103/</span><br><span class="hljs-regexp">&#125;)</span><br><span class="hljs-regexp">// =&gt;</span><br><span class="hljs-regexp">&#123;</span><br><span class="hljs-regexp">    &quot;regexp1&quot;: &quot;pJ7&quot;,</span><br><span class="hljs-regexp">    &quot;regexp2&quot;: &quot;F)\fp1G&quot;,</span><br><span class="hljs-regexp">    &quot;regexp3&quot;: &quot;561659409&quot;</span><br><span class="hljs-regexp">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="数据占位符-DPD"><a href="#数据占位符-DPD" class="headerlink" title="数据占位符 DPD"></a>数据占位符 DPD</h2><p>占位符只是在属性值字符串中占个位置,并不出现在最终的属性值中。<br>占位符的格式为:</p><blockquote><p><strong>@占位符<br>@占位符 (参数［,参数])</strong></p></blockquote><p>关于占位符需要知道以下几点</p><ul><li>用<code>@</code>标识符标识后面的字符串是占位符</li><li>占位符引用的是 <code>Mock.Random</code> 中的方法。</li><li>可以通过 <code>Mock.Random.extend (）</code>来扩展自定义占位符。</li><li>占位符也<strong>可以引用数据模板中的属性</strong>。</li><li>占位符会<strong>优先引用数据模板中的属性</strong>。</li><li>占位符支持<strong>相对路径和绝对路径</strong>。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//引入mockjs</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Mock</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mockjs&#x27;</span><br><span class="hljs-comment">//使用mockjs模拟数据</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-string">&#x27;/api/msdk/proxy/query_common_credit&#x27;</span>, &#123;<br>   <span class="hljs-string">&quot;ret&quot;</span>:<span class="hljs-number">0</span>,<br>   <span class="hljs-string">&quot;data&quot;</span>:<br>   &#123;<br>       <span class="hljs-string">&quot;mtime&quot;</span>:<span class="hljs-string">&quot;@datetime&quot;</span>,<span class="hljs-comment">//随机生成日期时间</span><br>       <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-string">&quot;@natural(1,800)&quot;</span>,<span class="hljs-comment">//随机生成1-800的数字</span><br>       <span class="hljs-string">&quot;rank&quot;</span>:<span class="hljs-string">&quot;@natural(1,100)&quot;</span>,<span class="hljs-comment">//随机生成1-100的数字</span><br>       <span class="hljs-string">&quot;stars&quot;</span>:<span class="hljs-string">&quot;@natural(0,5)&quot;</span>,<span class="hljs-comment">//随机生成1-5的数字</span><br>       <span class="hljs-string">&quot;nickname&quot;</span>:<span class="hljs-string">&quot;@cname&quot;</span>,<span class="hljs-comment">//随机生成中文名字</span><br>&#125;) ;<br></code></pre></td></tr></table></figure><h3 id="基础随机内容的生成"><a href="#基础随机内容的生成" class="headerlink" title="基础随机内容的生成"></a>基础随机内容的生成</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;string|1-10&quot;</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-comment">//随机生成 1 到 10 个等号</span><br>  <span class="hljs-string">&quot;string2|3&quot;</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-comment">//随机生成 2 个或者三个等号</span><br>  <span class="hljs-string">&quot;number|+1&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-comment">//从 o 开始自增</span><br>  <span class="hljs-string">&quot;number 2|1-10.1-3&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-comment">//生成一个小数,小数点前面 1 到 10,小数点后 1 到 3 位</span><br>  <span class="hljs-string">&quot;boolean&quot;</span>:<span class="hljs-string">&quot;@boolean（1,2,true）&quot;</span>,<span class="hljs-comment">//生成 boolean 值三个参数,1 表示第三个参数 true 出现的概率,2 表示 false 出现的概率</span><br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;@cname&quot;</span>,<span class="hljs-comment">//随机生成中文姓名</span><br>  <span class="hljs-string">&quot;firstname&quot;</span>:<span class="hljs-string">&quot;@cfirst&quot;</span>,<span class="hljs-comment">//随机生成中文姓</span><br>  <span class="hljs-string">&quot;int&quot;</span>:<span class="hljs-string">&quot;@integer(1,10)&quot;</span>,<span class="hljs-comment">//随机生成 1-10 的整数</span><br>  <span class="hljs-string">&quot;float&quot;</span>:<span class="hljs-string">&quot;@float (1,2,3,4)&quot;</span>,<span class="hljs-comment">//随机生成浮点数,四个参数分别为,整数部分的最大最小值和小数部分的最大最小值</span><br>  <span class="hljs-string">&quot;range&quot;</span>:<span class="hljs-string">&quot;@range(1,100,10)&quot;</span>,<span class="hljs-comment">//随机生成整数数组,三个参数为,最大最小值和加的步长</span><br>  <span class="hljs-string">&quot;natural&quot;</span>:<span class="hljs-string">&quot;@natural(60,100)&quot;</span>,<span class="hljs-comment">//随机生成自然数（大于零的数）</span><br>  <span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;@email&quot;</span>,<span class="hljs-comment">//邮箱</span><br>  <span class="hljs-string">&quot;ip&quot;</span>: <span class="hljs-string">&quot;@ip&quot;</span>,<span class="hljs-comment">// ip</span><br>  <span class="hljs-string">&quot;datatime&quot;</span>:<span class="hljs-string">&quot;@date（&#x27;yy-MM-ddhh:mm: ss&#x27;)&quot;</span><span class="hljs-comment">//随机生成指定格式的时间</span><br>  <span class="hljs-comment">//</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="列表数据"><a href="#列表数据" class="headerlink" title="列表数据"></a>列表数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;code&quot;</span>;<span class="hljs-string">&quot;0000&quot;</span>,<br>  <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;pageNo&quot;</span>: <span class="hljs-string">&quot;@integer (1, 100)&quot;</span>,<br>    <span class="hljs-string">&quot;totalRecord&quot;</span>: <span class="hljs-string">&quot;@integer (100, 1000)&quot;</span>,<br>    <span class="hljs-string">&quot;pagesize&quot;</span>: <span class="hljs-number">10</span>,<br>    <span class="hljs-string">&quot;list|10&quot;</span>: [&#123;<br>      <span class="hljs-string">&quot;id|+1&quot;</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;@cword(10)&quot;</span>,<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;@cword(20)&quot;</span>,<br>      <span class="hljs-string">&quot;descript&quot;</span>: <span class="hljs-string">&quot;@csentence(20,50)&quot;</span>,<br>      <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-string">&quot;@float(10,100,10,100)&quot;</span>,<br>   &#125;]<br> &#125;,<br>  <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;成功&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p>mockjs 可以生成任意大小，任意颜色块，且用文字填充内容的图片，使我们不用到处找图片资源就能轻松实现图片的模拟展示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-string">&quot;0000&quot;</span>,<br>  <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;pageNo&quot;</span>: <span class="hljs-string">&quot;@integer(1, 100)&quot;</span>,<br>    <span class="hljs-string">&quot;totalRecord&quot;</span>: <span class="hljs-string">&quot;@integer(100, 1000)&quot;</span>,<br>    <span class="hljs-string">&quot;pagesize&quot;</span>: <span class="hljs-number">10</span>,<br>    <span class="hljs-string">&quot;list|10&quot;</span>: [&#123;<br>     <span class="hljs-comment">//参数从左到右依次为，图片尺寸，背景色，前景色（及文字颜色），图片格式，图片中间的填充文字内容</span><br>     <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-string">&quot;@image (&#x27;200 x 100&#x27;，&#x27;#ffcc33 &#x27;，&#x27;#FFF&#x27;，&#x27;png&#x27;，&#x27;Fast Mock&#x27;)&quot;</span><br>   &#125;]<br>  &#125;,<br>  <span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;成功&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Mock-Random"><a href="#Mock-Random" class="headerlink" title="Mock. Random"></a>Mock. Random</h3><blockquote><p>Mock. Random 是一个工具类，用于生成各种随机数据。</p><p>Mock. Random 的方法在数据模板中称为『占位符』，书写格式为@占位符 (参数[, 参数)。<br>用法示例:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Random</span> = <span class="hljs-title class_">Mock</span>.<span class="hljs-property">Random</span><br><span class="hljs-title class_">Random</span>.<span class="hljs-title function_">email</span>()<br><span class="hljs-comment">// =&gt; &quot; n.clark@mi1ler.io &quot;</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-string">&#x27;@email&#x27;</span>)<br><span class="hljs-comment">// =&gt; &quot; y.lee@lewis.org &quot;</span><br><span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>(&#123;<span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;@email&#x27;</span>&#125;)<br><span class="hljs-comment">// =&gt; &#123; email: &quot;v.lewis@hall.gov&quot; &#125;</span><br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><p>[!NOTE] tips<br>如果前端请求的后端接口需要携带参数，那么前端 mock 的 index. js 里的拦截请求的写法应该如下所示（用正则表达式进行匹配接口）：<br><code>Mock.mock(RegExp(&#39;/product/search.*&#39;),&#123;...&#125;)</code></p></blockquote><h1 id="14-企业级集成方案"><a href="#14-企业级集成方案" class="headerlink" title="14 企业级集成方案"></a>14 企业级集成方案</h1><h2 id="vue-element-admin-介绍"><a href="#vue-element-admin-介绍" class="headerlink" title="vue-element-admin 介绍"></a>vue-element-admin 介绍</h2><blockquote><ul><li>vue-element-admin 是一个后台前端解决方案，它基于 vue 和 element-ui 实现。</li><li>内置了 i 18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件。</li><li>可以快速搭建企业级中后台产品原型。</li><li>地址: <a href="https://panjiachen.github.io/vue-element-admin-site/zh/guide/">https://panjiachen.github.io/vue-element-admin-site/zh/guide/</a></li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">克隆项目</span><br>git clone https://github.com/PanJiaChen/vue-admin-template.git<br><span class="hljs-meta prompt_"># </span><span class="language-bash">进入项目目录</span><br>cd vue-admin-template<br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装依赖</span><br>npm install<br><span class="hljs-meta prompt_"># </span><span class="language-bash">建议不要直接使用 cnpm 安装以来，会有各种诡异的 bug。可以通过如下操作解决 npm 下载速度慢的问题</span><br>npm install --registry=https://registry.npm.taobao.org<br><span class="hljs-meta prompt_"># </span><span class="language-bash">启动服务</span><br>npm run dev<br></code></pre></td></tr></table></figure><h1 id="15-JWT-跨域认证"><a href="#15-JWT-跨域认证" class="headerlink" title="15. JWT 跨域认证"></a>15. JWT 跨域认证</h1><h2 id="1-Session-认证"><a href="#1-Session-认证" class="headerlink" title="1. Session 认证"></a>1. Session 认证</h2><p>互联网服务离不开用户认证。一般流程是下面这样。</p><blockquote><ul><li>用户向服务器发送<strong>用户名和密码</strong>。</li><li>服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等。</li><li>服务器向用户返回一个 session_id，写入用户的 Cookie。</li><li>用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</li><li>服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</li></ul></blockquote><p>session 认证流程：<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307311353929.png" alt="|350"><br>session 认证的方式应用非常普遍，但也存在一些问题，扩展性不好，如果是服务<br>器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能<br>够读取 session，针对此种问题一般有两种方案:</p><blockquote><ol><li><p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。</p></li><li><p>一种方案是服务器不再保存 session 数据，所有数据都保存在客户端，每次请求都发回服务器。Token 认证就是这种方案的一个代表。</p></li></ol></blockquote><h2 id="2-Token-认证"><a href="#2-Token-认证" class="headerlink" title="2. Token 认证"></a>2. Token 认证</h2><p>Token 是在服务端产生的一串字符串, 是客户端访问资源接口（API) 时所需要的资<br>源凭证，流程如下：</p><blockquote><ul><li>客户端使用用户名跟密码请求登录，服务端收到请求，去验证用户名与密码</li><li>验证成功后，服务端会签发一个 token 并把这个 token 发送给客户端</li><li>客户端收到 token 以后，会把它存储起来，比如放在 cookie 里或者 localStorage 里</li><li>客户端每次向服务端请求资源的时候需要带着服务端签发的 token</li><li>服务端收到请求，然后去验证客户端请求里面带着的 token，如果验证成功，就向客户端返回请求的数据</li></ul></blockquote><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307311410745.png" alt="image.png|350"></p><ul><li><p>基于 token 的用户认证是一种服务端无状态的认证方式，服务端不用存放<br>token 数据。</p></li><li><p>用解析 token 的计算时间换取 session 的存储空间，从而减轻服务器的压力<br>减少频繁的查询数据库</p></li><li><p>token 完全由应用管理，所以它可以避开同源策略</p></li></ul><hr><h2 id="3-JWT-的使用"><a href="#3-JWT-的使用" class="headerlink" title="3. JWT 的使用"></a>3. JWT 的使用</h2><blockquote><p>JSON Web Token（简称 JWT）是一个 token 的具体实现方式，是目前最流行<br>的跨域认证解决方案。<br>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，具体如下:</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;姓名&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;张三&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;角色&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;管理员&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;到期时间&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2018 年 7 月 1 日 0 点 0 分&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。<br>为了防止用户篡改数据，服务器在生成这个对象的时候，会加上<strong>签名</strong>。</p></blockquote><blockquote><p>JWT 的由三个部分组成，依次如下：<br>  <em><strong>Header (头部)<br>  Payload (负载)<br>  Signature  (签名)</strong></em><br>  三部分最终组合为完整的字符串，中间使用·分隔，如下：<br>  Header.Payload.Signature<br>           <code>eyJhbGci0iJIUzI1NiIsInR5cCI6IkpXVCJ9. eyJzdwIi0iIxMjMoNTY30DkwIiwibmFtzsI6IkpvaG4 gRG91IiwiaXNTb2NpYWwiOnRydwV9. 4pcPyMD09o1PSyXnrXCjTwXyr4BsezdI1AVTmud2fU4</code></p></blockquote><h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><blockquote><p>Header 部分是一个 JSON 对象，描述 JWT 的元数据</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;H256&quot;</span><span class="hljs-punctuation">,</span><br> <span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JWT&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>alg 属性表示签名的算法（<strong>algorithm</strong>），默认是 HMAC SHA 256 (写成</li></ul><p><strong>HS256</strong>)</p><ul><li>typ 属性表示这个令牌（token）的类型（type），JWT 令牌统一写为 JWT</li><li>最后，将上面的 JSON 对象使用 Base 64 URL 算法转成字符串。</li></ul><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><blockquote><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了 7 个官方字段，供选用。</p></blockquote><ul><li>iss (issuer)：签发人</li><li>exp (expiration time): 过期时间</li><li>sub (subject): 主题</li><li>aud (audience): 受众</li><li>nbf (Not Before): 生效时间</li><li>iat (Issued At)：签发时间</li><li>jti (WT ID): 编号</li></ul><blockquote><p>注意，JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在个部分。<br>   这个 JSON 对象也要使用 <strong>Base 64 URL</strong> 算法转成字符串。</p></blockquote><h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><blockquote><p> Signature 部分是对前两部分的签名，防止数据篡改。<br>    首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户; 然后，使用 Header 里面指定的签名算法 （默认是 HMAC SHA 256），按照下面的公式产生签名。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">HMACSHA <span class="hljs-number">256</span> (<br>base64UrlEncode (header) + <span class="hljs-string">&quot;.&quot;</span> +<br>base64UrlEncode (payload)<span class="hljs-punctuation">,</span><br>secret)<br></code></pre></td></tr></table></figure><p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用”点”（’.’）分隔，就可以返回给用户。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307311433682.png" alt="image.png|450"></p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</li><li>客户端每次与服务器通信，都要带上这个 JWT，可以把它放在 Cookie 里面自动发送，但是这样不能跨域。</li><li>更好的做法是放在 HTTP 请求的头信息’Authorization’字段里面，单独发送。</li></ul><h3 id="请求认证"><a href="#请求认证" class="headerlink" title="请求认证"></a>请求认证</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202309262023932.png" alt="image.png|525"></p><h3 id="JWT验证拦截器"><a href="#JWT验证拦截器" class="headerlink" title="JWT验证拦截器"></a>JWT验证拦截器</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202309272236587.png" alt="image.png|250"></p><p>定义拦截器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.config;  <br>  <br><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON;  <br><span class="hljs-keyword">import</span> com.alleyf.sys.utils.Result;  <br><span class="hljs-keyword">import</span> com.alleyf.common.JwtUtils;  <br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;  <br>  <br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;  <br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;  <br>  <br><span class="hljs-meta">@Component</span>  <br><span class="hljs-meta">@Slf4j</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtValidateInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> JwtUtils jwtUtils;  <br>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;X-Token&quot;</span>);  <br>        log.debug(request.getRequestURI() + <span class="hljs-string">&quot;待验证：&quot;</span> + token);  <br>        <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) &#123;  <br>            <span class="hljs-keyword">try</span> &#123;  <br>                jwtUtils.getClaimsByToken(token);  <br>                log.debug(request.getRequestURI() + <span class="hljs-string">&quot; 验证通过&quot;</span>);  <br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;  <br>                e.printStackTrace();  <br>            &#125;  <br>        &#125;  <br>        log.debug(request.getRequestURI() + <span class="hljs-string">&quot; 禁止访问&quot;</span>);  <br>        response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);  <br>        response.getWriter().write(JSON.toJSONString(Result.error().message(<span class="hljs-string">&quot;jwt令牌无效，请重新登录&quot;</span>)));  <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>配置使用拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.config;  <br>  <br><span class="hljs-keyword">import</span> com.alleyf.config.JwtValidateInterceptor;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistration;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;  <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;  <br>  <br><span class="hljs-meta">@Configuration</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyInterceptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> JwtValidateInterceptor jwtValidateInterceptor;  <br>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;  <br>        <span class="hljs-type">InterceptorRegistration</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> registry.addInterceptor(jwtValidateInterceptor);  <br>        registration.addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>).excludePathPatterns(  <br>                <span class="hljs-string">&quot;/user/login&quot;</span>,  <br>                <span class="hljs-string">&quot;/user/register&quot;</span>,  <br>                <span class="hljs-string">&quot;/user/logout&quot;</span>,  <br>                <span class="hljs-string">&quot;/user/info&quot;</span>,  <br>                <span class="hljs-string">&quot;/error&quot;</span>  <br>        );  <br>    &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="后端实现"><a href="#后端实现" class="headerlink" title="后端实现"></a>后端实现</h3><h4 id="加入依赖"><a href="#加入依赖" class="headerlink" title="加入依赖"></a>加入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="生成-Token"><a href="#生成-Token" class="headerlink" title="生成 Token"></a>生成 Token</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//7 天过期</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Long</span> <span class="hljs-variable">expire</span> <span class="hljs-operator">=</span> <span class="hljs-number">604800</span>;<br><span class="hljs-comment">//32 位秘钥</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">secret</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdfghiabcdfghiabcdfghiabcdfghi&quot;</span>;<br><br><span class="hljs-comment">//生成 token</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateToken</span><span class="hljs-params">(String username)</span>&#123;<br>   <span class="hljs-type">Date</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>   <span class="hljs-type">Date</span> <span class="hljs-variable">expiration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span> (now.getTime() + <span class="hljs-number">1000</span> * expire);<br>   <span class="hljs-keyword">return</span> Jwts.builder ()<br>            .setHeaderParam(<span class="hljs-string">&quot;type&quot;</span>,<span class="hljs-string">&quot;JWT&quot;</span>)<br>            .setSubject(username)<br>            .setIssuedAt(now)<br>            .setExpiration(expiration)<br>            .signWith(SignatureAlgorithm.HS512, secret)<br>            .compact();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="解析-token"><a href="#解析-token" class="headerlink" title="解析 token"></a>解析 token</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Claims <span class="hljs-title function_">getClaimsByToken</span><span class="hljs-params">(String token)</span> &#123;  <br>    <span class="hljs-keyword">return</span> Jwts.parser()  <br>            .setSigningKey(secret)  <br>            .parseClaimsJws(token)  <br>            .getBody();  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="后端完整部分"><a href="#后端完整部分" class="headerlink" title="后端完整部分"></a>后端完整部分</h4><p><code>UserController. java:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*  </span><br><span class="hljs-comment"> * Copyright (c) alleyf 2023 - 6 - 1 19:56 * 适度编码益脑，沉迷编码伤身，合理安排时间，享受快乐生活。 * */</span>  <br><span class="hljs-keyword">package</span> com.alleyf.airesume.controller;  <br>  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.entity.User;  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.mapper.UserMapper;  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.utils.JwtUtils;  <br><span class="hljs-keyword">import</span> com.alleyf.airesume.utils.Result;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;  <br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;  <br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;  <br>  <br><span class="hljs-keyword">import</span> java.util.List;  <br>  <br><span class="hljs-meta">@Api(tags = &quot;用户&quot;, value = &quot;用户&quot;)</span>  <br><span class="hljs-meta">@RestController</span>  <br><span class="hljs-meta">@CrossOrigin</span>  <br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;  <br>    <span class="hljs-meta">@Autowired</span>  <br>    UserMapper userMapper;  <br><br>    <span class="hljs-meta">@ApiOperation(&quot;用户登录&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtUtils.generateToken(user.getUsername());  <br>        <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;token&quot;</span>, token);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;获取用户信息&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/info&quot;)</span>  <span class="hljs-comment">//&quot;token:xxx&quot;  </span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">info</span><span class="hljs-params">(String token)</span> &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> JwtUtils.getClaimsByToken(token).getSubject();  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://img2.baidu.com/it/u=1325995315,4158780794&amp;fm=26&amp;fmt=auto&amp;gp=0.jpg&quot;</span>;  <br>        <span class="hljs-keyword">return</span> Result.ok().data(<span class="hljs-string">&quot;name&quot;</span>, username).data(<span class="hljs-string">&quot;avatar&quot;</span>, url);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;注销&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span> <span class="hljs-comment">// &quot;token:xxx&quot;  </span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> Result.ok();  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;查询所有用户&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryAll&quot;)</span>  <br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryAllUser</span><span class="hljs-params">()</span> &#123;  <br><span class="hljs-comment">//        return userMapper.selectList(null);  </span><br>        <span class="hljs-keyword">return</span> userMapper.queryAllUserAndTask();  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照用户名查询用户&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByMName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByMName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;  <br><span class="hljs-comment">//        return userMapper.selectList(null);  </span><br>        <span class="hljs-keyword">return</span> userMapper.selectByName(username);  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照用户名查询用户(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByMPName&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByMPName</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;  <br>        <span class="hljs-keyword">return</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="hljs-string">&quot;username&quot;</span>, username));  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照用户名路径查询用户(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPMPName/&#123;username&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">queryByPMPName</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;username&quot;)</span> String username)</span> &#123;  <br>        <span class="hljs-keyword">return</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="hljs-string">&quot;username&quot;</span>, username));  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;按照页码查询用户(MP)&quot;)</span>  <br>    <span class="hljs-meta">@GetMapping(&quot;/queryByPage/&#123;page&#125;&quot;)</span>  <br>    <span class="hljs-keyword">public</span> IPage <span class="hljs-title function_">queryByPage</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;page&quot;)</span> <span class="hljs-type">int</span> page)</span> &#123;  <br>        Page&lt;User&gt; page1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, <span class="hljs-number">5</span>);  <br>        <span class="hljs-type">IPage</span> <span class="hljs-variable">iPage</span> <span class="hljs-operator">=</span> userMapper.selectPage(page1, <span class="hljs-literal">null</span>);  <br>        <span class="hljs-keyword">return</span> iPage;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@ApiOperation(&quot;添加用户&quot;)</span>  <br>    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span> &#123;  <br>        <span class="hljs-keyword">return</span> userMapper.insert(user) &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;添加成功&quot;</span> : <span class="hljs-string">&quot;添加失败&quot;</span>;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>Result.java:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*  </span><br><span class="hljs-comment"> * Copyright (c) alleyf 2023 - 5 - 29 &#125;9:52 * 适度编码益脑，沉迷编码伤身，合理安排时间，享受快乐生活。 * */</span>  <br><span class="hljs-keyword">package</span> com.alleyf.airesume.utils;  <br>  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> &#123;  <br>    <span class="hljs-keyword">private</span> Boolean success;  <br>    <span class="hljs-keyword">private</span> Integer code;  <br>    <span class="hljs-keyword">private</span> String message;  <br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Result</span><span class="hljs-params">()</span> &#123;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">ok</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">Result</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();  <br>        r.setCode(ResultCode.Success);  <br>        r.setSuccess(<span class="hljs-literal">true</span>);  <br>        r.setMessage(<span class="hljs-string">&quot;成功&quot;</span>);  <br>        <span class="hljs-keyword">return</span> r;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">error</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-type">Result</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();  <br>        r.setCode(ResultCode.Error);  <br>        r.setSuccess(<span class="hljs-literal">false</span>);  <br>        r.setMessage(<span class="hljs-string">&quot;失败&quot;</span>);  <br>        <span class="hljs-keyword">return</span> r;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">success</span><span class="hljs-params">(Boolean success)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setSuccess(success);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">message</span><span class="hljs-params">(String message)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setMessage(message);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">code</span><span class="hljs-params">(Integer code)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setCode(code);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">data</span><span class="hljs-params">(String key, Object value)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.data.put(key, value);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">data</span><span class="hljs-params">(Map&lt;String, Object&gt; map)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.setData(map);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">getSuccess</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> success;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSuccess</span><span class="hljs-params">(Boolean success)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.success = success;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> code;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(Integer code)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.code = code;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> message;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMessage</span><span class="hljs-params">(String message)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.message = message;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> data;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(Map&lt;String, Object&gt; data)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.data = data;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>JwtUtils.java:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alleyf.airesume.utils;  <br>  <br><span class="hljs-keyword">import</span> io.jsonwebtoken.Claims;  <br><span class="hljs-keyword">import</span> io.jsonwebtoken.Jwts;  <br><span class="hljs-keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;  <br>  <br><span class="hljs-keyword">import</span> java.util.Date;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtUtils</span> &#123;  <br>    <span class="hljs-comment">//7 天过期  </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Long</span> <span class="hljs-variable">expire</span> <span class="hljs-operator">=</span> <span class="hljs-number">604800L</span>;  <br>    <span class="hljs-comment">//32 位秘钥  </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">secret</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdfghiabcdfghiabcdfghiabcdfghi&quot;</span>;  <br>  <br>    <span class="hljs-comment">//生成 token  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateToken</span><span class="hljs-params">(String username)</span> &#123;  <br>        <span class="hljs-type">Date</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();  <br>        <span class="hljs-type">Date</span> <span class="hljs-variable">expiration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(now.getTime() + <span class="hljs-number">1000</span> * expire);  <br>        <span class="hljs-keyword">return</span> Jwts.builder()  <br>                .setHeaderParam(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;JWT&quot;</span>)  <br>                .setSubject(username)  <br>                .setIssuedAt(now)  <br>                .setExpiration(expiration)  <br>                .signWith(SignatureAlgorithm.HS512, secret)  <br>                .compact();  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Claims <span class="hljs-title function_">getClaimsByToken</span><span class="hljs-params">(String token)</span> &#123;  <br>        <span class="hljs-keyword">return</span> Jwts.parser()  <br>                .setSigningKey(secret)  <br>                .parseClaimsJws(token)  <br>                .getBody();  <br>  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">it is some basic usage of vue.</summary>
    
    
    
    <category term="Front_end_development" scheme="https://alleyf.github.io/categories/Front-end-development/"/>
    
    
    <category term="vue" scheme="https://alleyf.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>图像分类</title>
    <link href="https://alleyf.github.io/2023/03/73453d2eb27d.html"/>
    <id>https://alleyf.github.io/2023/03/73453d2eb27d.html</id>
    <published>2023-03-17T11:11:25.000Z</published>
    <updated>2023-04-14T05:10:39.023Z</updated>
    
    <content type="html"><![CDATA[<h1 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1><blockquote><ul><li><p>LeNet：Yan LeCun 等人于 1998 年第一次将卷积神经网络应用到图像分类任务上[1]，在手写数字识别任务上取得了巨大成功。</p></li><li><p>AlexNet：Alex Krizhevsky 等人在 2012 年提出了 AlexNet[2], 并应用在大尺寸图片数据集 ImageNet 上，获得了 2012 年 ImageNet 比赛冠军(ImageNet Large Scale Visual Recognition Challenge，ILSVRC）。</p></li><li><p>VGG：Simonyan 和 Zisserman 于 2014 年提出了 VGG 网络结构[3]，是当前最流行的卷积神经网络之一，由于其结构简单、应用性极强而深受广大研究者欢迎。</p></li><li><p>GoogLeNet：Christian Szegedy 等人在 2014 提出了 GoogLeNet[4]，并取得了 2014 年 ImageNet 比赛冠军。</p></li><li><p>ResNet：Kaiming He 等人在 2015 年提出了 ResNet[5]，通过引入残差模块加深网络层数，在 ImagNet 数据集上的错误率降低到 3.6%，超越了人眼识别水平。ResNet 的设计思想深刻地影响了后来的深度神经网络的设计。</p></li></ul></blockquote><h2 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h2><center><img src="https://ai-studio-static-online.cdn.bcebos.com/82e4124e2e6a4231bcde17e086bc86ba732d3e81dcd7415f86fb4ef050aa7772" width = "800"></center><center><br>图1：LeNet模型网络结构示意图</center><p><strong>【提示】：</strong></p><blockquote><p>[!NOTE] Tips<br>卷积层的输出特征图如何当作全连接层的输入使用呢？</p><p>卷积层的输出数据格式是 $[N, C, H, W]$，在输入全连接层的时候，会自动将数据拉平，</p><p>也就是对每个样本，自动将其转化为长度为 $K$ 的向量，</p><p>其中 $K = C \times H \times W$，一个 mini-batch 的数据维度变成了 $N\times K$ 的二维向量。</p></blockquote><hr><h3 id="手写数字识别"><a href="#手写数字识别" class="headerlink" title="手写数字识别"></a>手写数字识别</h3><h4 id="定义网络结构"><a href="#定义网络结构" class="headerlink" title="定义网络结构"></a>定义网络结构</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 导入需要的包</span><br><br><span class="hljs-keyword">import</span> paddle<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">from</span> paddle.nn <span class="hljs-keyword">import</span> Conv2D, MaxPool2D, Linear<br><br><br><br><span class="hljs-comment">## 组网</span><br><br><span class="hljs-keyword">import</span> paddle.nn.functional <span class="hljs-keyword">as</span> F<br><br><br><br><span class="hljs-comment"># 定义 LeNet 网络结构</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LeNet</span>(paddle.nn.Layer):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_classes=<span class="hljs-number">1</span></span>):<br><br>        <span class="hljs-built_in">super</span>(LeNet, self).__init__()<br><br>        <span class="hljs-comment"># 创建卷积和池化层</span><br>        <span class="hljs-comment"># 创建第1个卷积层</span><br><br>        self.conv1 = Conv2D(in_channels=<span class="hljs-number">1</span>, out_channels=<span class="hljs-number">6</span>, kernel_size=<span class="hljs-number">5</span>)<br><br>        self.max_pool1 = MaxPool2D(kernel_size=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>)<br><br>        <span class="hljs-comment"># 尺寸的逻辑：池化层未改变通道数；当前通道数为6</span><br>        <span class="hljs-comment"># 创建第2个卷积层</span><br><br>        self.conv2 = Conv2D(in_channels=<span class="hljs-number">6</span>, out_channels=<span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">5</span>)<br><br>        self.max_pool2 = MaxPool2D(kernel_size=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>)<br><br>        <span class="hljs-comment"># 创建第3个卷积层</span><br><br>        self.conv3 = Conv2D(in_channels=<span class="hljs-number">16</span>, out_channels=<span class="hljs-number">120</span>, kernel_size=<span class="hljs-number">4</span>)<br><br>        <span class="hljs-comment"># 尺寸的逻辑：输入层将数据拉平[B,C,H,W] -&gt; [B,C*H*W]</span><br>        <span class="hljs-comment"># 输入size是[28,28]，经过三次卷积和两次池化之后，C*H*W等于120</span><br><br>        self.fc1 = Linear(in_features=<span class="hljs-number">120</span>, out_features=<span class="hljs-number">64</span>)<br><br>        <span class="hljs-comment"># 创建全连接层，第一个全连接层的输出神经元个数为64， 第二个全连接层输出神经元个数为分类标签的类别数</span><br><br>        self.fc2 = Linear(in_features=<span class="hljs-number">64</span>, out_features=num_classes)<br><br>    <span class="hljs-comment"># 网络的前向计算过程</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br><br>        x = self.conv1(x)<br><br>        <span class="hljs-comment"># 每个卷积层使用Sigmoid激活函数，后面跟着一个2x2的池化</span><br><br>        x = F.sigmoid(x)<br><br>        x = self.max_pool1(x)<br><br>        x = F.sigmoid(x)<br><br>        x = self.conv2(x)<br><br>        x = self.max_pool2(x)<br><br>        x = self.conv3(x)<br><br>        <span class="hljs-comment"># 尺寸的逻辑：输入层将数据拉平[B,C,H,W] -&gt; [B,C*H*W]</span><br><br>        x = paddle.reshape(x, [x.shape[<span class="hljs-number">0</span>], -<span class="hljs-number">1</span>])<br><br>        x = self.fc1(x)<br><br>        x = F.sigmoid(x)<br><br>        x = self.fc2(x)<br><br>        <span class="hljs-keyword">return</span> x<br></code></pre></td></tr></table></figure><h4 id="查看网络各层形状"><a href="#查看网络各层形状" class="headerlink" title="查看网络各层形状"></a>查看网络各层形状</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 输入数据形状是 [N, 1, H, W]</span><br><br><span class="hljs-comment"># 这里用np.random创建一个随机数组作为输入数据</span><br><br>x = np.random.randn(*[<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>])<br><br>x = x.astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><br>  <br><br><span class="hljs-comment"># 创建LeNet类的实例，指定模型名称和分类的类别数目</span><br><br>model = LeNet(num_classes=<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># 通过调用LeNet从基类继承的sublayers()函数，</span><br><br><span class="hljs-comment"># 查看LeNet中所包含的子层</span><br><br><span class="hljs-built_in">print</span>(model.sublayers())<br><br>x = paddle.to_tensor(x)<br><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> model.sublayers():<br><br>    <span class="hljs-comment"># item是LeNet类中的一个子层</span><br><br>    <span class="hljs-comment"># 查看经过子层之后的输出数据形状</span><br><br>    <span class="hljs-keyword">try</span>:<br><br>        x = item(x)<br><br>    <span class="hljs-keyword">except</span>:<br><br>        x = paddle.reshape(x, [x.shape[<span class="hljs-number">0</span>], -<span class="hljs-number">1</span>])<br><br>        x = item(x)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(item.parameters())==<span class="hljs-number">2</span>:<br><br>        <span class="hljs-comment"># 查看卷积和全连接层的数据和参数的形状，</span><br><br>        <span class="hljs-comment"># 其中item.parameters()[0]是权重参数w，item.parameters()[1]是偏置参数b</span><br><br>        <span class="hljs-built_in">print</span>(item.full_name(), x.shape, item.parameters()[<span class="hljs-number">0</span>].shape, item.parameters()[<span class="hljs-number">1</span>].shape)<br><br>    <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-comment"># 池化层没有参数</span><br><br>        <span class="hljs-built_in">print</span>(item.full_name(), x.shape)<br></code></pre></td></tr></table></figure><h4 id="数据读取模型训练"><a href="#数据读取模型训练" class="headerlink" title="数据读取模型训练"></a>数据读取模型训练</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-comment"># LeNet 识别手写数字</span><br><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> paddle<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> paddle<br><br><span class="hljs-keyword">from</span> paddle.vision.transforms <span class="hljs-keyword">import</span> ToTensor<br><br><span class="hljs-keyword">from</span> paddle.vision.datasets <span class="hljs-keyword">import</span> MNIST<br><br>  <br><br><span class="hljs-comment"># 定义训练过程</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">model, opt, train_loader, valid_loader</span>):<br><br>    <span class="hljs-comment"># 开启0号GPU训练</span><br><br>    use_gpu = <span class="hljs-literal">True</span><br><br>    paddle.device.set_device(<span class="hljs-string">&#x27;gpu:0&#x27;</span>) <span class="hljs-keyword">if</span> use_gpu <span class="hljs-keyword">else</span> paddle.device.set_device(<span class="hljs-string">&#x27;cpu&#x27;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;start training ... &#x27;</span>)<br><br>    model.train()<br><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(EPOCH_NUM):<br><br>        <span class="hljs-keyword">for</span> batch_id, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_loader()):<br><br>            img = data[<span class="hljs-number">0</span>]<br><br>            label = data[<span class="hljs-number">1</span>] <br><br>            <span class="hljs-comment"># 计算模型输出</span><br><br>            logits = model(img)<br><br>            <span class="hljs-comment"># 计算损失函数</span><br><br>            loss_func = paddle.nn.CrossEntropyLoss(reduction=<span class="hljs-string">&#x27;none&#x27;</span>)<br><br>            loss = loss_func(logits, label)<br><br>            avg_loss = paddle.mean(loss)<br><br>  <br><br>            <span class="hljs-keyword">if</span> batch_id % <span class="hljs-number">2000</span> == <span class="hljs-number">0</span>:<br><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;epoch: &#123;&#125;, batch_id: &#123;&#125;, loss is: &#123;:.4f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch, batch_id, <span class="hljs-built_in">float</span>(avg_loss.numpy())))<br><br>            avg_loss.backward()<br><br>            opt.step()<br><br>            opt.clear_grad()<br><br>  <br><br>        model.<span class="hljs-built_in">eval</span>()<br><br>        accuracies = []<br><br>        losses = []<br><br>        <span class="hljs-keyword">for</span> batch_id, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(valid_loader()):<br><br>            img = data[<span class="hljs-number">0</span>]<br><br>            label = data[<span class="hljs-number">1</span>] <br><br>            <span class="hljs-comment"># 计算模型输出</span><br><br>            logits = model(img)<br><br>            pred = F.softmax(logits)<br><br>            <span class="hljs-comment"># 计算损失函数</span><br><br>            loss_func = paddle.nn.CrossEntropyLoss(reduction=<span class="hljs-string">&#x27;none&#x27;</span>)<br><br>            loss = loss_func(logits, label)<br><br>            acc = paddle.metric.accuracy(pred, label)<br><br>            accuracies.append(acc.numpy())<br><br>            losses.append(loss.numpy())<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[validation] accuracy/loss: &#123;:.4f&#125;/&#123;:.4f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(np.mean(accuracies), np.mean(losses)))<br><br>        model.train()<br><br>  <br><br>    <span class="hljs-comment"># 保存模型参数</span><br><br>    paddle.save(model.state_dict(), <span class="hljs-string">&#x27;mnist.pdparams&#x27;</span>)<br><br>  <br>  <br><br><span class="hljs-comment"># 创建模型</span><br><br>model = LeNet(num_classes=<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># 设置迭代轮数</span><br><br>EPOCH_NUM = <span class="hljs-number">5</span><br><br><span class="hljs-comment"># 设置优化器为Momentum，学习率为0.001</span><br><br>opt = paddle.optimizer.Momentum(learning_rate=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>, parameters=model.parameters())<br><br><span class="hljs-comment"># 定义数据读取器</span><br><br>train_loader = paddle.io.DataLoader(MNIST(mode=<span class="hljs-string">&#x27;train&#x27;</span>, transform=ToTensor()), batch_size=<span class="hljs-number">10</span>, shuffle=<span class="hljs-literal">True</span>)<br><br>valid_loader = paddle.io.DataLoader(MNIST(mode=<span class="hljs-string">&#x27;test&#x27;</span>, transform=ToTensor()), batch_size=<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># 启动训练过程</span><br><br>train(model, opt, train_loader, valid_loader)<br><br></code></pre></td></tr></table></figure><hr><h1 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h1><blockquote><p>解决网络层数加深后模型效果没有提升。</p></blockquote><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="残差块"><a href="#残差块" class="headerlink" title="残差块"></a>残差块</h3><p>实现方式：<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230409204947.png" alt="image.png|250"></p><blockquote><p>一般残差块输出通道数为输入通道数的==四倍==。</p></blockquote><h3 id="ResNet-50"><a href="#ResNet-50" class="headerlink" title="ResNet-50"></a>ResNet-50</h3><blockquote><p> depth = <em><strong>[3,4,6,3]</strong></em><br> 表示 c2 有 3 个残差块，c 3 有 4 个，c 4 有 6 个，c 5 有 3 个。<br> <img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230409212006.png" alt="image.png|525"></p></blockquote><h3 id="飞浆高层-API"><a href="#飞浆高层-API" class="headerlink" title="飞浆高层 API:"></a>飞浆高层 API:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#从paddle.vis ion.models模块中import残差网络，VGG网络，LeNet网络</span><br><span class="hljs-keyword">from</span> paddle.vision.models <span class="hljs-keyword">import</span> resnet50, v9g16, LeNet<br><span class="hljs-keyword">from</span> paddle.vision.datasets <span class="hljs-keyword">import</span> Cifar10 <br><span class="hljs-keyword">from</span> paddle.optimizer <span class="hljs-keyword">import</span> Momentum<br><span class="hljs-keyword">from</span> paddle.regularizer <span class="hljs-keyword">import</span> L2Decay<br><span class="hljs-keyword">from</span> paddle.nn <span class="hljs-keyword">import</span> CrossEnt ropyLoss<br><span class="hljs-keyword">from</span> paddle.metric <span class="hljs-keyword">import</span> Accuracy<br><span class="hljs-keyword">from</span> paddle.vision. transforms <span class="hljs-keyword">import</span> Transpose<br><span class="hljs-comment">#确保从paddle.vis ion.datasets. Cifar10中加载的图像数据是np. ndarray类型</span><br>paddle.vision.set_image_backend( <span class="hljs-string">&#x27;cv2&#x27;</span> )<br><span class="hljs-comment">#调用resnet50模型</span><br>model = padd le .Model( resnet50(pretrained=<span class="hljs-literal">False</span>, num_classes=<span class="hljs-number">10</span>&#125; )<br><span class="hljs-comment">#使用Cifar10数据集</span><br>train_dataset = Cifar10(mode=<span class="hljs-string">&#x27;train&#x27;</span>, transform= =Transpose() )<br>val_dataset = Cifar10 (mode=<span class="hljs-string">&#x27;test&#x27;</span>, transform=Transpose())<br><span class="hljs-comment">#定义优化器</span><br>optimizer = Momentum( learning_rate=<span class="hljs-number">0.01</span>, momentum=<span class="hljs-number">0.9</span>,<br>weight_decay = L2Decay(<span class="hljs-number">1e-4</span>),<br>parameters = model. parameters())<br><span class="hljs-comment">#进行训练前准备</span><br>model.prepare(optimizer, CrossEntropyLoss(), Accuracy(topk=(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)))<br><span class="hljs-comment">#启动训练</span><br>model.fit(train_dataset ,<br>val_dataset ,<br>epochs=<span class="hljs-number">50</span>,<br>batch_size=<span class="hljs-number">64</span>,<br>save_dir=*<span class="hljs-string">&quot;./output&quot;</span>,<br>num_workers=<span class="hljs-number">8</span> )<br> <br></code></pre></td></tr></table></figure><hr><h2 id="图像分类-ResNet-实战：眼疾识别分类"><a href="#图像分类-ResNet-实战：眼疾识别分类" class="headerlink" title="图像分类 ResNet 实战：眼疾识别分类"></a>图像分类 ResNet 实战：眼疾识别分类</h2><h3 id="CV-任务研发流程"><a href="#CV-任务研发流程" class="headerlink" title="CV 任务研发流程"></a>CV 任务研发流程</h3><p><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230411205932.png" alt="image.png|425"></p><blockquote><p>[!NOTE] Tips<br>其中，基本的计算机视觉任务研发全流程包含模型训练、模型预测和模型部署三大步骤。每个步骤又包含单独的流程：</p><ul><li>数据准备：根据网络接收的数据格式，完成相应的预处理和跑批量数据读取器操作，保证模型正常读取；</li><li>模型构建：设计卷积网络结构；</li><li>特征提取：使用构建的模型提取数据的特征信息；</li><li>损失函数：通过损失函数衡量模型的预测值和真实值的不一致程度，通常损失函数越小，模型性能越好；</li><li>模型评估：在模型训练中或训练结束后岁模型进行评估测试，观察准确率；</li><li>模型预测：使用训练好的模型进行测试，也需要准备数据和模型特征提取，最后对结果进行解析。</li></ul></blockquote><h3 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h3>]]></content>
    
    
    <summary type="html">some notes dealing with image classification.</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Image Classify" scheme="https://alleyf.github.io/tags/Image-Classify/"/>
    
  </entry>
  
  <entry>
    <title>目标检测</title>
    <link href="https://alleyf.github.io/2023/03/3962ffddc056.html"/>
    <id>https://alleyf.github.io/2023/03/3962ffddc056.html</id>
    <published>2023-03-17T11:10:56.000Z</published>
    <updated>2023-08-18T10:29:39.707Z</updated>
    
    <content type="html"><![CDATA[<h1 id="YOLO算法"><a href="#YOLO算法" class="headerlink" title="YOLO算法"></a>YOLO算法</h1>]]></content>
    
    
    <summary type="html">some konwledge about target detection.</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="CV" scheme="https://alleyf.github.io/tags/CV/"/>
    
  </entry>
  
  <entry>
    <title>卷积神经网络基础</title>
    <link href="https://alleyf.github.io/2023/03/f41646eecf81.html"/>
    <id>https://alleyf.github.io/2023/03/f41646eecf81.html</id>
    <published>2023-03-17T11:10:27.000Z</published>
    <updated>2023-07-04T14:04:59.020Z</updated>
    
    <content type="html"><![CDATA[<h1 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h1><h2 id="形状"><a href="#形状" class="headerlink" title="形状"></a>形状</h2><p><code>[N,C,H,W]</code></p><h2 id="步幅（stride）"><a href="#步幅（stride）" class="headerlink" title="步幅（stride）"></a>步幅（stride）</h2><p>卷积核运算过程中==移动的距离大小==。<br>卷积后的输出尺寸计算公式如下：<br>$$ H_{out}= \frac{H+2p_{h}-k_{h}}{s_{h}}+1 $$<br>$$ W_{out}= \frac{W+2p_{w}-k_{w}}{s_{w}}+1 $$</p><blockquote><p>其中 $p_h$ 和 $p_w$ 分别为高度和宽度<strong>填充</strong>，$k_h$ 和 $k_w$ 分别为卷积核的高宽<strong>大小</strong>，$s_h$ 和 $s_w$ 分别为高度和宽度<strong>步幅</strong>。</p></blockquote><blockquote><p>[!NOTE] 提示<br>步幅越大，特征越小，<em><strong>stride=2</strong></em>，则<em><strong>特征缩小一半</strong></em>。</p></blockquote><h2 id="批量卷积"><a href="#批量卷积" class="headerlink" title="批量卷积"></a>批量卷积</h2><p>对RGB三通道，同时输入一个批次（batch）张图片做卷积运算，每张图像卷积后通道叠在一起（不是叠加），如下图所示：<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202303201948212.png" alt="image.png|525"></p><hr><h2 id="感受野"><a href="#感受野" class="headerlink" title="感受野"></a>感受野</h2><blockquote><p>感受野是指输出特征图上的像素点所能感受到的输入数据的范围。</p></blockquote><p>从下图可以看出感受野的大小：<br><img src="https://s2.loli.net/2023/03/20/dC7PyWFI5ZmHhxr.png" alt="image.png|250"><br><code>网络越深，越深层特征图的感受野越大，主要从输入的主对角线反映。</code></p><blockquote><p>[!NOTE] 提示<br>对于图像分类任务来说，感受野的大小与网络的性能存在一定的关系。感受野越大，网络可以获取到更广泛的上下文信息，从而更好地理解图像。但过大的感受野对图像分类也会有一定的影响，主要表现在以下两个方面：</p></blockquote><blockquote><ol><li>过大的感受野会<strong>引入过多的噪声和干扰信号</strong>。当感受野越大时，网络就会考虑更远的像素，这些像素可能与目标物体或图案无关，甚至会背离目标。这些噪声和干扰信号会干扰网络的学习，从而导致分类准确性的降低。</li></ol></blockquote><blockquote><ol start="2"><li>过大的感受野会<strong>降低网络的细节敏感度</strong>。当感受野的大小超出图像细节的尺度范围时，网络无法有效地捕捉到细节信息，从而导致分类准确性的降低。尤其是对于一些小尺寸物体和图案，小细节对分类结果的影响会更加显著。</li></ol></blockquote><blockquote><p>因此，对于图像分类任务来说，选择适当的感受野大小非常重要。通常，在<strong>保证网络全局感知能力的同时，应该将感受野限制在合适的尺度范围内</strong>，以避免过度拟合和过大感受野带来的问题。同时，还可以结合多尺度特征提取的方法，综合利用不同感受野下的信息，以获取更全面、更准确的特征，提高分类精度。</p></blockquote><h2 id="Paddle-API卷积"><a href="#Paddle-API卷积" class="headerlink" title="Paddle API卷积"></a>Paddle API卷积</h2><p><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230320203438.png" alt="image.png|400"></p><h3 id="案例1-边缘检测二值图"><a href="#案例1-边缘检测二值图" class="headerlink" title="案例1-边缘检测二值图"></a>案例1-边缘检测二值图</h3><blockquote><p>检测图像黑白分界线。</p></blockquote><p><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230320205235.png" alt="image.png|150"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> fluid. dygraph. guard():<br><span class="hljs-comment">#创建初始化权重参数w</span><br>w = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>], dtype= <span class="hljs-string">&#x27;float32&#x27;</span>)<br><span class="hljs-comment">#将权重参数调整成维度为[cout, cin, kh, kw]的四维张里</span><br>w = w.reshape([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>])<br><span class="hljs-comment">#创建卷积算子，设置输出通道数，卷积核大小，和初始化权重参数</span><br><span class="hljs-comment"># filter_size = [1, 3]表示kh = 1, kw=3</span><br><span class="hljs-comment">#创建卷积算子的时候，通过参数属性param_ attr, 指定参数初始化方式</span><br><span class="hljs-comment">#这里的初始化方式时，从numpy. ndarray初始化卷积参数</span><br><span class="hljs-comment">#num_channels:输入通道数；num_filters：输出通道数；filter_size：卷积核高宽，param_attr：初始化参数</span><br>conv = Conv2D(num_channels=<span class="hljs-number">1</span>, num_filters=<span class="hljs-number">1</span>, filter_size=[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],param_attr=fluid.ParamAttr(<br>initializer=NumpyArrayInitializer(value=w)))<br><span class="hljs-comment">#创建输入图片，图片左边的像素点取值为1，右边的像素点取值为0</span><br>img = np.ones([<span class="hljs-number">50</span>,<span class="hljs-number">50</span>], dtype=<span class="hljs-string">&#x27;f1oat32&#x27;</span>)<br>img[:, <span class="hljs-number">30</span>:] = <span class="hljs-number">0.</span><br><span class="hljs-comment">#将图片形状调整为[N(bach_size), C（chanel）, H, W]的形式</span><br>x = img.reshape([<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">50</span>,<span class="hljs-number">50</span>])<br><span class="hljs-comment">#将numpy.ndarray转化成paddle中的tensor</span><br>x = fluid.dygraph.to_variable(x)<br><span class="hljs-comment">#使用卷积算子作用在输入图片上</span><br>y = conv(x)<br><span class="hljs-comment">#将输出tensor转化为numpy.ndarray</span><br>out = y.numpy()<br></code></pre></td></tr></table></figure><blockquote><p>查看卷积层参数:<code>conv.parameters()</code><br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230320205955.png" alt="image.png|450"></p></blockquote><hr><h3 id="案例2-边缘检测RGB彩图"><a href="#案例2-边缘检测RGB彩图" class="headerlink" title="案例2-边缘检测RGB彩图"></a>案例2-边缘检测RGB彩图</h3><blockquote><p><code>图片初始读入的形状为[H,W,C](垂直像素，水平像素，通道数)，需要调整为[N,C,H,W]格式。</code><br>卷积核：<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230320213046.png" alt="image.png|175"></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">img = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./work/ images/section1000000098520. jpg&#x27;)</span><br><span class="hljs-string">with fluid.dygraph.guard():</span><br><span class="hljs-string">#设置卷积核参数</span><br><span class="hljs-string">w = np.array([[-1,-1,-1], [-1,8,-1], [-1,-1,-1]], dtype= &#x27;float32&#x27;)/8</span><br><span class="hljs-string">w = w.reshape([1, 1, 3, 3])</span><br><span class="hljs-string">#由于输入通道数是3，将卷积核的形状从[1,1,3,3]调整为[1p3,p,3]</span><br><span class="hljs-string">w = np.repeat(w,3，axis=1)、</span><br><span class="hljs-string">#创建卷积算子，输出通道数为1，卷积核大小为3x3，</span><br><span class="hljs-string">#并使用上面的设置好的数值作为卷积核权重的初始化参数</span><br><span class="hljs-string">conv = Conv2D(num_channels=3, num_filters=1, filter_size=[3,3],param_attr=fluid.ParamAttr(initializer=NumpyArrayInitializer(value=w)))</span><br><span class="hljs-string">  #将读入的图片转化为float32类型的numpy.ndarray</span><br><span class="hljs-string">x = np.array(img).astype(&#x27;float32&#x27;)</span><br><span class="hljs-string">#图片读入成ndarry时，形状是[H, W, C]，</span><br><span class="hljs-string">#将通道这一维度调整到最前面</span><br><span class="hljs-string">x = np.transpose(x, (2,0,1))</span><br><span class="hljs-string">#将数据形状调整为[N, C, H, W]格式</span><br><span class="hljs-string">x = x.reshape(1, 3, img.height, img.width)</span><br><span class="hljs-string">x = fluid.dygraph.to_variable(x)#变为张量格式</span><br><span class="hljs-string">y = conv(x)</span><br><span class="hljs-string">out = y.numpy()#张量转numpy数组</span><br></code></pre></td></tr></table></figure><hr><h3 id="案例3-均值模糊"><a href="#案例3-均值模糊" class="headerlink" title="案例3-均值模糊"></a>案例3-均值模糊</h3><blockquote><p>卷积核：<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230320213328.png" alt="image.png|200"><br>效果对比：<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230320213358.png" alt="image.png|200"></p></blockquote><hr><h1 id="池化"><a href="#池化" class="headerlink" title="池化"></a>池化</h1><h2 id="形状-1"><a href="#形状-1" class="headerlink" title="形状"></a>形状</h2><p><code>[N,C,H,W]</code></p><blockquote><p><code>池化</code>是使用某一位置的相邻输出的总体统计特征来代替网络在该位置的输出<br><code>理解</code>：取输入的局部统计特征作为输出，==可以掩盖变化的细节==。</p></blockquote><h2 id="池化方法"><a href="#池化方法" class="headerlink" title="池化方法"></a>池化方法</h2><ol><li>平均池化<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230405140612.png" alt="image.png|200"></li></ol><ol start="2"><li>最大池化<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230405140630.png" alt="image.png|200"><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2></li><li>池化的好处是当输入数据做出<strong>少量平移</strong>时，经过池化函数后的大多数输出还能<strong>保持不变</strong>,池化能够<strong>帮助输入的表示近似不变</strong>。</li><li>由于池化之后特征图会变得更小，如果后面连接的是全连接层，能<strong>有效的减小神经元的个数</strong>,<strong>节省存储空间并提高计算效率</strong>。<h2 id="相关参数"><a href="#相关参数" class="headerlink" title="相关参数"></a>相关参数</h2></li></ol><ul><li>池化<strong>窗口大小</strong>：$pool_size = [k_h,k_w]$</li><li>池化窗口<strong>滑动步幅</strong>：$pool_stride = [stride_ h, stride_w]$</li><li>图片<strong>填充</strong>：$padding=[ph,pw]$</li><li>比较常见的参数配置是：$k_n =k_w=2,stride_h=stride_w=2,p_h=p_w=0$</li><li>采用这样的设置将会使得输出图片高和宽都减半<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2></li><li><strong>没有学习参数</strong></li><li><strong>通道数不变</strong>，每个通道独立进行池化</li><li>对<strong>微小的位置</strong>变化具有<strong>鲁棒性</strong></li></ul><hr><h1 id="激活函数"><a href="#激活函数" class="headerlink" title="激活函数"></a>激活函数</h1><blockquote><p>通常在卷积或者全连接这样的线形操作之后，会加上一个非线性的函数，作用在每一个神经元的输出上，从而实现非线性变换的效果。</p></blockquote><h2 id="sigmoid激活函数"><a href="#sigmoid激活函数" class="headerlink" title="sigmoid激活函数"></a>sigmoid激活函数</h2><blockquote><p><strong>说明：</strong> Sigmoid函数只有在x接近于0的地方，导数才比较大，但最大值也只有1/4；在X的数值非常大或者非常小的地方，导数都接近于0<br>$$\begin{array}<br>\text { 反向传播 } \frac{\partial L}{\partial x}=\frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial x}<br>\text { 这将导致 } \frac{\partial L}{\partial x} \ \text { 会显著的小于 } \frac{\partial L}{\partial y}<br>这将导致张会显著的小于光<br>\end{array}$$</p></blockquote><ol><li>如果X是非常大整数或者非常小的负数，则<strong>x的梯度将接近于0</strong></li><li>即使x的数值接近于0，其梯度最大不超过y的<strong>梯度的1/4</strong>，如果有多层网络使用Sigmoid激活函数，将导致<strong>较靠前</strong>的那些层，<strong>梯度变得非常的小</strong></li></ol><p><em>在神经网络里面，将这种经过反向传播之后，梯度值衰减到接近于0的现象称作<strong>梯度消失</strong>现象</em><br>$$y=\frac{1}{1+e^{-x}}$$</p><p><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230405151136.png" alt="image.png|250"></p><hr><h2 id="ReLU激活函数"><a href="#ReLU激活函数" class="headerlink" title="ReLU激活函数"></a>ReLU激活函数</h2><p>$$<br>y= \begin{cases}0, &amp; (x&lt;0) \ x, &amp; (x \geq 0)\end{cases}<br>$$<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230405154029.png" alt="image.png|250"></p><blockquote><p>[!note]</p><ul><li>在x&gt;0的地方，ReLU函数的<strong>导数为1</strong>，能够将y的梯度完整的传递给×，而<strong>不会引起梯度消失</strong>。</li><li>在神经网络发展的早期Sigmoid函数用的比较多，而目前用的较多的激活函数是ReLU</li></ul></blockquote><hr><h1 id="批归一化BatchNorm"><a href="#批归一化BatchNorm" class="headerlink" title="批归一化BatchNorm"></a>批归一化BatchNorm</h1><h2 id="数据分布和模型的数值稳定性"><a href="#数据分布和模型的数值稳定性" class="headerlink" title="数据分布和模型的数值稳定性"></a>数据分布和模型的数值稳定性</h2><p><strong>模型收敛</strong>：需要稳定的数据分布</p><blockquote><p>[!note]<br>                       浅层神经网络—&gt;对输入数据做标准化（也称作归一化)</p><pre><code class="hljs">                   深度神经网络---&gt;仅仅标准化输入数据还不够</code></pre><p><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230405155315.png" alt="image.png"></p></blockquote><p><strong>Batch Normalization 提升数值稳定性</strong></p><blockquote><p>对中间层的输出做标准化，可以保证在网络学习的过程中，网络层的输出具有稳定的分布。</p></blockquote><h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><ul><li>可以<strong>使学习快速进行</strong>（能够使用<strong>较大的学习率</strong>)</li><li>可以<strong>降低</strong>模型<strong>对初始值</strong>的<strong>敏感性</strong></li><li>可以从一定程度上<strong>抑制过拟合</strong></li></ul><h3 id="归一化公式"><a href="#归一化公式" class="headerlink" title="归一化公式"></a>归一化公式</h3><blockquote><p>每一项减去均值，除以方差加一个无穷小的数（$10^{-6}$）防止方差为0无意义.<br>$$<br>\hat{x_i} \leftarrow \frac{x_i-\mu_B}{\sqrt{\left(\sigma_B^2+\epsilon\right)}}<br>$$<br>对标准化输出进行平移和缩放<br>$$<br>y_i \leftarrow \gamma \hat{x}_i+\beta<br>$$<br>其中$\gamma$和$\beta$是可学习的参数，可以赋初始值$\gamma=1$,$\beta=0$,在训练过程中自动不断学习调整.</p></blockquote><h2 id="预测时使用BatchNorm"><a href="#预测时使用BatchNorm" class="headerlink" title="预测时使用BatchNorm"></a>预测时使用BatchNorm</h2><blockquote><p>[!解决方案]<br><strong>训练时</strong>计算在<strong>整个数据集上的均值和方差</strong>，并将<strong>结果保存预测时</strong>不计算样本内均值和方差，而是<strong>使用训练时保存的值</strong></p><ol><li>训练通过<strong>滚动平均</strong>的方式，计算在整个数据集上的均值和方差并保存</li><li>预测时直接加在训练时保存的均值和方差，而不用在样本内计算</li></ol></blockquote><hr><h1 id="丢弃法Dropout"><a href="#丢弃法Dropout" class="headerlink" title="丢弃法Dropout"></a>丢弃法Dropout</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p>防止过拟合的方法<br><em><strong>训练阶段</strong></em>：每次随机的删除一部分神经元，不向前传播其所携带的信息，相当于每次都是让不同的模型在学习<br><em><strong>测试阶段</strong></em>：向前传播所有神经元的信息，相当于让这些不同的模型一起工作<br><img src="https://alist.fcsy.fit/d/mobilepan/PicoImages/20230405172108.png" alt="image.png|350"></p></blockquote><h2 id="存在问题"><a href="#存在问题" class="headerlink" title="存在问题"></a>存在问题</h2><blockquote><p>训练时随机丢弃了一部分神经元的信息，输出数据的总大小变小了<br>预测时不丢弃神经元，导致预测和训练时的数据分布不一样</p></blockquote><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol><li>==downgrade_in_infer==</li></ol><p><strong>训练</strong>时<strong>随机丢弃</strong>一部分神经元；<strong>预测时</strong>不丢弃神经元，但把它们<strong>数值变小</strong><br>2. ==<strong>upscale_in_train</strong>==<br><strong>训练</strong>时<strong>随机丢弃</strong>一部分神经元，但是把<strong>保留</strong>的那些<strong>神经元数值放大</strong>；<strong>预测</strong>时<strong>原样输出</strong>所有神经元的信息</p><blockquote><p>Paddle中默认是<code>downgrade_in_infer</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#设置随机数种子，这样可以保证每次运行结果一致</span><br>np.random.seed(<span class="hljs-number">100</span>)<br><span class="hljs-comment">#创建数据N,C,H,WM,一般对应卷积层的输出</span><br>data1 = np.random.rand(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><span class="hljs-comment">#创建数据N,K),一般对应全连接层的输出</span><br>data2 = np.arange(<span class="hljs-number">1</span>,<span class="hljs-number">13</span>).reshape([-<span class="hljs-number">1</span>,<span class="hljs-number">3</span>]).astype(<span class="hljs-string">&#x27;float32&#x27;</span>)<br><span class="hljs-comment">#使用dropout作用在输入数据上</span><br><span class="hljs-keyword">with</span> fluid.dygraph.guard():<br>x1 = fluid.dygraph.to_variable(data1)<br>out1_1 = fluid.layers.dropout(x1,dropout_prob=<span class="hljs-number">0.5</span>,is_test=<span class="hljs-literal">False</span>)<br>out1_2 = fluid.layers.dropout(x1,dropout_prob=<span class="hljs-number">0.5</span>,is_test=<span class="hljs-literal">True</span>)<br><br>x2 = fluid.dygraph.to_variable(data2)<br>out2_1 = fluid.layers.dropout(x2,dropout_prob=<span class="hljs-number">0.5</span>,\<br>dropout_implementation=<span class="hljs-string">&#x27;upscale_in_train&#x27;</span>)<br>out2_2 = fluid.layers.dropout(x2,dropout_prob=<span class="hljs-number">0.5</span>,\<br>dropout_implementation=<span class="hljs-string">&#x27;upscale_in_train&#x27;</span>,is_test=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h1 id="全连接层"><a href="#全连接层" class="headerlink" title="全连接层"></a>全连接层</h1><blockquote><p>将输入全部转为1维进行线性求和</p></blockquote><h2 id="形状-2"><a href="#形状-2" class="headerlink" title="形状"></a>形状</h2><p><code>[N,C]</code></p><blockquote><p>[!NOTE] 数据变换<br>尺寸的逻辑：输入层将数据拉平[B,C,H,W] -&gt; [B,C*H*W]<br>        x = paddle.reshape(x, [x.shape[0], -1])</p></blockquote>]]></content>
    
    
    <summary type="html">some konwledge about CNN.</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="CNN" scheme="https://alleyf.github.io/tags/CNN/"/>
    
  </entry>
  
  <entry>
    <title>计算机视觉概述</title>
    <link href="https://alleyf.github.io/2023/03/cc1560495a8d.html"/>
    <id>https://alleyf.github.io/2023/03/cc1560495a8d.html</id>
    <published>2023-03-17T11:09:35.000Z</published>
    <updated>2023-04-05T11:34:43.789Z</updated>
    
    <content type="html"><![CDATA[<p>[[卷积神经网络基础]][[目标检测]][[图像分类]]</p><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>计算机视觉作为一门让机器学会如何去“看”的学科，具体的说，就是让机器去识别摄像机拍摄的图片或视频中的物体，检测出物体所在的位置，并对目标物体进行跟踪，从而理解并描述出图片或视频里的场景和故事，以此来模拟人脑视觉系统。因此，计算机视觉也通常被叫做机器视觉，其目的是建立能够从图像或者视频中“感知”信息的人工系统。</p><p>计算机视觉技术经过几十年的发展，已经在交通（车牌识别、道路违章抓拍）、安防（人脸闸机、小区监控）、金融（刷脸支付、柜台的自动票据识别）、医疗（医疗影像诊断）、工业生产（产品缺陷自动检测）等多个领域应用，影响或正在改变人们的日常生活和工业生产方式。未来，随着技术的不断演进，必将涌现出更多的产品和应用，为我们的生活创造更大的便利和更广阔的机会。</p><center><img src="https://ai-studio-static-online.cdn.bcebos.com/93476b373dd342d1aae22397aa24c58fc60ab68307fd448189f16c8284723e9d" width = "500"></center><center>图1：计算机视觉技术在各领域的应用</center><p>飞桨为计算机视觉任务提供了丰富的API，并通过底层优化和加速保证了这些API的性能。同时，飞桨还提供了丰富的模型库，覆盖图像分类、检测、分割、文字识别和视频理解等多个领域。用户可以直接使用这些API组建模型，也可以在飞桨提供的模型库基础上进行二次研发。<br>由于篇幅所限，本章将重点介绍计算机视觉的经典模型（卷积神经网络）和两个典型任务（图像分类和目标检测）。主要涵盖如下内容：<br><strong>卷积神经网络</strong>：卷积神经网络（Convolutional Neural Networks, CNN）是计算机视觉技术最经典的模型结构。本教程主要介绍卷积神经网络的常用模块，包括：卷积、池化、激活函数、批归一化、丢弃法等。</p><ul><li><strong>图像分类</strong>：介绍图像分类算法的经典模型结构，包括：LeNet、AlexNet、VGG、GoogLeNet、ResNet，并通过眼疾筛查的案例展示算法的应用。</li><li><strong>目标检测</strong>：介绍目标检测YOLOv3算法，并通过林业病虫害检测案例展示YOLOv3算法的应用。</li></ul><h1 id="发展历程"><a href="#发展历程" class="headerlink" title="发展历程"></a>发展历程</h1><p>计算机视觉的发展历程要从生物视觉讲起。对于生物视觉的起源，目前学术界尚没有形成定论。有研究者认为最早的生物视觉形成于距今约<a href="https://www.pnas.org/content/109/46/18868">7亿年前的水母之中</a>，也有研究者认为生物视觉产生于距今约5亿年前寒武纪【<a href="https://doi.org/10.1038%2Fnature10097">1</a>, <a href="https://en.wikipedia.org/wiki/Evolution_of_the_eye">2</a>】。寒武纪生物大爆发的原因一直是个未解之谜，不过可以肯定的是在寒武纪动物具有了视觉能力，捕食者可以更容易地发现猎物，被捕食者也可以更早的发现天敌的位置。视觉能力加剧了猎手和猎物之间的博弈，也催生出更加激烈的生存演化规则。视觉系统的形成有力地推动了食物链的演化，加速了生物进化过程，是生物发展史上重要的里程碑。经过几亿年的演化，目前人类的视觉系统已经具备非常高的复杂度和强大的功能，人脑中神经元数目达到了1000亿个，这些神经元通过网络互相连接，这样庞大的视觉神经网络使得我们可以很轻松的观察周围的世界，如 <strong>图2</strong> 所示。</p><center><img src="https://ai-studio-static-online.cdn.bcebos.com/70d8475ed908487680057bf1f2760f10e367e7176acf43ebb380207b748b2377" width = "600"></center><center><br>图2：人类视觉感知</center><hr><p>对人类来说，识别猫和狗是件非常容易的事。但对计算机来说，即使是一个精通编程的高手，也很难轻松写出具有通用性的程序（比如：假设程序认为体型大的是狗，体型小的是猫，但由于拍摄角度不同，可能一张图片上猫占据的像素比狗还多）。那么，如何让计算机也能像人一样看懂周围的世界呢？研究者尝试着从不同的角度去解决这个问题，由此也发展出一系列的子任务，如 <strong>图3</strong> 所示。</p><center><img src="https://ai-studio-static-online.cdn.bcebos.com/d65f1ebcb0054dcb81a8eb50223adc529bb9b63265ab467d931a5df5b2864122" width = "500"></center><center><br>图3：计算机视觉子任务示意图</center>- **(a) Image Classification：** 图像分类，用于识别图像中物体的类别（如：bottle、cup、cube）。- **(b) Object Localization：** 目标检测，用于检测图像中每个物体的类别，并准确标出它们的位置。- **(c) Semantic Segmentation：** 图像语义分割，用于标出图像中每个像素点所属的类别，属于同一类别的像素点用一个颜色标识。- **(d) Instance Segmentation：** 实例分割，值得注意的是，（b）中的目标检测任务只需要标注出物体位置，而（d）中的实例分割任务不仅要标注出物体位置，还需要标注出物体的外形轮廓。在早期的图像分类任务中，通常是先人工提取图像特征，再用机器学习算法对这些特征进行分类，分类的结果强依赖于特征提取方法，往往只有经验丰富的研究者才能完成，如 **图4** 所示。<center><img src="https://ai-studio-static-online.cdn.bcebos.com/01179d17c9f74570b8a618d6123261ce6e10344f11c84dda8e47d44c1eb4fc81" width = "500"></center><center><br>图4：早期的图像分类任务</center>在这种背景下，基于神经网络的特征提取方法应运而生。Yann LeCun是最早将卷积神经网络应用到图像识别领域的，其主要逻辑是使用卷积神经网络提取图像特征，并对图像所属类别进行预测，通过训练数据不断调整网络参数，最终形成一套能自动提取图像特征并对这些特征进行分类的网络，如 **图5** 所示。<center><img src="https://ai-studio-static-online.cdn.bcebos.com/1ccd30567304415d98b0b373ec641a3d00f76d803f194ea4b14aa85ce85bf7bb" width = "500"></center><center><br>图5：早期的卷积神经网络处理图像任务示意</center><p>这一方法在手写数字识别任务上取得了极大的成功，但在接下来的时间里，却没有得到很好的发展。其主要原因一方面是数据集不完善，只能处理简单任务，在大尺寸的数据上容易发生过拟合；另一方面是硬件瓶颈，网络模型复杂时，计算速度会特别慢。<br>目前，随着互联网技术的不断进步，数据量呈现大规模的增长，越来越丰富的数据集不断涌现。另外，得益于硬件能力的提升，计算机的算力也越来越强大。不断有研究者将新的模型和算法应用到计算机视觉领域。由此催生了越来越丰富的模型结构和更加准确的精度，同时计算机视觉所处理的问题也越来越丰富，包括分类、检测、分割、场景描述、图像生成和风格变换等，甚至还不仅仅局限于2维图片，包括视频处理技术和3D视觉等。</p>]]></content>
    
    
    <summary type="html">some overview about DL_CV。</summary>
    
    
    
    <category term="机器学习" scheme="https://alleyf.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="CV" scheme="https://alleyf.github.io/tags/CV/"/>
    
  </entry>
  
  <entry>
    <title>深度学习论文阅读总结</title>
    <link href="https://alleyf.github.io/2023/03/25848e23b2aa.html"/>
    <id>https://alleyf.github.io/2023/03/25848e23b2aa.html</id>
    <published>2023-03-17T11:09:35.000Z</published>
    <updated>2023-09-01T07:53:57.535Z</updated>
    
    <content type="html"><![CDATA[<h1 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>alex 团队使用大规模深度卷积神经网络对 ImageNet 图像分类竞赛中的 120 万张高分辨率图像进行分类的工作。主要总结如下:</p><ol><li>构建了一个包含<strong>6000 万参数、65 万个神经元</strong>的大型卷积神经网络, 包含<strong>5 个卷积层、若干（3）最大池化层和 3 个全连接层</strong>。</li><li>在 ImageNet 2010 比赛的数据集上, 该模型达到了<strong>top-1 错误率 37.5%, top-5 错误率 17.0%</strong>, 显著优于此前最佳结果。</li><li>使用<strong>非饱和神经元（ReLU）和高效（并行）的 GPU</strong> 卷积实现加速了训练。使用了新的 <strong>dropout 正则化</strong>方法减少全连接层过拟合。</li><li>在 ImageNet 2012 比赛中, 该模型的变体获得了 top-5 测试错误率 15.3%的获胜结果, 优于第二名的 26.2%。  </li></ol><hr><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><ol><li><p>当前的对象识别方法大量依赖机器学习, 可以通过收集<strong>更大的数据集</strong>、学习<strong>更强大的模型</strong>和使用<strong>更好的技术</strong>来<strong>防止过拟合</strong>来提高性能。</p></li><li><p><strong>以前</strong>的图像<strong>数据集相对较小</strong>, 新的更大数据集如 <strong>ImageNet</strong> 包含了<strong>上千万个带标签的高分辨率图像</strong>。</p></li><li><p><strong>卷积神经网络</strong> (CNN)是一个大容量的模型, 可以通过调节其<strong>深度和广度</strong>来控制其能力。它对图像的假设大多是正确的, 比标准前馈神经网络的<strong>参数更少, 更易训练</strong>。</p></li><li><p>当前的 <strong>GPU 和高度优化的 2 D 卷积</strong>实现足以训练有趣的大型 CNN, 大型数据集如 ImageNet 包含足够的标记样本来训练这些模型而不会严重过拟合。</p></li><li><p>本文训练了迄今为止<strong>最大的卷积神经网络之一</strong>, 在 ImageNet 数据集上取得了最好的结果。作者编写了<strong>高度优化的 GPU 2 D 卷积</strong>等操作实现。</p></li><li><p>网络的大小主要受当前 <strong>GPU 内存和可接受的训练时间</strong>的限制。作者使用了几种技术来防止过拟合。更深的网络层次似乎很重要。</p></li><li><p>实验表明, 可以通过等待<strong>更快的 GPU 和更大的数据集</strong>来进一步改进结果。</p></li></ol><hr><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="1-数据集"><a href="#1-数据集" class="headerlink" title="1. 数据集"></a>1. 数据集</h3><ol><li>将图像<strong>下采样</strong>至固定分辨率 <strong>256 × 256</strong>。</li><li><strong>重新缩放</strong>图像，使<strong>短边</strong>的长度为 <strong>256</strong></li></ol><hr><h3 id="2-架构"><a href="#2-架构" class="headerlink" title="2. 架构"></a>2. 架构</h3><h4 id="2-1-ReLU-Nonlinearity"><a href="#2-1-ReLU-Nonlinearity" class="headerlink" title="2.1 ReLU Nonlinearity"></a>2.1 ReLU Nonlinearity</h4><ol><li><p>传统的神经元模型使用 <strong>tanh 或 sigmoid</strong> 作为激活函数, <strong>训练时间较慢且易于梯度消失</strong>。</p></li><li><p>使用 <code>ReLU (f (x)=max (0, x))</code> 作为激活函数可以显著<strong>加快训练速度并且防止过拟合</strong>, 使大型网络的训练成为可能。</p></li></ol><blockquote><p>总之, 使用 ReLU 等非饱和激活函数可以显著加速训练, 这对于大规模深度学习模型非常重要。文章通过实验确证了这一点。</p></blockquote><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308181911241.png" alt="image.png|325"></p><blockquote><p>ReLU（实线）在 CIFAR-10 上达到 25% 的训练错误率，比具有 tanh 神经元的等效网络（虚线）快六倍。</p></blockquote><hr><h4 id="2-2-Training-on-Multiple-GPUs"><a href="#2-2-Training-on-Multiple-GPUs" class="headerlink" title="2.2 Training on Multiple GPUs"></a>2.2 Training on Multiple GPUs</h4><ol><li><p>采用的并行化方案本质上是在<strong>每个 GPU 上各放一半的内核（或神经元）</strong>，还有一个额外的技巧：<strong>GPU 仅在某些层中进行通信</strong></p><ul><li>缺点：<span style="background:rgba(255, 183, 139, 0.55)">选择连接模式是交叉验证的一个问题</span></li><li>优点：<span style="background:rgba(205, 244, 105, 0.55)">能够精确调整通信量，直到它达到计算量的可接受的分数</span></li></ul></li><li><p>该方案将 top-1 和 top-5 错误率降低了 <strong>1.7% 和 1.2%</strong></p></li><li><p>双 GPU 网络的<strong>训练时间</strong>比单 GPU 网络略少</p></li></ol><hr><h4 id="2-3-Local-Response-Normalization"><a href="#2-3-Local-Response-Normalization" class="headerlink" title="2.3 Local Response Normalization"></a>2.3 Local Response Normalization</h4><p>局部正则化表达式：<br>$$b_{x,y}^{i}=a_{x,y}^{i}(k+ \alpha \sum <em>{j= \min(0,i-n/2)}^{min(N-1,i+n/2)}(a</em>{x,y}^{j})^{2})^{\beta}$$<br>参数：$k = 2, n = 5, α = 10−4, β = 0.75$ 均为超参数，N：层中内核总数，n：同一空间位置的 n 个“相邻”核，</p><blockquote><p>效果：该方案将 top-1 和 top-5 错误率分别降低了<strong>0.4%和 0.3%</strong></p></blockquote><hr><h4 id="2-4-Overlapping-Pooling"><a href="#2-4-Overlapping-Pooling" class="headerlink" title="2.4 Overlapping Pooling"></a>2.4 Overlapping Pooling</h4><ol><li><p>池化层对同一个核映射中相邻的神经元组输出进行汇总。</p></li><li><p>传统上, 相邻池化单元汇总的邻域不重叠 (非重叠池化)。</p></li><li><p>池化层可以看作是一个栅格, 每个池化单元之间间隔 s 像素, 并汇总一个大小为 z x z 的邻域。</p><ul><li>如果 <strong>s=z</strong>, 则为传统的非重叠池化。 </li><li>如果 <strong>s&lt;z</strong>, 则为有重叠的池化, 该网络采用了 s=2, z=3 的重叠池化。</li></ul></li><li><p>该方案将 top-1 和 top-5 错误率分别降低了**0.4%和 0.3%**。</p></li><li><p>具有重叠池化的模型在训练时往往<strong>更难过拟合</strong>。</p></li></ol><blockquote><p>与传统非重叠池化相比, 重叠池化层可以<strong>汇总有重叠的邻域</strong>, 往往可以<strong>提高准确率并减少过拟合</strong>。该网络采用了具体参数为 s=2, z=3 的重叠池化。</p></blockquote><hr><h4 id="2-5-Overall-Architecture"><a href="#2-5-Overall-Architecture" class="headerlink" title="2.5 Overall Architecture"></a>2.5 Overall Architecture</h4><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308181930025.png" alt="image.png"></p><blockquote><ol><li>一个 GPU 运行图顶部的层部分，而另一个 GPU 运行底部的层部分。 GPU 仅在某些层进行通信。</li><li>第二到第五个卷积层顺序连接, 每层卷积核大小和数量分别为 256 个 5 x 5 x 48、384 个 3 x 3 x 256、384 个 3 x 3 x 192 和 256 个 3 x 3 x 192, 全连接层每个有 4096 个神经元。</li></ol></blockquote><hr><h3 id="3-防止过拟合"><a href="#3-防止过拟合" class="headerlink" title="3. 防止过拟合"></a>3. 防止过拟合</h3><h4 id="3-1-Data-Augmentation"><a href="#3-1-Data-Augmentation" class="headerlink" title="3.1 Data Augmentation"></a>3.1 Data Augmentation</h4><ol><li>普遍通用方式：使用<strong>标签保留转换</strong>人为地<strong>扩大数据集</strong></li><li>本文采用的方式：<ul><li>生成<strong>图像平移和水平反射</strong>（256 x 256 –&gt; 224 × 224 附带水平反射）</li><li><strong>改变</strong>训练图像中 <strong>RGB 通道的强度</strong>（ RGB 像素值集执行 <strong>PCA</strong>，对于每个训练图像，我们添加多个找到的主成分）</li></ul></li></ol><blockquote><p>[!NOTE] Conclusion</p><ul><li>该方案将 top-1 错误率降低了 1%以上</li><li>对象身份对于<strong>照明强度和颜色</strong>的变化是不变的</li></ul></blockquote><blockquote><p>新概念：<strong>PCA</strong><br>PCA (主成分分析)是一种广泛用于数据分析和机器学习的统计方法。它的主要作用是:</p><ol><li><strong>减维</strong>: PCA 通过正交变换, 将高维数据集投影到低维空间中, 同时尽量保留原数据的信息。</li><li><strong>去相关</strong>: PCA 可以去除数据间的相关性, 将高维数据转换为线性无关的低维特征。</li><li><strong>特征提取</strong>: PCA 可以将数据集中的主要特征提取出来, 去除噪声, 使得数据集中的特征更加显著。<br>其基本思想是利用正交变换把原始数据集投影到某个最佳子空间, 使得投影后的样本点能够最大限度保留原样本点的信息 (样本点的方差)。数学上, 它通过求数据协方差矩阵的特征向量来实现。PCA 是一种常用的无监督学习方法。</li></ol></blockquote><hr><h4 id="3-2-Dropout"><a href="#3-2-Dropout" class="headerlink" title="3.2 Dropout"></a>3.2 Dropout</h4><blockquote><p>具体做法：在前两个全连接层中使用 dropout，没有 dropout 时会过拟合，Dropout 大约使迭代次数加倍来收敛</p></blockquote><ul><li><p>Dropout 是一种很有效的模型集成技术, 在训练时<strong>随机让一半的隐层单元输出为 0</strong>。</p></li><li><p>Dropout 使得<strong>每次输入时神经网络采样不同的架构</strong>, 但这些架构<strong>共享权重</strong>。</p></li><li><p>这<strong>减少</strong>了<strong>神经元之间的复杂适应性</strong>, 迫使其学习更加鲁棒的特征。</p></li><li><p>在测试时使用所有神经元, 但将其<strong>输出乘以 0.5</strong> 来近似地取指数数量 dropout 网络的预测分布的几何平均。</p></li></ul><blockquote><p>总的来说, dropout 通过随机扰动实现模型集成, 减少过拟合, 但需要更多的迭代次数。</p></blockquote><hr><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><ol><li>随机梯度下降，批量大小为 128 ，动量为 0.9，权重衰减为 0.0005，轮数为 90</li><li>初始化的每层的权重来自标准差为 0.01 的零均值高斯分布</li><li>第二、第四和第五卷积层以及全连接隐藏层中的神经元偏差为常数 1，其余层中的神经元偏差为常数 0</li><li>学习率初始化为 0.01，当验证错误率停止以当前学习率提高时，将学习率除以 10</li></ol><blockquote><p>新概念：L 2</p><ul><li>L 2 在深度学习中通常指 L 2 正则化 (L 2 regularization)。L 2 正则化是一种常用的正则化技术, 主要作用是为了<strong>防止模型过拟合</strong>。</li><li>L 2 正则化的具体做法是在模型的损失函数中<strong>引入权重参数的 L 2 范数作为惩罚项</strong>。也就是在损失函数中添加<em><em>λ</em>||w||^2</em>*, 其中 w 是模型的参数,||w||^2 表示参数 w 的 L 2 范数,λ是超参数用于控制惩罚力度。</li><li>引入 L 2 范数会惩罚模型参数的大小, <strong>使得参数向 0 收缩, 从而达到减小模型复杂度</strong>, 防止过拟合的目的。一般来说, L 2 正则化在实际应用中使用更为广泛, 因为 L 2 正则化更容易优化, 且可以<strong>防止参数爆炸</strong>。</li></ul></blockquote><hr><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul><li><p>大型深层卷积神经网络通过<strong>纯监督学习</strong>在一个非常复杂的数据集上取得了<strong>记录性的结果</strong>。</p></li><li><p><strong>删除任何一个卷积层</strong>, 网络的<strong>性能</strong>都会<strong>下降</strong>, 如删除中间层会导致 top-1 性能降低约 <strong>2%</strong> </p></li><li><p>作者希望能在<strong>视频序列</strong>上应用<strong>更大更深的卷积网络</strong>, 因为时间信息可以提供静态图像中没有的有用信息。</p></li></ul><hr><h1 id="VGG"><a href="#VGG" class="headerlink" title="VGG"></a>VGG</h1><blockquote><p>VGGNet 是牛津大学视觉几何组 (Visual Geometry Group)提出的模型，该模型在 2014 ImageNet 图像分类与定位挑战赛 ILSVRC-2014 中取得在分类任务第二，定位任务第一的优异成绩。VGGNet 突出的贡献是证明了很小的卷积，通过增加网络深度可以有效提高性能。VGG 很好的继承了 Alexnet 的衣钵同时拥有着鲜明的特点。相比 Alexnet ，VGG 使用了更深的网络结构，证明了增加网络深度能够在一定程度上影响网络性能。 </p></blockquote><h2 id="摘要-1"><a href="#摘要-1" class="headerlink" title="摘要"></a>摘要</h2><ul><li>研究非常深的 CNN 在大规模图像分类中的效果</li><li>主要贡献: 通过增加网络深度来提高 ImageNet 分类性能</li><li>实验中深度从 11 层增加到 19 层, 使用 3 x 3 小卷积核</li><li>分类错误率随网络深度的增加而降低</li><li>在 ILSVRC 2014 分类任务中获得了第二名</li></ul><hr><h2 id="背景介绍-1"><a href="#背景介绍-1" class="headerlink" title="背景介绍"></a>背景介绍</h2><ul><li>CNN 近年来在图像识别中成功, 得益于大数据集和 GPU 计算</li><li>ILSVRC 竞赛推动了从浅层到深层网络的发展</li><li>本文通过增加深度来提升 CNN 性能</li><li>使用全 3 x 3 小卷积核, 增加非线性映射判别性, 减少参数量</li></ul><hr><h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h2><h3 id="卷积网络配置"><a href="#卷积网络配置" class="headerlink" title="卷积网络配置"></a>卷积网络配置</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308191508459.png" alt="image.png|400"><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308191506627.png" alt="image.png|400"><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308191506264.png" alt="image.png|325"></p><ul><li>输入 224 x 224 RGB 图像, 均值归一化预处理</li><li>所有卷积层使用 3 x 3 小卷积核</li><li>1 x 1 卷积可看作通道上的线性变换</li><li>卷积步长为 1, 使用 padding 保持分辨率  </li><li>5 次最大池化下采样</li><li>3 个全连接层, 最后分类层 1000 个输出</li><li>所有隐层使用 ReLU 激活函数</li><li>提出了 11-19 层的 5 种配置进行比较</li></ul><h3 id="分类框架"><a href="#分类框架" class="headerlink" title="分类框架"></a>分类框架</h3><ul><li>SGD 优化, momentum, dropout, batchsize=256</li><li>先训练 11 层网络 A, 初始化更深网络部分层权重</li><li>训练集数据增强: 随机裁剪, 翻转, 颜色抖动 </li><li>测试时多尺度密集预测, 平均结果</li></ul><hr><h2 id="实验-1"><a href="#实验-1" class="headerlink" title="实验"></a>实验</h2><h3 id="分类实验"><a href="#分类实验" class="headerlink" title="分类实验"></a>分类实验</h3><ul><li>在 ImageNet 上评估不同配置</li><li>错误率随深度减小, 19 层效果趋于饱和</li><li>多尺度评估优于单尺度, 训练尺度抖动也优于固定尺度</li><li>模型融合进一步提升, 2 模型组合 top-5 错误率 6.8%</li></ul><h3 id="定位实验"><a href="#定位实验" class="headerlink" title="定位实验"></a>定位实验</h3><ul><li>使用深度 CNN 预测 bounding box 进行对象定位</li><li>每类回归优于共享回归, 微调所有层优于仅全连接层</li><li>最终定位错误率 25.3%, 优于之前 state-of-the-art (SOTA)</li></ul><h3 id="很深特征泛化性"><a href="#很深特征泛化性" class="headerlink" title="很深特征泛化性"></a>很深特征泛化性</h3><ul><li>在其他数据集上测试 ImageNet 预训练模型作为特征提取器</li><li>在 PASCAL VOC、Caltech 等数据集上获得了 state-of-the-art 的分类效果</li><li>显示了很深 CNN 模型学到的特征具有很强的泛化性</li></ul><hr><h2 id="重点总结"><a href="#重点总结" class="headerlink" title="重点总结"></a>重点总结</h2><blockquote><ol><li><p><strong>小卷积核组</strong>: 作者通过堆叠多个 3*3 的卷积核 (少数使用 1*1）来替代大的卷积核，以减少所需参数；</p></li><li><p><strong>小池化核</strong>: 相比较于 AlexNet 使用的 3*3 的池化核，VGG 全部为 2*2 的池化核；</p></li><li><p><strong>网络更深特征图更宽</strong>: 卷积核专注于扩大通道数，池化专注于缩小高和宽，使得模型更深更宽的同时，计算量的增加不断放缓；</p></li><li><p><strong>将卷积核替代全连接</strong>: 作者在测试阶段将三个全连接层替换为三个卷积，使得测试得到的模型结构可以接收任意高度或宽度的输入。</p></li><li><p><strong>多尺度</strong>: 作者从多尺度训练可以提升性能受到启发，训练和测试时使用整张图片的不同尺度的图像，以提高模型的性能。</p></li><li><p><strong>去掉了 LRN 层</strong>: 作者发现深度网络中 LRN（Local Response Normalization，局部响应归一化）层作用不明显。</p></li></ol></blockquote><hr><h2 id="重要概念"><a href="#重要概念" class="headerlink" title="重要概念"></a>重要概念</h2><h3 id="感受野"><a href="#感受野" class="headerlink" title="感受野"></a>感受野</h3><p><strong>感受野（感受野其实就是结果层一个神经元节点发生变动能影响多少个输入层神经元节点）</strong><br>计算公式：<br>$$feature_{i}=(feature_{i+1}-1)\times window_{-}strides+kernel_{-}size$$<br>$f_i$ 是第 i 层感受野，times 为第 i 步的步长，kernel_size 为卷积核或池化核大小。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308191524259.png" alt="image.png|450"></p><blockquote><ul><li>感受野决定了神经网络能“看到”输入图像的哪一部分。每个神经元只连接到输入图像的一小块区域, 这块区域就是这个神经元的感受野。</li><li>在卷积神经网络中, 通过设置卷积核的大小, 可以控制每个神经元的感受野大小。典型的卷积核大小是 <strong>3 x 3 或 5 x 5</strong>。</li><li><strong>网络层数越深, 神经元的感受野会越来越大</strong>。这是因为每个神经元不仅连接到输入, 还连接到前一层的神经元。所以层与层堆叠, 会逐步扩大感受野。</li><li>扩大感受野有利于<strong>捕捉输入图像的全局信息</strong>, 以及学习更抽象和高级的特征表示。但是计算量也会增加。所以需要在两者之间做 trade-off。</li><li>在<strong>全连接层</strong>, 每个神经元的感受野是<strong>整个输入图像</strong>。</li></ul><p>总体来说, 调整卷积网络的感受野大小, 是控制网络提取<strong>局部还是全局信息</strong>的一个重要方法。这在卷积网络设计中需要特别考虑。</p></blockquote><hr><h1 id="GoogLeNet"><a href="#GoogLeNet" class="headerlink" title="GoogLeNet"></a>GoogLeNet</h1><h2 id="摘要-2"><a href="#摘要-2" class="headerlink" title="摘要"></a>摘要</h2><p align="justify">这篇文章介绍了一个名为 Inception 的深度卷积神经网络架构，它在 ImageNet Large-Scale Visual Recognition Challenge 2014 (ILSVRC 14)的分类和检测任务中取得了新的最优结果。该架构的主要特点是在网络内部改进了计算资源的利用。通过精心设计，增加了网络的深度和宽度，同时保持了计算预算不变。为了优化质量，架构决策基于 Hebbian 原理和多尺度处理的直觉。在 ILSVRC 14 中使用的一个特定版本称为 GoogLeNet，是一个 22 层深的网络，其质量在分类和检测的背景下进行了评估</p><hr><h2 id="背景介绍-2"><a href="#背景介绍-2" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>想要更好的预测效果，就要从网络深度和网络宽度两个角度出发增加网络的复杂度。<br>但这个思路有两个较为明显的问题：</p><ol><li><p>首先，更复杂的网络意味着更多的参数，也很容易过拟合；</p></li><li><p>其次，更复杂的网络会消耗更多的计算资源，而且卷积核个数设计不合理，导致了卷积核中参数没有被完全利用 (多数权重都趋近 0)时，会造成大量计算资源的浪费。</p></li></ol><p>因此 GoogLeNet 在专注于加深网络结构的同时，引入了新的基本结构——Inception 模块，以增加网络的宽度。GoogLeNet 一共 22 层，没有全连接层，在 2014 年的 ImageNet 图像识别挑战赛中获得了冠军。</p><h3 id="2-1-稀疏运算特性"><a href="#2-1-稀疏运算特性" class="headerlink" title="2.1 稀疏运算特性"></a>2.1 稀疏运算特性</h3><h4 id="稀疏矩阵"><a href="#稀疏矩阵" class="headerlink" title="稀疏矩阵"></a>稀疏矩阵</h4><p>在矩阵中，<strong>若数值为 0 的元素数目远远多于非 0 元素的数目，并且非 0 元素分布没有规律时，则称该矩阵为稀疏矩阵</strong>；与之相反，若非 0 元素数目占大多数时，则称该矩阵为<strong>稠密矩阵</strong>。定义非零元素的总数比上矩阵所有元素的总数为<strong>矩阵的稠密度</strong>。</p><h4 id="稀疏运算"><a href="#稀疏运算" class="headerlink" title="稀疏运算"></a>稀疏运算</h4><p>根据上面的缺点，作者认为我们应该把<strong>全连接</strong>层替换成<strong>稀疏连接</strong>结构，这样就可以避免计算资源的浪费，加速收敛。作者还提到了<strong>Hebbian principle</strong>，主旨是： </p><ol><li>如果突触两侧的两个神经元（即连接）<strong>同时被激活</strong>，则该突触的<strong>强度会选择性地增加</strong>。</li><li>如果突触两侧的两个神经元被<strong>异步激活</strong>，则该突触被<strong>选择性地削弱或消除.</strong></li></ol><h3 id="2-2-并行计算"><a href="#2-2-并行计算" class="headerlink" title="2.2 并行计算"></a>2.2 并行计算</h3><p>随着现在计算硬件的飞速发展，我们如果在 gpu 上用稀疏计算，那么它的效率将为减少 100 倍，无论我们怎么调试，它的效果都不尽人意，所以作者认为要充分利用 gpu 并行计算。</p><h4 id="结合稀疏与并行"><a href="#结合稀疏与并行" class="headerlink" title="结合稀疏与并行"></a>结合稀疏与并行</h4><p>想要找到一个鱼与熊掌兼得的方案，<strong>在使用稀疏运算的优势的同时，还要充分利用 GPU</strong>。利用稀疏矩阵分解成密集矩阵计算的原理来加快收敛速度。举个例子下图左侧是个稀疏矩阵（很多元素都为 0，不均匀分布在矩阵中），和一个 2 x 2 的矩阵进行卷积，需要对稀疏矩阵中的每一个元素进行计算；如果像右图那样把稀疏矩阵分解成 2 个子密集矩阵，再和 2 x 2 矩阵进行卷积，稀疏矩阵中 0 较多的区域就可以不用计算，计算量就大大降低, 但是这些都是作者的假设，他也不能合理的解释其原因.<br><img src="https://pic1.zhimg.com/80/v2-ced223397595dd66bede062845e2f9ec_1440w.webp"></p><hr><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><h3 id="3-1-Inception-模块"><a href="#3-1-Inception-模块" class="headerlink" title="3.1 Inception 模块"></a>3.1 Inception 模块</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308251404653.png" alt="image.png|450"><br>Inception 模块的基本组成结构可以分为四个部分：<strong>1 x 1 卷积、3 x 3 卷积、5 x 5 卷积和 3 x 3 最大池化</strong>。然后将这四部分的运算结果按通道进行组合。<br>这就是 Naive Inception（上图 a）的核心思想：<strong>利用不同大小的卷积核实现不同尺度上的特征提取，并最终将它们合并，以获得更好的图像表示</strong>（即探索特征图上不同邻域之间的“相关性”）。<br>注意：每个分支产生的<strong>特征矩阵的高度和宽度必须相同</strong>。<br>然而，Naive Inception 有两个缺点：</p><blockquote><ol><li>所有卷积层直接接收前一层输入的数据，导致卷积层的计算量很大（一次计算变为四次）。</li><li>在该模块中使用的最大池化层会保留输入数据的特征图的深度，因此合并后总输出的特征图深度一定会增加，这进一步增加了网络结构的计算量。</li></ol></blockquote><p>因此，增加了<strong>使用 1 x 1 卷积操作的目的是进行压缩降维，以减少参数量</strong>（即上图 b），从而让网络更深、更宽，更好地提取特征。这种思想也被称为 Pointwise Conv（逐点卷积），简称 PW。<br>压缩降维：通过调整卷积层的输出通道数来实现这一目标。</p><blockquote><p>减少参数量：假设输入通道数为 Cin，原本是直接要使用输出通道数为 Cout 的 N*N 卷积层来进行卷积，那么所需参数量为 Cin*Cout*N*N；如果加上输出通道数为 k 的 1*1 卷积核的话，所需参数量为：Cin*k+N*N*Cout*k，只要 k 足够小就能使参数量大幅度下降了。</p></blockquote><h3 id="3-2-辅助分类器"><a href="#3-2-辅助分类器" class="headerlink" title="3.2 辅助分类器"></a>3.2 辅助分类器</h3><p>因为神经网络的<strong>中间层也具有很强的识别能力</strong>，因此 GoogLeNet 在一些中间层中添加了含有多层的分类器。GoogLeNet 中共增加了<strong>两个辅助的 softmax 分支</strong>。网络结构如上图所示（其中的红圈圈就是辅助的分类器）。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308251417988.png" alt="image.png|400"><br>GoogLeNet 网络引入了辅助 softmax 分支的目的主要有三个作用。</p><ol><li><p>首先，为了<strong>避免梯度消失问题</strong>，在反向传播时，如果某一层求导为 0，则链式求导的结果也会为 0。因此，在中间层中<strong>添加辅助 softmax 分支可以保证梯度能够向前传递，避免梯度消失的问题</strong>，提高网络的训练效果。</p></li><li><p>其次，<strong>辅助 softmax 分支将中间某一层的输出用作分类器，起到了模型融合的作用</strong>。最终的分类结果不仅依赖于主分类器的结果，还考虑了这两个辅助分类器的结果，通过加权融合的方式得到最终的训练得到的分类结果。然而，在实际测试中，这两个辅助 softmax 分支通常会被去掉，因为它们的主要作用是向前传导梯度，在训练完成后就没有太多的价值，理应被丢弃。</p></li><li><p>另外，辅助分类器还起到了<strong>正则化的作用</strong>。在进一步的研究中，Google 团队发现，在训练早期，辅助分类器并没有改善收敛速度。在两种网络达到高精度之前，两种网络的训练进度几乎是相同的。直到接近训练结束时，有辅助分支的网络才开始超越没有任何分支的网络的准确性，达到更高的稳定水平。因此，辅助分类器更多地起到了正则化的作用，防止模型过拟合。</p></li></ol><p>综上所述，GoogLeNet 网络中的辅助 softmax 分支具有避免梯度消失、模型融合和正则化的作用。这一设计在提高网络的训练效果和稳定性方面取得了良好的效果。</p><h3 id="3-3-Average-pooling"><a href="#3-3-Average-pooling" class="headerlink" title="3.3 Average pooling"></a>3.3 Average pooling</h3><p align="justify">网络一共 22 层，为了减少参数作者把 alexnet 的两层全连接层换成了<font color="#ff0000">全局平均池化</font>，数据有多少类别，最后的 channel 数就是多少，把每个 channel 的 feature 换成这个 channel 所有 feature 的平均值，再经过 soft Max。最终通过实验发现，利用 average pooling 的精度比全连接层好了 6%。</p>### 3.4 网络结构共 5 段，9 个 inception 块，stage 3 两个，stage 4 五个，stage 5 两个。<p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308251448902.png" alt="image.png|250"><br>模型参数如下图所示：</p><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308251449022.png" alt="image.png"></p><hr><h2 id="实验-2"><a href="#实验-2" class="headerlink" title="实验"></a>实验</h2><h3 id="训练方法-Training-Method"><a href="#训练方法-Training-Method" class="headerlink" title="训练方法 (Training Method)"></a>训练方法 (Training Method)</h3><h4 id="超参数设置"><a href="#超参数设置" class="headerlink" title="超参数设置"></a>超参数设置</h4><p>dropout：0.7 SGDM：momentum=0.9 learning rate：decreasing learning rate by 4% every 8 epoch。</p><h3 id="模型集成"><a href="#模型集成" class="headerlink" title="模型集成"></a>模型集成</h3><h4 id="训练阶段"><a href="#训练阶段" class="headerlink" title="训练阶段"></a>训练阶段</h4><p>作者训练了 7 个模型，这七个模型有相同的学习率策略，模型结构，初始化权重（由于作者的疏忽）。不同点： 根据不同的图像采样，随机的图像输入顺序。</p><h4 id="预测阶段"><a href="#预测阶段" class="headerlink" title="预测阶段"></a>预测阶段</h4><ol><li>把图像根据短边 resize 四个尺寸，分别为 256、288，320、352。</li><li>每个尺寸在根据左中右，上中下分别裁剪出三个小图。</li><li>把每张小图取四个角和中央，然后 resize 224 * 224。</li><li>然后每张图做一个镜像操作。根据上述操作，每张图可以变成 4 * 3 * 6 * 2 = 144 张，然后对结果取均值。</li></ol><p><img src="https://pic2.zhimg.com/80/v2-1e5a618c963df39db5d6ce274adf4619_1440w.webp"></p><hr><h2 id="重点总结-1"><a href="#重点总结-1" class="headerlink" title="重点总结"></a>重点总结</h2><blockquote><p>下面这幅图将 Inception 模块所使用到的参数信息标注在每个分支上，其中 # 1 x 1 对应着分支 1 上 1 x 1 的卷积核个数， # 3 x 3 reduce 对应着分支 2 上 1 x 1 的卷积核个数， # 3 x 3 对应着分支 2 上 3 x 3 的卷积核个数， # 5 x 5 reduce 对应着分支 3 上 1 x 1 的卷积核个数， # 5 x 5 对应着分支 3 上 5 x 5 的卷积核个数，poolproj 对应着分支 4 上 1 x 1 的卷积核个数。</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200429112707888.png" alt="在这里插入图片描述"><br><strong>多个尺寸上进行卷积再聚合</strong><br>上图可以看到对输入做了 4 个分支，分别用不同尺寸的 filter 进行卷积或池化，最后再在特征维度上拼接到一起。这种全新的结构有什么好处呢？Szegedy 从多个角度进行了解释：<br><strong>解释 1</strong>：在直观感觉上在<strong>多个尺度上同时进行卷积，能提取到不同尺度的特征</strong>。特征更为丰富也意味着最后分类判断时更加准确。<br><strong>解释 2</strong>：利用<strong>稀疏矩阵分解成密集矩阵</strong>计算的原理来<strong>加快收敛速度</strong>。<br>举个例子下图左侧是个稀疏矩阵（很多元素都为 0，不均匀分布在矩阵中），和一个 2 x 2 的矩阵进行卷积，需要对稀疏矩阵中的每一个元素进行计算；如果像右图那样把稀疏矩阵分解成 2 个子密集矩阵，再和 2 x 2 矩阵进行卷积，稀疏矩阵中 0 较多的区域就可以不用计算，计算量就大大降低。<strong>这个原理应用到 inception 上就是要在特征维度上进行分解！</strong><br>传统的卷积层的输入数据只和一种尺度（比如 3 x 3）的卷积核进行卷积，输出固定维度（比如 256 个特征）的数据，所有 256 个输出特征基本上是均匀分布在 3 x 3 尺度范围上，这可以理解成输出了一个稀疏分布的特征集；而 inception 模块在多个尺度上提取特征（比如 1 x 1，3 x 3，5 x 5），输出的 256 个特征就不再是均匀分布，而是相关性强的特征聚集在一起（比如 1 x 1 的的 96 个特征聚集在一起，3 x 3 的 96 个特征聚集在一起，5 x 5 的 64 个特征聚集在一起），这可以理解成多个密集分布的子特征集。这样的特征集中因为相关性较强的特征聚集在了一起，不相关的非关键特征就被弱化，同样是输出 256 个特征，inception 方法输出的特征“冗余”的信息较少。用这样的“纯”的特征集层层传递最后作为反向计算的输入，自然收敛的速度更快。</p><p><img src="https://img-blog.csdnimg.cn/20200429114501229.png" alt="在这里插入图片描述"></p><p><strong>解释 3</strong>：Hebbin 赫布原理。<br>Hebbin 原理是神经科学上的一个理论，解释了在学习的过程中脑中的神经元所发生的变化，用一句话概括就是 fire togethter, wire together。赫布认为“两个神经元或者神经元系统，如果总是同时兴奋，就会形成一种‘组合’，其中一个神经元的兴奋会促进另一个的兴奋”。比如狗看到肉会流口水，反复刺激后，脑中识别肉的神经元会和掌管唾液分泌的神经元会相互促进，“缠绕”在一起，以后再看到肉就会更快流出口水。用在 inception 结构中就是要把相关性强的特征汇聚到一起。这有点类似上面的解释 2，把 1 x 1，3 x 3，5 x 5 的特征分开。因为训练收敛的最终目的就是要提取出独立的特征，所以预先把相关性强的特征汇聚，就能起到加速收敛的作用。<br>在 inception 模块中有一个分支使用了 max pooling，作者认为 pooling 也能起到提取特征的作用，所以也加入模块中。注意这个 pooling 的 stride=1，pooling 后没有减少数据的尺寸</p><hr><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol><li><a href="http://www.taodudu.cc/news/show-1217904.html?action=onClick">GoogLeNet——CNN经典网络模型详解（pytorch实现）</a></li><li><a href="https://zhuanlan.zhihu.com/p/579891517">深度学习：GoogLeNet核心思想详细讲解 - 知乎</a></li><li><a href="https://blog.csdn.net/weixin_55073640/article/details/128550616">GoogLeNet详解_tt丫的博客-CSDN博客</a></li><li><a href="https://www.bilibili.com/video/BV1b5411g7Xo?p=1&vd_source=9c896fa9c3f9023797e8efe7be0c113e">GoogLeNet_哔哩哔哩_bilibili</a></li></ol><hr><h1 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h1><h2 id="摘要-3"><a href="#摘要-3" class="headerlink" title="摘要"></a>摘要</h2><p>本文提出了一个残差学习框架，用于训练深度神经网络。通过引入残差块，可以让网络更深，同时避免了梯度消失和梯度弥散的问题。在多个视觉识别任务中，残差网络都取得了比传统网络更好的结果。</p><hr><h2 id="背景介绍（相关研究）"><a href="#背景介绍（相关研究）" class="headerlink" title="背景介绍（相关研究）"></a>背景介绍（相关研究）</h2><p>在近些年中，深度网络逐渐往更深的方向发展，但是更深的网络训练更加困难，因为梯度消失和梯度弥散的问题会导致网络难以收敛。之前的研究提出了一些方法，如使用更好的初始化方法、使用更好的激活函数等，但是这些方法并不能完全解决问题。本文提出了一种新的方法，即残差学习框架，通过引入残差块来解决梯度消失和梯度弥散的问题。<br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211604278.png" alt="image.png|500"><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211613960.png" alt="image.png|500"></p><hr><h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h2><h3 id="Identity-Mapping-by-Shortcuts"><a href="#Identity-Mapping-by-Shortcuts" class="headerlink" title="Identity Mapping by Shortcuts"></a>Identity Mapping by Shortcuts</h3><p>$$y=F(x, \left{ W_{i}\right})+x$$</p><hr><p>$$y=F(x, \left{ W_{i}\right})+W_{s}x$$</p><blockquote><p>若残差块输入输出维度一致，则直接短接即可；<br>   若唯独不一致，则对输入进行降维增维处理将输入输出维度统一。</p></blockquote><h3 id="网络架构"><a href="#网络架构" class="headerlink" title="网络架构"></a>网络架构</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211621589.png" alt="image.png|450"></p><blockquote><p>实现为等维直接短接，虚线为异维进行 A (0 填充) /B（投影快捷映射）</p></blockquote><hr><h2 id="实验-3"><a href="#实验-3" class="headerlink" title="实验"></a>实验</h2><h3 id="ImageNet"><a href="#ImageNet" class="headerlink" title="ImageNet"></a>ImageNet</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211631231.png" alt="image.png"></p><h3 id="CIFAR-10"><a href="#CIFAR-10" class="headerlink" title="CIFAR-10"></a>CIFAR-10</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211631353.png" alt="image.png|450"><br><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211632281.png" alt="image.png"><br>上图左边指的是 Plain Net, 然而 deeper 的时候，会出现明显的 <strong>degradation</strong>。当深度达到 100+的时候，plain Net 的错误率达到了 60%以上。<br>上图中间这是 ResNet，可以看到当 deeper 的时候，错误率也在降低，并没有出现所谓的 degradation。<br>然而右边则显示 <strong>1202 layers</strong> 的 ResNet 的错误率比 <strong>101 layers</strong> 的<strong>错误率高</strong>，作者认为这<strong>不是 degradation 导致</strong>，而是由于这么<strong>大的参数量在 cifar 10 这个小数据集上过拟合</strong>导致。</p><hr><h2 id="重点总结-2"><a href="#重点总结-2" class="headerlink" title="重点总结"></a>重点总结</h2><h3 id="1-残差块"><a href="#1-残差块" class="headerlink" title="1. 残差块"></a>1. 残差块</h3><p>作者发现，当加深模型深度时，模型的测试效果没有变好，反而变差。不符合所想的结果，因为浅层的网络应该是深层网络的一个子集，深层网络不应该比浅层网络表现的不好。然而实验的结果表明，当在浅层网络后加恒等映射层，深层网络的效果反而没有浅层网络好。为什么会出现这种原因呢？作者猜想，可能是因为深层网络难以训练。那么为什么会难以训练呢？可能是因为深层网络的最后面的层难以学习到恒等映射，因为浅层网络已经有很好的表现效果了，最后面的层如果找不到更好的表示效果就需要学习恒等映射，而让网络去学习恒等映射是很困难的。</p><blockquote><p>为了解决网络学习恒等映射困难的问题，作者就想，既然学习恒等映射困难，我们就让网络学习 $f(x)=0$ 这个映射。也就引出了参差学习块。</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200221174711860.png" alt="20200221174711860.png|400"><br>正常网络的输入是 x ，输出是 f (x)，如果我们要学习恒等映射，也就是让网络的部分学会 f (x)=x，即图中 f (x) 的部分学会一个 f (x) = x 的映射关系，但是我们说直接让网络去学习恒等映射很困难，怎么办？</p><blockquote><p>假设网络的输出是 h (x)，那么不加 shortcut connection 的网络的输出就是 h (x)=f (x)=x，为了让网络更好拟合恒等映射，我们让 h (x)=f (x)+x，那么我们看网络要学习的映射 f (x)，就变为了 f (x)=h (x)−x，这时我们发现，如果直接让 f (x)=0，那么 h (x)=x，也就是说我们让网络输出的结果和恒等映射相同，而网络只学习了 f (x)=0 这个映射，这个映射要比 f (x)=x 恒等映射更好学习，即模型会更好训练，而不受深层的影响，因为深层中多余的层我们可以都学恒等映射，最起码结果不会比浅层的结果差。然而实验结果表明，加上 shortcut connection 的深层网络比不加 shortcut connection 的浅层网络效果还好，这也就说明了深层网络所能提取的信息更高，抽象能力更强。</p></blockquote><h3 id="2-恒等快捷映射和投影快捷映射"><a href="#2-恒等快捷映射和投影快捷映射" class="headerlink" title="2. 恒等快捷映射和投影快捷映射"></a>2. 恒等快捷映射和投影快捷映射</h3><p>当 shortcut 的输入通道数和输出通道数相同时，我们可以使用恒等映射即 $f (x)=x$，也就是将 shortcut 的输出直接加上输入即可（恒等快捷映射）。<br>但是，当 shortcut connection 的输入不等于输出的时候怎么办？（两种方法）</p><blockquote><p>① 将输入数据扩充维度，多余的维度的数据用 0 填充。<br>② 使用 1 x 1 的卷积扩充维度（投影快捷映射）</p><p>我们实际上有三种方式组合：<br>① 零填充快捷连接用来增加维度，所有的快捷连接是没有参数的。<br>② 投影快捷连接用来增加维度，其它的快捷连接是恒等的。<br>③ 所有的快捷连接都是投影。<br>以上三种情况都比没有加 shortcut connection 的好，效果 ③ &gt; ② &gt; ①，但是 ③ 的计算量太大，提升的效果也不大，所以我们一般不用，我们一般用的最多的是 ②。</p></blockquote><p>投影快捷映射：</p><ul><li>当输入和输出的维度不匹配时，使用一个额外的卷积层来进行维度匹配。</li><li>可以用于解决深度残差网络中的维度不匹配问题，从而提高网络的性能。</li><li>在 ResNet 中，投影快捷映射是指使用一个 1 x 1 的卷积层来进行维度匹配。<h3 id="3-Deeper-Bottleneck-Architectures"><a href="#3-Deeper-Bottleneck-Architectures" class="headerlink" title="3. Deeper Bottleneck Architectures"></a>3. Deeper Bottleneck Architectures</h3><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202308211610964.png" alt="image.png"><blockquote><p>先用 1 x 1 降维，3 x 3 进行卷积，再用 1 x 1 进行升维。<br> 事实上，deeper 左边这种结构也能获得很好的效果。那么为什么要用右边这种结构呢？ 主要是源自于<strong>practical</strong>，因为<strong>左边</strong>这种结构在<strong>训练时间上要比右边结构长的多</strong>。</p></blockquote></li></ul><p align="justify">当换成上图右边这种 Bottleneck 结构的时候，可以发现 152 层的 ResNet 竟然比 VGG 16/19 都要少的复杂度</p>]]></content>
    
    
    <summary type="html">some overview about CV classical papers。</summary>
    
    
    
    <category term="科研学习" scheme="https://alleyf.github.io/categories/%E7%A7%91%E7%A0%94%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="CV" scheme="https://alleyf.github.io/tags/CV/"/>
    
  </entry>
  
  <entry>
    <title>algorithm</title>
    <link href="https://alleyf.github.io/2023/03/56d5f0383564.html"/>
    <id>https://alleyf.github.io/2023/03/56d5f0383564.html</id>
    <published>2023-03-17T11:06:15.000Z</published>
    <updated>2023-08-27T13:27:36.559Z</updated>
    
    <content type="html"><![CDATA[<ol><li>[[#1.1递归|1.1递归]]</li><li>[[#2.1 两数之和|2.1 两数之和]]</li><li>[[#2.2 合并两个有序数组|2.2 合并两个有序数组]]</li><li>[[#2.3 移动零|2.3 移动零]]</li><li>[[#2.4 找到所有数组中消失的数字|2.4 找到所有数组中消失的数字]]</li><li>[[#2.1 枚举|2.1 枚举]]<ol><li>[[#2.1 枚举#1. abc|1. abc]]</li><li>[[#2.1 枚举#2. 反序数|2. 反序数]]</li><li>[[#2.1 枚举#3. 对称平方数|3. 对称平方数]]</li><li>[[#2.1 枚举#4. 与 7 无关的数|4. 与 7 无关的数]]</li><li>[[#2.1 枚举#5. 百鸡问题|5. 百鸡问题]]</li><li>[[#2.1 枚举#6. Old Bill|6. Old Bill]]</li></ol></li><li>[[#2.2 模拟|2.2 模拟]]<ol><li>[[#2.2 模拟#1. 图形排版|1. 图形排版]]<ol><li>[[#1. 图形排版#1. 输出梯形|1. 输出梯形]]</li><li>[[#1. 图形排版#2. 叠筐|2. 叠筐]]</li></ol></li><li>[[#2.2 模拟#2. 日期|2. 日期]]<ol><li>[[#2. 日期#1. 今天是第几天|1. 今天是第几天]]</li><li>[[#2. 日期#2. 打印日期|2. 打印日期]]</li><li>[[#2. 日期#3. 日期累加|3. 日期累加]]<ol><li>[[#3. 日期累加#套路|套路]]</li><li>[[#3. 日期累加#技巧|技巧]]</li><li>[[#3. 日期累加#代码|代码]]</li></ol></li></ol></li><li>[[#2.2 模拟#3. 其他|3. 其他]]<ol><li>[[#3. 其他#1. 剩余的树|1. 剩余的树]]</li><li>[[#3. 其他#2. 手机键盘|2. 手机键盘]]</li><li>[[#3. 其他#3. xxx_定律|3. xxx_定律]]</li></ol></li></ol></li><li>[[#3.1 排序|3.1 排序]]<ol><li>[[#3.1 排序#1. 排序|1. 排序]]<ol><li>[[#1. 排序#大部分排序方法|大部分排序方法]]</li></ol></li><li>[[#3.1 排序#2. 成绩排序|2. 成绩排序]]</li><li>[[#3.1 排序#3. 成绩排序 2|3. 成绩排序 2]]</li></ol></li><li>[[#3.2 查找|3.2 查找]]<ol><li>[[#3.2 查找#1. 找 x|1. 找 x]]</li><li>[[#3.2 查找#2. 查找|2. 查找]]</li><li>[[#3.2 查找#3. extrenum_index|3. extrenum_index]]</li><li>[[#3.2 查找#4. 找位置|4. 找位置]]</li></ol></li><li>[[#4.1 字符串处理|4.1 字符串处理]]<ol><li>[[#4.1 字符串处理#1. <a href="http://t.cn/Ai8by9vW">特殊乘法</a>|1. <a href="http://t.cn/Ai8by9vW">特殊乘法</a>]]</li><li>[[#4.1 字符串处理#2. <a href="http://t.cn/Ai8bGaIx">密码翻译</a>|2. <a href="http://t.cn/Ai8bGaIx">密码翻译</a>]]</li><li>[[#4.1 字符串处理#3. <a href="http://t.cn/Ai8bih2z">简单密码</a>|3. <a href="http://t.cn/Ai8bih2z">简单密码</a>]]</li><li>[[#4.1 字符串处理#4. <a href="http://t.cn/Ai8fvq4I">统计字符</a>|4. <a href="http://t.cn/Ai8fvq4I">统计字符</a>]]</li><li>[[#4.1 字符串处理#5. <a href="http://t.cn/Ai8VB72e">字母统计</a>|5. <a href="http://t.cn/Ai8VB72e">字母统计</a>]]</li></ol></li><li>[[#4.2 字符串匹配|4.2 字符串匹配]]</li><li>[[#5.1 向量|5.1 向量]]<ol><li>[[#5.1 向量#<a href="http://t.cn/AiKEyQWW">完数与盈数</a>|<a href="http://t.cn/AiKEyQWW">完数与盈数</a>]]</li></ol></li><li>[[#5.2 队列|5.2 队列]]</li><li>[[#5.3 栈|5.3 栈]]</li><li>[[#简单题|简单题]]<ol><li>[[#简单题#1.<a href="https://www.nowcoder.com/practice/6fe361ede7e54db1b84adc81d09d8524">数组中重复的数字</a>|1.<a href="https://www.nowcoder.com/practice/6fe361ede7e54db1b84adc81d09d8524">数组中重复的数字</a>]]</li><li>[[#简单题#2.<a href="https://www.nowcoder.com/practice/0e26e5551f2b489b9f58bc83aa4b6c68">替换空格</a>|2.<a href="https://www.nowcoder.com/practice/0e26e5551f2b489b9f58bc83aa4b6c68">替换空格</a>]]</li><li>[[#简单题#3.<a href="https://www.nowcoder.com/practice/d0267f7f55b3412ba93bd35cfa8e8035">从尾到头打印链表</a>|3.<a href="https://www.nowcoder.com/practice/d0267f7f55b3412ba93bd35cfa8e8035">从尾到头打印链表</a>]]</li><li>[[#简单题#4.<a href="https://www.nowcoder.com/practice/54275ddae22f475981afa2244dd448c6">用两个栈实现队列</a>|4.<a href="https://www.nowcoder.com/practice/54275ddae22f475981afa2244dd448c6">用两个栈实现队列</a>]]</li></ol></li></ol><h1 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h1><hr><h2 id="1-1递归"><a href="#1-1递归" class="headerlink" title="1.1递归"></a>1.1递归</h2><p>***自顶向下递归<br>自底向上迭代</p><blockquote><p>问题特点</p><ol><li>一个问题的解可以<strong>分解为几个子问题</strong>的解。</li><li>这个问题与分解之后的子问题，<strong>除了数据规模不同，求解思路完全一样</strong>。</li><li><strong>存在基线终止条件</strong>。</li></ol></blockquote><p>爬楼梯问题：<br><img src="https://s2.loli.net/2023/05/22/tcH9QJ726li3Rng.png" alt="image.png|200"></p><p>解法 1：纯递归</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">private</span> Map&lt;Integer , Integer&gt; storeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">climbStairs</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br><span class="hljs-keyword">if</span>(n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">if</span>(n == <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">return</span> climbStairs(n-<span class="hljs-number">1</span>)+climbStairs(n-<span class="hljs-number">2</span>);<br><br></code></pre></td></tr></table></figure><p>解法 2：递归并采用 HashMap 存储已求值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">private</span> Map&lt;Integer , Integer&gt; storeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">climbStairs</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br><span class="hljs-keyword">if</span>(n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">if</span>(n == <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != storeMap.get(n))<br><span class="hljs-keyword">return</span> storeMap.get(n);<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> climbStairs(n-<span class="hljs-number">1</span>)+climbStairs(n-<span class="hljs-number">2</span>);<br>storeMap.put(n,result);<br><span class="hljs-keyword">return</span> result;<br><br></code></pre></td></tr></table></figure><p>解法 3：迭代自底向上循环累加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">climbStairs</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br><span class="hljs-keyword">if</span>(n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">if</span>(n == <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">pre</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">prePre</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">for</span>(inti=<span class="hljs-number">3</span>;i&lt;=n;++i)&#123;<br>result = pre + prePre;<br>prePre = pre;<br>pre = result;<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>总结：</p><blockquote><p><span style="background:rgba(240, 107, 5, 0.2)">对于多次重复出现的值，可以通过 HashMap 存储，后续先扫描 HashMap 是否存在再做行动。</span></p></blockquote><h1 id="2-LeetCode"><a href="#2-LeetCode" class="headerlink" title="2. LeetCode"></a>2. LeetCode</h1><hr><h2 id="2-1-两数之和"><a href="#2-1-两数之和" class="headerlink" title="2.1 两数之和"></a>2.1 两数之和</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">import</span> java.util.HashMap;  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;  <br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] <span class="hljs-built_in">twoSum</span>(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;  <br>HashMap&lt;Integer, Integer&gt; storeNums = <span class="hljs-keyword">new</span> <span class="hljs-built_in">HashMap</span>&lt;Integer, Integer&gt;(nums.length);  <br><span class="hljs-type">int</span>[] results = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">2</span>];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;  <br><span class="hljs-type">int</span> residue = target - nums[i];  <br>Integer index = storeNums.<span class="hljs-built_in">get</span>(residue);  <br><span class="hljs-keyword">if</span> (index != null) &#123;  <br>results[<span class="hljs-number">0</span>] = index;  <br>results[<span class="hljs-number">1</span>] = i;  <br><span class="hljs-keyword">break</span>;  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br>storeNums.<span class="hljs-built_in">put</span>(nums[i], i);  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">return</span> results;  <br>&#125;  <br>  <br>&#125;;  <br><span class="hljs-comment">//runtime:1 ms  </span><br><span class="hljs-comment">//memory:42.6 MB</span><br><br></code></pre></td></tr></table></figure><h2 id="2-2-合并两个有序数组"><a href="#2-2-合并两个有序数组" class="headerlink" title="2.2 合并两个有序数组"></a>2.2 合并两个有序数组</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//leetcode submit region begin(Prohibit modification and deletion)  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;  <br><span class="hljs-keyword">public</span>:  <br><span class="hljs-comment">// 方法1（直插排序法）  </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums1, <span class="hljs-type">int</span> m, vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums2, <span class="hljs-type">int</span> n)</span> </span>&#123;  <br><span class="hljs-keyword">auto</span> iter1 = nums1.<span class="hljs-built_in">begin</span>()+m;  <br><span class="hljs-keyword">auto</span> iter2 = nums1.<span class="hljs-built_in">end</span>();  <br>nums1.<span class="hljs-built_in">erase</span>(iter1,iter2);  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br>nums1.<span class="hljs-built_in">push_back</span>(nums2[i]);  <br>&#125;  <br><span class="hljs-comment">// nums1.erase(iter1,iter2);  </span><br><span class="hljs-comment">// nums1.insert(nums1.end(),nums2.begin(),nums2.end());  </span><br><span class="hljs-built_in">sort</span>(nums1.<span class="hljs-built_in">begin</span>(), nums1.<span class="hljs-built_in">end</span>());  <br>&#125;  <br><span class="hljs-comment">//方法2（前向双指针法）  </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums1, <span class="hljs-type">int</span> m, vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums2, <span class="hljs-type">int</span> n)</span> </span>&#123;  <br><span class="hljs-type">int</span> l = m+n,j=<span class="hljs-number">0</span>,index1 = <span class="hljs-number">0</span>,index2 = <span class="hljs-number">0</span>;  <br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">temp</span><span class="hljs-params">(l)</span></span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; l; ++i) &#123;  <br><span class="hljs-keyword">if</span> (index1&gt;=m)&#123;  <br>temp[i]=nums2[index2++];  <br>&#125;  <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(index2&gt;=n)&#123;  <br>temp[i]=nums1[index1++];  <br>&#125;  <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(nums1[index1]&lt;nums2[index2])&#123;  <br>temp[i]=nums1[index1++];  <br>&#125;  <br><span class="hljs-keyword">else</span> &#123;  <br>temp[i]=nums2[index2++];  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> item:temp)&#123;  <br>nums1[j++]=item;  <br>&#125;  <br>&#125;  <br><span class="hljs-comment">//方法3（反向双指针）  </span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums1, <span class="hljs-type">int</span> m, vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums2, <span class="hljs-type">int</span> n)</span> </span>&#123;  <br><span class="hljs-type">int</span> l = m+n,index1 = m<span class="hljs-number">-1</span>,index2 = n<span class="hljs-number">-1</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = l<span class="hljs-number">-1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;  <br><span class="hljs-keyword">if</span> (index1&lt;<span class="hljs-number">0</span>)&#123;  <br>nums1[i]=nums2[index2--];  <br>&#125;  <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(index2&lt;<span class="hljs-number">0</span>)&#123;  <br><span class="hljs-comment">// nums1[i]=nums1[index1--];  </span><br><span class="hljs-keyword">break</span>;  <br>&#125;  <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(nums1[index1]&gt;=nums2[index2])&#123;  <br>nums1[i]=nums1[index1--];  <br>&#125;  <br><span class="hljs-keyword">else</span> &#123;  <br>nums1[i]=nums2[index2--];  <br>&#125;  <br>&#125;  <br>&#125;  <br>&#125;;  <br><span class="hljs-comment">//leetcode submit region end(Prohibit modification and deletion)</span><br><br></code></pre></td></tr></table></figure><h2 id="2-3-移动零"><a href="#2-3-移动零" class="headerlink" title="2.3 移动零"></a>2.3 移动零</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//双指针</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;  <br><span class="hljs-keyword">public</span>:  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">moveZeroes</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;  <br><span class="hljs-keyword">if</span>(!nums.<span class="hljs-built_in">size</span>())&#123;  <br><span class="hljs-keyword">return</span>;  <br>&#125;  <br><span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> item:nums)&#123;  <br><span class="hljs-keyword">if</span> (item!=<span class="hljs-number">0</span>)  <br>nums[j++]=item;  <br>&#125;  <br><span class="hljs-keyword">while</span> (j&lt;nums.<span class="hljs-built_in">size</span>())&#123;  <br>nums[j++]=<span class="hljs-number">0</span>;  <br>&#125;  <br>&#125;  <br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="2-4-找到所有数组中消失的数字"><a href="#2-4-找到所有数组中消失的数字" class="headerlink" title="2.4 找到所有数组中消失的数字"></a>2.4 找到所有数组中消失的数字</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//数组 哈希表</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span>  </span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;  <br><span class="hljs-keyword">public</span>:  <br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">findDisappearedNumbers</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;  <br>vector&lt;<span class="hljs-type">int</span>&gt; disnums;  <br><span class="hljs-comment">// for(int item:nums)&#123;  </span><br><span class="hljs-comment">// item = item&gt;0 ? item : -item;  </span><br><span class="hljs-comment">// nums[item-1] = nums[item-1]&gt;0 ? nums[item-1] : -nums[item-1];  </span><br><span class="hljs-comment">// nums[item-1]=-nums[item-1];  </span><br><span class="hljs-comment">// &#125;  </span><br><span class="hljs-comment">// for(int i=0;i&lt;nums.size();i++)&#123;  </span><br><span class="hljs-comment">// if (nums[i]&gt;0)  </span><br><span class="hljs-comment">// disnums.push_back(i+1);  </span><br><span class="hljs-comment">// &#125;  </span><br><span class="hljs-type">int</span> n = nums.<span class="hljs-built_in">size</span>();  <br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> item:nums)&#123;  <br><span class="hljs-type">int</span> x = (item<span class="hljs-number">-1</span>)%n;  <br>nums[x]+=n;  <br>&#125;  <br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;  <br><span class="hljs-keyword">if</span> (nums[i]&lt;=n)  <br>disnums.<span class="hljs-built_in">push_back</span>(i+<span class="hljs-number">1</span>);  <br>&#125;  <br><span class="hljs-keyword">return</span> disnums;  <br>&#125;  <br>&#125;;<br></code></pre></td></tr></table></figure><h1 id="王道机试指南"><a href="#王道机试指南" class="headerlink" title="王道机试指南"></a>王道机试指南</h1><hr><h1 id="第二章暴力求解"><a href="#第二章暴力求解" class="headerlink" title="第二章暴力求解"></a>第二章暴力求解</h1><h2 id="2-1-枚举"><a href="#2-1-枚举" class="headerlink" title="2.1 枚举"></a>2.1 枚举</h2><h3 id="1-abc"><a href="#1-abc" class="headerlink" title="1. abc"></a>1. abc</h3><p><strong>三重循环暴力求解</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> a, b, c;<br>    <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt;= <span class="hljs-number">9</span>; a++) &#123;<br>        <span class="hljs-keyword">for</span> (b = <span class="hljs-number">0</span>; b &lt;= <span class="hljs-number">9</span>; b++) &#123;<br>            <span class="hljs-keyword">for</span> (c = <span class="hljs-number">0</span>; c &lt;= <span class="hljs-number">9</span>; c++) &#123;<br>                <span class="hljs-keyword">if</span> ((a * <span class="hljs-number">100</span> + b * <span class="hljs-number">10</span> + c) + (b * <span class="hljs-number">100</span> + c * <span class="hljs-number">10</span> + c) == <span class="hljs-number">532</span>) &#123;<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d %d\n&quot;</span>, a, b, c);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-反序数"><a href="#2-反序数" class="headerlink" title="2. 反序数"></a>2. 反序数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br>  <br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1000</span>; <span class="hljs-number">9</span> * i &lt;= <span class="hljs-number">9999</span>; i++) &#123;<br><br>        <span class="hljs-type">int</span> k = <span class="hljs-number">9</span> * i;<br><br>        <span class="hljs-keyword">if</span> (k / <span class="hljs-number">1000</span> == i % <span class="hljs-number">10</span> &amp;&amp; k % <span class="hljs-number">1000</span> / <span class="hljs-number">100</span> == i % <span class="hljs-number">100</span> / <span class="hljs-number">10</span> &amp;&amp;<br><br>                k % <span class="hljs-number">100</span> / <span class="hljs-number">10</span> == i % <span class="hljs-number">1000</span> / <span class="hljs-number">100</span> &amp;&amp;<br><br>                k % <span class="hljs-number">10</span> == i / <span class="hljs-number">1000</span>) &#123;<br><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, i);<br><br>        &#125;<br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-对称平方数"><a href="#3-对称平方数" class="headerlink" title="3. 对称平方数"></a>3. 对称平方数</h3><p>判断一个数是否为对称数核心:<br><font color="#ff0000">while (j) {</font><br><font color="#ff0000">sum = sum * 10 + j % 10;</font><br><font color="#ff0000">j /= 10;</font><br><font color="#ff0000">}</font><br><span style="background:#affad1">j 为对称数则 sum 等于 j*j </span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br>  <br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;i &lt;= <span class="hljs-number">256</span> ; i++) &#123;<br><br>        <span class="hljs-type">int</span> j = i * i, sum = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">while</span>(j) &#123;<br><br>            sum = sum * <span class="hljs-number">10</span> + j % <span class="hljs-number">10</span>;<br><br>            j /= <span class="hljs-number">10</span>;<br><br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(sum == i * i) &#123;<br><br>            cout &lt;&lt; i &lt;&lt; endl;<br><br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-与-7-无关的数"><a href="#4-与-7-无关的数" class="headerlink" title="4. 与 7 无关的数"></a>4. 与 7 无关的数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br>  <br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-type">int</span> b, c, x, sum;<br><br>    cin &gt;&gt; x;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= x; ++i) &#123;<br><br>        b = i % <span class="hljs-number">10</span>;<br><br>        c = (i / <span class="hljs-number">10</span>) % <span class="hljs-number">10</span>;<br><br>        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">7</span> != <span class="hljs-number">0</span> &amp;&amp; b != <span class="hljs-number">7</span> &amp;&amp; c != <span class="hljs-number">7</span>) &#123;<br><br>            sum = sum + i * i;<br><br>        &#125;<br><br>    &#125;<br><br>    cout &lt;&lt; sum &lt;&lt; endl;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="5-百鸡问题"><a href="#5-百鸡问题" class="headerlink" title="5. 百鸡问题"></a>5. 百鸡问题</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br>  <br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-type">int</span> n;<br><br>    cin &gt;&gt; n;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt;= <span class="hljs-number">100</span>; ++x) &#123;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt;= <span class="hljs-number">100</span>; ++y) &#123;<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> z = <span class="hljs-number">0</span>; z &lt;= <span class="hljs-number">100</span>; ++z) &#123;<br><br>                <span class="hljs-keyword">if</span> (x + y + z == <span class="hljs-number">100</span> &amp;&amp; ((<span class="hljs-number">5</span> * x + <span class="hljs-number">3</span> * y + z / <span class="hljs-number">3.0</span>) &lt;= n)) &#123;<br><br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;x=%d,y=%d,z=%d\n&quot;</span>, x, y, z);<br><br>                &#125;<br><br>            &#125;<br><br>        &#125;<br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="6-Old-Bill"><a href="#6-Old-Bill" class="headerlink" title="6. Old Bill"></a>6. Old Bill</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;title.h&quot;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> n, x, y, z;  <br>vector&lt;<span class="hljs-type">int</span>&gt; buff;  <br>cin &gt;&gt; n;  <br>cin &gt;&gt; x &gt;&gt; y &gt;&gt; z;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">100000.0</span> / n; ++i) &#123;  <br><span class="hljs-type">int</span> sum = i * n;  <br><span class="hljs-keyword">if</span> (sum &lt; <span class="hljs-number">10000</span>)  <br><span class="hljs-keyword">continue</span>;  <br><span class="hljs-type">int</span> a = sum % <span class="hljs-number">10</span>;  <br><span class="hljs-type">int</span> z1 = sum / <span class="hljs-number">10</span> % <span class="hljs-number">10</span>;  <br><span class="hljs-type">int</span> y1 = sum / <span class="hljs-number">100</span> % <span class="hljs-number">10</span>;  <br><span class="hljs-type">int</span> x1 = sum / <span class="hljs-number">1000</span> % <span class="hljs-number">10</span>;  <br><span class="hljs-type">int</span> b = sum / <span class="hljs-number">10000</span>;  <br><span class="hljs-keyword">if</span> (x == x1 &amp;&amp; y == y1 &amp;&amp; z == z1) &#123;  <br>buff.<span class="hljs-built_in">push_back</span>(b);  <br>buff.<span class="hljs-built_in">push_back</span>(a);  <br>buff.<span class="hljs-built_in">push_back</span>(i);  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">if</span> (buff.<span class="hljs-built_in">empty</span>())  <br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0&quot;</span>);  <br><span class="hljs-keyword">else</span> &#123;  <br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d %d\n&quot;</span>, buff[buff.<span class="hljs-built_in">size</span>() - <span class="hljs-number">3</span>], buff[buff.<span class="hljs-built_in">size</span>() - <span class="hljs-number">2</span>], buff[buff.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>]);  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>方法 2：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n, x, y, z;<span class="hljs-comment">//n火鸡数、xyz原价格中间三位</span><br>    <span class="hljs-keyword">while</span>(~<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;n))&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d %d&quot;</span>, &amp;x, &amp;y, &amp;z);<br>        <span class="hljs-type">int</span> tot, f = <span class="hljs-number">0</span>;<span class="hljs-comment">//tot原价格、f标记是否存在能够整除火鸡数n的价格</span><br>        <span class="hljs-comment">//这里选择从9枚举到1是为了第一次输出就是最高价格</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> a = <span class="hljs-number">9</span>; a &gt;= <span class="hljs-number">1</span>; a--)&#123;<span class="hljs-comment">//a控制原价格的万位[1,9]</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> b = <span class="hljs-number">9</span>; b &gt;= <span class="hljs-number">0</span>; b--)&#123;<span class="hljs-comment">//b控制原价格的个位[0,9]</span><br>                tot = a * <span class="hljs-number">10000</span> + x * <span class="hljs-number">1000</span> + y * <span class="hljs-number">100</span> + z * <span class="hljs-number">10</span> + b;<br>                <span class="hljs-keyword">if</span>(tot % n == <span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//如果原价格tot能够整除火鸡数n</span><br>                    f = <span class="hljs-number">1</span>;<span class="hljs-comment">//则将整除标记置1</span><br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d %d\n&quot;</span>, a, b, tot / n);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;          <br>            &#125;<br>            <span class="hljs-keyword">if</span>(f) <span class="hljs-keyword">break</span>;<span class="hljs-comment">//如果已经整除，则跳出枚举</span><br>        &#125;<br>        <span class="hljs-keyword">if</span>(!f) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0\n&quot;</span>);<span class="hljs-comment">//如果没有可以整除的价格，则打印0</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="2-2-模拟"><a href="#2-2-模拟" class="headerlink" title="2.2 模拟"></a>2.2 模拟</h2><h3 id="1-图形排版"><a href="#1-图形排版" class="headerlink" title="1. 图形排版"></a>1. 图形排版</h3><h4 id="1-输出梯形"><a href="#1-输出梯形" class="headerlink" title="1. 输出梯形"></a>1. 输出梯形</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;title.h&quot;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> h;  <br><span class="hljs-keyword">while</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;h) != EOF) <span class="hljs-comment">//高度h  </span><br>&#123;  <br><span class="hljs-type">int</span> b = h + <span class="hljs-number">2</span> * (h - <span class="hljs-number">1</span>), t = h; <span class="hljs-comment">//下底边长，上底边长  </span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= h; i++) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= b; j++) &#123;  <br><span class="hljs-keyword">if</span> (j &gt; b - t - <span class="hljs-number">2</span> * (i - <span class="hljs-number">1</span>))  <br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;*&quot;</span>);  <br><span class="hljs-keyword">else</span>  <br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; &quot;</span>);  <br>&#125;  <br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="2-叠筐"><a href="#2-叠筐" class="headerlink" title="2. 叠筐"></a>2. 叠筐</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n;<br>    <span class="hljs-type">char</span> a,b;<br>    <span class="hljs-type">char</span> S[<span class="hljs-number">80</span>][<span class="hljs-number">80</span>];<br>    <span class="hljs-keyword">while</span>(cin&gt;&gt;n&gt;&gt;a&gt;&gt;b)&#123;<br>        <span class="hljs-type">int</span> mid=n/<span class="hljs-number">2</span>;<br>        <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br>        S[mid][mid]=a;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=mid;i++)&#123;<br>                <span class="hljs-keyword">if</span>(flag)&#123;<br>                    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>;j++)&#123;<br>                    S[mid-i][mid-i+j]=b;<br>                    S[mid+i][mid-i+j]=b;<br>                    S[mid-i+j][mid-i]=b;<br>                    S[mid-i+j][mid+i]=b;<br>                    flag=<span class="hljs-literal">false</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>;j++)&#123;<br>                    S[mid-i][mid-i+j]=a;<br>                    S[mid+i][mid-i+j]=a;<br>                    S[mid-i+j][mid-i]=a;<br>                    S[mid-i+j][mid+i]=a;<br>                    flag=<span class="hljs-literal">true</span>;<br>                    &#125;<br>                &#125;<br>        &#125;<br>        S[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]=S[<span class="hljs-number">0</span>][n<span class="hljs-number">-1</span>]=S[n<span class="hljs-number">-1</span>][<span class="hljs-number">0</span>]=S[n<span class="hljs-number">-1</span>][n<span class="hljs-number">-1</span>]=<span class="hljs-string">&#x27; &#x27;</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++)<br>                    cout&lt;&lt;S[i][j];<br>                cout&lt;&lt;endl;<br>            &#125;<br> <br>            cout&lt;&lt;endl;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="2-日期"><a href="#2-日期" class="headerlink" title="2. 日期"></a>2. 日期</h3><h4 id="1-今天是第几天"><a href="#1-今天是第几天" class="headerlink" title="1. 今天是第几天"></a>1. 今天是第几天</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//</span><br><br><span class="hljs-comment">// Created by alleyf on 2023/6/23.</span><br><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isLeap</span><span class="hljs-params">(<span class="hljs-type">int</span> year)</span> </span>&#123;<br><br>    <span class="hljs-keyword">return</span> (year % <span class="hljs-number">4</span> == <span class="hljs-number">0</span> &amp;&amp; year % <span class="hljs-number">100</span> != <span class="hljs-number">0</span>) || year % <span class="hljs-number">400</span> == <span class="hljs-number">0</span>;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>  <br><br>    <span class="hljs-type">int</span> year, month, day;<br><br>    <span class="hljs-keyword">while</span> (cin &gt;&gt; year &gt;&gt; month &gt;&gt; day) &#123;<br><br>        unordered_map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; monthDay&#123;<br><br>            &#123;<span class="hljs-number">1</span>, <span class="hljs-number">31</span>&#125;, &#123;<span class="hljs-number">2</span>, <span class="hljs-number">28</span>&#125;, &#123;<span class="hljs-number">3</span>, <span class="hljs-number">31</span>&#125;, &#123;<span class="hljs-number">4</span>, <span class="hljs-number">30</span>&#125;, &#123;<span class="hljs-number">5</span>, <span class="hljs-number">31</span>&#125;, &#123;<span class="hljs-number">6</span>, <span class="hljs-number">30</span>&#125;, &#123;<span class="hljs-number">7</span>, <span class="hljs-number">31</span>&#125;, &#123;<span class="hljs-number">8</span>, <span class="hljs-number">31</span>&#125;, &#123;<span class="hljs-number">9</span>, <span class="hljs-number">30</span>&#125;, &#123;<span class="hljs-number">10</span>, <span class="hljs-number">31</span>&#125;, &#123;<span class="hljs-number">11</span>, <span class="hljs-number">30</span>&#125;, &#123;<span class="hljs-number">12</span>, <span class="hljs-number">31</span>&#125;<br><br>        &#125;;<br><br>        <span class="hljs-type">int</span> sum = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isLeap</span>(year)) &#123;<br><br>            monthDay[<span class="hljs-number">2</span>] = <span class="hljs-number">29</span>;<br><br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; month; i++) &#123;<br><br>            sum += monthDay[i];<br><br>        &#125;<br><br>        sum += day;<br><br>        cout &lt;&lt; sum &lt;&lt; endl;<br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="2-打印日期"><a href="#2-打印日期" class="headerlink" title="2. 打印日期"></a>2. 打印日期</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/23.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isLeap</span><span class="hljs-params">(<span class="hljs-type">int</span> year)</span></span>&#123;  <br><span class="hljs-keyword">return</span> (year%<span class="hljs-number">4</span>==<span class="hljs-number">0</span>&amp;&amp;year%<span class="hljs-number">100</span>!=<span class="hljs-number">0</span>)||year%<span class="hljs-number">400</span>==<span class="hljs-number">0</span>;  <br>&#125;  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;  <br>  <br><span class="hljs-type">int</span> year,allday;  <br>string month,day;  <br><span class="hljs-keyword">while</span>(cin&gt;&gt;year&gt;&gt;allday)&#123;  <br>unordered_map&lt;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>&gt; monthDay&#123;  <br>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">31</span>&#125;,&#123;<span class="hljs-number">2</span>,<span class="hljs-number">59</span>&#125;,&#123;<span class="hljs-number">3</span>,<span class="hljs-number">90</span>&#125;,&#123;<span class="hljs-number">4</span>,<span class="hljs-number">120</span>&#125;,&#123;<span class="hljs-number">5</span>,<span class="hljs-number">151</span>&#125;,&#123;<span class="hljs-number">6</span>,<span class="hljs-number">181</span>&#125;,&#123;<span class="hljs-number">7</span>,<span class="hljs-number">212</span>&#125;,&#123;<span class="hljs-number">8</span>,<span class="hljs-number">243</span>&#125;,&#123;<span class="hljs-number">9</span>,<span class="hljs-number">273</span>&#125;,&#123;<span class="hljs-number">10</span>,<span class="hljs-number">304</span>&#125;,&#123;<span class="hljs-number">11</span>,<span class="hljs-number">334</span>&#125;,&#123;<span class="hljs-number">12</span>,<span class="hljs-number">365</span>&#125;  <br>&#125;;  <br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">isLeap</span>(year))&#123;  <br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=<span class="hljs-number">12</span>;i++)&#123;  <br>monthDay[i]+=<span class="hljs-number">1</span>;  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">12</span>;i++)&#123;  <br><span class="hljs-keyword">if</span>(monthDay[i]&gt;=allday)&#123;  <br>month = i&gt;=<span class="hljs-number">10</span> ? <span class="hljs-built_in">to_string</span>(i): (<span class="hljs-string">&#x27;0&#x27;</span>+<span class="hljs-built_in">to_string</span>(i));  <br><span class="hljs-keyword">if</span>(i==<span class="hljs-number">1</span>)&#123;  <br>day = allday&gt;=<span class="hljs-number">10</span> ? <span class="hljs-built_in">to_string</span>(allday): (<span class="hljs-string">&#x27;0&#x27;</span>+<span class="hljs-built_in">to_string</span>(allday));  <br>&#125;<span class="hljs-keyword">else</span> &#123;  <br>allday = allday - monthDay[i - <span class="hljs-number">1</span>];  <br>day = allday&gt;=<span class="hljs-number">10</span> ? <span class="hljs-built_in">to_string</span>(allday): (<span class="hljs-string">&#x27;0&#x27;</span>+<span class="hljs-built_in">to_string</span>(allday));  <br>&#125;  <br><span class="hljs-keyword">break</span>;  <br>&#125;;  <br>&#125;  <br>cout&lt;&lt;year&lt;&lt;<span class="hljs-string">&#x27;-&#x27;</span>&lt;&lt;month&lt;&lt;<span class="hljs-string">&#x27;-&#x27;</span>&lt;&lt;day&lt;&lt;endl;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="3-日期累加"><a href="#3-日期累加" class="headerlink" title="3. 日期累加"></a>3. 日期累加</h4><h5 id="套路"><a href="#套路" class="headerlink" title="套路"></a>套路</h5><p>以前大一的时候面对这个题，就是单纯按月份纯算，算的可谓是焦头烂额。现在学习了新的方法：</p><ol><li>计算是当年的第几天</li><li>这个数值 sum 加上需要累加的天数</li><li>计算进位的多少年，确定年份</li><li>根据剩下的第几天反解出这是几月几日</li><li>输出</li></ol><h5 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h5><p>用到的技巧包括打表、巧用 bool。<br>提前写出来每个月有多少天、每年有多少天。<br>还有判断是否闰年函数，用它能够得到 bool 值，0 和 1 可以分别对应于平年和闰年，所以上面的可以构造成二维数组。</p><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isLeap</span><span class="hljs-params">(<span class="hljs-type">int</span> year)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(year%<span class="hljs-number">400</span>==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(year%<span class="hljs-number">4</span>==<span class="hljs-number">0</span>&amp;&amp;year%<span class="hljs-number">100</span>!=<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> days[<span class="hljs-number">2</span>][<span class="hljs-number">12</span>]=&#123;<br>        &#123;<span class="hljs-number">31</span>,<span class="hljs-number">28</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>&#125;,<br>        &#123;<span class="hljs-number">31</span>,<span class="hljs-number">29</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>&#125;,<br>    &#125;;<br>    <span class="hljs-type">int</span> n;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;n);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> current = <span class="hljs-number">0</span>; current&lt;n; current++)&#123;<br>        <span class="hljs-type">int</span> year,month,date,plus;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d %d %d&quot;</span>,&amp;year,&amp;month,&amp;date,&amp;plus);<br>        <span class="hljs-type">int</span> y=<span class="hljs-number">0</span>,m=<span class="hljs-number">1</span>,d=<span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> sum=<span class="hljs-number">0</span>;<br>        <span class="hljs-type">bool</span> leap = <span class="hljs-built_in">isLeap</span>(year);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;month;i++)&#123;<br>            sum+=days[leap][i<span class="hljs-number">-1</span>];<br>        &#125;<br>        sum+=date;<br>        sum+=plus;<br>        y=year;<br>        <span class="hljs-comment">//逐年增加，直到sum&lt;对应天数</span><br>        <span class="hljs-type">int</span> total[<span class="hljs-number">2</span>] = &#123;<span class="hljs-number">365</span>,<span class="hljs-number">366</span>&#125;;<br>        <span class="hljs-keyword">while</span>(sum&gt;total[<span class="hljs-built_in">isLeap</span>(y)])&#123;<br>            sum-=total[<span class="hljs-built_in">isLeap</span>(y)];<br>            y++;    <br>        &#125; <br>        <span class="hljs-comment">//反解为日期 </span><br>        leap = <span class="hljs-built_in">isLeap</span>(y);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;sum&gt;days[leap][i<span class="hljs-number">-1</span>];i++)&#123;<br>            m++;<br>            sum-=days[leap][i<span class="hljs-number">-1</span>];<br>        &#125;<br>        d=sum;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%04d-%02d-%02d\n&quot;</span>,y,m,d);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-其他"><a href="#3-其他" class="headerlink" title="3. 其他"></a>3. 其他</h3><h4 id="1-剩余的树"><a href="#1-剩余的树" class="headerlink" title="1. 剩余的树"></a>1. 剩余的树</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Created by alleyf on 2023/6/24.</span><br><span class="hljs-comment">//</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> MAXL = <span class="hljs-number">100001</span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">bool</span> flag[MAXL];<br>    <span class="hljs-type">int</span> l, m, num;<br>    cin &gt;&gt; l &gt;&gt; m;<br>    num = l + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= l; ++i) &#123;<br>        flag[i] = <span class="hljs-literal">true</span>;<br>    &#125;;<br>    <span class="hljs-keyword">while</span> (m--) &#123;<br>        <span class="hljs-type">int</span> left, right;<br>        cin &gt;&gt; left &gt;&gt; right;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = left; i &lt;= right; ++i) &#123;<br>            <span class="hljs-keyword">if</span> (flag[i]) &#123;<br>                flag[i] = <span class="hljs-literal">false</span>;<br>                num--;<br>            &#125;<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; num;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><font color="#ff0000">1. 使用一个 l+1 长度的 array 存储所有树的存在状态，初始化所有树的状态为真；</font><br><font color="#ff0000">2. 根据区间循环判每棵树的状态，若为真则修改树输出总数的状态为假并将树的总数自减；</font><br><font color="#ff0000">3. 输出剩余树的数量。</font></p><h4 id="2-手机键盘"><a href="#2-手机键盘" class="headerlink" title="2. 手机键盘"></a>2. 手机键盘</h4><blockquote><ol><li>用一个数组按顺序保存每个字母所需要的时间段</li><li>循环每个输入的字母求和总次数，判断前后两字符是否在一个按键上，若果是则加两个时间段</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/24.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> letter_num[<span class="hljs-number">26</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;;  <br>string s;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; s) &#123;  <br><span class="hljs-type">int</span> allNum = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-built_in">size</span>(); ++i) &#123;  <br>allNum += letter_num[s[i] - <span class="hljs-string">&#x27;a&#x27;</span>];  <br><span class="hljs-keyword">if</span> (i != <span class="hljs-number">0</span> &amp;&amp; s[i] - s[i - <span class="hljs-number">1</span>] == letter_num[s[i] - <span class="hljs-string">&#x27;a&#x27;</span>] - letter_num[s[i - <span class="hljs-number">1</span>] - <span class="hljs-string">&#x27;a&#x27;</span>]) &#123;  <br>allNum += <span class="hljs-number">2</span>;  <br>&#125;  <br>&#125;  <br>cout &lt;&lt; allNum &lt;&lt; endl;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="3-xxx-定律"><a href="#3-xxx-定律" class="headerlink" title="3. xxx_定律"></a>3. xxx_定律</h4><blockquote><p>既可递归实现也可 while 迭代迭代实现。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/24.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">xxx_law</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;num, <span class="hljs-type">int</span> &amp;cnt)</span> </span>&#123;  <br><span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>) &#123;  <br><span class="hljs-keyword">return</span> cnt;  <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (num % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>) &#123;  <br>cnt++;  <br>num = <span class="hljs-number">3</span> * num + <span class="hljs-number">1</span>;  <br>num /= <span class="hljs-number">2</span>;  <br><span class="hljs-keyword">return</span> <span class="hljs-built_in">xxx_law</span>(num, cnt);  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br>cnt++;  <br>num /= <span class="hljs-number">2</span>;  <br><span class="hljs-keyword">return</span> <span class="hljs-built_in">xxx_law</span>(num, cnt);  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> num;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; num) &#123;  <br><span class="hljs-type">int</span> cnt = <span class="hljs-number">0</span>;  <br>cout &lt;&lt; <span class="hljs-built_in">xxx_law</span>(num, cnt) &lt;&lt; endl;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="第三章排序与查找"><a href="#第三章排序与查找" class="headerlink" title="第三章排序与查找"></a>第三章排序与查找</h1><h2 id="3-1-排序"><a href="#3-1-排序" class="headerlink" title="3.1 排序"></a>3.1 排序</h2><h3 id="1-排序"><a href="#1-排序" class="headerlink" title="1. 排序"></a>1. 排序</h3><p><span style="background:#b1ffff">&gt; 冒泡排序：</span><br><span style="background:#b1ffff">&gt;     1. 升序：外层循环递减，内层循环递增直到外层循环变量；</span><br><span style="background:#b1ffff">&gt;     2. 降序：外层循环递增，内层循环从外层循环变量开始递增。</span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/25.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> n;  <br>cin &gt;&gt; n;  <br><span class="hljs-type">int</span> array[n];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br>cin &gt;&gt; array[i];  <br>&#125;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = n; i &gt; <span class="hljs-number">0</span>; --i) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; i; ++j) &#123;  <br><span class="hljs-keyword">if</span> (array[j] &gt; array[j + <span class="hljs-number">1</span>] &amp;&amp; j + <span class="hljs-number">1</span> &lt; n) &#123;  <br><span class="hljs-type">int</span> tmp = array[j + <span class="hljs-number">1</span>];  <br>array[j + <span class="hljs-number">1</span>] = array[j];  <br>array[j] = tmp;  <br>&#125;  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value: array) &#123;  <br>cout &lt;&lt; value &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span>;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="大部分排序方法"><a href="#大部分排序方法" class="headerlink" title="大部分排序方法"></a>大部分排序方法</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//所有基本的排序方法了，桶排序、基数排序暂不写了  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">110</span>, MAX = <span class="hljs-number">1e8</span>;  <br><span class="hljs-type">int</span> a[N];  <br><span class="hljs-type">int</span> n;  <br><span class="hljs-type">int</span> h[N], idx;<span class="hljs-comment">//heap_sort用  </span><br><span class="hljs-type">int</span> tmp[N];<span class="hljs-comment">//merge_sort用  </span><br><span class="hljs-type">int</span> bkt[MAX];<span class="hljs-comment">//counting_sort用  </span><br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buble_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++)  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n - <span class="hljs-number">1</span> - i; j++) &#123;  <br><span class="hljs-keyword">if</span> (a[j] &gt; a[j + <span class="hljs-number">1</span>]) <span class="hljs-built_in">swap</span>(a[j], a[j + <span class="hljs-number">1</span>]);  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">quick_sort</span><span class="hljs-params">(<span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> </span>&#123;  <br><span class="hljs-keyword">if</span> (l &gt;= r) <span class="hljs-keyword">return</span>;  <br><span class="hljs-type">int</span> x = a[(l + r) / <span class="hljs-number">2</span>];  <br><span class="hljs-type">int</span> i = l - <span class="hljs-number">1</span>, j = r + <span class="hljs-number">1</span>;  <br><span class="hljs-keyword">while</span> (i &lt; j) &#123;  <br><span class="hljs-keyword">do</span> i++; <span class="hljs-keyword">while</span> (a[i] &lt; x);  <br><span class="hljs-keyword">do</span> j--; <span class="hljs-keyword">while</span> (a[j] &gt; x);  <br><span class="hljs-keyword">if</span> (i &lt; j) <span class="hljs-built_in">swap</span>(a[i], a[j]);  <br>&#125;  <br><span class="hljs-built_in">quick_sort</span>(l, j);  <br><span class="hljs-built_in">quick_sort</span>(j + <span class="hljs-number">1</span>, r);  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">selection_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) &#123;  <br><span class="hljs-type">int</span> min_pos = i;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = i + <span class="hljs-number">1</span>; j &lt; n; j++)  <br><span class="hljs-keyword">if</span> (a[j] &lt; a[min_pos]) min_pos = j;  <br><span class="hljs-built_in">swap</span>(a[i], a[min_pos]);  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">down</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span> </span>&#123;  <br><span class="hljs-type">int</span> t = u;  <br><span class="hljs-keyword">if</span> (u * <span class="hljs-number">2</span> &lt;= idx &amp;&amp; h[u * <span class="hljs-number">2</span>] &lt; h[t]) t = u * <span class="hljs-number">2</span>;  <br><span class="hljs-keyword">if</span> (u * <span class="hljs-number">2</span> + <span class="hljs-number">1</span> &lt;= idx &amp;&amp; h[u * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] &lt; h[t]) t = u * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;  <br><span class="hljs-keyword">if</span> (t != u) &#123;  <br><span class="hljs-built_in">swap</span>(h[t], h[u]);  <br><span class="hljs-built_in">down</span>(t);  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">heap_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) h[i] = a[i - <span class="hljs-number">1</span>];  <br>idx = n;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = idx / <span class="hljs-number">2</span>; i &gt; <span class="hljs-number">0</span>; i--) <span class="hljs-built_in">down</span>(i);  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;  <br>a[i] = h[<span class="hljs-number">1</span>];  <br>h[<span class="hljs-number">1</span>] = h[idx--];  <br><span class="hljs-built_in">down</span>(<span class="hljs-number">1</span>);  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insertion_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;  <br><span class="hljs-type">int</span> cur_idx = a[i];  <br><span class="hljs-type">int</span> j;  <br><span class="hljs-keyword">for</span> (j = i - <span class="hljs-number">1</span>; j &gt;= <span class="hljs-number">0</span> &amp;&amp; a[j] &gt; cur_idx; j--) &#123;  <br>a[j + <span class="hljs-number">1</span>] = a[j];  <br>&#125;  <br>a[j + <span class="hljs-number">1</span>] = cur_idx;  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">binary_insertion_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;  <br><span class="hljs-type">int</span> cur_idx = a[i];  <br><span class="hljs-type">int</span> l = <span class="hljs-number">0</span>, r = i - <span class="hljs-number">1</span>;  <br><span class="hljs-keyword">while</span> (l &lt; r) &#123;  <br><span class="hljs-type">int</span> mid = (l + r + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;  <br><span class="hljs-keyword">if</span> (a[mid] &lt;= cur_idx) l = mid;  <br><span class="hljs-keyword">else</span> r = mid - <span class="hljs-number">1</span>;  <br>&#125;  <br><span class="hljs-keyword">if</span> (a[l] &gt; cur_idx) l = <span class="hljs-number">-1</span>;  <br><span class="hljs-type">int</span> j;  <br><span class="hljs-keyword">for</span> (j = i - <span class="hljs-number">1</span>; j &gt; l; j--) a[j + <span class="hljs-number">1</span>] = a[j];  <br>a[j + <span class="hljs-number">1</span>] = cur_idx;  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">shell_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> gap = n / <span class="hljs-number">2</span>; gap &gt;= <span class="hljs-number">1</span>; gap /= <span class="hljs-number">2</span>) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = gap; i &lt; n; i++) &#123;  <br><span class="hljs-type">int</span> cur_idx = a[i];  <br><span class="hljs-type">int</span> j;  <br><span class="hljs-keyword">for</span> (j = i - gap; j &gt;= <span class="hljs-number">0</span> &amp;&amp; a[j] &gt; cur_idx; j -= gap) &#123;  <br>a[j + gap] = a[j];  <br>&#125;  <br>a[j + gap] = cur_idx;  <br>&#125;  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge_sort</span><span class="hljs-params">(<span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> </span>&#123;  <br><span class="hljs-keyword">if</span> (l &gt;= r) <span class="hljs-keyword">return</span>;  <br><span class="hljs-type">int</span> mid = (l + r) / <span class="hljs-number">2</span>;  <br><span class="hljs-built_in">merge_sort</span>(l, mid), <span class="hljs-built_in">merge_sort</span>(mid + <span class="hljs-number">1</span>, r);  <br><span class="hljs-type">int</span> k = <span class="hljs-number">0</span>, i = l, j = mid + <span class="hljs-number">1</span>;  <br><span class="hljs-keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r) &#123;  <br><span class="hljs-keyword">if</span> (a[i] &lt;= a[j]) tmp[k++] = a[i++];  <br><span class="hljs-keyword">else</span> tmp[k++] = a[j++];  <br>&#125;  <br><span class="hljs-keyword">while</span> (i &lt;= mid) tmp[k++] = a[i++];  <br><span class="hljs-keyword">while</span> (j &lt;= r) tmp[k++] = a[j++];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = l, j = <span class="hljs-number">0</span>; i &lt;= r; j++, i++) a[i] = tmp[j];  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">counting_sort</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> max = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;  <br>bkt[a[i]]++;  <br><span class="hljs-keyword">if</span> (a[i] &gt; max) max = a[i];  <br>&#125;  <br><span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max + <span class="hljs-number">1</span>; i++) &#123;  <br><span class="hljs-keyword">while</span> (bkt[i]) &#123;  <br>a[j++] = i;  <br>bkt[i]--;  <br>&#125;  <br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;n);  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;a[i]);  <br><span class="hljs-comment">// buble_sort();  </span><br><span class="hljs-comment">// quick_sort(0, n - 1);  </span><br><span class="hljs-comment">// selection_sort();  </span><br><span class="hljs-comment">// heap_sort();  </span><br><span class="hljs-comment">// insertion_sort();  </span><br><span class="hljs-comment">// binary_insertion_sort();  </span><br><span class="hljs-comment">// shell_sort();  </span><br><span class="hljs-comment">// merge_sort(0, n - 1);  </span><br><span class="hljs-built_in">counting_sort</span>();  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>, a[i]);  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="2-成绩排序"><a href="#2-成绩排序" class="headerlink" title="2. 成绩排序"></a>2. 成绩排序</h3><p><font color="#f79646">- 定义一个结构体包含学号与成绩</font><br><font color="#f79646">- 写一个比较器 Compare</font><br><font color="#f79646">- 使用内置 sort 算法，设置迭代头和尾（地址）以及比较规则（比较器）</font></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-comment">//定义学生结构体  </span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Student</span> &#123;  <br><span class="hljs-type">int</span> number;  <br><span class="hljs-type">int</span> score;  <br>  <br><span class="hljs-built_in">Student</span>() &#123;&#125;  <br>  <br><span class="hljs-built_in">Student</span>(<span class="hljs-type">int</span> n, <span class="hljs-type">int</span> s) : <span class="hljs-built_in">number</span>(n), <span class="hljs-built_in">score</span>(s) &#123;&#125;  <br>&#125;;  <br>  <br><span class="hljs-comment">//定义比较函数  </span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">Compare</span><span class="hljs-params">(Student s1, Student s2)</span> </span>&#123;  <br><span class="hljs-comment">//成绩相同比学号  </span><br><span class="hljs-keyword">if</span> (s1.score == s2.score) &#123;  <br><span class="hljs-keyword">return</span> s1.number &lt; s2.number; <span class="hljs-comment">//&#x27;&lt;&#x27;,指按照比较的参数由小到大排序  </span><br>&#125; <span class="hljs-keyword">else</span> &#123;  <br><span class="hljs-keyword">return</span> s1.score &lt; s2.score; <span class="hljs-comment">////&#x27;&lt;&#x27;,指按照比较的参数由小到大排序,同理，如果是&#x27;&gt;&#x27;，指按照由大到小排序  </span><br>&#125;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> n;  <br>cin &gt;&gt; n;  <br><span class="hljs-comment">//定义数组保存比较学生的基本信息  </span><br>Student arr[n];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br>cin &gt;&gt; arr[i].number &gt;&gt; arr[i].score;  <br>&#125;  <br><span class="hljs-built_in">sort</span>(arr, arr + n, Compare);  <br><span class="hljs-keyword">for</span> (Student s: arr) &#123;  <br>cout &lt;&lt; s.number &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; s.score &lt;&lt; endl;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-成绩排序-2"><a href="#3-成绩排序-2" class="headerlink" title="3. 成绩排序 2"></a>3. 成绩排序 2</h3><p>方法 1：<br><font color="#ff0000">sort 是不稳定排序，stable_sort 才是稳定排序，稳定排序不改变输入的顺序</font></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/25.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br><span class="hljs-type">int</span> num, sort_flag;  <br>  <br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Student</span> &#123;  <br>string name;  <br><span class="hljs-type">int</span> score;  <br>  <br><span class="hljs-built_in">Student</span>() &#123;&#125;;  <br>  <br><span class="hljs-built_in">Student</span>(string n, <span class="hljs-type">int</span> s) : <span class="hljs-built_in">name</span>(n), <span class="hljs-built_in">score</span>(s) &#123;&#125;  <br>&#125;;  <br>  <br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">Compare</span><span class="hljs-params">(Student s1, Student s2)</span> </span>&#123;  <br><span class="hljs-keyword">return</span> sort_flag ? s1.score &lt; s2.score : s1.score &gt; s2.score;<span class="hljs-comment">//sort_flag为真则升序否则降序  </span><br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; num &gt;&gt; sort_flag) &#123;  <br>Student arr[num];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; num; ++i) &#123;  <br>cin &gt;&gt; arr[i].name &gt;&gt; arr[i].score;  <br>&#125;  <br><span class="hljs-built_in">stable_sort</span>(arr, arr + num, Compare);<span class="hljs-comment">//重点：sort是不稳定排序，stable_sort才是稳定排序，稳定排序不改变输入的顺序  </span><br><span class="hljs-keyword">for</span> (Student s: arr) &#123;  <br>cout &lt;&lt; s.name &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; s.score &lt;&lt; endl;  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>方法 2：<br>用一个编号保存每个学生的顺序，排序比较器里成绩相等的按照编号升序排</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstring&gt;</span> </span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">student</span>&#123;<br>string name;<br><span class="hljs-type">int</span> score;<br><span class="hljs-type">int</span> num; <br>&#125;;<br><span class="hljs-type">int</span> flag; <span class="hljs-comment">//升序还是降序 </span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(student a,student b)</span></span>&#123;<br><span class="hljs-keyword">if</span>(flag==<span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">if</span>(a.score==b.score) <span class="hljs-keyword">return</span> a.num&lt;b.num;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> a.score&gt;b.score;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span>(a.score==b.score) <span class="hljs-keyword">return</span> a.num&lt;b.num;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> a.score&lt;b.score;<span class="hljs-comment">//这里必须写else，否则牛客会编译失败 </span><br>&#125; <br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-type">int</span> n;<br><span class="hljs-keyword">while</span>(cin&gt;&gt;n)&#123;<br>cin&gt;&gt;flag;<br>student stu[n];<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<br>cin&gt;&gt;stu[i].name&gt;&gt;stu[i].score;<br>stu[i].num=i;<br>&#125; <br><span class="hljs-built_in">sort</span>(&amp;stu[<span class="hljs-number">0</span>],&amp;stu[n],cmp); <span class="hljs-comment">//重点：sort是不稳定排序，stable_sort才是稳定排序 </span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++) cout&lt;&lt;stu[i].name&lt;&lt;<span class="hljs-string">&#x27; &#x27;</span>&lt;&lt;stu[i].score&lt;&lt;endl;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h2 id="3-2-查找"><a href="#3-2-查找" class="headerlink" title="3.2 查找"></a>3.2 查找</h2><h3 id="1-找-x"><a href="#1-找-x" class="headerlink" title="1. 找 x"></a>1. 找 x</h3><p>方法 1：<br>用 flag 标志是否找到</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/25.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;algorithm&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> n, t;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; n) &#123;  <br><span class="hljs-type">int</span> arr[n];  <br><span class="hljs-type">bool</span> flag = <span class="hljs-literal">false</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br>cin &gt;&gt; arr[i];  <br>&#125;  <br>cin &gt;&gt; t;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br><span class="hljs-keyword">if</span> (t == arr[i]) &#123;  <br>cout &lt;&lt; i &lt;&lt; endl;  <br>flag = ~flag;  <br><span class="hljs-keyword">break</span>;  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">if</span> (!flag)  <br>cout &lt;&lt; <span class="hljs-number">-1</span> &lt;&lt; endl;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>方法 2：<br>设置初始默认为-1，找到则修改状态</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">int</span> maxn=<span class="hljs-number">200</span>+<span class="hljs-number">10</span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> arr[maxn];<br>    <span class="hljs-type">int</span> n;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;n)!=EOF)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;arr[i]);<br>        &#125;<br>        <span class="hljs-type">int</span> x;<br>        <span class="hljs-type">int</span> answer=<span class="hljs-number">-1</span>;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;x);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;<br>            <span class="hljs-keyword">if</span>(arr[i]==x)&#123;<br>                answer=i;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            &#125;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,answer);<br>        &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h3 id="2-查找"><a href="#2-查找" class="headerlink" title="2. 查找"></a>2. 查找</h3><p>方法 1：复杂度 O（n）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;map&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> n;<br>    <span class="hljs-type">int</span> m;<br>    <span class="hljs-keyword">while</span>(cin&gt;&gt;n) &#123;<br>        map&lt;<span class="hljs-type">int</span>,<span class="hljs-type">bool</span>&gt; mp;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>            <span class="hljs-type">int</span> temp;<br>            cin&gt;&gt;temp;<br>            mp[temp] = <span class="hljs-literal">true</span>;<br>        &#125;<br>        cin&gt;&gt;m;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) &#123;<br>            <span class="hljs-type">int</span> temp;<br>            cin&gt;&gt;temp;<br>            <span class="hljs-keyword">if</span> (mp.<span class="hljs-built_in">find</span>(temp) != mp.<span class="hljs-built_in">end</span>()) &#123;<br>                cout&lt;&lt;<span class="hljs-string">&quot;YES&quot;</span>&lt;&lt;endl;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                cout&lt;&lt;<span class="hljs-string">&quot;NO&quot;</span>&lt;&lt;endl;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>方法 2：复杂度 O（m·n）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/25.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> n, m;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; n) &#123;  <br><span class="hljs-type">int</span> arr[n];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br>cin &gt;&gt; arr[i];  <br>&#125;  <br>cin &gt;&gt; m;  <br><span class="hljs-type">int</span> tar[m];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) &#123;  <br>cin &gt;&gt; tar[i];  <br>&#125;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) &#123;  <br>string status = <span class="hljs-string">&quot;NO&quot;</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; ++j) &#123;  <br><span class="hljs-keyword">if</span> (arr[j] == tar[i]) &#123;  <br>status = <span class="hljs-string">&quot;YES&quot;</span>;  <br><span class="hljs-keyword">break</span>;  <br>&#125;  <br>&#125;  <br>cout &lt;&lt; status &lt;&lt; endl;  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-extrenum-index"><a href="#3-extrenum-index" class="headerlink" title="3. extrenum_index"></a>3. extrenum_index</h3><p>方法 1：<br>空间复杂度为 O（1）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-type">int</span> n, i, left, mid, right;<br><span class="hljs-keyword">while</span> (cin &gt;&gt; n) &#123;<br>cin &gt;&gt; mid &gt;&gt; right;<br><span class="hljs-keyword">if</span> (mid != right)<br>cout &lt;&lt; <span class="hljs-string">&quot;0 &quot;</span>;<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; n - <span class="hljs-number">1</span>; ++i) &#123;<br>left = mid;<br>mid = right;<br>cin &gt;&gt; right;<br><span class="hljs-keyword">if</span> ((mid - left) * (mid - right) &gt; <span class="hljs-number">0</span>)<br>cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (mid != right)<br>cout &lt;&lt; i;<br>cout &lt;&lt; endl;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>方法 2：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br><span class="hljs-type">int</span> n;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; n) &#123;  <br><span class="hljs-type">int</span> arr[n];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;  <br>cin &gt;&gt; arr[i];  <br>&#125;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; ++i) &#123;  <br><span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span> &amp;&amp; arr[i] != arr[i + <span class="hljs-number">1</span>]) &#123;  <br>cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span>;  <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((arr[i] &gt; arr[i - <span class="hljs-number">1</span>] &amp;&amp; arr[i] &gt; arr[i + <span class="hljs-number">1</span>]) || (arr[i] &lt; arr[i - <span class="hljs-number">1</span>] &amp;&amp; arr[i] &lt; arr[i + <span class="hljs-number">1</span>])) &#123;  <br>cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span>;  <br>&#125;  <br><span class="hljs-keyword">if</span> (i == n - <span class="hljs-number">2</span> &amp;&amp; arr[i] != arr[i + <span class="hljs-number">1</span>]) &#123;  <br>cout &lt;&lt; i + <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span>;  <br>&#125;  <br>&#125;  <br>cout &lt;&lt; endl;  <br>&#125;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-找位置"><a href="#4-找位置" class="headerlink" title="4. 找位置"></a>4. 找位置</h3><p><span style="background:#b1ffff">时间复杂度为 O (n)</span></p><p><font color="#ff0000">1. 用一个额外的矢量 orderS 不重复的添加字符，以保证输出时字符顺序</font><br><font color="#ff0000">2. 用 map 的 key 记录字符，value 记录重复出现的次数</font><br><font color="#ff0000">3. 最后按照 orderS 的顺序遍历输出</font></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br>string s;  <br>map&lt;<span class="hljs-type">char</span>, vector&lt;<span class="hljs-type">int</span>&gt;&gt; sm;  <br>vector&lt;<span class="hljs-type">char</span>&gt; orderS;  <br>cin &gt;&gt; s;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-built_in">length</span>(); ++i) &#123;  <br><span class="hljs-keyword">if</span> (sm.<span class="hljs-built_in">find</span>(s[i]) != sm.<span class="hljs-built_in">end</span>()) &#123;  <br>sm[s[i]].<span class="hljs-built_in">push_back</span>(i);  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br>sm[s[i]] = vector&lt;<span class="hljs-type">int</span>&gt;&#123;i&#125;;  <br>orderS.<span class="hljs-built_in">push_back</span>(s[i]);  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> item: orderS) &#123;  <br><span class="hljs-keyword">auto</span> tmp = sm.<span class="hljs-built_in">find</span>(item);  <br><span class="hljs-keyword">if</span> (tmp != sm.<span class="hljs-built_in">end</span>() &amp;&amp; tmp-&gt;second.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">1</span>) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> index: tmp-&gt;second) &#123;  <br><span class="hljs-keyword">if</span> (index != tmp-&gt;second.<span class="hljs-built_in">back</span>())  <br>cout &lt;&lt; tmp-&gt;first &lt;&lt; <span class="hljs-string">&#x27;:&#x27;</span> &lt;&lt; index &lt;&lt; <span class="hljs-string">&#x27;,&#x27;</span>;  <br><span class="hljs-keyword">else</span>  <br>cout &lt;&lt; tmp-&gt;first &lt;&lt; <span class="hljs-string">&#x27;:&#x27;</span> &lt;&lt; index &lt;&lt; endl;  <br>&#125;  <br>&#125;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="第四章字符串"><a href="#第四章字符串" class="headerlink" title="第四章字符串"></a>第四章字符串</h1><h2 id="4-1-字符串处理"><a href="#4-1-字符串处理" class="headerlink" title="4.1 字符串处理"></a>4.1 字符串处理</h2><h3 id="1-特殊乘法"><a href="#1-特殊乘法" class="headerlink" title="1. 特殊乘法"></a>1. <a href="http://t.cn/Ai8by9vW">特殊乘法</a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/26.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br>string a, b;  <br><span class="hljs-type">int</span> sum = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; a &gt;&gt; b) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> i: a) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> j: b) &#123;  <br>sum += (i - <span class="hljs-string">&#x27;0&#x27;</span>) * (j - <span class="hljs-string">&#x27;0&#x27;</span>);  <br>&#125;  <br>&#125;  <br>cout &lt;&lt; sum &lt;&lt; endl;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="2-密码翻译"><a href="#2-密码翻译" class="headerlink" title="2. 密码翻译"></a>2. <a href="http://t.cn/Ai8bGaIx">密码翻译</a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/26.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br>string s;  <br><span class="hljs-keyword">while</span> (cin &gt;&gt; s) &#123;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-built_in">length</span>(); ++i) &#123;  <br><span class="hljs-keyword">if</span> ((s[i] &gt;= <span class="hljs-string">&#x27;A&#x27;</span> &amp;&amp; s[i] &lt;= <span class="hljs-string">&#x27;Y&#x27;</span>) || (s[i] &gt;= <span class="hljs-string">&#x27;a&#x27;</span> &amp;&amp; s[i] &lt;= <span class="hljs-string">&#x27;y&#x27;</span>)) &#123;  <br>s[i] += <span class="hljs-number">1</span>;  <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">&#x27;z&#x27;</span> || s[i] == <span class="hljs-string">&#x27;Z&#x27;</span>) &#123;  <br>s[i] = s[i] == <span class="hljs-string">&#x27;z&#x27;</span> ? <span class="hljs-string">&#x27;a&#x27;</span> : <span class="hljs-string">&#x27;A&#x27;</span>;  <br>&#125;  <br>&#125;  <br>cout &lt;&lt; s &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span>;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="3-简单密码"><a href="#3-简单密码" class="headerlink" title="3. 简单密码"></a>3. <a href="http://t.cn/Ai8bih2z">简单密码</a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// 方法1：</span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Created by alleyf on 2023/6/26.</span><br><span class="hljs-comment">//</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    string s;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(cin, s)) &#123;<br>        <span class="hljs-keyword">if</span> (s != <span class="hljs-string">&quot;ENDOFINPUT&quot;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (s != <span class="hljs-string">&quot;START&quot;</span> &amp;&amp; s != <span class="hljs-string">&quot;END&quot;</span>) &#123;<br>                <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> item : s) &#123;<br>                    <span class="hljs-keyword">if</span> ((item &gt;= <span class="hljs-string">&#x27;A&#x27;</span> &amp;&amp; item &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>))<br>                       s[i] = <span class="hljs-string">&#x27;A&#x27;</span> + (item - <span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-number">21</span>) % <span class="hljs-number">26</span>;<br>                    i++;<br>                &#125;<br>                cout &lt;&lt; s &lt;&lt; endl;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 方法2:</span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Created by alleyf on 2023/6/26.</span><br><span class="hljs-comment">//</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br>map&lt;<span class="hljs-type">char</span>, <span class="hljs-type">char</span>&gt; pwd_map&#123;<br>    &#123;<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;Z&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;A&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;N&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;K&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;Z&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>&#125;,<br>&#125;;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    string s;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(cin, s)) &#123;<br>        <span class="hljs-keyword">if</span> (s != <span class="hljs-string">&quot;ENDOFINPUT&quot;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (s != <span class="hljs-string">&quot;START&quot;</span> &amp;&amp; s != <span class="hljs-string">&quot;END&quot;</span>) &#123;<br>                <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> item : s) &#123;<br>                    <span class="hljs-keyword">if</span> ((item &gt;= <span class="hljs-string">&#x27;A&#x27;</span> &amp;&amp; item &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>))<br>                       s[i] = pwd_map[item];<br>                    i++;<br>                &#125;<br>                cout &lt;&lt; s &lt;&lt; endl;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-统计字符"><a href="#4-统计字符" class="headerlink" title="4. 统计字符"></a>4. <a href="http://t.cn/Ai8fvq4I">统计字符</a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/30.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br>string ts, s;  <br><span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(cin, ts)) &#123;  <br><span class="hljs-keyword">if</span> (ts == <span class="hljs-string">&quot;#&quot;</span>)  <br><span class="hljs-keyword">break</span>;  <br><span class="hljs-built_in">getline</span>(cin, s);  <br><span class="hljs-type">int</span> cnum[ts.<span class="hljs-built_in">length</span>()];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ts.<span class="hljs-built_in">length</span>(); ++i) &#123;  <br>cnum[i] = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> j: s) &#123;  <br><span class="hljs-keyword">if</span> (j == ts[i]) &#123;  <br>cnum[i]++;  <br>&#125;  <br>&#125;  <br>cout &lt;&lt; ts[i] &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; cnum[i] &lt;&lt; endl;  <br>&#125;  <br>&#125;  <br>  <br>&#125;  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment">* 方法2：  </span><br><span class="hljs-comment">* using namespace std;  </span><br><span class="hljs-comment">//1：注意读题，i ng是当四个字符处理，而非i和ng  </span><br><span class="hljs-comment">//2：如何持续输入？while持续输入第一个字符，循环体内输入第二个  </span><br><span class="hljs-comment">//如何捕捉结束字符？在第一个字符串输入时识别  </span><br><span class="hljs-comment">  </span><br><span class="hljs-comment">int number[128];  </span><br><span class="hljs-comment">int main()  </span><br><span class="hljs-comment">&#123;  </span><br><span class="hljs-comment">string str1,str2;  </span><br><span class="hljs-comment">while(getline(cin,str1))&#123;  </span><br><span class="hljs-comment">if(str1==&quot;#&quot;) break;  </span><br><span class="hljs-comment">getline(cin,str2);  </span><br><span class="hljs-comment">memset(number,0,sizeof(number)); //number数组记录该字符，出现的次数  </span><br><span class="hljs-comment">for(int i=0;i&lt;str2.size();i++)&#123;  </span><br><span class="hljs-comment">number[str2[i]]++; //长字符串的字符对应ASCII码的下标+1  </span><br><span class="hljs-comment">&#125;  </span><br><span class="hljs-comment">for(int i=0;i&lt;str1.size();i++)&#123;  </span><br><span class="hljs-comment">printf(&quot;%c %d\n&quot;,str1[i],number[str1[i]]);  </span><br><span class="hljs-comment">&#125;  </span><br><span class="hljs-comment">&#125;  </span><br><span class="hljs-comment">&#125;  </span><br><span class="hljs-comment">//学到的方法：ASCII码不大，想统计每个字符，直接将其对应的ASCII码下标的元素加1即可！  </span><br><span class="hljs-comment">  </span><br><span class="hljs-comment">*/</span><br><br></code></pre></td></tr></table></figure><h3 id="5-字母统计"><a href="#5-字母统计" class="headerlink" title="5. 字母统计"></a>5. <a href="http://t.cn/Ai8VB72e">字母统计</a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/6/30.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>map&lt;<span class="hljs-type">char</span>, <span class="hljs-type">int</span>&gt; c_map&#123;  <br>&#123;<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;N&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;O&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;U&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#123;<span class="hljs-string">&#x27;Z&#x27;</span>, <span class="hljs-number">0</span>&#125;,  <br>&#125;;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;  <br>string s;  <br><span class="hljs-built_in">getline</span>(cin, s);  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c: s) &#123;  <br><span class="hljs-keyword">if</span> (c_map.<span class="hljs-built_in">find</span>(c) != c_map.<span class="hljs-built_in">end</span>()) &#123;  <br>c_map[c]++;  <br>&#125;  <br>&#125;  <br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> item: c_map) &#123;  <br>cout &lt;&lt; item.first &lt;&lt; <span class="hljs-string">&#x27;:&#x27;</span> &lt;&lt; item.second &lt;&lt; endl;  <br>&#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="4-2-字符串匹配"><a href="#4-2-字符串匹配" class="headerlink" title="4.2 字符串匹配"></a>4.2 字符串匹配</h2><h1 id="第五章基础数据结构"><a href="#第五章基础数据结构" class="headerlink" title="第五章基础数据结构"></a>第五章基础数据结构</h1><h2 id="5-1-向量"><a href="#5-1-向量" class="headerlink" title="5.1 向量"></a>5.1 向量</h2><h3 id="完数与盈数"><a href="#完数与盈数" class="headerlink" title="完数与盈数"></a><a href="http://t.cn/AiKEyQWW">完数与盈数</a></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//  </span><br><span class="hljs-comment">// Created by alleyf on 2023/8/17.  </span><br><span class="hljs-comment">//  </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span>  </span><br>  <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">judge_EG</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span> </span>&#123;  <br><span class="hljs-type">int</span> sum = <span class="hljs-number">0</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= num / <span class="hljs-number">2</span>; ++i) &#123;  <br><span class="hljs-keyword">if</span> (num % i == <span class="hljs-number">0</span>)  <br>sum += i;  <br>&#125;  <br><span class="hljs-keyword">if</span> (sum == num)  <br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sum &gt; num)  <br><span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;  <br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;  <br>  <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;   <br><span class="hljs-comment">// vector&lt;int&gt; E, G;  </span><br>string E = <span class="hljs-string">&quot;E:&quot;</span>, G = <span class="hljs-string">&quot;G:&quot;</span>;  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">2</span>; i &lt;= <span class="hljs-number">60</span>; ++i) &#123;  <br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">judge_EG</span>(i) == <span class="hljs-number">1</span>)  <br>E += <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-built_in">to_string</span>(i);  <br><span class="hljs-comment">// E.push_back(i);  </span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">judge_EG</span>(i) == <span class="hljs-number">2</span>)  <br>G += <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-built_in">to_string</span>(i);  <br><span class="hljs-comment">// G.push_back(i);  </span><br>&#125;  <br>cout &lt;&lt; E &lt;&lt; endl &lt;&lt; G;  <br><span class="hljs-comment">// cout &lt;&lt; &quot;E:&quot;;  </span><br><span class="hljs-comment">// for (auto e: E) &#123;  </span><br><span class="hljs-comment">// cout &lt;&lt; &quot; &quot; &lt;&lt; e;  </span><br><span class="hljs-comment">// &#125;  </span><br><span class="hljs-comment">// cout &lt;&lt; endl &lt;&lt; &quot;G:&quot;;  </span><br><span class="hljs-comment">// for (auto g: G) &#123;  </span><br><span class="hljs-comment">// cout &lt;&lt; &quot; &quot; &lt;&lt; g;  </span><br><span class="hljs-comment">// &#125;  </span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol><li>思路：<font color="#ff0000">获取一个数的所有因子可以通过循环取余，判断余数是否为零来获得，若为零则为因子，反之不为因子</font></li><li>细节：<font color="#ff0000">关键在于格式输出的问题</font></li></ol></blockquote><h2 id="5-2-队列"><a href="#5-2-队列" class="headerlink" title="5.2 队列"></a>5.2 队列</h2><h2 id="5-3-栈"><a href="#5-3-栈" class="headerlink" title="5.3 栈"></a>5.3 栈</h2><h1 id="剑指offer"><a href="#剑指offer" class="headerlink" title="剑指offer"></a>剑指offer</h1><h2 id="简单题"><a href="#简单题" class="headerlink" title="简单题"></a>简单题</h2><h3 id="1-数组中重复的数字"><a href="#1-数组中重复的数字" class="headerlink" title="1.数组中重复的数字"></a>1.<a href="https://www.nowcoder.com/practice/6fe361ede7e54db1b84adc81d09d8524">数组中重复的数字</a></h3><blockquote><p><strong>桶排序思想</strong></p><ol><li>首先定义一个与输入长度相等的数组，并将所有值置零；</li><li>遍历输入向量，对遇到的值作为数组下标进行自增；</li><li>判断自增后的值是否大于1，若是则为重复数则直接返回。</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * @param numbers int整型vector</span><br><span class="hljs-comment">     * @return int整型</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">duplicate</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; numbers)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (numbers.<span class="hljs-built_in">size</span>() != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">int</span> a[numbers.<span class="hljs-built_in">size</span>()];<br>            <span class="hljs-comment">//数组元素置零</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i; i &lt; numbers.<span class="hljs-built_in">size</span>(); i++) &#123;<br>                a[i] = <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-comment">//遍历计数</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> item : numbers) &#123;<br>                a[item]++;<br>                <span class="hljs-keyword">if</span> (a[item] &gt; <span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-keyword">return</span> item;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p><strong>位置重排</strong></p><ol><li>遍历数组，遇到数组元素与下标相同的不用管。</li><li>遇到数组元素与下标不同，就将其交换到属于它的位置，交换前检查那个位置是否有相同的元素，若有则重复。</li><li>遍历结束完全交换也没重复，则返回-1.</li></ol></blockquote><p><img src="https://uploadfiles.nowcoder.com/images/20220421/397721558_1650511844449/985457EF766F228F555A31DC0363FE81" alt="|550"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">duplicate</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; numbers)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numbers.<span class="hljs-built_in">size</span>(); i++)&#123;<br>            <span class="hljs-comment">//该位置本来就是对的</span><br>            <span class="hljs-keyword">if</span>(numbers[i] == i)<br>                <span class="hljs-keyword">continue</span>;<br>            <span class="hljs-comment">//位置不对，需要换到自己对应的位置</span><br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//对应位置相等，重复</span><br>                <span class="hljs-keyword">if</span>(numbers[i] == numbers[numbers[i]])<br>                    <span class="hljs-keyword">return</span> numbers[i];<br>                <span class="hljs-comment">//交换位置</span><br>                <span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-built_in">swap</span>(numbers[i], numbers[numbers[i]]);<br>                  i--;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//没有重复</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p><strong>哈希表</strong></p><ol><li>遍历数组，将没有出现过的元素加入哈希表。</li><li>遇到的元素在哈希表中出现过就是重复数组。</li><li>遍历结束也没找到就返回-1.</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">duplicate</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; numbers)</span> </span>&#123;<br>        <span class="hljs-comment">//哈希表记录重复</span><br>        unordered_map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; mp;<br>        <span class="hljs-comment">//遍历数组</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numbers.<span class="hljs-built_in">size</span>(); i++)&#123;<br>            <span class="hljs-comment">//如果没有出现过就加入哈希表</span><br>            <span class="hljs-keyword">if</span>(mp.<span class="hljs-built_in">find</span>(numbers[i]) == mp.<span class="hljs-built_in">end</span>())<br>                mp[numbers[i]]++;<br>            <span class="hljs-comment">//否则就是重复数字</span><br>            <span class="hljs-keyword">else</span><br>                <span class="hljs-keyword">return</span> numbers[i];<br>        &#125;<br>        <span class="hljs-comment">//没有重复</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>&#125;;<br><br><br></code></pre></td></tr></table></figure><h3 id="2-替换空格"><a href="#2-替换空格" class="headerlink" title="2.替换空格"></a>2.<a href="https://www.nowcoder.com/practice/0e26e5551f2b489b9f58bc83aa4b6c68">替换空格</a></h3><blockquote><p>python直接用字符串函数<code>replace</code>全局替换即可</p></blockquote><blockquote><p><strong>遍历覆盖法</strong><br>定义一个新字符串，遍历原字符串，遇到空格新字符串加要求替换的字符，否则添加原字符。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><br>  <span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * @param s string字符串</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     * @return string字符串</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-function">string <span class="hljs-title">replaceSpace</span><span class="hljs-params">(string s)</span> </span>&#123;<br><br>        string new_s;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i; i &lt; s.<span class="hljs-built_in">length</span>(); i++) &#123;<br><br>            <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">&#x27; &#x27;</span>) &#123;<br><br>                new_s += <span class="hljs-string">&quot;%20&quot;</span>;<br><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br><br>                new_s += s[i];<br><br>            &#125;<br><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> new_s;<br><br>    &#125;<br><br>&#125;;<br><br></code></pre></td></tr></table></figure><h3 id="3-从尾到头打印链表"><a href="#3-从尾到头打印链表" class="headerlink" title="3.从尾到头打印链表"></a>3.<a href="https://www.nowcoder.com/practice/d0267f7f55b3412ba93bd35cfa8e8035">从尾到头打印链表</a></h3><p><strong>1.数组逆向拷贝</strong></p><blockquote><ol><li>遍历链表，用一个数组顺序添加节点值</li><li>逆向遍历数组，添加数组值到新数组中</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  struct ListNode &#123;</span><br><span class="hljs-comment">*        int val;</span><br><span class="hljs-comment">*        struct ListNode *next;</span><br><span class="hljs-comment">*        ListNode(int x) :</span><br><span class="hljs-comment">*              val(x), next(NULL) &#123;</span><br><span class="hljs-comment">*        &#125;</span><br><span class="hljs-comment">*  &#125;;</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstddef&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>     <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">printListFromTailToHead</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>         vector&lt;<span class="hljs-type">int</span>&gt; a, b;<br>         <span class="hljs-keyword">while</span> (head != <span class="hljs-literal">nullptr</span>) &#123;<br>             a.<span class="hljs-built_in">push_back</span>(head-&gt;val);<br>             head = head-&gt;next;<br>         &#125;<br>         <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = a.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>             b.<span class="hljs-built_in">push_back</span>(a[i]);<br>         &#125;<br>         <span class="hljs-keyword">return</span> b;<br>     &#125;<br><br>&#125;;<br><br></code></pre></td></tr></table></figure><p><strong>2.递归</strong></p><blockquote><ol><li>从表头开始往后递归进入每一个节点。</li><li>遇到尾节点后开始返回，每次返回依次添加一个值进入输出数组。</li><li>直到递归返回表头</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*  struct ListNode &#123;</span><br><span class="hljs-comment">*        int val;</span><br><span class="hljs-comment">*        struct ListNode *next;</span><br><span class="hljs-comment">*        ListNode(int x) :</span><br><span class="hljs-comment">*              val(x), next(NULL) &#123;</span><br><span class="hljs-comment">*        &#125;</span><br><span class="hljs-comment">*  &#125;;</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstddef&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">//递归函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">recursion</span><span class="hljs-params">(ListNode* head, vector&lt;<span class="hljs-type">int</span>&gt;&amp; res)</span></span>&#123; <br>        <span class="hljs-keyword">if</span>(head != <span class="hljs-literal">NULL</span>)&#123;<br>            <span class="hljs-comment">//先往链表深处遍历</span><br>            <span class="hljs-built_in">recursion</span>(head-&gt;next, res); <br>            <span class="hljs-comment">//再填充到数组就是逆序</span><br>            res.<span class="hljs-built_in">push_back</span>(head-&gt;val); <br>        &#125;<br>    &#125;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">printListFromTailToHead</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>        vector&lt;<span class="hljs-type">int</span>&gt; res;<br>        <span class="hljs-comment">//递归函数打印</span><br>        <span class="hljs-built_in">recursion</span>(head, res); <br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>&#125;;<br><br><br></code></pre></td></tr></table></figure><p><strong>3.栈</strong></p><blockquote><ol><li>我们可以顺序遍历链表，将链表的值push到栈中。</li><li>然后再依次弹出栈中的元素，加入到数组中，即可实现链表逆序。</li></ol></blockquote><p><img src="https://uploadfiles.nowcoder.com/images/20210929/397721558_1632894642785/BE964CB47EFCAE9EDFDA27F797D795C0"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstddef&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">printListFromTailToHead</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>        vector&lt;<span class="hljs-type">int</span>&gt; res;<br>        stack&lt;<span class="hljs-type">int</span>&gt; s;<br>        <span class="hljs-comment">//正序输出链表到栈中</span><br>        <span class="hljs-keyword">while</span>(head != <span class="hljs-literal">NULL</span>)&#123; <br>            s.<span class="hljs-built_in">push</span>(head-&gt;val);<br>            head = head-&gt;next;<br>        &#125;<br>        <span class="hljs-comment">//输出栈中元素到数组中</span><br>        <span class="hljs-keyword">while</span>(!s.<span class="hljs-built_in">empty</span>())&#123; <br>            res.<span class="hljs-built_in">push_back</span>(s.<span class="hljs-built_in">top</span>());<br>            s.<span class="hljs-built_in">pop</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="4-用两个栈实现队列"><a href="#4-用两个栈实现队列" class="headerlink" title="4.用两个栈实现队列"></a>4.<a href="https://www.nowcoder.com/practice/54275ddae22f475981afa2244dd448c6">用两个栈实现队列</a></h3><p><strong>解题思路</strong>：</p><p>借助栈的<strong>先进后出</strong>规则模拟实现队列的<strong>先进先出</strong></p><ol><li>**当插入时，直接插入 stack1</li><li>当弹出时，当 <strong>stack2 不为空</strong>，<strong>弹出 stack2 栈顶元素</strong>，如果 stack2 <strong>为空</strong>，<strong>将 stack1 中的全部数逐个出栈入栈 stack2，再弹出 stack2 栈顶元素</strong></li></ol><p><strong>图解</strong>：</p><p><img src="https://uploadfiles.nowcoder.com/images/20210630/889362376_1625037262242/6A83CFA85D068C98792D42B93A33518D">  </p><p><strong>代码展示：</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-type">int</span> node)</span> </span>&#123;<br>        stack1.<span class="hljs-built_in">push</span>(node);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (stack2.<span class="hljs-built_in">empty</span>()) &#123;<br>            <span class="hljs-keyword">while</span> (!stack1.<span class="hljs-built_in">empty</span>()) &#123;<br>                stack2.<span class="hljs-built_in">push</span>(stack1.<span class="hljs-built_in">top</span>());<br>                stack1.<span class="hljs-built_in">pop</span>();<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">int</span> node = stack2.<span class="hljs-built_in">top</span>();<br>        stack2.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> node;<br>    &#125;<br> <br>  <span class="hljs-keyword">private</span>:<br>    stack&lt;<span class="hljs-type">int</span>&gt; stack1;<br>    stack&lt;<span class="hljs-type">int</span>&gt; stack2;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>复杂度分析</strong>：</p><blockquote><ul><li><p>时间复杂度：对于插入和删除操作，时间复杂度均为 O(1)。插入不多说，对于删除操作，虽然看起来是 O(n) 的时间复杂度，但是仔细考虑下每个元素只会「至多被插入和弹出 stack2 一次」，因此均摊下来每个元素被删除的时间复杂度仍为 O(1)。</p></li><li><p>空间复杂度O(N)：辅助栈的空间，最差的情况下两个栈共存储N个元素.</p></li></ul></blockquote><h3 id="5-旋转数组的最小数字"><a href="#5-旋转数组的最小数字" class="headerlink" title="5.旋转数组的最小数字"></a>5.<a href="https://www.nowcoder.com/practice/9f3231a991af4f55b95579b44b7a01ba">旋转数组的最小数字</a></h3><p><strong>求解思路：</strong></p><ol><li>暴力法</li></ol><blockquote><ul><li>特殊情况，如果数组为空，则直接返回0</li><li>创建最小值 min</li><li>遍历数组每一个元素nums，并更新最小值 min = min(min，num)</li><li>遍历结束，直接返回 min</li></ul></blockquote><p>时间复杂度O(N)：N表示数组的长度，遍历整个数组O(N)<br>空间复杂度O(1)：仅使用一个额外空间变量O(1)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">minNumberInRotateArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>         <span class="hljs-type">int</span> min = <span class="hljs-number">10000</span>;<br>         <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> item : nums) &#123;<br>             <span class="hljs-keyword">if</span> (min &gt;= item)<br>                 min = item;<br>         &#125;<br>         <span class="hljs-keyword">return</span> min;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><hr><ol start="2"><li>二分法</li></ol><blockquote><ul><li><strong>初始化</strong>：定义二分端点双指针<code>i，j</code>，<code>m=（i+j）/ 2</code>为每次二分的中点（ “/“ 代表向下取整除法）</li><li><strong>循环二分</strong>：循环不成立则按照以下规则更新双指针：<ol><li>当 array[m] &gt; array[j] 时： m 一定在左排序数组中，即旋转点 x 一定在 [m + 1, j] 闭区间内，因此执行 i = m + 1；</li><li>当 array[m] &lt; array[j] 时： m 一定在右排序数组中，即旋转点 x 一定在[i, m]闭区间内，因此执行 j = m；</li><li>当 array[m] = array[j] 时： 无法判断 mm 在哪个排序数组中，即无法判断旋转点 x 在 [i, m] 还是 [m + 1, j] 区间中。解决方案： 执行 j = j - 1 缩小判断范围</li></ol></li><li><strong>返回值</strong>： 当 i = j 时跳出二分循环，并返回旋转点的值 array[i] 即可。</li></ul></blockquote><p><img src="https://uploadfiles.nowcoder.com/images/20210716/889362376_1626418937573/3C28F80DBB0E1E084CB71A32958F04F9" alt="|500"></p><p>时间复杂度O(logN)：N表示数组的长度，二分查找O(logN)<br>空间复杂度O(1)：仅使用常数（i, j, m）额外空间变量O(1)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">minNumberInRotateArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>, j = nums.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (i != j) &#123;<br>            <span class="hljs-type">int</span> m = (i + j) / <span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">if</span> (nums[m] &gt; nums[j])<br>                i = m + <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nums[m] &lt; nums[j])<br>                j = m;<br>            <span class="hljs-keyword">else</span><br>                j -= <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> nums[i];<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="6-二进制中1的个数"><a href="#6-二进制中1的个数" class="headerlink" title="6.二进制中1的个数"></a>6.<a href="https://www.nowcoder.com/practice/8ee967e43c2c4ec193b040ea7fbb10b8">二进制中1的个数</a></h3><p><strong>求解思路：</strong></p><ol><li>循环按位比较法（推荐使用）</li></ol><p><strong>知识点：位运算</strong></p><p>计算机的数字由二进制表示，我们平常的运算是对整个数字进行运算，但是还可以按照二进制的每一位分别进行运算。常见运算有位与、位或、移位、位异或等。</p><p><strong>思路：</strong></p><p>我们可以检查该数字的二进制每一位是否为1，如果遍历二进制每一位呢？可以考虑移位运算，每次移动一位就可以。至于怎么统计到1呢？我们都只知道数字1与数字相位与运算，其实只是最后一位为1就是1，最后一位为0就是0，这样我们只需要将数字1移位运算，就可以遍历二进制的每一位，再去做位与运算，结果为1的就是二进制中为1的。</p><p><strong>具体做法：</strong></p><blockquote><ul><li>遍历二进制的32位，通过移位0-31次实现。</li><li>将移位后的1与数字进行位与运算，从而判断数字的二进制每一位结果，结果为1就记录一次。</li></ul></blockquote><p><strong>复杂度分析：</strong></p><ul><li>时间复杂度：O(k)O(k)O(k)，kkk为int型的32位，一次遍历</li><li>空间复杂度：O(1)O(1)O(1)，常数级变量，没有额外辅助空间</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span>  <span class="hljs-title">NumberOf1</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>&#123;<br>        <span class="hljs-type">int</span> res = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//遍历32位</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)&#123;<br>            <span class="hljs-comment">//按位比较</span><br>            <span class="hljs-keyword">if</span>((n &amp; (<span class="hljs-number">1</span> &lt;&lt; i)) != <span class="hljs-number">0</span>)   <br>                res++;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>     &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="2"><li>暴力法</li></ol><blockquote><ul><li>判断数n是否为负数，负数则转化为相同二进制表示的正数（$P_b = 2^N+n,N为二进制位数$）</li><li>通过连除法，用结果累加n%2的余数，并更新n=n/2</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">NumberOf1</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>&#123;<br>        <span class="hljs-type">int</span> sum = <span class="hljs-number">0</span>;<br>        <span class="hljs-type">long</span> m = n;<br>        <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">0</span>)<br>            m = n + <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">32</span>);<br>        <span class="hljs-keyword">while</span> (m != <span class="hljs-number">0</span>) &#123;<br>            sum += m % <span class="hljs-number">2</span>;<br>            m /= <span class="hljs-number">2</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><ol start="3"><li>位运算优化法（扩展思路）</li></ol><p><strong>思路：</strong></p><p><strong>有一个性质：$n&amp;(n−1)$，会将n的二进制中最低位由1变成0</strong></p><p>我们可以不断让当前的 n与 n−1做位与运算，直到 n的二进制全部变为 0 停止。因为每次运算会使得 n 的最低位的 1 被翻转成0，因此运算次数就等于 n 的二进制位中 1 的个数，由此统计1的个数。</p><p><strong>具体做法：</strong></p><blockquote><ul><li>使用循环检查n是否为0.</li><li>不为0就与n−1做位与运算，去掉二进制最后一位的1，并统计次数。</li></ul></blockquote><p><strong>图示：</strong></p><p><img src="https://uploadfiles.nowcoder.com/images/20220419/397721558_1650336051737/D2B5CA33BD970F64A6301FA75AE2EB22"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">NumberOf1</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>&#123;<br>        <span class="hljs-type">int</span> res = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//当n为0时停止比较</span><br>        <span class="hljs-keyword">while</span>(n)&#123;  <br>            n &amp;= n - <span class="hljs-number">1</span>;<br>            res++;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>     &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">some solutions about common algorithms</summary>
    
    
    
    <category term="前后端开发" scheme="https://alleyf.github.io/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Algorithm" scheme="https://alleyf.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Dateframe—Algorithm</title>
    <link href="https://alleyf.github.io/2023/03/2e76a383274a.html"/>
    <id>https://alleyf.github.io/2023/03/2e76a383274a.html</id>
    <published>2023-03-17T11:06:15.000Z</published>
    <updated>2023-05-24T09:15:40.453Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-线性表"><a href="#1-线性表" class="headerlink" title="1.线性表"></a>1.线性表</h1><blockquote><p>无论哪种数据结构，都存在<font color="#ff0000">增删改查 (按值查找)查（按位查找）</font>操作，对应不同操作的<font color="#4bacc6">时间复杂度不同</font>，要根据实际数据的形式选择合适的数据结构进行存储，再选择合适算法进行处理。</p></blockquote><h2 id="顺序表（sequence-list）"><a href="#顺序表（sequence-list）" class="headerlink" title="顺序表（sequence list）"></a>顺序表（sequence list）</h2><h3 id="1初始化"><a href="#1初始化" class="headerlink" title="1初始化"></a>1初始化</h3><h3 id="2增加元素"><a href="#2增加元素" class="headerlink" title="2增加元素"></a>2增加元素</h3><h3 id="3删除元素"><a href="#3删除元素" class="headerlink" title="3删除元素"></a>3删除元素</h3><h3 id="4修改元素"><a href="#4修改元素" class="headerlink" title="4修改元素"></a>4修改元素</h3><h3 id="5查找元素"><a href="#5查找元素" class="headerlink" title="5查找元素"></a>5查找元素</h3><h4 id="按值查找"><a href="#按值查找" class="headerlink" title="按值查找"></a>按值查找</h4><h4 id="按位查找"><a href="#按位查找" class="headerlink" title="按位查找"></a>按位查找</h4><h2 id="链表（link-list）"><a href="#链表（link-list）" class="headerlink" title="链表（link list）"></a>链表（link list）</h2><h3 id="1初始化-1"><a href="#1初始化-1" class="headerlink" title="1初始化"></a>1初始化</h3><h3 id="2增加元素-1"><a href="#2增加元素-1" class="headerlink" title="2增加元素"></a>2增加元素</h3><h4 id="头插"><a href="#头插" class="headerlink" title="头插"></a>头插</h4><h4 id="尾插"><a href="#尾插" class="headerlink" title="尾插"></a>尾插</h4><h3 id="3删除元素-1"><a href="#3删除元素-1" class="headerlink" title="3删除元素"></a>3删除元素</h3><h3 id="4修改元素-1"><a href="#4修改元素-1" class="headerlink" title="4修改元素"></a>4修改元素</h3><h3 id="5查找元素-1"><a href="#5查找元素-1" class="headerlink" title="5查找元素"></a>5查找元素</h3><h4 id="按值查找-1"><a href="#按值查找-1" class="headerlink" title="按值查找"></a>按值查找</h4><h4 id="按位查找-1"><a href="#按位查找-1" class="headerlink" title="按位查找"></a>按位查找</h4><h1 id="2-栈"><a href="#2-栈" class="headerlink" title="2.栈"></a>2.栈</h1><blockquote><p>栈是一种<font color="#8064a2">后进先出（LIFO）</font>的线性表结构。</p></blockquote><p><span style="background:rgba(240, 107, 5, 0.2)">顺序栈：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span>SElemType *base;<br>SElemType *top;<br><span class="hljs-type">int</span> stacksize;&#125; SgStack;<br></code></pre></td></tr></table></figure><p><span style="background:#b1ffff">链栈：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StackNode</span>&#123;</span><br>SElemType data;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StackNode</span> *<span class="hljs-title">next</span>;</span>&#125;StackNode,*LinkStack;<br><br></code></pre></td></tr></table></figure><h2 id="1初始化-2"><a href="#1初始化-2" class="headerlink" title="1初始化"></a>1初始化</h2><p><span style="background:rgba(240, 107, 5, 0.2)">顺序栈：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">InitStack</span><span class="hljs-params">(SgStack &amp;S,<span class="hljs-type">int</span> MAXSIZE&#123;</span><br><span class="hljs-params">S.base =new SElemType [MAXSIZE]；</span><br><span class="hljs-params"><span class="hljs-keyword">if</span>(!S.base） </span><br><span class="hljs-params">   <span class="hljs-keyword">return</span> OVERFLOW;</span><br><span class="hljs-params">   S.top = S.base;</span><br><span class="hljs-params">   S.stacksize = MAXSIZE；</span><br><span class="hljs-params">   <span class="hljs-keyword">return</span> OK;</span><br></code></pre></td></tr></table></figure><p><span style="background:#b1ffff">链栈：</span></p><p><strong>不带头节点：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Initstack</span> <span class="hljs-params">(LinkStack &amp;S)</span><br>&#123;<br>S=<span class="hljs-literal">NULL</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="2-入栈"><a href="#2-入栈" class="headerlink" title="2 入栈"></a>2 入栈</h2><p><span style="background:rgba(240, 107, 5, 0.2)">顺序栈：</span><br>时间复杂度：O（1）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>Status <span class="hljs-title function_">Push</span><span class="hljs-params">(SqStack &amp;S,SElemType e)</span><br>&#123;<br><span class="hljs-keyword">if</span>(S.top - S.base==S.stacksize）<span class="hljs-keyword">return</span> ERROR;<br>*S.top++=e;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br></code></pre></td></tr></table></figure><p>这段代码是一个名为 <code>Push</code> 的函数，它接受两个参数：一个指向栈 <code>S</code> 的指针引用和要入栈的元素 <code>e</code>。<code>SqStack</code> 表示栈的类型，在这里推测它是由结构体或类定义的。<code>&amp;S</code> 表示将栈变量的地址传递给函数，通过引用来修改栈的内容。在 C/C++中，引用有时候也被称为别名(alias)，它允许我们使用类似于指针的语法来操作对象，但是具有更好的安全性和易读性。<code>SElemType</code> 是栈元素的数据类型，可以是任何合法的数据类型。</p><p>这个函数的作用是将元素e压入到栈S中，如果栈已满则返回ERROR，否则在栈顶插入元素e并返回OK。其中<code>S.top - S.base</code> 表示当前栈中已有元素的个数，如果这个值等于<code>S.stacksize</code>就意味着栈已经满了。<code>*S.top++=e</code>表示将元素e存储在栈顶，并将栈指针往上移动一位，准备接收下一个元素。最后，函数返回插入操作的结果，OK表示成功，ERROR表示失败。</p><p><span style="background:#b1ffff">链栈：</span><br><strong>头插</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">Push</span> <span class="hljs-params">(LinkStack&amp;S,ElemType e)</span>&#123;<br>p=new StackNode;<span class="hljs-comment">//生成新结点p</span><br><span class="hljs-keyword">if</span> (!p)<span class="hljs-keyword">return</span> OVERFLOW;<br>p-&gt;data=e;<br>p-&gt;next=S;<br>S=p;<span class="hljs-comment">//S始终指向当前第一个节点(栈顶节点)</span><br><span class="hljs-keyword">return</span> OK;<br><br></code></pre></td></tr></table></figure><h2 id="3-出栈"><a href="#3-出栈" class="headerlink" title="3 出栈"></a>3 出栈</h2><p><span style="background:rgba(240, 107, 5, 0.2)">顺序栈：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">Pop</span><span class="hljs-params">(SqStack &amp;S,SElemType &amp;e)</span><br>&#123;<br><span class="hljs-keyword">if</span>(S.top == S.base）<span class="hljs-keyword">return</span> ERROR;<br>e=*--S.top;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><span style="background:#b1ffff">链栈：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">Pop</span> <span class="hljs-params">(LinkStack &amp;S,SElemType &amp;e)</span><br>&#123;<br><span class="hljs-keyword">if</span> (S==<span class="hljs-literal">NULL</span>)<br><span class="hljs-keyword">return</span> ERROR;<br>e = S-&gt;data;<br>p = S;<br>S = S-&gt;next;<br>delete p;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="3-队列"><a href="#3-队列" class="headerlink" title="3. 队列"></a>3. 队列</h1><blockquote><p>队列是一种先进先出（FIFO）的线性表，只允许在表的一端插入，另一端删除。</p></blockquote><p><font color="#8064a2">顺序队列：</font></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Typedef <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>QElemType *base;<span class="hljs-comment">//初始化的动态分配存储空间</span><br><span class="hljs-type">int</span> front;<span class="hljs-comment">//头指针</span><br><span class="hljs-type">int</span> rear;<span class="hljs-comment">//尾指针</span><br>&#125;SgQueue;<br><br></code></pre></td></tr></table></figure><p><font color="#f79646">链队列：</font></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">QNode</span></span><br><span class="hljs-class">&#123;</span><br>QElemType data;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Qnode</span> *<span class="hljs-title">next</span>;</span><br>&#125;Qnode,*QueuePtr;<br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> </span><br><span class="hljs-class">&#123;</span><br>QueuePtr front;<span class="hljs-comment">//队头指针</span><br>QueuePtr rear;<span class="hljs-comment">//队尾指针</span><br>&#125;LinkQueue;<br><br></code></pre></td></tr></table></figure><h2 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1 初始化"></a>1 初始化</h2><p><span style="background:#d3f8b6">顺序队列：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">InitQueue</span> <span class="hljs-params">(SgQueue &amp;Q)</span><br>&#123;<br>Q.base = new QElemType[MAXQSIZE];<br><span class="hljs-keyword">if</span> (!Q.base)<br><span class="hljs-built_in">exit</span> (OVERFLOW);<br>Q.front=Q.rear=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><span style="background:#fdbfff">链队列：</span><br><strong>有头节点</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">InitQueue</span> <span class="hljs-params">(LinkQueue &amp;Q)</span>&#123;<br>Q.front=(QueuePtr)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(QNode));<br><span class="hljs-keyword">if</span>(!Q.front)<br><span class="hljs-built_in">exit</span>(OVERFLOW);<br>Q.rear=Q.front;<br>Q.front-&gt;next=<span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><span style="background:#d3f8b6">队空标志：front==rear</span><br><span style="background:#d3f8b6">队满标志：（rear+1）%M=front</span>（循环队列）</p><h2 id="2-入队"><a href="#2-入队" class="headerlink" title="2 入队"></a>2 入队</h2><p><strong>链接新节点，更新队尾节点</strong></p><p><span style="background:#d3f8b6">顺序队列：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">EnQueue</span><span class="hljs-params">(SqQueue &amp;Q,QElemType e)</span><br>&#123;<span class="hljs-keyword">if</span>((Q.rear+<span class="hljs-number">1</span>)%MAXQSIZE==Q.front)<br><span class="hljs-keyword">return</span> ERROR;<br>Q.base[Q.rear]=e;<br>Q.rear=(Q.rear+<span class="hljs-number">1</span>)%MAXQSIZE;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><span style="background:#fdbfff">链队列：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">EnQueue</span> <span class="hljs-params">(LinkQueue &amp;Q,QElemType e)</span>&#123;<br>p=(QueuePtr)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span> (QNode));<br><span class="hljs-keyword">if</span>(!p)<br><span class="hljs-built_in">exit</span>(OVERFLOW);<br>p-&gt;data=e;<br>p-&gt;next=<span class="hljs-literal">NULL</span>;<br>Q.rear-&gt;next=p;<br>Q.rear=p;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-出队"><a href="#3-出队" class="headerlink" title="3 出队"></a>3 出队</h2><p><strong>临时存储首元节点，队头节点指向首元节点的下一个节点，删除释放首元节点</strong></p><p><span style="background:#d3f8b6">顺序队列：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">DeQueue</span> <span class="hljs-params">(LinkQueue &amp;Q,QElemType &amp;e)</span><br>&#123;<br><span class="hljs-keyword">if</span>(Q.front==Q.rear)<br><span class="hljs-keyword">return</span> ERROR;<br>e=Q.base[Q.front];<br>Q.front=(Q.front+<span class="hljs-number">1</span>)%MAXQSIZE;<br><span class="hljs-keyword">return</span> OK;<br>&#125;<br></code></pre></td></tr></table></figure><p><span style="background:#fdbfff">链队列：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">Status <span class="hljs-title function_">DeQueue</span> <span class="hljs-params">(LinkQueue &amp;Q,QElemType &amp;e&#123;</span><br><span class="hljs-params"><span class="hljs-keyword">if</span>(Q.front==Q.rear)</span><br><span class="hljs-params"><span class="hljs-keyword">return</span> ERROR;</span><br><span class="hljs-params">p=Q.front-&gt;next;</span><br><span class="hljs-params">e=p-&gt;data;</span><br><span class="hljs-params">Q.front-&gt;next=p-&gt;next;</span><br><span class="hljs-params"><span class="hljs-keyword">if</span>(Q.rear==p)</span><br><span class="hljs-params">Q.rear=Q.front;</span><br><span class="hljs-params"><span class="hljs-built_in">free</span>(p);</span><br><span class="hljs-params"><span class="hljs-keyword">return</span> OK;</span><br><span class="hljs-params">&#125;</span><br></code></pre></td></tr></table></figure><p><span style="background:rgba(240, 200, 0, 0.2)">最后一个节点的时候，不删除，要让队头等于队尾节点。</span></p><h2 id="4-取队列长度"><a href="#4-取队列长度" class="headerlink" title="4 取队列长度"></a>4 取队列长度</h2><p><span style="background:#d3f8b6">顺序队列：</span></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">QueueLength</span><span class="hljs-params">(SqQueue Q)</span><br>&#123;<br><span class="hljs-keyword">return</span> (Q.rear-Q.front+MAXQSIZE)%MAXQSIZE;<br>&#125;<br><br></code></pre></td></tr></table></figure><hr><h1 id="4-串、数组和广义表"><a href="#4-串、数组和广义表" class="headerlink" title="4. 串、数组和广义表"></a>4. 串、数组和广义表</h1><blockquote><p> 串就是字符串<br> 数组包括一维数组和二维数组<br> 广义表类似于 python 中的列表，可以表嵌套</p></blockquote><h1 id="5-树"><a href="#5-树" class="headerlink" title="5. 树"></a>5. 树</h1><p>n 个节点的有限集合</p><h2 id="1性质"><a href="#1性质" class="headerlink" title="1性质"></a>1性质</h2><ul><li>具有 n 个节点的完全二叉树的深度为<br>$$<a href="%E5%8F%96%E4%B8%8B%E7%95%8C">log_2 n</a>+1$$</li></ul><p>两类特殊的二叉树：</p><ol><li>满二叉树：<span style="background:#b1ffff">指深度为 k 且含有</span> $2^k-1$ <span style="background:#b1ffff">个节点的二叉树。</span></li><li>完全二叉树：<span style="background:#affad1">书中所含的 n 个节点和满二叉树中编号为 1 至 n 的节点一一对应。</span></li></ol><h2 id="2存储结构"><a href="#2存储结构" class="headerlink" title="2存储结构"></a>2存储结构</h2><p>顺序存储：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> IMAXSIZE 100</span><br><span class="hljs-keyword">typedef</span> TElemType SqBiTree[MAXSIZE];<br>SqBiTree bt;<br></code></pre></td></tr></table></figure><p>链式存储：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>   TEIemType data;<br>   <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BiTNode</span> *<span class="hljs-title">Ichild</span>, *<span class="hljs-title">rchild</span>;</span><br>&#125;BiTNode, *BiTree;<br></code></pre></td></tr></table></figure><h2 id="3遍历方式"><a href="#3遍历方式" class="headerlink" title="3遍历方式"></a>3遍历方式</h2><blockquote><p>先中后的顺序指的是根据点访问的顺序，如先序遍历就是<font color="#f79646">根左右</font>，后序遍历就是<font color="#f79646">左右根</font>。</p></blockquote><p><img src="https://s2.loli.net/2023/05/24/kyjJIXU7eLSbCFW.png" alt="遍历图|275"></p><h3 id="先序遍历"><a href="#先序遍历" class="headerlink" title="先序遍历"></a>先序遍历</h3><p>ABCDEFGHK</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Preorder</span> <span class="hljs-params">(BiTree T)</span><br>&#123;<br>   <span class="hljs-keyword">if</span> (T)&#123;<br>      visit(T-&gt;data);<br>      Preorder(T-&gt;IchiId);<br>      Preorder(T-&gt;rchiId);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h3><p>BDCAEHGKF</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Inorder</span> <span class="hljs-params">(BiTree T)</span><br>&#123;<br>   <span class="hljs-keyword">if</span> (T) &#123;<br>      Inorder(T-&gt;lchiId);<br>      visit(T-&gt;data);<br>      Ineorder(T-&gt;rchiId);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>中序非递归：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Inorder1</span> <span class="hljs-params">(BiTree T)</span><br>&#123; <br>Initstack(S); p=T;<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">while</span>(p) &#123;Push(S,p);p=p-&gt;lchild;&#125;<span class="hljs-comment">//先将左孩子全部入栈</span><br><span class="hljs-keyword">if</span>(StackEmpty(S)) <span class="hljs-keyword">return</span>;<br>Pop(S,p);<span class="hljs-comment">//出一个左孩子</span><br><span class="hljs-built_in">cout</span>&lt;&lt;P-&gt;data;<br>p=p-&gt;rchild;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h3><p>DCBHKGFEA</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">bkorder</span> <span class="hljs-params">(BiTree T)</span><br>&#123;<br>   <span class="hljs-keyword">if</span> (T) &#123;<br>      bkorder(T-&gt;lchiId);<br>      bkorder(T-&gt;rchiId);<br>      visit(T-&gt;data);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="层次遍历"><a href="#层次遍历" class="headerlink" title="层次遍历"></a>层次遍历</h3><p>ABECFDGHK</p><h3 id="4-常见应用"><a href="#4-常见应用" class="headerlink" title="4 常见应用"></a>4 常见应用</h3><ol><li>统计二叉树中叶子节点的个数：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">CountLeaf</span> <span class="hljs-params">(BiTree T, <span class="hljs-type">int</span> &amp; count)</span> &#123;<br><span class="hljs-keyword">if</span>(T)&#123;<br><span class="hljs-keyword">if</span>(!T-&gt;lchild&amp;&amp;!T-&gt;rchild)<br>count++;<br>CountLeaf(T-&gt;lchild, count);<br>CountLeaf(T-&gt;rchild, count);<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ol start="2"><li>求二叉树的深度：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">Depth</span> <span class="hljs-params">(BiTree I)</span>&#123;<br> <span class="hljs-keyword">if</span> (!T) depthval = O;<br> <span class="hljs-keyword">else</span> &#123;<br>    depthL= Depth(T-&gt;IchiId);<span class="hljs-comment">//求左子树的深度</span><br>    depthR= Depth(T-&gt;rchild);<span class="hljs-comment">//求右子树的深度</span><br>    depthval=<span class="hljs-number">1</span>+ (depthL&gt;depthR?depthL:depthR);<span class="hljs-comment">//取较大者相加</span><br>   &#125;<br> <span class="hljs-keyword">return</span> depthval;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>建立二叉树的存储结构：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">CreateBiTree</span><span class="hljs-params">(BiTree &amp;T)</span>&#123;<br><span class="hljs-type">char</span> ch;<br><span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%c&quot;</span>,&amp;ch);<br><span class="hljs-keyword">if</span>(ch=<span class="hljs-string">&quot;&quot;</span>)<br>T=<span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">else</span><br>&#123;<br>T = new BiTNode;<br>T-&gt;data = ch;<br>CreteBiTree(T-&gt;lchild);<span class="hljs-comment">//创建左子树</span><br>CreteBiTree(T-&gt;rchild);<span class="hljs-comment">//创建右子树</span><br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ol start="4"><li>查询二叉树中的某个节点：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">bool</span> <span class="hljs-title function_">Preorder</span> <span class="hljs-params">(BiTree T, ElemType x, BiTree &amp;p)</span>&#123;<br><span class="hljs-keyword">if</span>(T)&#123;<br>    <span class="hljs-keyword">if</span>(T-&gt;data==x)<span class="hljs-comment">//递归终止条件</span><br>    &#123; <br>    p = T;<br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br>elseif&#123; <br><span class="hljs-keyword">if</span>(Preorder(T-&gt;lchild, x, p))<br><span class="hljs-keyword">return</span> TRUE;<br>elseif&#123;<br><span class="hljs-keyword">if</span>(Preorder(T-&gt;rchild, x, p))<br><span class="hljs-keyword">return</span> TRUE;<br><span class="hljs-keyword">else</span>&#123;<br>p = <span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">return</span> False;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> False;<br></code></pre></td></tr></table></figure><ol start="5"><li>线索二叉树：</li></ol><p>在中序线索二叉树中，查找结点*p的中序后继结点<br><span style="background:rgba(240, 200, 0, 0.2)">1. 若 P-&gt;Rtag 为 1, 则 P 的右线索指向其后继结点<em>q;</span><br><span style="background:rgba(240, 200, 0, 0.2)">2. 若 P-&gt;Rtag 为 0, 则其后继结点</em>q 是右子树中的最左结点。</span></p><ol start="6"><li>森林于树之间的转换</li></ol><blockquote><p>左孩子右兄弟连接原则：左子树均为孩子节点，右子树均为兄弟节点。</p></blockquote><ol start="7"><li>哈夫曼树，降序排列，从低到高，两两（多多）做兄弟构造新树，循环往复<br>所有叶子节点带权长度之和：<br>$$<br>WPL(T)=\sum W_kl_k(对所有叶子节点)<br>$$<blockquote><p>WPL 最小的哈夫曼树为<font color="#8db3e2">最优哈夫曼树</font>。<br>哈夫曼编码原则：<font color="#ff0000">左 0 右 1 原则</font></p></blockquote></li></ol><h1 id="6-图"><a href="#6-图" class="headerlink" title="6. 图"></a>6. 图</h1><h1 id="7"><a href="#7" class="headerlink" title="7."></a>7.</h1>]]></content>
    
    
    <summary type="html">some key points with respect to dataframe-algorithm</summary>
    
    
    
    <category term="前后端开发" scheme="https://alleyf.github.io/categories/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Dataframe-Algorithm" scheme="https://alleyf.github.io/tags/Dataframe-Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>FIR and IIR filter design</title>
    <link href="https://alleyf.github.io/2022/12/b3288796b118.html"/>
    <id>https://alleyf.github.io/2022/12/b3288796b118.html</id>
    <published>2022-12-21T13:17:00.000Z</published>
    <updated>2022-12-21T13:46:59.270Z</updated>
    
    <content type="html"><![CDATA[<h1 id="FIR和IIR滤波器设计与实现"><a href="#FIR和IIR滤波器设计与实现" class="headerlink" title="FIR和IIR滤波器设计与实现"></a>FIR和IIR滤波器设计与实现</h1><h2 id="一、要求"><a href="#一、要求" class="headerlink" title="一、要求"></a>一、要求</h2><p>在子作业4的基础上，采用MATLAB的filterDesigner或fdatool工具箱，设计出相应的IIR滤波器和FIR滤波器。</p><h2 id="二、实现思路"><a href="#二、实现思路" class="headerlink" title="二、实现思路"></a>二、实现思路</h2><h3 id="1-IIR滤波器设计实现"><a href="#1-IIR滤波器设计实现" class="headerlink" title="1.IIR滤波器设计实现"></a>1.IIR滤波器设计实现</h3><p>根据作业四得到的性能指标，利用MATLAB滤波器工具箱，输入性能指标参数选择效果最好的IIR滤波器进行滤波。</p><h3 id="2-FIR滤波器设计实现"><a href="#2-FIR滤波器设计实现" class="headerlink" title="2.FIR滤波器设计实现"></a>2.FIR滤波器设计实现</h3><p>根据作业四得到的性能指标，利用MATLAB滤波器工具箱，输入截止频率**$f_c$**选择合适的窗函数设计得到FIR滤波器。</p><h2 id="三、实现过程"><a href="#三、实现过程" class="headerlink" title="三、实现过程"></a>三、实现过程</h2><h3 id="1-性能指标分析"><a href="#1-性能指标分析" class="headerlink" title="1.性能指标分析"></a>1.性能指标分析</h3><p>数字滤波器的频率响应表示为：<br>$$<br>H(e^{j\omega})=|H(e^{j\omega})|e^{j\beta(j\omega)}<br>$$<br>根据下图中理想低通滤波器逼近的误差容限可以看出，频率响应有通带、过渡带、阻带三个范围:</p><p><img src="https://cdn.jsdelivr.net/gh/chuiyugin/imgbed/%E6%BB%A4%E6%B3%A2%E5%99%A8.png"></p><p>下图展示了不同滤波器的技术指标：</p><p><img src="https://cdn.jsdelivr.net/gh/chuiyugin/imgbed/%E6%BB%A4%E6%B3%A2%E5%99%A82.png"></p><p>依据作业四得到的性能指标，通带截止频率**$w_p=10.7khz$<strong>，阻带截止频率</strong>$w_{st}=11.15khz$<strong>,通带最大衰减系数</strong>$\delta_1=2db$<strong>，阻带最小衰减</strong>$\delta_2=80db$**。可以使用MATLAB滤波器工具箱进行IIR和FIR滤波器的设计。</p><h3 id="2-IIR滤波器设计实现"><a href="#2-IIR滤波器设计实现" class="headerlink" title="2.IIR滤波器设计实现"></a>2.IIR滤波器设计实现</h3><p>采用MATLAB的滤波器设计工具进行设计，在尝试不同种类的滤波器后，对比发现<strong>巴特沃斯滤波器</strong>的效果最佳，因此选择该滤波器来滤除噪声信号，设计得到的IIR滤波器结果如下图所示：</p><img src="D:\IIR.png" style="zoom: 50%;" /><p>IIR滤波过程代码如下：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs matlab">clc<br>clear all<br><span class="hljs-comment">%% 数据导入及参数设置</span><br>[x,Fs]=audioread(<span class="hljs-string">&#x27;D:\DSP实验报告\大作业报告\ch4andch5\myaudio_11.15k_11.95k.wav&#x27;</span>);<br>x=x(:,<span class="hljs-number">1</span>);<span class="hljs-comment">%选择左声道</span><br>N=<span class="hljs-built_in">length</span>(x);<br>t=(<span class="hljs-number">0</span>:N<span class="hljs-number">-1</span>)/Fs;<span class="hljs-comment">%时域范围</span><br>df=Fs/<span class="hljs-built_in">length</span>(t); <span class="hljs-comment">%计算谱线间隔</span><br>f=t*df;<span class="hljs-comment">%频域范围</span><br>X=FFT(x,N,Fs,t);<br>X=fftshift(X);<span class="hljs-comment">%将频谱翻转过来</span><br>f=(f*Fs-Fs/<span class="hljs-number">2</span>)/<span class="hljs-number">1e3</span>;<span class="hljs-comment">%只显示正频谱</span><br>X=<span class="hljs-built_in">abs</span>(X);<br><span class="hljs-comment">% 绘出时域图和幅频响应</span><br><span class="hljs-built_in">figure</span>;<br>subplot(<span class="hljs-number">221</span>)<br><span class="hljs-built_in">plot</span>(t,x);<br>title(<span class="hljs-string">&quot;原信号音频时域图&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;t/s&quot;</span>);<br>subplot(<span class="hljs-number">222</span>)<br><span class="hljs-built_in">plot</span>(f(:,<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>),X(<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;c&#x27;</span>)<br>title(<span class="hljs-string">&quot;原信号音频幅频响应&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;f/Khz&quot;</span>); <br><span class="hljs-comment">%% IIR-Butterworth低通滤波器滤除高频噪声</span><br>y=filter(IIR,x);<br>Y=FFT(y,N,Fs,t);<br>Y=fftshift(Y);<br>Y=<span class="hljs-built_in">abs</span>(Y);<br><span class="hljs-comment">% 绘出滤波后的时域图和幅频响应</span><br>subplot(<span class="hljs-number">223</span>)<br><span class="hljs-built_in">plot</span>(t,y,<span class="hljs-string">&#x27;b&#x27;</span>);<br>title(<span class="hljs-string">&quot;IIR滤波后信号音频时域图&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;t/s&quot;</span>); <br>subplot(<span class="hljs-number">224</span>)<br><span class="hljs-built_in">plot</span>(f(<span class="hljs-number">1</span>,<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>),Y(<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;g&#x27;</span>)<br>title(<span class="hljs-string">&quot;IIR滤波后信号音频幅频响应&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;f/Khz&quot;</span>); <br><span class="hljs-comment">%% 试听及保存</span><br>sound(y,Fs);<br>audiowrite(<span class="hljs-string">&#x27;./IIRfilter.wav&#x27;</span>,y,Fs)<br></code></pre></td></tr></table></figure><h3 id="3-FIR滤波器设计实现"><a href="#3-FIR滤波器设计实现" class="headerlink" title="3.FIR滤波器设计实现"></a>3.FIR滤波器设计实现</h3><p>采用MATLAB的滤波器设计工具进行设计，在尝试不同种类的窗函数后，对比发现<strong>布莱克曼窗</strong>的效果最佳，因此选择该窗函数来滤除噪声信号，设计得到的FIR滤波器结果如下图所示：</p><img src="D:\FIRt.png" style="zoom:50%;" /><p>FIR时域和频域特性图如下图上所示：</p><img src="D:\DSP实验报告\大作业报告\ch4andch5\图片\FIR窗特性.png" style="zoom: 50%;" /><p>FIR滤波过程代码如下：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs matlab">clc<br>clear all<br><span class="hljs-comment">%% 数据导入及参数设置</span><br>[x,Fs]=audioread(<span class="hljs-string">&#x27;D:\DSP实验报告\大作业报告\ch4andch5\myaudio_11.15k_11.95k.wav&#x27;</span>);<br>x=x(:,<span class="hljs-number">1</span>);<span class="hljs-comment">%选择左声道</span><br>Nx=<span class="hljs-built_in">length</span>(x);<br>tx=(<span class="hljs-number">0</span>:Nx<span class="hljs-number">-1</span>)/Fs;<span class="hljs-comment">%时域范围</span><br>df=Fs/<span class="hljs-built_in">length</span>(tx); <span class="hljs-comment">%计算谱线间隔</span><br>fx=tx*df;<span class="hljs-comment">%频域范围</span><br>X=FFT(x,Nx,Fs,tx);<span class="hljs-comment">%快速傅里叶变换</span><br>fx=(fx*Fs)/<span class="hljs-number">1e3</span>;<span class="hljs-comment">%只显示正频谱</span><br>X=<span class="hljs-built_in">abs</span>(X);<br><span class="hljs-comment">% 绘出时域图和幅频响应</span><br><span class="hljs-built_in">figure</span>;<br>subplot(<span class="hljs-number">221</span>)<br><span class="hljs-built_in">plot</span>(tx,x); <br>title(<span class="hljs-string">&quot;原信号音频时域图&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;t/s&quot;</span>); <br>subplot(<span class="hljs-number">222</span>)<br><span class="hljs-built_in">plot</span>(fx(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>:<span class="hljs-built_in">ceil</span>(Nx/<span class="hljs-number">2</span>)),X(<span class="hljs-number">1</span>:<span class="hljs-built_in">ceil</span>(Nx/<span class="hljs-number">2</span>),<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;b&#x27;</span>)<br>title(<span class="hljs-string">&quot;原信号音频幅频响应&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;f/Khz&quot;</span>); <br><span class="hljs-comment">%% blackman窗低通滤波器滤除高频噪声</span><br>y=filter(FIR,x);<br>Ny=<span class="hljs-built_in">length</span>(y);<span class="hljs-comment">%滤波后信号的长度</span><br>ty=(<span class="hljs-number">0</span>:Ny<span class="hljs-number">-1</span>)/Fs;<span class="hljs-comment">%时域范围</span><br>Y=FFT(y,Ny,Fs,ty);<span class="hljs-comment">%快速傅里叶变换求频谱</span><br>df=Fs/<span class="hljs-built_in">length</span>(ty); <span class="hljs-comment">%计算谱线间隔</span><br>fy=ty*df;<span class="hljs-comment">%频域范围</span><br>fy=(fy*Fs)/<span class="hljs-number">1e3</span>;<span class="hljs-comment">%只显示正频谱</span><br>Y=<span class="hljs-built_in">abs</span>(Y);<br><span class="hljs-comment">% 绘出滤波后的时域图和幅频响应</span><br>subplot(<span class="hljs-number">223</span>)<br><span class="hljs-built_in">plot</span>(ty,y,<span class="hljs-string">&quot;b&quot;</span>);<br>title(<span class="hljs-string">&quot;FIR滤波后信号音频时域图&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;t/s&quot;</span>); <br>subplot(<span class="hljs-number">224</span>)<br>stem(fx(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>:<span class="hljs-built_in">ceil</span>(Ny/<span class="hljs-number">2</span>)),Y(<span class="hljs-number">1</span>:<span class="hljs-built_in">ceil</span>(Ny/<span class="hljs-number">2</span>),<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>)<br>title(<span class="hljs-string">&quot;FIR滤波后信号音频幅频响应&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;f/Khz&quot;</span>); <br><span class="hljs-comment">%% 试听及保存</span><br>sound(y,Fs);<br>audiowrite(<span class="hljs-string">&#x27;./FIRfilter.wav&#x27;</span>,y,Fs)<br></code></pre></td></tr></table></figure><h2 id="四、结果展示"><a href="#四、结果展示" class="headerlink" title="四、结果展示"></a>四、结果展示</h2><p>加噪信号经过IIR滤波器和FIR滤波器前后时域、频域对比图如下图所示：</p><table>    <thead>        <th>            <img src="D:\DSP实验报告\大作业报告\ch4andch5\图片\IIR滤波前后对比图.png" alt="IIR滤波前后对比图" style="zoom:50%;display:inline" />        </th>        <th>            <img src="D:\DSP实验报告\大作业报告\ch4andch5\图片\FIR滤波前后对比图.png"  alt="FIR滤波前后对比图" style="zoom:50%;display:inline" />        </th>    </thead></table><p>由图可知IIR和FIR滤波器都很好的滤除了噪声信号，达到了预期的设计，<u>IIR和FIR滤波后的音频依附录可见</u>。</p><h2 id="五、结果分析"><a href="#五、结果分析" class="headerlink" title="五、结果分析"></a>五、结果分析</h2><blockquote><ol><li>IIR滤波器和FIR滤波器各自有各自的优缺点，都有不同的结构和实现方法。<strong>IIR滤波器结构简单</strong>容易实现，但是一般<strong>阶数较高</strong>，而且<strong>不稳定</strong>，相频响应<strong>不是完全线性相位</strong>。<strong>FIR滤波器</strong>一般<strong>阶数较低</strong>，相频响应具有<strong>完全的线性相位</strong>，系统<strong>绝对稳定</strong>，但是线性相位结构的FIR滤波器<strong>结构相对比较复杂</strong>难以实现。</li><li>IIR和FIR滤波器实际人工设计实现起来相对比较复杂，我们可以利用MATLAB中的滤波器设计工具箱辅助我们完成满足要求的各种滤波器，实现起来比较简单容易，</li></ol></blockquote><h2 id="六、源码开源"><a href="#六、源码开源" class="headerlink" title="六、源码开源"></a>六、源码开源</h2><blockquote><p><a href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-24bfcec2-0b23-4547-a957-73ffab276534/2c7c8bdd-2316-47cd-8a94-4882573700a5.zip">源代码资源包</a>有需要的小伙伴可以下载参考。</p></blockquote>]]></content>
    
    
    <summary type="html">some ideas about FIR and IIR filter。</summary>
    
    
    
    <category term="DSP" scheme="https://alleyf.github.io/categories/DSP/"/>
    
    
    <category term="FIR、IIR" scheme="https://alleyf.github.io/tags/FIR%E3%80%81IIR/"/>
    
  </entry>
  
  <entry>
    <title>Frequency——Analysis</title>
    <link href="https://alleyf.github.io/2022/12/98f47ed35125.html"/>
    <id>https://alleyf.github.io/2022/12/98f47ed35125.html</id>
    <published>2022-12-21T13:17:00.000Z</published>
    <updated>2023-03-17T06:34:53.929Z</updated>
    
    <content type="html"><![CDATA[<h1 id="频谱分析及滤波指标设计"><a href="#频谱分析及滤波指标设计" class="headerlink" title="频谱分析及滤波指标设计"></a>频谱分析及滤波指标设计</h1><h2 id="一、要求"><a href="#一、要求" class="headerlink" title="一、要求"></a>一、要求</h2><p>为了完成对子作业1中音频信号的滤波，对子作业1中的音频信号进行<strong>频谱分析</strong>，并获取滤波器设计所需要的<strong>性能指标</strong>。</p><h2 id="二、实现思路"><a href="#二、实现思路" class="headerlink" title="二、实现思路"></a>二、实现思路</h2><h3 id="1-频谱分析"><a href="#1-频谱分析" class="headerlink" title="1.频谱分析"></a>1.频谱分析</h3><h4 id="1-读取音频"><a href="#1-读取音频" class="headerlink" title="1.读取音频"></a>1.读取音频</h4><ul><li>利用<strong>MATLAB</strong>的<code>audioread</code>函数读取原始音频（无噪声原始音频），该函数读取音频的实质是对音频进行<strong>采样</strong>，采样频率根据原始信号的情况而定。</li></ul><h4 id="2-FFT变换"><a href="#2-FFT变换" class="headerlink" title="2.FFT变换"></a>2.FFT变换</h4><ul><li>对读取到的音频取<strong>单声道</strong>根据读取音频时得到的采样频率和频谱分辨率要求计算捕获时间和频谱间隔，进行进行<strong>FFT</strong>快速傅里叶变换得到原始音频信号的频谱，分析频谱的分布。</li></ul><h4 id="3-信号加噪"><a href="#3-信号加噪" class="headerlink" title="3.信号加噪"></a>3.信号加噪</h4><ul><li>给原始信号加入高频带限噪声，加入噪声的频率范围为<code>11.15khz~11.95khz</code>。</li></ul><h4 id="4-FFT变换"><a href="#4-FFT变换" class="headerlink" title="4.FFT变换"></a>4.FFT变换</h4><ul><li>对加噪后的音频信号进行FFT快速傅里叶变换，观察频谱的频率分布和范围。</li></ul><h4 id="5-失真分析"><a href="#5-失真分析" class="headerlink" title="5.失真分析"></a>5.失真分析</h4><ul><li>分析原始信号经过采样后的频谱是否存在<strong>频谱混叠</strong>和<strong>栅栏效应</strong>，如果有则改进加以去除。</li></ul><h3 id="2-设计性能指标"><a href="#2-设计性能指标" class="headerlink" title="2.设计性能指标"></a>2.设计性能指标</h3><ul><li><p>根据前面的频谱得到通带截止频率**$w_p$<strong>和阻带截止频率</strong>$w_s$**。</p></li><li><p>根据频谱设置通带容限**$\alpha1$<strong>和阻带容限</strong>$\alpha2$<strong>，进而得到通带最大衰减系数</strong>$\delta_1$<strong>和阻带最小衰减系数</strong>$\delta_2$**.</p></li></ul><h2 id="三、实现过程"><a href="#三、实现过程" class="headerlink" title="三、实现过程"></a>三、实现过程</h2><h3 id="1-读取原始音频信号及频谱分析"><a href="#1-读取原始音频信号及频谱分析" class="headerlink" title="1.读取原始音频信号及频谱分析"></a>1.读取原始音频信号及频谱分析</h3><p>在MATLAB中利用audioread函数读取原始音频信号，并且绘出其时域图和频谱图，结果如下图所示。</p><img src="D:\DSP实验报告\大作业报告\ch4andch5\图片\原始信号.png" style="zoom:67%;" /><p>由图可知原始音频信号的频谱从<strong>0~10.7khz</strong>左右就基本没有了，因此原始信号的最高频率**$f_{max}=10.7khz$**.</p><p>其源代码如下所示：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-comment">%% 数据导入及参数设置</span><br>[x,Fs]=audioread(<span class="hljs-string">&#x27;D:\DSP实验报告\大作业报告\ch4andch5\myaudio.mp3&#x27;</span>);<br>x=x(:,<span class="hljs-number">1</span>);<span class="hljs-comment">%选择左声道</span><br>N=<span class="hljs-built_in">length</span>(x);<br>t=(<span class="hljs-number">0</span>:N<span class="hljs-number">-1</span>)/Fs;<span class="hljs-comment">%时域范围</span><br>df=Fs/<span class="hljs-built_in">length</span>(t); <span class="hljs-comment">%计算谱线间隔</span><br>f=t*df;<span class="hljs-comment">%频域范围</span><br>X=FFT(x,N,Fs,t);<br>X=fftshift(X);<span class="hljs-comment">%将频谱翻转过来</span><br>f=(f*Fs-Fs/<span class="hljs-number">2</span>)/<span class="hljs-number">1e3</span>;<span class="hljs-comment">%只显示正频谱</span><br>X=<span class="hljs-built_in">abs</span>(X);<br><span class="hljs-comment">% 绘出时域图和幅频响应</span><br><span class="hljs-built_in">figure</span>;<br>subplot(<span class="hljs-number">221</span>)<br><span class="hljs-built_in">plot</span>(t,x);<br>title(<span class="hljs-string">&quot;原信号音频时域图&quot;</span>);<br>ylabel(<span class="hljs-string">&#x27;幅值&#x27;</span>);<br>xlabel(<span class="hljs-string">&quot;t/s&quot;</span>);<br>subplot(<span class="hljs-number">222</span>)<br><span class="hljs-built_in">plot</span>(f(:,<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>),X(<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;c&#x27;</span>)<br><span class="hljs-comment">% plot(f*Fs/1e3,Y,&#x27;k&#x27;);</span><br>title(<span class="hljs-string">&quot;原信号音频幅频响应&quot;</span>);<br>xlabel(<span class="hljs-string">&quot;f/Khz&quot;</span>); <br>ylabel(<span class="hljs-string">&#x27;频率幅值&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="2-信号加噪及频谱分析"><a href="#2-信号加噪及频谱分析" class="headerlink" title="2.信号加噪及频谱分析"></a>2.信号加噪及频谱分析</h3><p>给原始音频信号加入频谱范围为<code>11.15~11.95khz</code>的<strong>高频带限噪声</strong>为后面设计滤波器做准备，绘出加噪信号的时域图和频谱图，如下图所示。</p><img src="D:\DSP实验报告\大作业报告\ch4andch5\图片\加噪信号.png" style="zoom:67%;" /><p>由上图观察可知加噪后的信号在<code>11.15~11.95khz</code>的范围内出现了高频噪声信号，这也是后面需要滤波消除的部分，根据加噪后的信号的频谱可以得到设计滤波器的性能指标。</p><p>源代码如下所示：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-comment">%% 加入噪声</span><br>noise=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">0.1</span>:<span class="hljs-number">0.1</span>:<span class="hljs-number">5</span><br>    noise=noise+<span class="hljs-number">0.003</span>*(<span class="hljs-built_in">cos</span>((<span class="hljs-number">70</span>+<span class="hljs-built_in">i</span>)*<span class="hljs-number">1000</span>*t));<br><span class="hljs-keyword">end</span><br>x_z=x+noise&#x27;;<br>X_Z=FFT(x_z,N,Fs,t);<br>X_Z=fftshift(X_Z);<span class="hljs-comment">%将频谱翻转过来</span><br>X_Z=<span class="hljs-built_in">abs</span>(X_Z);<br>subplot(<span class="hljs-number">211</span>)<br><span class="hljs-built_in">plot</span>(t,x_z);<br>xlabel(<span class="hljs-string">&quot;t/s&quot;</span>);<br>ylabel(<span class="hljs-string">&#x27;幅值&#x27;</span>);<br>title(<span class="hljs-string">&#x27;加噪后信号时域图&#x27;</span>);<br>subplot(<span class="hljs-number">212</span>)<br><span class="hljs-built_in">plot</span>(f(:,<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>),X_Z(<span class="hljs-built_in">ceil</span>(N/<span class="hljs-number">2</span>):<span class="hljs-keyword">end</span>,<span class="hljs-number">1</span>),<span class="hljs-string">&#x27;c&#x27;</span>)<br>xlabel(<span class="hljs-string">&#x27;f/Hz&#x27;</span>);<br>ylabel(<span class="hljs-string">&#x27;频率幅值&#x27;</span>);<br>title(<span class="hljs-string">&#x27;加噪后信号幅频响应&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="3-失真分析"><a href="#3-失真分析" class="headerlink" title="3.失真分析"></a>3.失真分析</h3><p>由上述的频谱图可知原始音频信号**$f_{max}=10.7khz&lt;f_s=48khz$**,因此经过采样后信号没有发生频谱混叠，且没有栅栏效应发生。</p><h3 id="4-设计性能指标"><a href="#4-设计性能指标" class="headerlink" title="4.设计性能指标"></a>4.设计性能指标</h3><p>数字滤波器的频率响应表示为：<br>$$<br>H(e^{j\omega})=|H(e^{j\omega})|e^{j\beta(j\omega)}<br>$$<br>根据下图中理想低通滤波器逼近的误差容限可以看出，频率响应有通带、过渡带、阻带三个范围:</p><p><img src="https://cdn.jsdelivr.net/gh/chuiyugin/imgbed/%E6%BB%A4%E6%B3%A2%E5%99%A8.png"></p><p>下图展示了不同滤波器的技术指标：</p><p><img src="https://cdn.jsdelivr.net/gh/chuiyugin/imgbed/%E6%BB%A4%E6%B3%A2%E5%99%A82.png"></p><p> 对加噪后的音频频谱进行分析，有用信号的频谱范围是<code>0~10.7khz</code>，噪声信号的频谱范围是<code>11.15~11.95khz</code>，因此设置通带截止频率**$w_p=10.7khz$<strong>，阻带截止频率</strong>$w_{st}=11.15khz$<strong>,通带最大衰减系数</strong>$\delta_1=2db$<strong>，阻带最小衰减</strong>$\delta_2=80db$**。</p><h2 id="四、结果展示"><a href="#四、结果展示" class="headerlink" title="四、结果展示"></a>四、结果展示</h2><p>原始音频信号加噪前后时域、频域对比图如下图所示：</p><img src="D:\DSP实验报告\大作业报告\ch4andch5\图片\加噪信号频谱图.png" alt="加噪前后对比图" style="zoom:67%;" /><p>设计滤波器的性能指标如下：</p><p><u>通带截止频率**$w_p=10.7khz$<strong>，阻带截止频率</strong>$w_{st}=11.15khz$<strong>,通带最大衰减系数</strong>$\delta_1=2db$<strong>，阻带最小衰减</strong>$\delta_2=80db$**。</u></p><h2 id="五、结果分析"><a href="#五、结果分析" class="headerlink" title="五、结果分析"></a>五、结果分析</h2><blockquote><ol><li>谱分析的过程中首先要知道分辨率和采样频率等要求，然后根据原始信号的最大频率结合<strong>奈奎斯特采样定理</strong>设定合适的采样频率，再依据$F_0=\frac{1}{T_0}=\frac{1}{N*T_s}$计算得到采样点数和捕获时间等信息，计算频域窗口范围，接着进行FFT变换获得其频谱，观察频谱与理论频谱是否一致，判断是否发生<strong>频谱混叠、栅栏效应</strong>等，若使用了窗函数进行截断还要考虑是否发生<strong>频谱泄露</strong>。</li><li>设计滤波器性能指标过程中，首先需要知道待滤波信号的频谱情况，然后依据频谱判断有用信号和噪声信号的分布，从而确定使用低通、高通、带通还是带阻等滤波器，并且设计相应的性能指标，一般包括<strong>通带截止频率、阻带截止频率、通带最大衰减和阻带最大衰减</strong>四个性能指标。</li></ol></blockquote><h2 id="六、源码开源"><a href="#六、源码开源" class="headerlink" title="六、源码开源"></a>六、源码开源</h2><blockquote><p><a href="https://vkceyugu.cdn.bspapp.com/VKCEYUGU-24bfcec2-0b23-4547-a957-73ffab276534/2c7c8bdd-2316-47cd-8a94-4882573700a5.zip">源代码资源包</a>有需要的小伙伴可以下载参考。</p></blockquote>]]></content>
    
    
    <summary type="html">some ideas about FFT。</summary>
    
    
    
    <category term="DSP" scheme="https://alleyf.github.io/categories/DSP/"/>
    
    
    <category term="FFT" scheme="https://alleyf.github.io/tags/FFT/"/>
    
  </entry>
  
  <entry>
    <title>Embeded theory and appliment</title>
    <link href="https://alleyf.github.io/2022/11/8134dd087a1a.html"/>
    <id>https://alleyf.github.io/2022/11/8134dd087a1a.html</id>
    <published>2022-11-21T08:25:00.000Z</published>
    <updated>2023-07-04T14:20:24.021Z</updated>
    
    <content type="html"><![CDATA[<h1 id="嵌入式原理与应用"><a href="#嵌入式原理与应用" class="headerlink" title="嵌入式原理与应用"></a><span alt="rainbow">嵌入式原理与应用</span></h1><blockquote><p>题型：</p><ol><li>选择（判断）</li><li>简述（解释）</li><li>简答</li><li>硬件设计（画图扩展）</li><li>编程、分析</li></ol><p>重点：</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203145401819.png" alt="image-20221203145401819" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203141024153.png" alt="image-20221203141024153" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203141214880.png" alt="image-20221203141214880" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203141457717.png" alt="image-20221203141457717" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203141626775.png" alt="image-20221203141626775" style="zoom:33%;" /></blockquote><h2 id="1-绪论"><a href="#1-绪论" class="headerlink" title="1.绪论"></a>1.绪论</h2><h3 id="1-1嵌入式系统定义"><a href="#1-1嵌入式系统定义" class="headerlink" title="1.1嵌入式系统定义"></a>1.1嵌入式系统定义</h3><ul><li><p><strong>广义</strong>：<code>微处理器+硬/软件系统</code></p></li><li><p><strong>狭义</strong>：<code>嵌入式微处理器+OS+特定功能+专用+硬/软件系统</code></p></li><li><p><strong>从技术的角度定义</strong>：<u>以应用为中心、以计算机技术为基础、软件硬件可裁剪、适应应用系统对功能、可靠性、成本、体积、功耗严格要求的专用计算机系统。</u></p></li><li><p><strong>从系统的角度定义</strong>：<u>嵌入式系统是设计完成复杂功能的硬件和软件，并使其紧密耦合在一起的计算机系统。术语嵌入式反映了这些系统通常是更大系统中的一个完整的部分，称为嵌入的系统。嵌入的系统中可以共存多个嵌入式系统。</u></p></li></ul><h3 id="1-2嵌入式系统特点及分类"><a href="#1-2嵌入式系统特点及分类" class="headerlink" title="1.2嵌入式系统特点及分类"></a>1.2嵌入式系统特点及分类</h3><h4 id="1-特点"><a href="#1-特点" class="headerlink" title="1.特点"></a>1.特点</h4><ul><li>系统内核小 </li><li>专用性强 </li><li>系统精简 </li><li> 高实时性 </li><li>多任务的操作系统</li><li>需要专门的开发工具和环境（自身不具备）</li></ul><h4 id="2-分类"><a href="#2-分类" class="headerlink" title="2.分类"></a>2.分类</h4><blockquote><p>由于嵌入式系统由硬件和软件两大部分组成，所以其分类也可以从硬件和软件进行划分.</p></blockquote><p><strong>嵌入式系统的硬件</strong></p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121145910133.png" style="zoom: 67%;" /><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121145944569.png"  /><p><strong>嵌入式系统软件</strong></p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121150118822.png" style="zoom: 67%;" /><h3 id="1-3嵌入式微处理器"><a href="#1-3嵌入式微处理器" class="headerlink" title="1.3嵌入式微处理器"></a>1.3嵌入式微处理器</h3><h4 id="1-3-1-ARM处理器"><a href="#1-3-1-ARM处理器" class="headerlink" title="1.3.1 ARM处理器"></a>1.3.1 ARM处理器</h4><p><strong>特点</strong>：</p><ol><li>小体积、低功耗、低成本而高性能；</li><li>16/32位双指令集；</li><li> 全球的合作伙伴众多。</li></ol><h4 id="1-3-2-MIPS"><a href="#1-3-2-MIPS" class="headerlink" title="1.3.2 MIPS"></a>1.3.2 MIPS</h4><blockquote><p><strong>MIPS</strong>是Microprocessor without Inter— locked Pipeline Stages的缩写，是一种处理器内 核标准，它是由MIPS技术公司开发的。</p></blockquote><h3 id="1-4嵌入式操作系统"><a href="#1-4嵌入式操作系统" class="headerlink" title="1.4嵌入式操作系统"></a>1.4嵌入式操作系统</h3><h4 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h4><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121150633545.png" style="zoom:67%;" /><h4 id="2-实时操作系统"><a href="#2-实时操作系统" class="headerlink" title="2.实时操作系统"></a>2.实时操作系统</h4><h5 id="1-特点-1"><a href="#1-特点-1" class="headerlink" title="1.特点"></a>1.特点</h5><ol><li>异步的事件响应 </li><li>切换时间和中断延迟时间确定 </li><li>优先级中断和调度 </li><li><code>抢占式调度</code> </li><li>内存锁定 </li><li>连续文件 </li><li>同步</li></ol><h5 id="2-分类-1"><a href="#2-分类-1" class="headerlink" title="2.分类"></a>2.分类</h5><ul><li><p><strong>一般实时操作系统</strong>：应用于实时处理系统的上位机和实时查询系统等实时性较弱的实时系统，并且提供了开发、调试、运用一致的环境。</p></li><li><p><strong>嵌入式实时操作系统</strong>：统应用于实时性要求高的实时控制系统， 而且应用程序的开发过程是通过交叉开发来完成的， 即开发环境与运行环境是不一致。</p></li></ul><blockquote><p>嵌入式实时操作系统具有规模小(一般在几K～几十 K 内)、可固化使用实时性强(在毫秒或微秒数量级上) 的特点 </p></blockquote><h5 id="3-必要性"><a href="#3-必要性" class="headerlink" title="3.必要性"></a>3.必要性</h5><blockquote><ul><li>嵌入式实时操作系统在目前的嵌入式应用中用得越来 越广泛，尤其在功能复杂、系统庞大的应用中显得愈 来愈重要。 </li><li>在嵌入式应用中，只有把CPU嵌入到系统中，同时又 把操作系统嵌入进去，才是真正的计算机嵌入式应用。</li></ul></blockquote><ol><li>嵌入式实时操作系统提高了系统的可靠性。 </li><li>提高了开发效率，缩短了开发周期。</li><li>嵌入式实时操作系统充分发挥了<strong>32位CPU</strong>的多任务 潜力。</li></ol><h5 id="4-优缺点"><a href="#4-优缺点" class="headerlink" title="4.优缺点"></a>4.优缺点</h5><ol><li><p><strong>优点</strong>：</p><ul><li>在嵌入式实时操作系统环境下开发实时应用程序使程序的<strong>设计和扩展变得容易</strong>，不需要大的改动就可以增加新的功能。 </li><li>通过将应用程序<strong>分割成若干独立的任务模块</strong>，使应用程序的设计过程大为简化；而且对实时性要求苛刻的事件都得到了<strong>快速、可靠的处理。</strong> </li><li>通过有效的系统服务，嵌入式实时操作系统使得<strong>系统资源得到更好的利用</strong></li></ul></li><li><p><strong>缺点</strong>：</p></li></ol><ul><li>需要额外的<strong>ROM/RAM开销</strong>，2~5%的CPU额外负荷， 以及内核的费用</li></ul><h4 id="3-前后台系统"><a href="#3-前后台系统" class="headerlink" title="3.前后台系统"></a>3.前后台系统</h4><blockquote><p>对基于芯片的开发来说，应用程序一般是 一个无限的循环，可称为前后台系统或超循环系统。</p></blockquote><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121151211045.png" style="zoom:67%;" /><h4 id="4-操作系统"><a href="#4-操作系统" class="headerlink" title="4.操作系统"></a>4.操作系统</h4><h5 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h5><blockquote><ul><li><p>实时操作系统是一段在嵌入式系统启动后首先执 行的背景程序，用户的应用程序是运行于<strong>RTOS</strong>之上的各个任务，RTOS根据各个任务的要求，进行<strong>资源(包括存储器、外设等)管理、消息管理、任务调度、异常处理</strong>等工作。</p></li><li><p>在RTOS支持的系统中， 每个任务均有一个优先级，RTOS根据各个任务的优先级，动态地切换各个任务，保证对实时性的要求.</p></li></ul></blockquote><ol><li>是计算机中最基本的程序。</li><li>负责计算机系统中全部软硬资源的分配与回收、控制与协 调等并发的活动；</li><li> 提供用户接口，使用户获得良好的工作环境；</li><li>为用户扩展新的系统功能提供软件平台。</li></ol><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121151424983.png" style="zoom:80%;" /><h5 id="2-代码的临界区"><a href="#2-代码的临界区" class="headerlink" title="2.代码的临界区"></a>2.代码的临界区</h5><blockquote><p>代码的临界区也称为临界区，指处理时不可分割的代码，运行这些代码不允许被打断。一旦这部分代码开始执行，则不允许任何中断打入 （这不是绝对的，如果中断不调用任何包含临界区的代码，也不访问任何临界区使用的共享资源，这个中断可能可以执行）。</p><p><strong>为确保临界区代码的执行，在进入临界区之前要关中断，而临界区代码执行完成以后要立即开中断。</strong></p></blockquote><h5 id="3-资源"><a href="#3-资源" class="headerlink" title="3.资源"></a>3.资源</h5><blockquote><p>程序运行时可使用的软、硬件环境统称为资源。</p></blockquote><ul><li>资源可以是输入输出设备，例如打印机、 键盘、显示器。</li><li>资源也可以是一个变量、一个结构或一个数组等。</li></ul><h5 id="4-共享资源"><a href="#4-共享资源" class="headerlink" title="4.共享资源"></a>4.共享资源</h5><blockquote><p>可以被一个以上任务使用的资源叫做共享资源。 为了防止数据被破坏，每个任务在与共享资源打交道时，必须<strong>独占该资源</strong>，这叫做<strong>互斥</strong>。</p></blockquote><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121152043856.png" style="zoom:67%;" /><h5 id="5-任务"><a href="#5-任务" class="headerlink" title="5.任务"></a>5.任务</h5><blockquote><p>一个任务，也称作一个<strong>线程</strong>，是一个简单的程序， 该程序可以认为CPU完全属于该程序自己。</p></blockquote><p>实时应用程序的设计过程，包括:</p><ol><li>如何把问题分割成多个任务</li><li>每个任务都是整个应用的某一部分</li><li>每个任务被赋予一定的优先级</li><li>有它自己的一套CPU寄存器和自己的栈空间</li></ol><h5 id="6-任务切换"><a href="#6-任务切换" class="headerlink" title="6.任务切换"></a>6.任务切换</h5><blockquote><p>当多任务内核决定运行另外的任务时，它保存正 在运行任务的当前状态，即CPU寄存器中的全部内容。 这些内容保存在任务的当前状态保存区，也就是任务 自已的栈区之中。入栈工作完成以后，就把下一个将 要运行的任务的当前状态从任务的栈中重新装入CPU 的寄存器，并开始下一个任务的运行。这个过程就称为<strong>任务切换</strong>。</p><p>这个过程增加了应用程序的额外负荷。CPU的内部寄 存器越多，额外负荷就越重。做任务切换所需要的时间取决于CPU有多少寄存器要入栈。</p></blockquote><h5 id="7-内核"><a href="#7-内核" class="headerlink" title="7.内核"></a>7.内核</h5><blockquote><p>多任务系统中，<strong>内核负责管理各个任务，或者说为每个任务分配CPU时间，并且负责任务之间的通信</strong>。</p></blockquote><ul><li>内核提供的基本服务是<code>任务切换</code>。 </li><li>使用实时内核可以大大简化应用系统的设计，是因为<code>实时内核</code>允许将应用分成<code>若干个任务</code>，由实时内核来管理它们。内核需要消耗一定的系统资源，比如2％～5％的 <code>CPU运行时间、RAM和ROM</code>等。</li><li>内核提供必不可少的系统服务，如<code>信号量、消息队列、 延时</code>等。</li></ul><h5 id="8-调度"><a href="#8-调度" class="headerlink" title="8.调度"></a>8.调度</h5><blockquote><p>调度是内核的主要职责之一。调度就是决定该轮到哪个任务运行了。</p></blockquote><ul><li>多数实时内核是基于优先级调度法的。每个任务根据其重要程序的不同被赋予一定的优先级。基于优先级的调度法指CPU总是让处在就绪态的优先级最高的任务先运行。</li><li>然而究竟何时让高优先级任务掌握CPU的使用权， 有两种不同的情况，这要看用的是什么类型的内核， 是<strong>非占先式</strong>的还是<strong>占先式</strong>的内核。</li></ul><h5 id="9-非占先式内核"><a href="#9-非占先式内核" class="headerlink" title="9.非占先式内核"></a>9.非占先式内核</h5><blockquote><ol><li>非占先式内核要求每个任务自动弃CPU 的所有权。 非占先式调度法也称作合作型多任务，各个任务彼此合作共享一个CPU。 </li><li>异步事件还是由<strong>中断服务</strong>来处理。 </li><li>中断服务可以使一个高优先级的任务由挂起状态变为<strong>就绪状态</strong>。但中断服务以后控制权还是回到原来被中断了的那个任务，直到该任务主动放弃CPU的使用权时，那个高优先级的任务才能获得CPU的使用权。</li></ol></blockquote><h5 id="10-占先式内核"><a href="#10-占先式内核" class="headerlink" title="10.占先式内核"></a>10.占先式内核</h5><blockquote><ol><li>当系统响应时间很重要时，要使用占先式内核。 因此绝大多数商业上销售的实时内核都是占先式内核。 <strong>最高优先级的任务一旦就绪，总能得到CPU的控制权。</strong> </li><li>当一个运行着的任务使一个比它优先级高的任务进入了就绪状态，当前任务的CPU使用权就被剥夺了，或者说被挂起了，那个高优先级的任务立刻得到了CPU 的控制权。</li></ol></blockquote><h5 id="11-任务优先级"><a href="#11-任务优先级" class="headerlink" title="11.任务优先级"></a>11.任务优先级</h5><blockquote><p>任务的优先级是表示任务被调度的<strong>优先程度</strong>。每个任务都具有优先级。 任务越重要，赋予的优先级应越高，越容易被调度而进入<strong>运行态</strong>。</p></blockquote><h5 id="12-中断"><a href="#12-中断" class="headerlink" title="12.中断"></a>12.中断</h5><blockquote><ol><li>中断是一种硬件机制，用于通知CPU有个<strong>异步事件</strong>发生了。 </li><li>中断一旦被识别，CPU保存部分或全部上下文 （即部分或全部寄存器的值），跳转到专门的子程序， 称为中断服务子程序（ISR）。中断服务子程序做事件处理，处理完成后，程序返回到：<ul><li>在前后台系统中，程序<code>回到后台程序</code>；</li><li>对非占先式内核而言，程序回到被中断了的任务； </li><li>对占先式内核而言，让进入就绪态的优先级最高的任务开始运行</li></ul></li></ol></blockquote><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221121154003220.png" style="zoom:67%;" /><h5 id="13-时钟节拍"><a href="#13-时钟节拍" class="headerlink" title="13.时钟节拍"></a>13.时钟节拍</h5><blockquote><p>时钟节拍是<code>特定的周期性中断</code>。 </p><ul><li> 这个中断可以看作是系统心脏的脉动。 </li><li>中断之间的时间间隔取决于不同应用，一般在<code>10ms到200ms</code>之间。</li><li>时钟的节拍式中断使得内核可以将任务延时 若干个整数时钟节拍，以及当任务等待事件 发生时，提供等待超时的依据。</li><li> <code>时钟节拍率</code>越快，系统的额外开销就越大。</li></ul></blockquote><h2 id="2-体系结构"><a href="#2-体系结构" class="headerlink" title="2.体系结构"></a>2.体系结构</h2><h4 id="1-ARM处理器"><a href="#1-ARM处理器" class="headerlink" title="1.ARM处理器"></a>1.ARM处理器</h4><h5 id="1-ARM简介"><a href="#1-ARM简介" class="headerlink" title="1.ARM简介"></a>1.ARM简介</h5><p>ARM(Advanced RISC Machines)，既可以认为是一个<strong>公司的名字</strong>，也可以认为是对一类<strong>微处理器的通称</strong>，还可以认为是一种<strong>技术的名字</strong>。</p><p>ARM处理器核简介——ARM7<br>• 该系列包括ARM7TDMI、ARM7TDMI-S、带有高速缓存处理器宏单元的ARM720T和扩充了<strong>Jazelle（ java加速器）</strong>的ARM7EJ-S。该系列处理器提供<strong>Thumb 16</strong>位压缩指令集和EmbededICE软件调试方式，适用于更大规模的SoC设计中。<br>• ARM7系列广泛应用于多媒体和嵌入式设备，包括Internet设备、网络和调制解调器设备，以及移动电话、PDA等无线设备。</p><p>ARM处理器核简介——Cortex<br>ARM11以后的产品改用Cortex命名，并分成A、R和M三类：<br>“A”系列面向尖端的基于虚拟内存的操作系统和用户应用——-如：智能手机、平板电脑等<br>“R”系列针对实时系统——如：汽车制动系统等<br>“M”系列针对微控制器—— STM32基于Cortex-M0/M3/M4核</p><p>ARM处理器核简介——SecurCore<br>• 该系列涵盖了SC100、SC110、SC200和SC210处理核。<br>• 该系列处理器主要针对新兴的安全市场，以一种全新的安全处理器设计为智能卡和其它安全IC开发提供独特的32位系统设计，并具有特定反伪造方法，从而有助于防止对硬件和软件的盗版。</p><h4 id="2-RISC（Reduced-Instruction-Set-Computer，精简指令集计算机）体系结构"><a href="#2-RISC（Reduced-Instruction-Set-Computer，精简指令集计算机）体系结构" class="headerlink" title="2.RISC（Reduced Instruction Set Computer，精简指令集计算机）体系结构"></a>2.RISC（Reduced Instruction Set Computer，精简指令集计算机）体系结构</h4><p>RISC特点如下：<br>精简指令集计算机<strong>RISC</strong>结构的产生是相对于传统的复杂指令集计算机<strong>CISC</strong>结构而言的。</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gcode">指令规整、对称、简单。指令小于<span class="hljs-number">100</span>条，基本寻址方式有<span class="hljs-number">2</span>~<span class="hljs-number">3</span>种。<br>■ 单周期指令。<br>■ 指令字长度一致，单拍完成，便于流水操作;<br>■ AR<span class="hljs-name">M7</span> 三级流水线：取址、译码、执行；<br>■ AR<span class="hljs-name">M9</span> 五级流水线；<br>■ ARMl<span class="hljs-number">0</span> 六级流水线。<br>■ 大量的寄存器。寄存器不少于<span class="hljs-number">32</span>个。数据处理器的指令只对寄存器的内容操作。只有加载／存储指令可以访问存储器。<br></code></pre></td></tr></table></figure><p>（1）使计算机的结构更加简单；<br>（2）合理地提高运算速度。</p><h4 id="3-ARM和Thumb状态"><a href="#3-ARM和Thumb状态" class="headerlink" title="3.ARM和Thumb状态"></a>3.ARM和Thumb状态</h4><p>正在执行Thumb指令集的处理器是工作在Thumb状态下——16位。<br>正在执行ARM指令集的处理器是工作在ARM状态下——32位。</p><h4 id="4-寄存器"><a href="#4-寄存器" class="headerlink" title="4.寄存器"></a>4.寄存器</h4><p>ARM处理器有<strong>37(31+6)<strong>个物理寄存器,有</strong>18</strong>个可编程访问的寄存器。</p><ul><li>寄存器被安排成部分重叠的组。每种处理器模式都有不同的寄存器组。</li><li>分组的寄存器在异常处理和特权操作时,可得到快速的上下文切换。</li></ul><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203150113185.png" alt="image-20221203150113185" style="zoom: 33%;" /><h5 id="ARM状态下各模式寄存器"><a href="#ARM状态下各模式寄存器" class="headerlink" title="ARM状态下各模式寄存器"></a>ARM状态下各模式寄存器</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122162025400.png" alt="image-20230122162025400" style="zoom: 33%;" /><blockquote><ol><li><p>在汇编语言中寄存器R0～R13为保存数据或地址值的通用寄存器。它们是完全通用的寄存器，不会被体系结构作为特殊用途，并且可用于任何使用通用寄存器的指令.</p></li><li><p>其中R0～R7为未分组的寄存器，也就是说对于任何处理器模式，这些寄存器都对应于相同的32位物理寄存器.</p></li><li><p>寄存器R8～R14为分组寄存器。它们所对应的物理寄存器取决于当前的处理器模式，几乎所有允许使用通用寄存器的指令都允许使用分组寄存器.</p></li><li><p>寄存器R13常作为堆栈指针（SP）。在ARM指令集当中，没有以特殊方式使用R13的指令或其它功能，只是习惯上都这样使用。但是在Thumb指令集中存在使用R13的指令.</p></li><li><p>R14为链接寄存器（LR），在结构上有两个特殊功能： 在每种模式下，模式自身的R14版本用于保存子程序返回地址； 当发生异常时，将R14对应的异常模式版本设置为异常返回地址（有些异常有一个小的固定偏移量）.</p></li></ol></blockquote><blockquote><p><code>R14寄存器注意要点</code>:</p><p>相同异常嵌套时，<strong>外部中断处理程序保存在R14_irq中的任何值都将被嵌套中断的返回地址所覆盖</strong>。</p><p>IRQ服务程序A执行完毕， 将R14_irq寄存器的内容减去某个常量后存入PC，返回之前被中断的程序；</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122164851577.png" alt="image-20230122164851577" style="zoom:25%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122165002004.png" alt="image-20230122165002004" style="zoom:25%;" /><p><code>读R15的限制</code>：</p><ol><li>正常操作时，从R15读取的值是处理器正在取指的地址，即当前正在执行指令的地址加上8个字节（两条ARM指令的长度）。 由于ARM指令总是以字为单位，所以R15寄存器的最低两位总是为0。</li></ol><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122165358890.png" alt="image-20230122165358890" style="zoom:33%;" /><ol start="2"><li><p>当使用STR或STM指令保存R15时，会有一个例外： 这些指令可能将当前指令地址加8字节或加12字节保存（将来可能还有其它数字）。偏移量是8还是12取决于具体的ARM芯片，但是对于一个确定的芯片， 这个值是一个常量。 所以最好避免使用STR和STM指令来保存R15， 如果很难做到，那么应当在程序中计算出该芯片的偏移量。</p></li><li><p>正常操作时，写入R15 的值被当作一个指令地址，程序从这个地址处继续执行（相当于执行一次无条件跳转）。</p></li></ol></blockquote><blockquote><p>寄存器CPSR为程序状态寄存器，在异常模式中，另外一个寄存器“程序状态保存寄存器（SPSR）”可以被访问。每种异常都有自己的SPSR，在因为异常事件而进入异常时它保存CPSR的当前值， 异常退出时可通过它恢复CPSR。</p><p>堆栈指针SP对应ARM状态的寄存器 R13。每个异常模式都有其自身的SP分组版本，SP通常指向各异常模式所专用的堆栈。 注意：在发生异常时，处理器自动进入ARM状态。</p><p>链接寄存器LR对应ARM状态寄存器 R14，在结构上有两个特殊功能:子程序返回地址、异常返回地址。 注意：在发生异常时，处理器自动进入ARM状态。</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122192204555.png" alt="image-20230122192204555" style="zoom: 25%;" /></blockquote><h4 id="5-指令集概述"><a href="#5-指令集概述" class="headerlink" title="5.指令集概述"></a>5.指令集概述</h4><ol><li>ARM指令集</li></ol><blockquote><p>ARM指令集可分为5大类指令，所有指令都可以条件执行，其中一些指令还可以根据执行结果更新CPSR寄存器的相关标志位.</p><ul><li>数据处理指令 </li><li>加载和存储指令</li><li>分支指令 </li><li>协处理器指令</li><li> 杂项指令</li></ul></blockquote><ol start="2"><li> Thumb指令集</li></ol><blockquote><p>Thumb指令集可分为4大类指令： </p><ul><li>分支指令； </li><li>数据处理指令；</li><li>寄存器加载和存储指令；</li><li>异常产生指令。</li></ul></blockquote><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">ARM—公司名称、微处理器名称和嵌入式技术名称；<br>特点—高性能、小体积、低功耗、紧代码密度、多供应商、高占有率；<br>系列—ARM7、<span class="hljs-built_in">ARM9</span>(E)、ARM10、ARM11、ARM Cortex、Xscale、StrongARM和SecurCore等；<br>结构—两种CPU工作状态、<span class="hljs-number">32</span>位RISC结构、多寄存器、多种处理器模式 、两种指令集；<br></code></pre></td></tr></table></figure><h4 id="6-数据类型"><a href="#6-数据类型" class="headerlink" title="6.数据类型"></a>6.数据类型</h4><p>ARM处理器支持下列数据类型： </p><ol><li>字节 8位 </li><li>半字 16位（必须分配为占用两个字节） </li><li>字 32位（必须分配为占用4个字节）</li></ol><h4 id="7-ARM微处理器的工作状态"><a href="#7-ARM微处理器的工作状态" class="headerlink" title="7.ARM微处理器的工作状态"></a>7.ARM微处理器的工作状态</h4><p>ARM微处理器的工作状态一般有两种:</p><ol><li><code>ARM状态</code>—处理器执行<code>32</code>位的、<code>字对齐</code>的 ARM指令；</li><li><code>Thumb状态</code>—处理器执行<code>16</code>位的、<code>半字对齐</code>的 Thumb指令。</li></ol><p> <strong>处理器状态切换</strong></p><ol><li><p>进入Thumb状态： </p><blockquote><p>当操作数寄存器的<code>状态位(位[0])为1</code>时，执行 <code>BX（带状态切换分支指令）</code>进入Thumb状态。 如果处理器在Thumb状态进入异常，则当异常 处理返回时，自动转换到Thumb状态。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">;从Arm状态切换到Thumb状态<br>LDR R0,=Lable+1<br>BX R0<br></code></pre></td></tr></table></figure></blockquote></li><li><p>进入ARM状态:</p><blockquote><p>当操作数寄存器的<code>状态位(位[0])为0</code>时 执行<code>BX指令</code>进入ARM状态。 当处理器进行异常处理时，进入ARM状态，从异常向量地址处开始执行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">;从Thumb状态切换到ARM状态<br>LDR R0,=Lable<br>BX R0<br></code></pre></td></tr></table></figure></blockquote></li></ol><h4 id="8-存储器格式"><a href="#8-存储器格式" class="headerlink" title="8.存储器格式"></a>8.存储器格式</h4><p>ARM体系结构可以用两种方法存储字数据，称为<strong>大端格式（Big-Endian）</strong>和<strong>小端格式（Little-Endian ）</strong>。</p><p><code>小端格式</code></p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203153053759.png" alt="image-20221203153053759" style="zoom:33%;" /><p><code>大端格式</code></p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203153153991.png" alt="image-20221203153153991" style="zoom:33%;" /><p>示例</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125161454291.png" alt="image-20230125161454291" style="zoom:50%;" /><p><strong>大端反（高地址对应低字节），小端同（高地址对应高字节）</strong></p><blockquote><p><strong>ARM默认小端格式</strong>，但用户可设置大、小端格式</p></blockquote><h4 id="9-处理器模式"><a href="#9-处理器模式" class="headerlink" title="9.处理器模式"></a>9.处理器模式</h4><p>ARM体系结构支持7种处理器模式，分别为：<br><strong>用户模式、快中断模式、中断模式、管理模式、中止模式、未定义模式和系统模式。</strong></p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203160553300.png" alt="image-20221203160553300" style="zoom:33%;" /><h5 id="特权模式"><a href="#特权模式" class="headerlink" title="特权模式"></a>特权模式</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122160458920.png" alt="image-20230122160458920" style="zoom:50%;" /><h5 id="异常模式"><a href="#异常模式" class="headerlink" title="异常模式"></a>异常模式</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122160528448.png" alt="image-20230122160528448" style="zoom:50%;" /><h5 id="用户和系统模式"><a href="#用户和系统模式" class="headerlink" title="用户和系统模式"></a>用户和系统模式</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122161341215.png" alt="image-20230122161341215" style="zoom:50%;" /><h4 id="10-异常"><a href="#10-异常" class="headerlink" title="10.异常"></a>10.异常</h4><h5 id="异常进入"><a href="#异常进入" class="headerlink" title="异常进入"></a>异常进入</h5><p><strong>在异常发生后，ARM7TDMI内核会（自动）做以下工作</strong>： </p><ol><li><p>在适当的LR中保存下一条指令的地址，当异常入口来自： ARM状态，那么ARM7TDMI将当前指令地址加4或加8复制（取决于异常的类型）到LR中；若为Thumb状态，那么保存当前PC值到LR中；这样异常处理程序就不需要确定异常是从何种状态进入的。</p></li><li><p>将CPSR复制到适当的SPSR中； </p></li><li><p>将CPSR模式位强制设置为与异常类型相对应的值； </p></li><li><p>强制PC从相关的异常向量处取指。</p></li></ol><blockquote><ul><li><p><strong>ARM7TDMI</strong>内核在中断异常时<strong>置位中断禁止标志</strong>，这样可以防止不受控制的异常嵌套。</p></li><li><p><strong>异常总是在ARM状态中进行处理</strong>,若在thumb状态，在异常向量地址装入PC时会自动切换到ARM状态</p></li></ul></blockquote><h5 id="异常返回"><a href="#异常返回" class="headerlink" title="异常返回"></a>异常返回</h5><p><strong>当异常结束时，异常处理程序必须</strong>：</p><ol><li><p>将LR中的值减去偏移量后存入PC(手动调整！)，偏移量根据异常的类型而有所不同； </p></li><li><p>将SPSR的值复制回CPSR； </p></li><li><p>若在进入异常处理时设置了中断禁止标志则清零该标志。</p></li></ol><blockquote><ul><li>恢复CPSR的动作会将T、F和I位自动恢复为异常发生前的值。</li></ul></blockquote><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230210163615090.png" alt="image-20230210163615090" style="zoom:50%;" /><h5 id="异常向量表"><a href="#异常向量表" class="headerlink" title="异常向量表"></a>异常向量表</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122192828603.png" alt="image-20230122192828603" style="zoom:33%;" /><h5 id="异常的入口和出口处理"><a href="#异常的入口和出口处理" class="headerlink" title="异常的入口和出口处理"></a>异常的入口和出口处理</h5><blockquote><p>如果异常处理程序已经把返回地址拷贝到堆栈， 那么可以使用一条多寄存器传送指令来恢复用户寄存器并实现返回。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">SUB LR,LR,#4 ;计算返回地址（偏移-4）<br>STMFD SP!,&#123;R0-R3,LR&#125; ;保存使用到的寄存器<br>. . .<br>LDMFD SP!,&#123;R0-R3,PC&#125;^ ;中断返回（加载从左到右）<br></code></pre></td></tr></table></figure><blockquote><p>注意：中断返回指令的寄存器列表（其中必须包括PC）后的“^”符号表示这是一条特殊形式的指令。这条指令在从存储器中装载PC的同时（PC是最后恢复的）， CPSR也得到恢复。 这里使用的堆栈指针SP（R13）是属于异常模式的寄存器，每个异常模式有自己的堆栈指针。 这个堆栈指针应必须在系统启动时初始化。</p></blockquote><h6 id="进入异常"><a href="#进入异常" class="headerlink" title="进入异常"></a>进入异常</h6><p><strong>在异常发生后，ARM7TDMI内核会（自动）做以下工作</strong>： </p><ol><li>在适当的LR中保存下一条指令的地址，当异常入口来自：</li></ol><ul><li><p>ARM状态，那么ARM7TDMI将当前指令地址加4或加8复制（取决于异常的类型）到LR中； </p></li><li><p>Thumb状态，那么保存当前PC值到LR中；这样异常处理程序就不需要确定异常是从何种状态进入的。</p></li></ul><ol start="2"><li><p>将CPSR复制到适当的SPSR中； </p></li><li><p>将CPSR模式位强制设置为与异常类型相对应的值； </p></li><li><p>强制PC从相关的异常向量处取指。</p></li></ol><p>（还可以设置中断禁止位,以禁止其他中断）</p><blockquote><p>注：</p><ul><li><p>ARM7TDMI内核在中断异常时置位中断禁止标志，这样可以防止不受控制的异常嵌套。 </p></li><li><p>异常总是在ARM状态中进行处理。当处理器处于Thumb状态时发生了异常，在异常向量地址装入PC时，会自动切换到ARM状态。</p></li></ul></blockquote><h6 id="退出异常"><a href="#退出异常" class="headerlink" title="退出异常"></a>退出异常</h6><p><strong>当异常结束时，异常处理程序必须</strong>： </p><p>1.将LR中的值减去偏移量后存入PC(手动调整！)，偏移量根据异常的类型而有所不同； </p><p>2.将SPSR的值复制回CPSR； </p><p>3.若在进入异常处理时设置了中断禁止标志则清零该标志。 </p><blockquote><p>注：</p><ul><li>恢复CPSR的动作会将T、F和I位自动恢复为异常发生前的值。</li></ul></blockquote><h5 id="异常种类"><a href="#异常种类" class="headerlink" title="异常种类"></a>异常种类</h5><h6 id="快速中断请求（FIQ）"><a href="#快速中断请求（FIQ）" class="headerlink" title="快速中断请求（FIQ）"></a>快速中断请求（FIQ）</h6><p>快速中断请求(FIQ)适用于对一个突发事件的快速响应，这得益于在ARM状态中，快中断模式有8个专用的寄存器可用来满足寄存器保护的需要（这可以加速上下文切换的速度）。 </p><p>不管异常入口是来自ARM状态还是Thumb状态， FIQ处理程序都会通过执行下面的指令从中断返回： </p><p><code>SUBS PC,R14_fiq,#4</code> </p><p>在一个特权模式中，可以通过置位CPSR中的F位来禁止FIQ异常。</p><h6 id="中断请求（IRQ）"><a href="#中断请求（IRQ）" class="headerlink" title="中断请求（IRQ）"></a>中断请求（IRQ）</h6><p>中断请求（IRQ）异常是一个由nIRQ输入端的低电平所产生的正常中断（在具体的芯片中，nIRQ由片内外设拉低，nIRQ是内核的一个信号，对用户不可见）。 </p><p>IRQ的优先级低于FIQ。进入FIQ处理时FIQ和IRQ都被禁。在一个特权模式下，可通过置位CPSR中的I位来禁止IRQ。</p><p>不管异常入口是来自ARM状态还是Thumb状态，IRQ处理程序都会通过执行下面的指令从中断返回：</p><p><code>SUBS PC,R14_irq,#4</code></p><h6 id="中止（ABT）"><a href="#中止（ABT）" class="headerlink" title="中止（ABT）"></a>中止（ABT）</h6><p>中止发生在对存储器的访问不能完成时， 中止包含两种类型： </p><ol><li><p>预取中止: 发生在指令预取过程中 </p><p>当发生预取中止时，ARM7TDMI内核将预取的指令标记为无效，但在指令到达流水线的执行阶段时才进入异常。</p><p>如果指令在流水线中因为发生分支而没有被执行，中止将不会发生。</p><p>在处理中止的原因之后，不管处于哪种处理器操作状态，处理程序都会执行下面的指令恢复PC和CPSR并重试被中止的指令：</p><p><code>SUBS PC,R14_abt,#4</code></p></li><li><p>数据中止: 发生在对数据访问时</p></li></ol><p>​    当发生数据中止后，根据产生数据中止的指令类型作出不同的处理： </p><p>​    数据转移指令（LDR、STR）—–回写到被修改的基址寄存器。中止处理程序必须注意这一点； </p><p>​    交换指令（SWP）——中止好像没有被执行过一样（中止必须发生在SWP指令进行读访问时）；</p><p>​    块数据转移指令（LDM,STM）完成。当回写被设置时，基址寄存器被更新。在指示出现中止后， ARM7TDMI内核防止所有寄存器被覆盖。这意味着ARM7TDMI内核总是会保护被中止的LDM指令中的R15（总是最后一个被转移的寄存器）。</p><p>​    在修复产生中止的原因后，不管处于哪种处理器操作状态，处理程序都必须执行下面的返回指令 ：</p><p>​    <code>SUBS PC,R14_abt,#8</code></p><h6 id="软件中断指令（SWI）"><a href="#软件中断指令（SWI）" class="headerlink" title="软件中断指令（SWI）"></a>软件中断指令（SWI）</h6><p>使用软件中断(SWI)指令可以进入管理模式， 通常用于请求一个特定的管理函数。</p><p>SWI处理程序通过执行下面的指令返回：</p><p><code>MOVS PC,R14_svc</code></p><p>这个动作恢复了PC和CPSR并返回到SWI之后的指令。SWI处理程序读取操作码以提取SWI函数编号。</p><h6 id="未定义的指令（UND）"><a href="#未定义的指令（UND）" class="headerlink" title="未定义的指令（UND）"></a>未定义的指令（UND）</h6><p>当ARM7TDMI处理器遇到一条自己和系统内任何协处理器都无法处理的指令时，ARM7TDMI 内核执行未定义指令陷阱。</p><p>软件可使用这一机制通过模拟未定义的协处理器指令来扩展ARM指令集。 </p><blockquote><p>注：ARM7TDMI处理器完全遵循ARM结构v4T，可以捕获所有分类未被定义的指令位格式。</p></blockquote><p>在模拟处理了失败的指令后，陷阱程序执行下面的指令： </p><p><code>MOVS PC,R14_und</code> </p><p>这个动作恢复了PC和CPSR并返回到未定义指令之后的指令。</p><h5 id="异常向量"><a href="#异常向量" class="headerlink" title="异常向量"></a>异常向量</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122202516763.png" alt="image-20230122202516763" style="zoom: 25%;" /><h5 id="异常优先级"><a href="#异常优先级" class="headerlink" title="异常优先级"></a>异常优先级</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230122202621615.png" alt="image-20230122202621615" style="zoom: 33%;" /><blockquote><p>注意： <strong>未定义的指令和SWI异常互斥</strong>。因为同一条指令不能既是未定义的，又能产生有效的软件中断； </p><p>当FIQ使能，并且FIQ和数据中止异常同时发生时： </p><p>（1）内核首先进入数据中止处理程序； （2）然后立即跳转到FIQ向量； （3）在FIQ处理结束后返回到数据中止处理程序。</p><p>数据中止的优先级必须高于FIQ以确保数据转移错误不会被漏过。</p></blockquote><h2 id="3-指令集"><a href="#3-指令集" class="headerlink" title="3.指令集"></a>3.指令集</h2><blockquote><p><strong>注意：</strong></p><ul><li><p>所有的ARM指令都是可以有条件执行,而Thumb指令集只有一条指令（B）具有条件执行的功能。 </p></li><li><p>ARM指令和Thumb指令可以相互调用，两者之间的状态切换所用的开销几乎为0</p></li><li><p>立即数合法判断：</p><pre><code class="hljs">立即数必须由 1 个 8 位的常数通过进行 32 位循环右移偶数位得到，其中循环右移的位数由一个 4 位二进制的两倍表示。即一个 8 位的常数通过循环右移 2*rotate_4 位（即 0,2,4，。。。30)得到</code></pre><p><code>1、大于8位的数右移出来的数不合法，</code><br><code>2、小于等于8位的数移动奇数位也不合法</code></p></li></ul></blockquote><h3 id="ARM处理器寻址方式"><a href="#ARM处理器寻址方式" class="headerlink" title="ARM处理器寻址方式"></a>ARM处理器寻址方式</h3><p>ARM处理器具有9种基本寻址方式。</p><table><thead><tr><th align="center">寻址方式</th><th>注释</th><th>示例</th></tr></thead><tbody><tr><td align="center">立即寻址</td><td>立即寻址指令中后面的地址码部分为<a href="https://so.csdn.net/so/search?q=%E7%AB%8B%E5%8D%B3%E6%95%B0&spm=1001.2101.3001.7020">立即数</a>（常量或常数），多用于给寄存器赋初值</td><td><code>MOV R0, #1234</code> ；指令执行后R0=1234，表十六进制数值以0x开头，如#0x20</td></tr><tr><td align="center">寄存器寻址</td><td>寄存器寻址，操作数的值在寄存器中，指令执行从寄存器取值操作</td><td><code>MOV R0, R1</code> ；指令执行后，R0=R1</td></tr><tr><td align="center">寄存器移位寻址</td><td>在操作前需要对源寄存器操作数进行移位操作, 支持五种移位操作：<br /><strong>LSL: 逻辑左移，移位后寄存器空出的低位补0；<br />LSR: 逻辑右移，移位后寄存器空出的高位补0；<br />ASR: 算术右移，移位过程中符号位保持不变，如果源操作数为正数，则移位后空出的高位补0，否则补1.<br />ROR：循环右移，移位后移出的低位填入空出的高位。<br />RRX：带扩展的循环右移，操作数右移一位，移位空出的高位用C标志的值填充。</strong></td><td><code>MOV R0, R1, LSL #2</code> ；将R1寄存器左移2位，即R1&lt;&lt;2后赋值给R0寄存器</td></tr><tr><td align="center">寄存器间接寻址</td><td>寄存器间接寻址是操作数的地址指针，所需的操作数保存在寄存器指定地址的存储单元</td><td><code>LDR R0, [R1]</code>；将R1寄存器的数值作为地址，取出此地址中的值赋值给R0寄存器</td></tr><tr><td align="center">基址寻址</td><td>基址寻址是将基址寄存器与偏移量相加，形成操作数的有效地址。基址寻址多用于查表、数组访问等操作</td><td><code>LDR R0, [R1, #-4]</code> ；将R1寄存器的数值减4作为地址，取出此地址的值赋给R0寄存器</td></tr><tr><td align="center">多寄存器寻址</td><td>多寄存器寻址一条指令最多可以完成16个通用寄存器值的传送</td><td><code>LDMIA R0, &#123;R1, R2, R3, R4&#125;</code><br/>；LDM是数据加载指令，指令IA表示每次执行完加载操作后R0寄存器的值自增1个字（ARM指令字表示一个32位数值），R1=[R0], R2=[R0+#4], R3=[R0+#8], R4=[R0+#12] <br /><code>STMIA R0,&#123;R1,LR&#125;</code> 先存LR,再存R1<br /><code>STMDA R0,&#123;R1,LR&#125;</code> 先存LR,再存R1</td></tr><tr><td align="center">堆栈寻址(用于堆栈)</td><td>堆栈寻址需要使用特定的指令来完成，指令有个LDMFA/STMFA、LDMEA/STMEA、LDMFD/STMFD、LDMED/STMED. LDM和STM为指令前缀表示多寄存器寻址，一次可以传送多个寄存器值，FA/EA/FD/ED为指令后缀。<br /><strong>FD：满递减堆栈，堆栈向低地址生长，堆栈指针指向最后一个入栈的有效数据项<br />FA：满递增堆栈，堆栈向高地址生长，堆栈指针指向最后一个入栈的有效数据项<br />ED：空递减堆栈，堆栈向低地址生长，堆栈指针指向下一个要放入的空地址<br />EA：空递增堆栈，堆栈向高地址生长，堆栈指针指向下一个要放入的空地址</strong></td><td><code>STMFD SP!, &#123;R1-R7, LR&#125;</code>  ；将R1<del>R7,LR入栈。多用于保存子程序现场(从右到左)<br/><code>LDMFD SP!, &#123;R1-R7, LR&#125;</code>  ；将数据出栈，放入R1\</del>R7,LR寄存器。多用于恢复子程序现场<br /></td></tr><tr><td align="center">块拷贝寻址（用于数据块传输）</td><td>快拷贝寻址可实现连续地址数据从存储器的某一位置拷贝到另一位置。指令有个LDMIA/STMIA、LDMDA/STMDA、LDMIB/STMIB、LDMDB/STMDB. LDM和STM为指令前缀表示多寄存器寻址，一次可以传送多个寄存器值，IA/DA/IB/DB为指令后缀.<br /><strong>IA:（Increase After）每次传送后地址加4,其中的寄存器从左到右执⾏<br/>IB:（Increase Before）每次传送前地址加4,同上<br/>DA:（Decrease After）每次传送后地址减4,其中的寄存器从右到左执⾏<br/>DB：(Decrease Before）每次传送前地址减4,同上</strong></td><td><code>LDMIA R0!, &#123;R1-R3&#125;</code> ；从R0寄存器指向的存储单元中读取3个字数据到R1-R3寄存器<br/><code>STMIA R0!, &#123;R1-R3&#125;</code> ；存储R1-R3寄存器的内容到R0寄存器指向的存储单元<br />!:表示最后的地址写回到Rn中</td></tr><tr><td align="center">相对寻址</td><td>相对寻址以程序计数器PC的当前值为基地址，指令中的地址标号作为偏移量，将两者相加之后得到操作数的有效地址</td><td><code>BL NEXT</code>      ;跳到NEXT标号处执行<br/>   ……<br/><code>NEXT:</code>        ;标号NEXT就是偏移量<br/>   ……</td></tr></tbody></table><h3 id="ARM指令集"><a href="#ARM指令集" class="headerlink" title="ARM指令集"></a>ARM指令集</h3><h4 id="1-指令格式"><a href="#1-指令格式" class="headerlink" title="1.指令格式"></a>1.指令格式</h4><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123133643864.png" alt="image-20230123133643864" style="zoom: 50%;" /><h4 id="2-条件码"><a href="#2-条件码" class="headerlink" title="2.条件码"></a>2.条件码</h4><p>所有的ARM指令都可以条件执行，而Thumb指令只有B（跳转）指令具有条件执行功能。如果指令不标明条件代码，将<strong>默认为无条件（AL）执行</strong>。</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123135204279.png" alt="image-20230123135204279" style="zoom:50%;" /><h4 id="3-ARM存储器访问指令"><a href="#3-ARM存储器访问指令" class="headerlink" title="3.ARM存储器访问指令"></a>3.ARM存储器访问指令</h4><p>ARM处理器是典型的RISC处理器，对存储器的访问只能使用加载和存储指令实现。</p><p>ARM处理器是<strong>冯•诺依曼存储结构</strong>，程序空间、RAM空间及I/O映射空间统一编址，除对RAM操作以外，对外围IO、程序数据的访问均要通过加载/存储指令进行。</p><p>存储器访问指令分为单寄存器操作指令和多寄存器操作指令。</p><h5 id="单寄存器加载指令"><a href="#单寄存器加载指令" class="headerlink" title="单寄存器加载指令"></a>单寄存器加载指令</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123135934463.png" alt="image-20230123135934463" style="zoom:33%;" /><h5 id="单寄存器存储指令"><a href="#单寄存器存储指令" class="headerlink" title="单寄存器存储指令"></a>单寄存器存储指令</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123135952113.png" alt="image-20230123135952113" style="zoom:33%;" /><p>LDR/STR指令用于对内存变量的访问、内存缓冲区数据的访问、查表、外围部件的控制操作等。若使用LDR指令加载数据到PC寄存器，则实现程序跳转功能，这样也就实现了程序散转。 </p><blockquote><p>说明：</p><ul><li><p>所有单寄存器加载/存储指令可分为“字和无符号字节加载存储指令”，“半字和有符号字节加载存储指令“。</p></li><li><p>T为可选后缀。若指令有T，那么即使处理器是在特权模式下，存储系统也将访问看成是在用户模式下进行的。</p></li></ul></blockquote><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123141137872.png" alt="image-20230123141137872" style="zoom:33%;" /><blockquote><ul><li><p><strong>有符号位半字/字节</strong>加载是指用<strong>符号位加载扩展到32位</strong>， <strong>无符号半字</strong>加载是指用<strong>零扩展到32位</strong>； </p></li><li><p>地址对齐——半字读写的指定地址必须为<strong>偶数</strong>，否则将产生不可靠的结果</p></li></ul></blockquote><h5 id="多寄存器存取"><a href="#多寄存器存取" class="headerlink" title="多寄存器存取"></a>多寄存器存取</h5><p>LDM和STM指令可以实现在一组寄存器和一块连续的内存单元之间传输数据。 </p><p>LDM为加载多个寄存器； STM为存储多个寄存器。 允许一条指令传送16个寄存器的任何子集或所有寄存器。 </p><p>指令格式如下： </p><p><code>LDM&#123;cond&#125;&lt;模式&gt; Rn&#123;!&#125;,reglist&#123;^&#125;</code></p><p><code>STM&#123;cond&#125;&lt;模式&gt; Rn&#123;!&#125;,reglist&#123;^&#125;</code> </p><blockquote><p>多寄存器存取LDM和STM的主要用途是现场保护、数据复制、常数传递等</p><p><strong>高编号寄存器位于高地址，低编号寄存器位于低地址。</strong></p><p><strong>LDM从最低编号寄存器开始处理，与书写顺序无关，高编号寄存器总是在最后</strong></p><p>“STM<strong>从最高编号寄存器开始处理，与书写顺序无关，高编号寄存器总是在最后</strong>“</p></blockquote><p>多寄存器加载/存储指令的8种类型如下表所示，右边四种为堆栈操作、左边四种为数据传送操作。</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123142102284.png" alt="image-20230123142102284" style="zoom:50%;" /><blockquote><p>进行数据复制时，先设置好源数据指针和目标指针，然后使用块拷贝寻址指令LDMIA/STMIA、LDMIB/STMIB、LDMDA/STMDA、 LDMDB/STMDB进行读取和存储 。 </p><p>进行堆栈操作时，要先设置堆栈指针（SP），然后使用堆栈寻址指令 STMFD/LDMFD 、 STMED/LDMED 、 STMFA/LDMFA 和 STMEA/LDMEA实现堆栈操作。</p></blockquote><p><code>LDM&#123;cond&#125;&lt;模式&gt; Rn&#123;!&#125;,reglist&#123;^&#125;</code></p><p><code>STM&#123;cond&#125;&lt;模式&gt; Rn&#123;!&#125;,reglist&#123;^&#125;</code></p><ul><li><p>指令格式中，寄存器Rn为基址寄存器， 装有传送数据的初始地址，Rn不允许为R15。</p></li><li><p>后缀“!”表示最后的地址写回到Rn中。 </p></li><li><p>寄存器列表reglist可包含多于一个寄存器或包含寄存器范围，使用“ ，”分开，如{R1，R2，R6-R9}，寄存器按由小到大排列。</p></li><li><p>后缀“^”不允许在用户模式或系统模式下使用。</p></li><li><p>若在LDM指令且寄存器列表中<strong>包含有PC</strong>时使用，那么除了正常的多寄存器传送外，<strong>将SPSR也拷贝到CPSR中</strong>，这可<strong>用于异常处理返回</strong>。</p></li><li><p>使用后缀<strong>“^”</strong>进行数据传送且寄存器列表<strong>不包含PC</strong>时，加载／存储的是用户模式的寄存器，而不是当前模式的寄存器。</p></li><li><p>当Rn在寄存器列表中且使用后缀<strong>“!”</strong>时,对于STM指令,若Rn为寄存器列表中的最低数字的寄存器,则会将Rn的初值保存; 其它情况下Rn的加载值和存储值不可预知。地址对齐—这些指令忽略地址位[1:0]。</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">LDMIA R0!，&#123;R3 - R9&#125;；加载R0指向地址上的多字数据，保存到R3~R9中，R0值更新 <br>STMIA R1!，&#123;R3 - R9&#125;；将R3～R9的数据存储到R1指向的地址上，R1值更新 <br>STMFD SP!，&#123;R0 - R7，LR&#125; ；现场保存，将R0～R7、LR人栈 <br>LDMFD SP!，&#123;R0 - R7，PC&#125; ；恢复现场，异常处理返回<br></code></pre></td></tr></table></figure><h5 id="寄存器和存储器交换指令"><a href="#寄存器和存储器交换指令" class="headerlink" title="寄存器和存储器交换指令"></a>寄存器和存储器交换指令</h5><p>SWP指令用于将一个内存单元(该单元地址放在寄存器Rn中)的内容读取到一个寄存器Rd中，同时将另一个寄存器Rm的内容写入到该内存单元中。使用SWP可实现信号量操作。 指令格式如下：</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123143753566.png" alt="image-20230123143753566" style="zoom:33%;" /><p>其中，B为可选后缀，若有B，则交换字节，否则交换32位字； Rd用于保存从存储器中读入的数据；Rm的数据用于存储到存储器中，若Rm与Rd相同，则为寄存器与存储器内容进行交换；Rn为要进行数据交换的存储器地址，Rn不能与Rd和Rm相同。</p><p><code>SWP R1,R1,[R0] ;将R1的内容与R0指向的存储单元的内容进行交换 </code></p><p><code>SWPB R1,R2,[R0] ;将R0指向的存储单元内容读取一字节数据到R1中 ;(高24位清零)，并将R2的内容写入到该内存单元中 ;(最低字节有效)</code></p><h4 id="4-ARM数据处理指令"><a href="#4-ARM数据处理指令" class="headerlink" title="4.ARM数据处理指令"></a>4.ARM数据处理指令</h4><blockquote><p>数据处理指令只能对寄存器的内容进行操作，而不能对内存中的数据进行操作。</p><p>所有ARM数据处理指令均可选择<strong>使用S后缀，并影响状态标志</strong>。</p><p>比较指令<strong>CMP、CMN、TST和TEQ不需要后缀S，它们会直接影响状态标志</strong>。</p></blockquote><h5 id="1-数据传送指令"><a href="#1-数据传送指令" class="headerlink" title="1.数据传送指令"></a>1.数据传送指令</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123144712628.png" alt="image-20230123144712628" style="zoom: 67%;" /><h5 id="2-算术逻辑运算指令"><a href="#2-算术逻辑运算指令" class="headerlink" title="2.算术逻辑运算指令"></a>2.算术逻辑运算指令</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123150144961.png" alt="image-20230123150144961" style="zoom: 67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asm">求64位加法<br>ADDS R0,R0,R2 ;使用ADC实现64位加法<br>ADC R1,R1,R3 ;(R1、R0)＝(R1、R0)+(R3、R2)<br>求64位减法<br>SUBS R0,R0,R2 ;使用SBC实现64位减法<br>SBC R1,R1,R3 ; (R1、R0)＝(R1、R0)-(R3、R2)<br>求64位数值负数<br>RSBS R2,R0,#0 <br>RSC R3,R1,#0 ;使用RSC指令实现求64位数值的负数<br></code></pre></td></tr></table></figure><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123151253591.png" alt="image-20230123151253591" style="zoom: 67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asm">逻辑与<br>ANDS R0,R0,#0x01 ;R0←R0&amp;0x01，取出最低位数据<br>AND R2,R1,R3 ;R2←R1&amp;R3<br>逻辑或<br>ORR R0,R0,#0x0F ;将R0的低4位置1<br>逻辑异或<br>EOR R1,R1,#0x0F ;将R1的低4位取反<br>EORS R0,R5,#0x01 ; 将R5和0x01进行逻辑异或，<br>;结果保存到R0，并影响标志位<br>位清除<br>BIC R1,R1,#0x0F ;将R1的低4位清零，其它位不变<br></code></pre></td></tr></table></figure><h5 id="3-比较指令"><a href="#3-比较指令" class="headerlink" title="3.比较指令"></a>3.比较指令</h5><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123151910240.png" alt="image-20230123151910240" style="zoom: 67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asm">比较指令<br>CMP R1,#10 ; R1-10，R1与10比较，设置相关标志位<br>负数比较指令<br>CMN R0，#1 ；R0+1，判断R0是否为 -1 的补码。若是，<br>； 则Z位置1。<br>位测试指令（按位逻辑与）<br>TST R0,#0x01 ; 判断R0的最低位是否为0 <br>TST R1,#0x0F ; 判断R1的低4位是否为0<br>相等测试指令（按位异或）<br>TEQ R0,R1 ; 比较R0与R1是否相等 (不影响V位和C位)<br></code></pre></td></tr></table></figure><blockquote><p>TST指令与ANDS指令的区别在于TST指令<strong>不保存运算结果</strong>。 TST指令通常与EQ、NE条件码配合使用，当所有测试位均为0时，EQ有效， 而只要有一个测试位不为0， 则NE有效</p><p>TEQ指令与EORS指令的 区别在于TEQ指令不保存运算结果。使用TEQ进行相等测试时， 常与EQ、NE条件码配合使用。当两个数据相等时，EQ有效，否则NE有效。</p></blockquote><h4 id="5-乘法指令"><a href="#5-乘法指令" class="headerlink" title="5.乘法指令"></a>5.乘法指令</h4><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123153407347.png" alt="image-20230123153407347" style="zoom: 67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asm">32乘法<br>MUL R1,R2,R3 ;R1=R2×R3<br>MULS R0,R3,R7 ;R0=R3×R7，同时影响CPSR中的N位和Z位<br>32位乘加<br>MLA R1,R2,R3,R0 ; R1=R2×R3+R0<br>64位无符号乘法<br>UMULL R0,R1,R5,R8 ; (R1、R0)=R5×R8<br>64位无符号乘加<br>UMLAL R0,R1,R5,R8 ;(R1、R0)=R5×R8+(R1、R0)<br></code></pre></td></tr></table></figure><blockquote><p><strong>前低字后高字</strong></p></blockquote><h4 id="6-ARM分支指令"><a href="#6-ARM分支指令" class="headerlink" title="6.ARM分支指令"></a>6.ARM分支指令</h4><p>在ARM中有两种方式可以实现程序的跳转：</p><ul><li><p>一种是使用分支指令直接跳转 </p></li><li><p>另一种则是直接向PC寄存器赋值实现跳转</p></li></ul><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123154217855.png" alt="image-20230123154217855" style="zoom: 50%;" /><p>分支指令——B指令，该指令跳转范围限制在当前指令的±32M字节地址内(ARM指令为字对齐，最低2位地址固定为0)。指令格式如下：</p><p><code>B WAITA ; 跳转到WAITA标号处</code></p><p>带链接的分支指令——BL指令，限制在当前指令的±32MB的范围内，BL指令常用与子程序调用。</p><p><code>BL DELAY ; 调用子程序DELAY</code></p><p>带状态切换的分支指令——BX指令，该指令可以根据跳转地址（Rm） 的最低位来切换处理器状态,bit[0]=0为ARM代码，否则为Thumb。其跳转范围限制在当前指令的±32M字节地址内(ARM指令为字对齐，最低2位地址固定为0)。</p><p><code>ADRL R0,ThumbFun+1 ；将Thumb程序的入口地址加1 ；存入R0（ADRL地址读取伪指令） </code>            </p><p><code>BX R0 ；跳转到R0指定的地址，并根据R0的最低位来切换处理器状态</code></p><h4 id="7-协处理器指令"><a href="#7-协处理器指令" class="headerlink" title="7.协处理器指令"></a>7.协处理器指令</h4><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123154836944.png" alt="image-20230123154836944" style="zoom: 50%;" /><h4 id="8-杂项指令"><a href="#8-杂项指令" class="headerlink" title="8.杂项指令"></a>8.杂项指令</h4><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123154952114.png" alt="image-20230123154952114" style="zoom:50%;" /><h3 id="Thumb指令集和ARM指令集区别"><a href="#Thumb指令集和ARM指令集区别" class="headerlink" title="Thumb指令集和ARM指令集区别"></a>Thumb指令集和ARM指令集区别</h3><ol><li><p>分支指令：</p><p>程序相对转移，特别是条件跳转与ARM代码下的跳转相比，在范围上有更多的限制，转向子程序是无条件的转移。 </p></li><li><p>数据处理指令： </p><ul><li><p>数据处理指令是对通用寄存器进行操作。在大多数情况下，操作的结果须放入其中一个操作数寄存器中，而不是第3个寄存器中。 </p></li><li><p>数据处理操作比ARM状态的更少。</p></li><li><p>访问寄存器R8~R15受到一定限制。</p></li><li><p>除MOV和ADD指令访问器R8～R15外，其它数据处理指令总是更新CPSR中的ALU状态标志。</p></li><li><p>访问寄存器R8~R15的Thumb数据处理指令不能更新CPSR中的ALU状态标志。</p></li></ul></li></ol><p>3.单寄存器加载和存储指令，在Thumb状态下，单寄存器加载和存储指令只能访问寄存器R0~R7。</p><p>4.多寄存器加载和存储指令，LDM和STM指令可以将任何范围为R0<del>R7的寄存器子集加载或存储，多寄存器加载和存储指令只有LDMIA和STMIA指令。PUSH和POP指令使用堆栈指令R13作为基址实现满递减堆栈。 除R0</del>R7外,PUSH指令还可以存储LR, 并且POP指令可以加载PC。</p><h2 id="4-汇编程序设计"><a href="#4-汇编程序设计" class="headerlink" title="4.汇编程序设计"></a>4.汇编程序设计</h2><h3 id="1-ARM伪指令"><a href="#1-ARM伪指令" class="headerlink" title="1.ARM伪指令"></a>1.ARM伪指令</h3><p>与单片机汇编程序设计一样，在ARM汇编语言程序里， 有一些特殊指令助记符，这些助记符与指令系统的真正的指令不同，没有相对应的操作码，通常称这些特殊指令助记符为伪指令，他们所完成的操作称为<strong>伪操作</strong>。 伪指令在源程序中的作用是<strong>为完成汇编程序作各种准备工作的</strong>，这些伪指令<strong>仅在汇编过程中起作用</strong>，一旦汇编结束，伪指令的使命就完成。 在ARM的汇编程序中，有如下几种伪指令：<strong>符号定义伪指令、数据定义伪指令、汇编控制伪指令、宏指令以及其他伪指令</strong>。</p><h4 id="常用伪指令-常考"><a href="#常用伪指令-常考" class="headerlink" title="常用伪指令(常考)"></a>常用伪指令(常考)</h4><ul><li><p>ADR（小范围的地址读取伪指令） </p><p><code>ADR&#123;cond&#125; register, expr</code> </p></li><li><p>ADRL（中等范围的地址读取伪指令） </p><p><code>ADRL&#123;cond&#125; register, expr</code> </p></li><li><p>LDR（大范围的地址读取伪指令） </p><p><code>LDR&#123;cond&#125; register, =expr | label-expr</code> </p></li><li><p>NOP空操作伪指令<br><code>NOP</code></p></li></ul><h4 id="符号定义伪指令（常考）"><a href="#符号定义伪指令（常考）" class="headerlink" title="符号定义伪指令（常考）"></a>符号定义伪指令（常考）</h4><p>符号定义伪指令用于定义ARM汇编语言程序中的变量、对变量赋值以及定义寄存器的别名等操作。常见的符号定义伪指令有如下几种： </p><p>● 用于定义全局变量的GBLA、GBLL和GBLS。 </p><p>● 用于定义局部变量的LCLA、LCLL和LCLS。 </p><p>● 用于对变量赋值的SETA、SETL、SETS。 </p><p>● 为通用寄存器列表定义名称的RLIST。 </p><p>● 为一个协处理器的寄存器定义名称的伪指令：CN </p><p>● 为一个协处理器定义名称的伪指令：CP </p><p>● 为一个VFP寄存器定义名称的伪指令：DN和SN </p><p>● 为一个FPA浮点寄存器定义名称的伪指令：FN</p><h5 id="GBLA、GBLL和GBLS"><a href="#GBLA、GBLL和GBLS" class="headerlink" title="GBLA、GBLL和GBLS"></a>GBLA、GBLL和GBLS</h5><p>GBL<strong>A</strong>伪指令用于定义一个全局的<strong>数字变量</strong>，并初始化为<strong>0</strong>； </p><p>GBL<strong>L</strong>伪指令用于定义一个全局的<strong>逻辑变量</strong>，并初始化为<strong>F（假）</strong>； </p><p>GBL<strong>S</strong>伪指令用于定义一个全局的<strong>字符串变量</strong>，并初始化为<strong>空</strong>； </p><blockquote><p>以上三条伪指令用于定义全局变量，因此在整个程序范围内变量名必须唯一</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">GBLA Number1；定义一个全局的数字变量，变量名为Number1<br>Number1 SETA 0xaa；将Number1变量赋值为0xaa<br>GBLL True1；定义一个全局的逻辑变量，变量名为True1<br></code></pre></td></tr></table></figure><h5 id="LCLA、LCLL和LCLS"><a href="#LCLA、LCLL和LCLS" class="headerlink" title="LCLA、LCLL和LCLS"></a>LCLA、LCLL和LCLS</h5><p>LCLA伪指令用于定义一个局部的数字变量，并初始化为0；</p><p>LCLL伪指令用于定义一个局部的逻辑变量，并初始化为F（假）； </p><p>LCLS伪指令用于定义一个局部的字符串变量，并初始化为空； </p><blockquote><p>以上三条伪指令用于声明局部变量，在其作用范围内变量名必须唯一。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">LCLA Number2；声明一个局部的数字变量，变量名为Number2<br>Number2 SETA 0xaa ；将Number2变量赋值为0xaa<br>LCLL Logic2 ；声明一个局部的逻辑变量，变量名为Logic2<br>Logic2 SETL &#123;TRUE&#125; ；将Logic2变量赋值为真<br>LCLS String2 ；定义一个局部的字符串变量，变量名为String2<br>String2 SETS “Testing” ；将String2变量赋值为“Testing”<br></code></pre></td></tr></table></figure><h5 id="SETA、SETL和SETS"><a href="#SETA、SETL和SETS" class="headerlink" title="SETA、SETL和SETS"></a>SETA、SETL和SETS</h5><p>SETA伪指令用于给一个数学变量赋值； </p><p>SETL伪指令用于给一个逻辑变量赋值； </p><p>SETS伪指令用于给一个字符串变量赋值； </p><blockquote><p>其中，变量名为已经定义过的全局变量或局部变量，表达式为将要赋给变量的值</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">LCLA Number3 ；声明一个局部的数字变量，变量名为Number3<br>Number3 SETA 0xaa ；将Number3变量赋值为0xaa<br>LCLL Logic3；声明一个局部的逻辑变量，变量名为Logic3<br>Logic3 SETL &#123;TRUE&#125;；将Logic3变量赋值为真<br></code></pre></td></tr></table></figure><h5 id="RLIST"><a href="#RLIST" class="headerlink" title="RLIST"></a>RLIST</h5><p>RLIST伪指令可用于对一个通用寄存器列表定义名称， 使用该伪指令定义的名称可在ARM指令LDM/STM中使用。 在LDM/STM指令中，列表中的寄存器访问<strong>次序为根据寄存器的编号由低到高</strong>，而与列表中的寄存器排列次序无关。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">RegList RLIST&#123;R0-R5，R8，R10&#125; ；将寄存器列表<br>名称定义为RegList，可在ARM指令LDM/STM中通过该<br>名称访问寄存器列表。<br>……<br>STMFD SP！，RegList ；保存寄存器列表RegList到<br>堆栈<br></code></pre></td></tr></table></figure><h4 id="数据定义（Data-Definition）伪指令（DCB（-），DCW，DCD（-amp-），SPACE（-），MAP（-），FIELD-常考）"><a href="#数据定义（Data-Definition）伪指令（DCB（-），DCW，DCD（-amp-），SPACE（-），MAP（-），FIELD-常考）" class="headerlink" title="数据定义（Data Definition）伪指令（DCB（=），DCW，DCD（&amp;），SPACE（%），MAP（^），FIELD(#)常考）"></a>数据定义（Data Definition）伪指令（DCB（=），DCW，DCD（&amp;），SPACE（%），MAP（^），FIELD(#)常考）</h4><blockquote><p>数据定义伪指令一般用于为特定的数据分配存储单元，同时可完成已分配存储单元的初始化。常见的数据定义伪指令有如下几种：</p></blockquote><p>● <strong>DCB</strong> 用于分配一片连续的字节存储单元并用指定的数据初始化。 </p><p>● <strong>DCW</strong>（DCWU）用于分配一片连续的半字存储单元并用指定的数据初始化。 </p><p>● <strong>DCD</strong>（DCDU）用于分配一片连续的字存储单元并用指定的数据初始化。 </p><p>● DCFD（DCFDU）用于为双精度的浮点数分配一片连续的字存储单元并用指定的数据初始化。 </p><p>● DCFS（DCFSU） 用于为单精度的浮点数分配一片连续的字存储单元并用指定的数据初始化。 </p><p>● DCQ（DCQU）用于分配一片以8字节为单位的连续的存储单元并用指定的数据初始化。 </p><p>● DCDO 用于分配一段字的内存单元，将每个单元的内容初始化为该单元相对于基址寄存器的偏移量 </p><p>● DCI 用于分配一段字的内存单元，并用单精度的浮点数据初始化，指定内存单元存放的是代码，而不是数据 </p><p>● <strong>SPACE</strong> 用于分配一片连续的字节存储单元，并初始化为0 </p><p>● <strong>MAP</strong> 用于定义一个结构化的内存表首地址 </p><p>● <strong>FIELD</strong> 用于定义一个结构化的内存表的数据域 </p><p>● <strong>LTORG</strong> 用于声明一个文字池（缓冲池）</p><h5 id="DCB"><a href="#DCB" class="headerlink" title="DCB"></a>DCB</h5><blockquote><p>DCB伪指令用于分配一片<strong>连续的字节存储单元</strong>并用伪指令中指定的表达式初始化。其中，表达式可以为0～255 的数字或字符串。<strong>DCB也可用“=“代替</strong>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">String DCB “This is a test！” ；分配一片连续的字节存储单元并初始化。<br>Parameter DCB 0x33，0x44，0x55<br>DCB –1，-2，0，1，2 ；分配一片连续的字节存储单元并初始化。<br></code></pre></td></tr></table></figure><h5 id="DCW-或DCWU"><a href="#DCW-或DCWU" class="headerlink" title="DCW(或DCWU)"></a>DCW(或DCWU)</h5><blockquote><p>DCW（或DCWU）伪指令用于分配一片<strong>连续的半字存储单元</strong>并用伪指令中指定的表达式初始化。 其中，表达式可以是程序标号或数字表达式。 用DCW分配的字存储单元是半字对齐的，而用DCWU分配的字存储单元并不严格半字对齐。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">Data DCW 0，1，2，3 ；分配一片连续的半字存储单元并初始化。<br></code></pre></td></tr></table></figure><h5 id="DCD（或DCDU）"><a href="#DCD（或DCDU）" class="headerlink" title="DCD（或DCDU）"></a>DCD（或DCDU）</h5><blockquote><p>DCD（或DCDU）伪指令用于分配一片<strong>连续的字存储单元</strong>并用伪指令中指定的表达式初始化。 其中，表达式可以为程序标号或数字表达式。<strong>DCD也可用 “&amp;”代替</strong>。 用DCD分配的字存储单元是字对齐的，而用DCDU分配的字存储单元并不严格字对齐。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">Data DCD 3，4，5，6 ；分配一片连续的字存储单元并初始化。<br></code></pre></td></tr></table></figure><h5 id="DCFD（或DCFDU）"><a href="#DCFD（或DCFDU）" class="headerlink" title="DCFD（或DCFDU）"></a>DCFD（或DCFDU）</h5><blockquote><p>DCFD（或DCFDU）伪指令用于为<strong>双精度的浮点数</strong>分配一片连续的字存储单元并用伪指令中指定的表达式初始化。 每个双精度的浮点数占据两个字单元。 用<strong>DCFD分配的字存储单元是字对齐的</strong>，而用</p><p><strong>DCFDU分配的字存储单元并不严格字对齐</strong>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">FData DCFD 0，2E115，-5E7 ；分配一片连续的字存储单元并初始化为指定的双精度数。<br></code></pre></td></tr></table></figure><h5 id="DCFS（或DCFSU）"><a href="#DCFS（或DCFSU）" class="headerlink" title="DCFS（或DCFSU）"></a>DCFS（或DCFSU）</h5><blockquote><p>DCFS（或DCFSU）伪指令用于为<strong>单精度的浮点数</strong>分配一片连续的字存储单元并用伪指令中指定的表达式初始化。每个单精度的浮点数占据一个字单元。 用DCFS分配的字存储单元是字对齐的，而用DCFSU分配的字存储单元并不严格字对齐。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">Sdata DCFS 1，2E5，-5E－7 ；分配一片连续的字存储单元并初始化为指定的单精度数。<br></code></pre></td></tr></table></figure><h5 id="DCQ-或DCQU"><a href="#DCQ-或DCQU" class="headerlink" title="DCQ(或DCQU)"></a>DCQ(或DCQU)</h5><blockquote><p>DCQ（或DCQU）伪指令用于<strong>分配一片以8个字节为单位的连续存储区域</strong>并用伪指令中指定的表达式初始化。 用DCQ分配的存储单元是字对齐的，而用DCQU分配的存储单元并不严格字对齐。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">Data DCQ 100，1000 ；分配一片连续的存储单元并初始化为指定的值。<br></code></pre></td></tr></table></figure><h5 id="DCDO"><a href="#DCDO" class="headerlink" title="DCDO"></a>DCDO</h5><blockquote><p>DCDO用于<strong>分配一段字内存单元</strong>，并将每个单元的内容初始化为<strong>该单元相对于静态基址寄存器的偏移量</strong>。 DCDO伪指令作为静态基址寄存器R9的偏移量分配内存单元，该指令需要内存字对齐。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asm">IMPORT externsys<br>Data DCDO externsys；分配32位的字单元，其值为标号externsys相对于R9的偏移量<br></code></pre></td></tr></table></figure><h5 id="DCI"><a href="#DCI" class="headerlink" title="DCI"></a>DCI</h5><blockquote><p>DCI用于<strong>分配一段字内存单元</strong>，并用伪指令中指定的表达式初始化。<strong>指定内存单元存放的是代码而不是数据</strong>。在Thumb代码中，DCI分配的是半字内存代码单元。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">MACRO ； 这个宏指令将newinstr Rd，Rm定义为相应的机器指令<br>newinstr $Rd，$Rm<br>DCI 0Xe15f0f10 ； 这里存放的是指令<br>MEND<br></code></pre></td></tr></table></figure><h5 id="SPACE"><a href="#SPACE" class="headerlink" title="SPACE"></a>SPACE</h5><blockquote><p>SPACE伪指令用于<strong>分配一片连续的存储区域并初始化为0</strong>。 其中，表达式为要分配的<strong>字节数</strong>。<strong>SPACE也可用“％”代替</strong>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">DataSpace SPACE 1000 ；分配连续1000字节的存储单元并初始化为0。<br></code></pre></td></tr></table></figure><h5 id="MAP"><a href="#MAP" class="headerlink" title="MAP"></a>MAP</h5><blockquote><p>MAP伪指令用于<strong>定义一个结构化的内存表的首地址</strong>。(MAP也可用<strong>“＾”</strong>代替)。表达式可以为程序中的标号或数学表达式，基址寄存器为可选选项. </p><p>•当基址寄存器选项不存在时，表达式的值即为内存表的首地址， </p><p>•当该选项存在时，内存表的首地址为表达式的值与基址寄存器的和。 </p><p>•MAP伪指令通常与FIELD伪指令配合使用来定义结构化的内存表。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asm">MAP 0x100 ；定义结构化内存表首地址的值为0x100。<br></code></pre></td></tr></table></figure><h5 id="FIELD"><a href="#FIELD" class="headerlink" title="FIELD"></a>FIELD</h5><blockquote><p>FIELD伪指令用于<strong>定义一个结构化内存表中的数据域</strong>。(FIELD也可用<strong>“#”</strong>代替)。 </p><p>•表达式的值为当前数据域在内存表中所占的<strong>字节数</strong>。 </p><p>•FIELD伪指令常与MAP伪指令配合使用来定义结构化的内存表。MAP伪指令定义内存表的首地址，FIELD伪指令定义内存表中的各个数据域，并可以为每个数据域指定一个标号供其他的指令引用。 </p><p>•注意MAP和FIELD伪指令仅用于定义数据结构，并不实际分配存储单元。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">MAP 0x100 ；定义结构化内存表首地址的值为0x100。<br>A FIELD 16 ；定义A的长度为16字节，位置为0x100<br>B FIELD 32 ；定义B的长度为32字节，位置为0x110（0x100 后存放了16个字节）<br>S FIELD 256 ；定义S的长度为256字节，位置为0x130（0x110后存放了32个字节）<br></code></pre></td></tr></table></figure><h5 id="LTORG"><a href="#LTORG" class="headerlink" title="LTORG"></a>LTORG</h5><blockquote><p>LTORG用于<strong>声明一个文字池（数据缓冲池）</strong>，在使用LDR伪指令时，要在适当的地址加入LTORG声明文字池， 这样就会把要加载的数据保存在文字池中，再用ARM的加载指令读出数据。如果没有使用LTORG声明文字池，则汇编器会在程序末尾自动声明。使用LTORG声明文字池的目的可以在程序代码的任何位置存储加载的数据。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">……<br>LDR R0，=0x12345 ；有效二进制数位超过8，先放进文字池<br>ADD R1，R1，R0<br>MOV PC，LR<br>LTORG ；声明文字池，此处存放0x12345<br>…… ；其他代码<br></code></pre></td></tr></table></figure><h4 id="汇编控制伪指令"><a href="#汇编控制伪指令" class="headerlink" title="汇编控制伪指令"></a>汇编控制伪指令</h4><blockquote><p>汇编控制伪指令用于控制汇编程序的执行流程，常用的汇编控制伪指令包括以下几条：</p></blockquote><p>● IF、ELSE、ENDIF </p><p>● WHILE、WEND </p><p>● MACRO、MEND </p><p>● MEXIT</p><h5 id="IF、ELSE、ENDIF"><a href="#IF、ELSE、ENDIF" class="headerlink" title="IF、ELSE、ENDIF"></a>IF、ELSE、ENDIF</h5><blockquote><p>IF、ELSE、ENDIF伪指令能<strong>根据条件的成立与否决定是否执行</strong>某个指令序列。当IF后面的逻辑表达式为真，则执行指令序列1，否则执行指令序列2。其中，ELSE及指令序列2可以没有，此时，当IF后面的逻辑表达式为真，则执行指令序列1，否则继续执行后面的指令。 IF、ELSE、ENDIF伪指令可以嵌套使用。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asm">GBLS Version ；定义一个全局的字符串变量，<br>变量名为Version<br>……<br>IF Version =“V1”<br>指令序列1<br>ELSE<br>指令序列2<br>ENDIF<br></code></pre></td></tr></table></figure><h5 id="WHILE、WEND"><a href="#WHILE、WEND" class="headerlink" title="WHILE、WEND"></a>WHILE、WEND</h5><blockquote><p>WHILE、WEND伪指令能<strong>根据条件的成立与否决定是否循环执行</strong>某个指令序列。当WHILE后面的逻辑表达式为真，则执行指令序列，该指令序列执行完毕后，再判断逻辑表达式的值，若为真则继续执行，一直到逻辑表达式的值为假。 WHILE、WEND伪指令可以嵌套使用。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">GBLA Counter ；声明一个全局的数字变量，变量名为<br>Counter，作为循环计数器<br>……<br>WHILE Counter &lt; 10<br>指令序列<br>WEND<br></code></pre></td></tr></table></figure><h5 id="MACRO、MEND"><a href="#MACRO、MEND" class="headerlink" title="MACRO、MEND"></a>MACRO、MEND</h5><blockquote><p>MACRO、MEND伪指令<strong>可以将一段代码定义为一个整体</strong>，称为<strong>宏指令</strong>，然后就可以在程序中通过宏指令多次调用该段代码。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">MACRO<br>CODE_1； 宏名为CODE_1，无参数<br>LDR R0，=rPDATG； 读取PG0口的值<br>LDR R1，[R0]<br>ORR R1，R1，#0X01； CSI置位<br>STR R1，[R0]<br>MEND<br></code></pre></td></tr></table></figure><blockquote><p>宏定义中，**$标号<strong>在宏指令被展开时，标号会被替换为用户定义的符号，</strong>宏指令可以使用一个或多个参数**， 当宏指令被展开时，这些参数被相应的值替换。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asm">MACRO ；宏定义<br>CALLSubfunction $Function，$dat1，$dat2 ；<br>宏名为CALLSubfunction，带3个参数<br>IMPORT $Function ；声明外部子程序名<br>MOV R0，$dat1 ；设置子程序参数R0=$dat1<br>MOV R1，$dat2<br>BL Function ；调用子程序<br>MEND ；宏定义结束<br></code></pre></td></tr></table></figure><h4 id="其他常用的伪指令"><a href="#其他常用的伪指令" class="headerlink" title="其他常用的伪指令"></a>其他常用的伪指令</h4><blockquote><p>其他的一些使用较频繁的伪指令：</p></blockquote><p>● AREA </p><p>● ALIGN</p><p>● CODE16、CODE32 </p><p>● ENTRY </p><p>● END </p><p>● EQU </p><p>● EXPORT（或GLOBAL） </p><p>● IMPORT </p><p>● EXTERN </p><p>● GET（或INCLUDE） </p><p>● INCBIN</p><h5 id="AREA"><a href="#AREA" class="headerlink" title="AREA"></a>AREA</h5><blockquote><p>AREA伪指令用于<strong>定义一个代码段或数据段</strong>。ARM汇编程序设计采用分段式设计，一个ARM汇编源程序至少需要一个代码段，大的程序可以包含多个代码段和数据段。 当程序太长时，也可以将程序分为多个代码段和数据段。使用AREA伪指令将程序分为多个ELF（Executable and Linkable Format）格式的段，段名可以相同，这时同名的段被放在同一个EFL段中。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>指令序列<br>；该伪指令定义了一个代码段，段名为Init，属性为只读<br></code></pre></td></tr></table></figure><h5 id="ALIGN"><a href="#ALIGN" class="headerlink" title="ALIGN"></a>ALIGN</h5><blockquote><p>ALIGN伪指令<strong>可通过添加填充字节的方式</strong>，使当前位置满足一定的对齐方式。其中，表达式的值用于指定对齐方式，可能的取值为2的幂，如1、2、4、8、16等。 若未指定表达式，则将当前位置对齐到下一个字的位置。 偏移量也为一个数字表达式，若使用该字段，则当前位置的对齐方式为：2的表达式次幂＋偏移量。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY，ALIGN＝3 ；指定后面的指令为8字节对齐。<br>指令序列<br>END<br></code></pre></td></tr></table></figure><h5 id="CODE16、CODE32"><a href="#CODE16、CODE32" class="headerlink" title="CODE16、CODE32"></a>CODE16、CODE32</h5><blockquote><p>CODE16伪指令通知编译器，其后的指令序列为16位的Thumb指令。</p><p>CODE32伪指令通知编译器，其后的指令序列为32位的ARM指令。</p><p>CODE16和CODE32伪指令只告诉编译器后面的指令是16位或32位的类型，指令本身不能进行程序状态的切换，如果要进行状态的切换，可以使用BX指令进行操作。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>……<br>CODE32 ；通知编译器其后的指令为32位的ARM指令<br>LDR R0，＝NEXT＋1 ；将跳转地址放入寄存器R0<br>BX R0 ；程序跳转到新的位置执行，并将处理器切换到Thumb工作状态<br>……<br>CODE16 ；通知编译器其后的指令为16位的Thumb指令<br>NEXT<br>LDR R3，＝0x3FF<br>……<br>END ；程序结束<br></code></pre></td></tr></table></figure><h5 id="ENTRY"><a href="#ENTRY" class="headerlink" title="ENTRY"></a>ENTRY</h5><blockquote><p>ENTRY伪指令<strong>用于指定程序的入口点</strong>。在一个完整的汇编语言程序中至少要有一个ENTRY（也可以有多个，当有多个ENTRY时，程序的真正入口点由链接器指定）,但在一个源文件里最多只能有一个ENTRY（可以没有）。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>ENTRY ；指定应用程序的入口点<br>……<br></code></pre></td></tr></table></figure><h5 id="END"><a href="#END" class="headerlink" title="END"></a>END</h5><blockquote><p>END伪指令用于通知编译器已经到了源程序的结尾。每一个汇编源文件都需要使用一个END伪指令，<strong>指示本源程序结束</strong>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>……<br>END ；指定应用程序的结尾<br></code></pre></td></tr></table></figure><h5 id="EQU"><a href="#EQU" class="headerlink" title="EQU"></a>EQU</h5><blockquote><blockquote><p>EQU伪指令用于<strong>为程序中的常量、标号等定义一个等效的字符名称</strong>，类似于C语言中的<strong>＃define</strong>。其中EQU可用 <strong>“*”代替</strong>。名称为EQU伪指令定义的字符名称，当表达式为32位的常量时，可以指定表达式的数据类型，可以有以下三种类型：CODE16、CODE32和DATA。</p></blockquote></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">ABCE EQU label+8； 定义地址标号ABCE为label+8<br>Test EQU 50 ；定义标号Test的值为50<br>Addr EQU 0x55，CODE32 ；定义Addr的值为0x55，且该处为32位的ARM指令。<br></code></pre></td></tr></table></figure><h5 id="EXPORT（或GLOBAL）"><a href="#EXPORT（或GLOBAL）" class="headerlink" title="EXPORT（或GLOBAL）"></a>EXPORT（或GLOBAL）</h5><blockquote><p>EXPORT伪指令用于在程序中<strong>声明一个全局的标号</strong>，<strong>该标号可在其他的文件中引用</strong>。EXPORT<strong>可用GLOBAL代替</strong>。标号在程序中区分大小写。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>EXPORT main ；声明一个可全局引用的标号main<br>……<br>END<br></code></pre></td></tr></table></figure><h5 id="IMPORT"><a href="#IMPORT" class="headerlink" title="IMPORT"></a>IMPORT</h5><blockquote><p>IMPORT伪指令用于<strong>通知编译器要使用的标号在其他的源文件中定义</strong>，<strong>但要在当前源文件中引用</strong>，而且无论当前源文件是否引用该标号，该标号<strong>均会被加入到当前源文件的符号表中</strong>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>IMPORT main ；通知编译器当前文件要引用标号main，但main在其他源文件中定义<br>……<br>END<br></code></pre></td></tr></table></figure><h5 id="EXTERN"><a href="#EXTERN" class="headerlink" title="EXTERN"></a>EXTERN</h5><blockquote><p>EXTERN伪指令用于<strong>通知编译器要使用的标号在其他的源文件中定义，但要在当前源文件中引用</strong>，如果当前源文件<strong>实际并未引用该标号，该标号就不会被加入到当前源文件的符号表中</strong>。注意: 该伪指令与IMPORT的区别是，<strong>IMPORT伪指令无论当前源文件是否引用该标号，该标号均会被加入到当前源文件的符号表中</strong>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>EXTERN main ；通知编译器当前文件要引用标号main，<br>main在其他源文件中定义，如果本文件<br>中没有使用main，则main就不会被加<br>入到当前源文件的符号表中。<br>……<br>END<br></code></pre></td></tr></table></figure><h5 id="GET（或INCLUDE）"><a href="#GET（或INCLUDE）" class="headerlink" title="GET（或INCLUDE）"></a>GET（或INCLUDE）</h5><blockquote><p>GET伪指令用于<strong>将一个源文件包含到当前的源文件中，并将被包含的源文件在当前位置进行汇编处理</strong>。可以<strong>使用INCLUDE代替GET</strong>。使用方法与C语言中的 “include”相似。 GET伪指令只能用于包含源文件，如果需要包含经过编译后的二进制目标文件，需要使用INCBIN伪指令。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>GET a1.s ；通知编译器当前源文件包含源文件a1.s<br>GET C：\a2.s；通知编译器当前源文件包含源文件C：\ a2.s<br>……<br>END<br></code></pre></td></tr></table></figure><h5 id="INCBIN"><a href="#INCBIN" class="headerlink" title="INCBIN"></a>INCBIN</h5><blockquote><p>INCBIN伪指令用于<strong>将一个二进制目标代码文件或任意格式的数据文件包含到当前的源文件中</strong>，被包含的文件不作任何变动地存放在当前文件中，编译器从其后开始继续处理。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>INCBIN a1.dat ；通知编译器当前源文件包含文件a1.dat<br>INCBIN C：\a2.txt；通知编译器当前源文件包含文件C：\a2.txt<br>INCBIN a3.bin ；通知编译器当前源文件包含文件a3.bin<br>……<br>END<br></code></pre></td></tr></table></figure><h3 id="2-汇编语法"><a href="#2-汇编语法" class="headerlink" title="2.汇编语法"></a>2.汇编语法</h3><blockquote><p>在一个项目设计中：至少需要有一个汇编源文件或C程序文件，可以有多个汇编文件或多个C程序文件，或者C语言和汇编语言混合编程的文件。汇编程序源文件的扩展名必须是“.s”。</p></blockquote><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230123210515574.png" alt="image-20230123210515574" style="zoom:33%;" /><h4 id="汇编语句语法"><a href="#汇编语句语法" class="headerlink" title="汇编语句语法"></a>汇编语句语法</h4><h5 id="汇编语句格式"><a href="#汇编语句格式" class="headerlink" title="汇编语句格式"></a>汇编语句格式</h5><blockquote><p>ARM（Thumb）汇编语言的语句格式为： <strong>{标号} {指令或伪指令} {；注释}</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asm">正确的例子：<br>……<br>String1 SETS “My string1”<br>Count RN R0 ；给R0寄存器定义别名<br>START<br>LDR R0，=0x12345<br>MOV R1，#0<br>LOOP<br>MOV R2，#3<br>……<br>错误的例子：<br>START MOV R0，#1 ；标号START没有顶头写<br>ABC： MOV R1，#2 ；标号后不能带：<br>MOV R2，#3 ；指令不允许顶头写<br>Loop Mov R2，#3 ；指令中大小写混合<br> B loop ；无法跳转到Loop去<br></code></pre></td></tr></table></figure><h5 id="标号"><a href="#标号" class="headerlink" title="标号"></a>标号</h5><blockquote><p>在ARM汇编中，标号代表一个地址，段内标号的地址在汇编时确定，而段外标号的地址在连接时确定，根据标号的生成方式，可以有以下3种方式： </p><p>（1）<strong>基于PC的标号</strong>是位于目标指令前的标号或程序中的数据定义伪指令前的标号，这种标号在汇编时被处理成PC值加上或减去一个数字常量，它常用于跳转指令的目标地址，或代码段中所嵌入的少量数据。</p><p>（2）<strong>基于寄存器的标号</strong>通常由MAP和FIELD伪指令定义，也可以用EQU伪指令定义。这种标号在汇编时被处理成寄存器的值加上或减去一个数字常量。它通常被用于访问位于数据段中的数据。 </p><p>（3）<strong>绝对地址</strong>是一个32位的数字，它可以寻址的范围是<strong>0~2^32-1</strong>，可以直接寻址整个内存空间。</p></blockquote><h5 id="常用符号"><a href="#常用符号" class="headerlink" title="常用符号"></a>常用符号</h5><p>● 符号由大、小写字母、数字以及下划线组成。 </p><p>● 除局部标号以数字开头外，其他的符号不能以数字开头 </p><p>● 符号区分大小写，同名的大、小写符号会被编译器认为是两个不同的符号。 </p><p>● 符号在其作用范围内必须唯一。 </p><p>● 自定义的符号名不能与系统的保留字相同。 </p><p>● 符号名不应与指令或伪指令同名。</p><h3 id="3-汇编程序设计"><a href="#3-汇编程序设计" class="headerlink" title="3.汇编程序设计"></a>3.汇编程序设计</h3><blockquote><p>在ARM（Thumb）汇编语言程序中，以程序段为单位组织代码。段是相对独立的指令或数据序列，具有特定的名称。段可以分为<strong>代码段和数据段</strong>，代码段的内容为执行代码，数据段存放代码运行时需要用到的数据。一个汇编程序至少应该有一个代码段，当程序较长时，可以分割为多个代码段和数据段，多个段在程序编译链接时最终形成一个<strong>可执行的映象文件</strong>。 可执行映象文件通常由以下几部分构成： ● 一个或多个代码段，<strong>代码段</strong>的属性为<strong>只读</strong>。 </p><p>● 零个或多个包含初始化数据的数据段，<strong>数据段</strong>的属性为<strong>可读写</strong>。 </p><p>● 零个或多个不包含初始化数据的数据段，数据段的属性为可读写。 链接器根据系统默认或用户设定的规则，将各个段安排在存储器中的相应位置。因此<strong>源程序中段之间的相对位置与可执行的映象文件中段的相对位置一般不会相同</strong>。</p></blockquote><p>汇编语言源程序的基本结构：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>ENTRY<br>Start<br>LDR R0，=0x3FF5000<br>MOV R1，#0xFF<br>STR R1，[R0]<br>LDR R0，=0x3FF5008<br>MOV R1，#0x01<br>STR R1，[R0]<br>……<br>END<br></code></pre></td></tr></table></figure><p>在汇编语言程序中，用<strong>AREA伪指令定义一个段</strong>，并说明所定义段的相关属性，本例定义一个名为Init的代码段，属性为只读。ENTRY伪指令标识程序的入口点，接下来为指令序列，程序的末尾为END伪指 令，该伪指令告诉编译器源文件的结束，每一个汇编语言程序段都必须有一条END伪指令，指示代码段的结束。</p><h4 id="子程序调用"><a href="#子程序调用" class="headerlink" title="子程序调用"></a>子程序调用</h4><blockquote><p>在ARM汇编语言程序中，子程序的调用一般是通过BL指令来实现的。在程序中，使用指令“<strong>BL子程序名</strong>”即可完成子程序的调用。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA Init，CODE，READONLY<br>ENTRY<br>Start<br>LDR R0，=0x3FF5000<br>MOV R1，#0xFF<br>STR R1，[R0]<br>LDR R0，=0x3FF5008<br>MOV R1，#0x01<br>STR R1，[R0]<br>BL PRINT_TEXT<br>……<br>PRINT_TEXT<br>……<br>MOV PC，LR<br>……<br>END<br></code></pre></td></tr></table></figure><h4 id="宏定义及其作用"><a href="#宏定义及其作用" class="headerlink" title="宏定义及其作用"></a>宏定义及其作用</h4><blockquote><p>• 使用宏定义可以提高程序的可读性，简化程序代码和同步修改。 </p><p>• ARM宏定义与标准C语言的#define相似，只在源程序中进行字符的简单替代。 </p><p>• 宏定义从MACRO伪指令开始，到MEND结束，并可以使用参数。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs asm">MACRO ；宏定义<br>CALLSubfunction $Function，$dat1，$dat2 ；宏名为；CALLSubfunction，带3个参数<br>IMPORT $Function ；声明外部子程序名<br>MOV R0，$dat1 ；设置子程序参数R0=$dat1<br>MOV R1，$dat2<br>BL Function ；调用子程序<br>MEND ；宏定义结束<br>……<br>CALLSubfunction FADD1，#3，#2 ；宏调用<br>……<br>汇编处理后，宏调用将被展开，程序如下：<br>……<br>IMPORT FADD1<br>MOV R0，#3<br>MOV R1，#2<br>BL FADD1<br>……<br></code></pre></td></tr></table></figure><h4 id="数据比较跳转"><a href="#数据比较跳转" class="headerlink" title="数据比较跳转"></a>数据比较跳转</h4><blockquote><p>汇编程序可以使用<strong>CMP指令进行两个数的比较</strong>，然后根据比较结果实现程序的跳转，代码如下：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asm">CMP R5，#10<br>BEQ BRANCH1 ；如果R5为10，则跳转到；BRANCH1<br>……<br>CMP R1，R2<br>ADDHI R1，R1，#1 ；如果R1&gt;R2，则R1=R1+1<br>ADDLS R1，R1，#2 ；如果R1&lt;=R2，则R1=R1+2<br>……<br>ANDS R1，R1，#0x80 ；R1=R1&amp;0x80，并设置相应的标志位<br>BNE WAIT ；如果R1的第7位1，则跳转到WAIT<br></code></pre></td></tr></table></figure><h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><blockquote><p>下面的程序代码为汇编循环程序的例子，指定了循环的次数，每循环一次进行减1操作，并判断结果是否为0，如果为0则退出循环。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">MOV R0，#10<br>LOOP<br>……<br>SUBS R0，R0，#1<br>BNE LOOP<br>……<br></code></pre></td></tr></table></figure><h4 id="数据块复制"><a href="#数据块复制" class="headerlink" title="数据块复制"></a>数据块复制</h4><blockquote><p>可以使用存储器访问指令<strong>LDM/STM</strong>进行读取和存储，进行数据块的复制，示例代码如下：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asm">LDR R0，=DATA_DST ；指向数据的目标地址<br>LDR R1，=DATA_SRC ；指向数据源地址<br>MOV R10，#10 ；复制数据块的大小为10*N个字<br>LOOP LDMIA R1！，&#123;R2-R9&#125;<br>     STMIA R0！，&#123;R2-R9&#125;<br>     SUBS R10，R10，#1<br>     BNE LOOP<br>……<br></code></pre></td></tr></table></figure><h4 id="堆栈操作"><a href="#堆栈操作" class="headerlink" title="堆栈操作"></a>堆栈操作</h4><blockquote><p>可以使用存储器访问指令<strong>LDM/STM</strong>实现堆栈操作，用于子程序的寄存器保护。在使用堆栈前，首先需要分配好堆栈空间，设置好寄存器R13（即堆栈指针SP），否则操作失败。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asm">OUTDAT<br>STMFD SP！，&#123;R0-R7，LR&#125; ；寄存器入栈，压栈从右到左<br>……<br>BL DELAY<br>……<br>LDMFD SP！，&#123;R0-R7，PC&#125;^ ；寄存器出栈，出栈从左到右<br></code></pre></td></tr></table></figure><h4 id="查表操作"><a href="#查表操作" class="headerlink" title="查表操作"></a>查表操作</h4><blockquote><p>查表操作是汇编程序经常使用的一种功能，代码如下：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asm">……<br>LDR R3，=DISP_TAB ；字模表的首地址<br>LDR R2，[R3，R5，LSL #2] ；根据R5的值查表，取出相应的值。<br>……<br>下面的表为0-F的字模<br>DISP_TAB DCD 0xC0，0xF9，0xA4，0x99，0x92<br>DCD 0x82，0xF8，0x80，0x90，0x88，0x83<br>DCD 0xC6，0xA1，0x86，0x8E，0xFF<br></code></pre></td></tr></table></figure><h4 id="长跳转"><a href="#长跳转" class="headerlink" title="长跳转"></a>长跳转</h4><blockquote><p>• ARM的B指令和BL指令无法进行整个内存空间范围内的跳转<strong>（仅±32MB）</strong>， </p><p>• 但可以通过对PC寄存器的赋值实现32位地址的跳转和调用。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">LDR PC，=JUMP_FUNC ；跳转到JUMP_FUNC处<br>……<br>JUMP_FUNC …….；跳转到这里<br>……<br></code></pre></td></tr></table></figure><h4 id="对信号量的支持"><a href="#对信号量的支持" class="headerlink" title="对信号量的支持"></a>对信号量的支持</h4><blockquote><p>ARM提供一条内存与寄存器交换的指令<strong>SWP</strong>用于多线程环境下支持信号量的操作，实现系统任务之间的<strong>同步与互斥</strong>，代码如下：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">DISP_SEM EQU 0x40002A00<br>……<br>DISP_WAIT MOV R1，#0 ；0作为信号量的值<br>LDR R0，=DISP_SEM<br>SWP R1，R1，[R0] ；取出信号量，设置为0<br>CMP R1，#0<br>BEQ DISP_WAIT ；如果信号量没到，则等待<br></code></pre></td></tr></table></figure><h4 id="片上特殊寄存器定义及应用"><a href="#片上特殊寄存器定义及应用" class="headerlink" title="片上特殊寄存器定义及应用"></a>片上特殊寄存器定义及应用</h4><blockquote><p>对ARM芯片的片上外设的<strong>特殊功能寄存器进行访问</strong>时，可以使用下面的代码对其寄存器进行定义并应用：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asm">WDTCNT EQU 0x01D30008 ；看门狗计数器寄存器定义<br>……<br>LDR R0，=WDTCNT ；寄存器地址传给R0<br>MOV R1，#12<br>STR R1，[R0] ；用十进制12设置看门狗计数器寄存器<br></code></pre></td></tr></table></figure><h4 id="片外部件控制"><a href="#片外部件控制" class="headerlink" title="片外部件控制"></a>片外部件控制</h4><blockquote><p>• 设置<strong>“置位/复位”</strong>寄存器 </p><p>• 对外围部件的控制寄存器进行操作时可以<strong>使用存储/保存指令的偏移功能</strong>，避免了每次都加载寄存器地址的操作</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asm">LDR R0，=GPIO_BASE<br>MOV R1，#0X00<br>STR R1，[R0，#0x04] ；基地址+0x04=IOSET，将IOSET设置为0<br>MOV R1，#0x10<br>STR R1，[R0，#0x0C] ；基地址+0x0C=IOCLR，将IOCLR设置为0x10<br></code></pre></td></tr></table></figure><h2 id="5-嵌入式C语言程序设计基础"><a href="#5-嵌入式C语言程序设计基础" class="headerlink" title="5.嵌入式C语言程序设计基础"></a>5.嵌入式C语言程序设计基础</h2><h3 id="1-嵌入式C语言的预处理伪指令-考察宏"><a href="#1-嵌入式C语言的预处理伪指令-考察宏" class="headerlink" title="1.嵌入式C语言的预处理伪指令(考察宏)"></a>1.嵌入式C语言的预处理伪指令(考察宏)</h3><h4 id="1-文件包含伪指令"><a href="#1-文件包含伪指令" class="headerlink" title="1.文件包含伪指令"></a>1.文件包含伪指令</h4><p>​    文件包含伪指令可将头文件包含到程序中， 头文件中定义的内容有<code>符号常量，复合变量原型、用户定义的变量原型和函数的原型</code>说明等。 编译器编译预处理时，用文件包含的正文内容<strong>替换</strong>到实际程序中。</p><ol><li><p>文件包含伪指令的格式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;头文件名.h&gt;</span> <span class="hljs-comment">/*标准头文件*/</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;头文件名.h &quot;</span> <span class="hljs-comment">/*自定义头文件*/</span></span><br></code></pre></td></tr></table></figure></li><li><p>包含文件伪指令的说明</p><ul><li>常在头文件名后用.h作为扩展名，<strong>可带或不带路径</strong>。 </li><li>头文件可分为<strong>标准头文件</strong>和<strong>自定义头文件</strong>。</li><li>尖括号内的头文件为标准头文件，由开发环境或系统提供。 </li><li>双引号内的头文件为用户自定义头文件。 搜索时，<u>首先在当前目录中搜索，其次按环境变量include指定的目录顺序搜索</u>。 </li><li>搜索到头文件后，就将该伪指令直接用头文件内容<strong>替换</strong></li></ul></li></ol><h4 id="2-宏定义伪指令"><a href="#2-宏定义伪指令" class="headerlink" title="2.宏定义伪指令"></a>2.宏定义伪指令</h4><p>​    宏定义伪指令分为：<strong>简单宏、参数宏、条件宏、预定义宏及宏释放</strong>。</p><ol><li>简单宏格式如下：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">define</span> 宏标识符 宏体</span><br></code></pre></td></tr></table></figure><ol><li><p>说明：</p><blockquote><ul><li>宏体是由单词序列组成。宏体超长时，<strong>允许使用续行符 “\”进行续行</strong>，续行符和其后的换行符 \n 都不会进入宏体。</li><li>在定义宏时，应尽量<strong>避免</strong>使用<strong>C语言的关键字</strong>和<strong>预处理器的预定义宏</strong>，以免引起灾难性的后果。</li><li>在源文件中，用预处理器伪指令定义过宏标识符之后， 就可用宏标识编写程序。当源文件被预处理器处理时，每遇到该宏标识符，预处理器便将宏展为宏体。</li></ul></blockquote></li><li><p>参数宏格式如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">define</span> 宏标识符（形式参数表） 宏体</span><br></code></pre></td></tr></table></figure></li><li><p>说明：</p><blockquote><ul><li>形式参数表为<strong>逗号分割</strong>的形式参数。 </li><li>宏体是由单词序列组成。宏体超长时，允许使用 续行符“\”进行续行，续行符和其后的换行符 \n 都 不会进入宏体。 </li><li>使用参数宏时，形式参数表应换为同样个数的实 参数表，这一点类似于函数的调用。参数宏与函数 的区别在于参数宏的形参数表中没有类型说明符。</li><li>预处理器在处理参数宏时<strong>使用2遍宏展开</strong>。第1遍展开宏体，第2遍对展开后的宏体用实参数替换形式参数。</li></ul></blockquote></li></ol><p>示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> bNAND_CTL(Nb) __REG(0x4e000000 + (Nb))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NFCONF bNAND_CTL(0x00)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NFCMD bNAND_CTL(0x04)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NFADDR bNAND_CTL(0x08)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NFDATA bNAND_CTL(0x0c)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NFSTAT bNAND_CTL(0x10)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NFECC bNAND_CTL(0x14)</span><br></code></pre></td></tr></table></figure><ol start="3"><li><p>条件宏格式：</p><ul><li><p>格式1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">ifdef</span> 宏标识符 <span class="hljs-comment">//若标识符已定义</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">undef</span> 宏标识符<span class="hljs-comment">//释放宏</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> 宏标识符 宏体<span class="hljs-comment">//重定义宏</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">else</span> </span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> 宏标识符 宏体</span><br><span class="hljs-meta"># <span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure></li><li><p>格式2</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">ifndef</span> 宏标识符 <span class="hljs-comment">//若标识符未定义</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> 宏标识符 宏体</span><br><span class="hljs-meta"># <span class="hljs-keyword">else</span> </span><br><span class="hljs-meta"># <span class="hljs-keyword">undef</span> 宏标识符<span class="hljs-comment">//释放宏</span></span><br><span class="hljs-meta"># <span class="hljs-keyword">define</span> 宏标识符 宏体</span><br><span class="hljs-meta"># <span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure></li></ul><p>说明：</p><blockquote><ul><li>格式1是<strong>测试存在</strong>，格式2是<strong>测试不存在</strong>。 </li><li><code>else</code>可有，也可没有。</li></ul></blockquote></li><li><p>宏释放</p></li></ol><blockquote><p>用于释放原先定义的宏标识符。经释放后的宏标识 符可再次用于定义其他宏体。</p></blockquote><ul><li><p>格式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">undef</span> 宏标识符</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-条件编译伪指令"><a href="#3-条件编译伪指令" class="headerlink" title="3.条件编译伪指令"></a>3.条件编译伪指令</h4><p>格式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">if</span>（条件表达式1）</span><br>…<br><span class="hljs-meta"># <span class="hljs-keyword">elif</span> （条件表达式2）</span><br>…<br><span class="hljs-meta"># <span class="hljs-keyword">elif</span> （条件表达式3）</span><br>…<br><span class="hljs-meta"># <span class="hljs-keyword">elif</span> （条件表达式n）</span><br>…<br><span class="hljs-meta"># <span class="hljs-keyword">else</span></span><br>…<br><span class="hljs-meta"># <span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-keyword">if</span> _B0SIZE==B0SIZE_BYTE</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> PB0SIZE；<br><span class="hljs-meta"># <span class="hljs-keyword">elif</span> _B0SIZE==B0SIZE_SHORT</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> PB0SIZE；<br><span class="hljs-meta"># <span class="hljs-keyword">elif</span> _B0SIZE==B0SIZE_WORD</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> PB0SIZE；<br><span class="hljs-meta"># <span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h3 id="2-嵌入式C语言的基本数据类型"><a href="#2-嵌入式C语言的基本数据类型" class="headerlink" title="2.嵌入式C语言的基本数据类型"></a>2.嵌入式C语言的基本数据类型</h3><h4 id="1-数据类型与表达式"><a href="#1-数据类型与表达式" class="headerlink" title="1.数据类型与表达式"></a>1.数据类型与表达式</h4><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221123152039319.png" style="zoom:50%;" /><h5 id="1-类型修饰符"><a href="#1-类型修饰符" class="headerlink" title="1.类型修饰符"></a>1.类型修饰符</h5><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221123145944765.png" style="zoom:50%;" /><h5 id="2-访问修饰符"><a href="#2-访问修饰符" class="headerlink" title="2.访问修饰符"></a>2.访问修饰符</h5><p>C语言有两个用于控制访问和修改变量方式的修饰符， 分别是<code>常量(const)</code>和<code>易变量(volatile)</code>。</p><blockquote><p>带<strong>const</strong>修饰符定义出的常量在程序运行过程中始终保持不变。 </p><p><strong>volatile</strong>修饰符用于提醒编译程序，该变量的值可以不通过程序中明确定义的方法来改变，而是<strong>从内存中读取最新数据（抑制编译器优化）</strong>。</p></blockquote><p>例如： </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-type">int</span> num； <br><span class="hljs-type">const</span> <span class="hljs-type">int</span> num=<span class="hljs-number">100</span>；<br><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> num=<span class="hljs-number">0</span>；<span class="hljs-comment">//num的值由内存中实际数据决定，初始值不一定为0</span><br></code></pre></td></tr></table></figure><p><code>static</code></p><p>作用：<strong>static的作用有2条:（1）隐藏; (2)赋初始值一次有效</strong></p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221123151113245.png" style="zoom:50%;" /><blockquote><p>a是全局变量，msg是函数，并且都没有加static前缀，因此对于另外的源文件main.c是可见的。如果加了static，就会对其它源文件隐藏。例如在a和msg的定义前加上static， main.c就看不到它们了。利用这一特性可以在不同的文件中定义同名函数和同名变量， 而不必担心命名冲突.</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">fun</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>&#123;<br><span class="hljs-type">static</span> <span class="hljs-type">int</span> count = <span class="hljs-number">10</span>; <span class="hljs-comment">//赋初值，一次有效</span><br><span class="hljs-keyword">return</span> count--;<br>&#125;<br><span class="hljs-type">int</span> count = <span class="hljs-number">1</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;global\t\tlocal static\n&quot;</span>);<br><span class="hljs-keyword">for</span>(; count &lt;= <span class="hljs-number">10</span>; ++count)<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\t\t%d\n&quot;</span>, count, fun());<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-位运算符"><a href="#3-位运算符" class="headerlink" title="3.位运算符"></a>3.位运算符</h5><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20221123152542459.png" style="zoom:50%;" /><h3 id="3-函数"><a href="#3-函数" class="headerlink" title="3.函数"></a>3.函数</h3><p><strong>内联函数</strong>（相当于宏）</p><blockquote><ul><li>与一般函数不同的是，它不是在调用时发生转移，而是在<strong>编译时将函数体嵌入在每一个调用语句处</strong>。 </li><li>这样就相对节省了参数传递、系统栈的保护与恢复等的开销。</li></ul></blockquote><p>格式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">&lt;<span class="hljs-keyword">inline</span>&gt; &lt;类型标识符&gt; &lt;被调函数名&gt;(含类型说明的形参表)<br>&#123;<br>函数体<br>&#125;<br></code></pre></td></tr></table></figure><p>示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iomanip.h&gt;</span></span><br><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title function_">max</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span><br>&#123;<br><span class="hljs-keyword">if</span>(a&gt;b)<br><span class="hljs-keyword">return</span> a;<br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">return</span> b;<br>&#125;<br></code></pre></td></tr></table></figure><p>说明：</p><blockquote><ol><li><p>宏调用并不执行类型检查，甚至连正常参数也不检查，但是函数调用却要检查。 </p></li><li><p> C语言的宏使用的是文本替换，可能导致无法预料的后果，因为需要重新计算参数和操作顺序。 </p></li><li><p> 以下情况不宜使用内联： </p></li></ol><p>   （1）如果函数体内的代码比较长（&gt;10句），使用内联将导致内存消耗代价较高。 </p><p>   （2）如果函数体内出现循环，那么执行函数体内代码的时间要比函数调用的开销大。</p></blockquote><h3 id="内嵌汇编的局限性-作业题"><a href="#内嵌汇编的局限性-作业题" class="headerlink" title="内嵌汇编的局限性(作业题)"></a>内嵌汇编的局限性(作业题)</h3><p> （1）操作数 </p><p>• ARM 开发工具编译环境下内嵌汇编语言，指令操作数可以是寄存器、常量或 C 语 言表达式。可以是 char、short 或 int 类型，而且是作为无符号数进行操作。 </p><p>• 当表达式过于复杂时需要使用较多的物理寄存器，有可能产生冲突。 </p><p>• GNU ARM 编译环境下内嵌汇编语言 ARM 开发工具稍有差别，不能直接引用 C 语 言中的变量。 </p><p>（2）物理寄存器 </p><p>不要直接向程序计数器 PC 赋值，程序的跳转只能通过 B 或 BL 指令实现。 一般将寄存器 R0～R3、R12 及 R14 用于子程序调用存放中间结果，因此在内嵌汇 编指令中，一般不要将这些寄存器同时指定为指令中的物理寄存器。 在内嵌的汇编指令中使用物理寄存器时，如果有 C 语言变量使用了该物理寄存器， 则编译器将在合适的时候保存并恢复该变量的值。需要注意的是，当寄存器 SP、 SL、FP 以及 SB 用作特定的用途时，编译器不能恢复这些寄存器的值。 通常在内嵌汇编指令中不要指定物理寄存器，因为有可能会影响编译器分配寄存 器，进而可能影响代码的效率。 </p><p>（3）标号、常量及指令展开 </p><p>• C 语言程序中的标号可以被内嵌的汇编指令所使用。但是只有 B 指令可以使用 C 语言程序中的标号，BL 指令不能使用 C 语言程序中的标号。 </p><p>（4）内存单元的分配 </p><p>• 内嵌汇编器不支持汇编语言中用于内存分配的伪操作。所用的内存单元的分配都是 通过 C 语言程序完成的，分配的内存单元通过变量以供内嵌的汇编器使用。 </p><p>（5）SWI 和 BL 指令 </p><p>• SWI 和 BL 指令用于内嵌汇编时，除了正常的操作数域外，还必须增加如下 3 个可 选的寄存器列表： </p><p>• 用于存放输入的参数的寄存器列表。 </p><p>• 用于存放返回结果的寄存器列表。 </p><p>• 用于保存被调用的子程序工作寄存器的寄存器列表。</p><h3 id="4-汇编语言与C-C-的混合编程"><a href="#4-汇编语言与C-C-的混合编程" class="headerlink" title="4.汇编语言与C/C++的混合编程"></a>4.汇编语言与C/C++的混合编程</h3><h4 id="1-相互调用规则—ATPCS"><a href="#1-相互调用规则—ATPCS" class="headerlink" title="1.相互调用规则—ATPCS"></a>1.相互调用规则—ATPCS</h4><blockquote><p>过程调用标准ATPCS（ARM-Thumb Procedure Call Standard）规定了<strong>子程序间相互调用的基本规则</strong>， ATPCS规定子程序调用过程中<strong>寄存器的使用规则</strong>、<strong>数据栈的使用规则</strong>及<strong>参数的传递规则</strong>。</p><p>2007年，ARM公司推出了新的过程调用标准AAPCS（ARM Architecture Procedure Call Standard）,它只是改进了原有的ATPCS的二进制代码的兼容性。 </p></blockquote><h5 id="1-寄存器的使用规则"><a href="#1-寄存器的使用规则" class="headerlink" title="1.寄存器的使用规则"></a>1.寄存器的使用规则</h5><blockquote><p>子程序间通过寄存器<strong>R0~R3来传递参数</strong>，记为<strong>A1~A4</strong>。 被调用的子程序在返回前无须恢复寄存器R0~R3的内容。</p></blockquote><ul><li><p>子程序中使用寄存器<strong>R4~R11来保存局部变量</strong>。记为V1<del>V8。 如果在子程序中使用到了寄存器V1</del>V8中的某些寄存器，则<strong>子程序进入时必须保存这些寄存器的值，在返回前必须恢复这些寄存器的值</strong>； </p></li><li><p>对于子程序中没有用到的寄存器，则不必进行这些操作。 </p></li><li><p>在Thumb程序中，通常只能使用寄存器<strong>R4~R7</strong>来保存局部变量。</p></li><li><p>寄存器<strong>R12</strong>用<strong>做子程序间调用时临时保存栈指针</strong>，常用于子程序间的连接代码段中，记作IP。</p></li><li><p>寄存器<strong>R13</strong>用做<strong>数据栈指针</strong>，记作SP。在子程序中寄存器R13不能用做其他用途。寄存器SP在进入子程序时的值和退出子程序时的值必须相等。</p></li><li><p>寄存器<strong>R14</strong>称为<strong>链接寄存器</strong>，记作LR。它用于保存子程序的返回地址。如果在子程序中保存了返回地址，则寄存器R14可作其他用途。</p></li><li><p><strong>R15是程序计数器，记作PC</strong>。不能作其他用途。</p></li></ul><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221128140943017.png" alt="image-20221128140943017" style="zoom:33%;" /><h5 id="2-数据栈的使用规则"><a href="#2-数据栈的使用规则" class="headerlink" title="2.数据栈的使用规则"></a>2.数据栈的使用规则</h5><blockquote><p><strong>FD（Full Descending） 满递减</strong> </p><p> ED（Empty Descending） 空递减 </p><p>FA（Full Ascending） 满递增 </p><p> EA（Empty Ascending） 空递增</p></blockquote><p><strong>ATPCS规定数据栈为FD（满递减）类型， 并且对数据栈的操作是8字节对齐的。 异常中断处理程序可使用中断程序的数据栈</strong>。</p><ul><li>数据栈指针（Stack Point）：最后一个写入栈的数据的内存地址。 </li><li> 数据栈的基地址（Stack Base）：数据栈的最高地址。 ATPSC中的数据栈是FD型，最早入栈的数据所占的内存单元是基地址的下一个内存单元。 </li><li>数据栈界限（Stack Limit）：数据栈中可使用的最低的内存单元地址。 </li><li> 数据栈中的数据帧（Stack Frames）：数据栈中为子程序分配用来保存寄存器和局部变量的区域。</li></ul><h5 id="3-参数传递规则"><a href="#3-参数传递规则" class="headerlink" title="3.参数传递规则"></a>3.参数传递规则</h5><p>（1）参数个数固定的子程序参数传递规则若系统含浮点运算硬件部件，浮点参数传递规则： </p><p><strong>各个浮点参数按顺序处理。为每个浮点参数分配FP寄存器。方法：满足该浮点参数需要的且编号最小的一组连续的FP寄存器</strong>。 第一个整数参数，通过寄存器R0～R3来传递。其他参数通过数据栈传递。</p><p>（2）参数个数可变的子程序参数传递规则 </p><p><strong>当参数不超过4个，用R0～R3传递参数，当参数超过4个时，使用数据栈来传递参数。在参数传递时，所有参数看作是存放在连续的内存字单元中的字数据。然后，依次将各字数据传递到寄存器R0～R3中。</strong> 如果参数多于4个，将剩余的字数据传送到数据栈中，入栈的顺序与参数顺序相反，即最后一个字数据先入栈。</p><p>（3）子程序结果返回规则</p><p><strong>结果为一个32位整数，可通过寄存器R0返回；结果为一个64位整数，可通过寄存器R0，R1返回，依次类推；</strong>结果为一个浮点数时，可通过运算部件的寄存器F0、D0或者S0来返回；结果为复合型的浮点数（如复数）时，可通过寄存器F0～Fn或者D0～Dn来返回。对于位数更多的结果，需通过内存来传递，如通过数据栈来传递。</p><h4 id="2-C-C＋＋代码中嵌入汇编指令"><a href="#2-C-C＋＋代码中嵌入汇编指令" class="headerlink" title="2.C/C＋＋代码中嵌入汇编指令"></a>2.C/C＋＋代码中嵌入汇编指令</h4><p>内嵌汇编指令： </p><ul><li><p> 表现为独立定义的函数体 </p></li><li><p>ADS中可直接引用C语言的变量定义 </p></li><li><p>数据交换必须通过ATPCS(ARM-Thumb  Procedure Call Standard)进行</p></li></ul><h6 id="1．内嵌汇编指令的语法格式"><a href="#1．内嵌汇编指令的语法格式" class="headerlink" title="1．内嵌汇编指令的语法格式"></a>1．内嵌汇编指令的语法格式</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">__asm&#123;<br>instruction<br>…<br>instruction<br>&#125;; //ADS中支持<br>特别注意:<br>“__asm” 是两个下划线。<br></code></pre></td></tr></table></figure><h6 id="2-内嵌汇编指令的特点"><a href="#2-内嵌汇编指令的特点" class="headerlink" title="2.内嵌汇编指令的特点"></a>2.内嵌汇编指令的特点</h6><p>（1）操作数 </p><p>作为操作数的寄存器和常量可以是C/C++表达式。 是char、short、int类型，而且这些表达式都是作为无符号数进行操作。 </p><p>编译器将会计算这些表达式的值，并为其分配寄存器。</p><p>（2）物理寄存器 内嵌汇编指令中使用物理寄存器的限制： </p><p>不能直接向PC寄存器中赋值，程序的跳转只能 通过B指令和BL指令实现。 </p><p>在内嵌汇编指令中，不要使用过于复杂的 C/C++表达式。 </p><p>编译器可能会使用R12寄存器或R13寄存器存放 编译的中间结果，在计算表达式值时可能会将 寄存器R0到R3、R12以及R14用于子程序调用。 一般不要指定物理寄存器（会影响编译器分配 寄存器）。</p><p>（3）常量 常量前的符号#可省略。若表达式前使用了符号#， 则必须是一个常量。 </p><p>（4）指令展开 如果包含常量操作数，该指令可能会被汇编器展 开成几条指令。</p><p>例如指令：</p><p> ADD R0，R0，#1023 可能会被展开成下面的指令序列：</p><p> ADD R0，R0，#1024 SUB R0，R0，#01 MUL指令会被展开成一系列加法和移位操作。</p><p>（5）标号 C/C++程序中的标号可被内嵌的汇编指令使用。但只有B指令可使用C/C++程序中的标 号，指令BL不能使用C/C++程序中的标号。 指令B使用C/C++程序中的标号格式: B{cond} label </p><p>（6）内存单元的分配 所用的内存单元的分配都是通过C/C++程序 完成的，分配的内存单元通过变量供内嵌的汇编器使用。</p><p>（7）SWI和BL指令的使用 内嵌SWI和BL指令中3个可选寄存器列表： </p><ul><li>第1个寄存器列表用于存放输入的参数。 </li><li>第2个寄存器列表用于存放返回的参数。 </li><li>第3个寄存器列表的内容供被调用的子程序作为工作寄存器。</li></ul><h6 id="3．内嵌的汇编-与-armasm的区别"><a href="#3．内嵌的汇编-与-armasm的区别" class="headerlink" title="3．内嵌的汇编 与 armasm的区别"></a>3．内嵌的汇编 与 armasm的区别</h6><p>在功能和使用方法上主要有以下特点： </p><ul><li> 不能写PC (MOV PC, LR) </li><li> 不支持伪指令LDR Rn，=expression，但可用指令: MOV Rn，expression来代替。 </li><li> 除NOP外，不支持ADR、ADRL等伪指令。 </li><li> 指令中的C变量不要与任何物理寄存器重名 </li><li> LDM/STM指令中的寄存器列表只能使用物理寄存器，不 能使用C表达式 </li><li> 不支持指令BX/BLX </li><li> 用户不用维护数据栈 </li><li> 不要轻易改变处理器模式。 </li><li>不支持内存分配操作</li></ul><p>例5.15 使能和禁止中断</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c">__inline <span class="hljs-type">void</span> <br><span class="hljs-title function_">enable_IRQ</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span> tmp;<br>__asm<br>&#123;<br>MRS tmp,CPSR<br>BIC tmp, tmp, #<span class="hljs-number">0x80</span><br>MSR CPSR_c, tmp<br>&#125;<br>&#125;<br>__inline <span class="hljs-type">void</span> <span class="hljs-title function_">disable_IRQ</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-type">int</span> tmp;<br>__asm<br>&#123;<br>MRS tmp, CPSR<br>ORR tmp, tmp, <span class="hljs-number">0x80</span><br>MSR CPSR_c, tmp<br>&#125;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>disable_IRQ( );<br>enable_IRQ( ) ; <br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="3-变量互访"><a href="#3-变量互访" class="headerlink" title="3.变量互访"></a>3.变量互访</h4><p>在C程序中声明的全局变量可被汇编程序通 过地址间接访问。具体访问方法如下： </p><p>使用IMPORT伪操作声明该全局变量。 </p><p>使用LDR伪指令读取该全局变量的内存地 址，通常该全局变量的内存地址值存放在程序 的数据缓冲池中（literal pool）。 </p><p>根据该数据的类型， 使用相应的LDR指令读取该全局变量的值； 使用相应的STR指令修改该全局变量的值。</p><p>各数据类型及对应的LDR/STR指令如下： </p><ul><li>对于无符号的char类型变量通过指令LDRB/STRB来读/写。 </li><li>对于无符号的short类型变量通过指令LDRH/STRH来读/写。 </li><li>对于int类型的变量通过指令LDR/STR来读/写 </li><li>对于有符号的char类型的变量通过指令LDRSB来读取。 </li><li>对于有符号的char类型的变量通过指令STRB来写入。 </li><li>对于有符号的short类型的变量通过指令LDRSH来读取。 </li><li>对于有符号的short类型的变量通过指令STRH来写入。 </li><li>对于小于8个字的结构型变量，可以通过一条LDM/STM指令 来读/写整个变量。 </li><li>对于结构型变量的数据成员，可以使用相应的LDR/STR指令 来访问，这时必须知道该数据成员相对于结构型变量开始地 址的偏移量。</li></ul><p>【例5.16 】从汇编程序中访问C程序全局变量 在汇编程序中访问C程序全局变量。 </p><ul><li>程序中变量globvl是在C程序中声明的全局变量。 </li><li>在汇编程序中首先用IMPORT伪操作声明该变量； </li><li>将其内存地址读入到寄存器R1中； </li><li>再将其内存单元中的值读入到寄存器R0中； </li><li>修改后再将寄存器R0的值赋于变量globvl。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA globals, CODE, READONLY<br>EXPORT asmsub<br>IMPORT globvl<br>asmsub<br>LDR R1, =globvl ；获得变量地址<br>LDR R0, [R1] ；读入<br>ADD R0, R0, #2 ；修改变量的内容<br>STR R0, [R1] ；回存<br>MOV PC, LR<br>END<br></code></pre></td></tr></table></figure><h4 id="4-相互调用"><a href="#4-相互调用" class="headerlink" title="4.相互调用"></a>4.相互调用</h4><h6 id="1-C语言程序调用汇编语言程序"><a href="#1-C语言程序调用汇编语言程序" class="headerlink" title="1.C语言程序调用汇编语言程序"></a>1.C语言程序调用汇编语言程序</h6><p>汇编语言程序的设计要遵守ATPCS。在汇 编语言中需用EXPORT伪操作来说明，使得本程序可被其他程序调用。 C语言程序调用该汇编语言程序之前，需要在C语言程序中使用EXTERN关键词来声明该汇编语言程序。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asm">AREA SCopy, CODE, <br>READONLY<br>EXPORT my_strcpy<br>my_strcpy <br>LDRB R2, [R1],#1 <br>STRB R2, [R0],#1 <br>CMP R2, #0 <br>BNE my_strcpy <br>MOV PC, LR<br>END<br></code></pre></td></tr></table></figure><h2 id="6-ARM开发工具的使用"><a href="#6-ARM开发工具的使用" class="headerlink" title="6. ARM开发工具的使用"></a>6. ARM开发工具的使用</h2><p>嵌入式调试系统应包括<strong>调试主机、仿真器和目标板</strong>3个部分。</p><p>调试方法一般有如下4种：</p><p>1） 指令集模拟器（软调试）</p><p>2） 驻留监控软件</p><p>3） JTAG仿真器</p><p>4） 在线仿真器（仿真头）</p><h2 id="7-硬件系统设计"><a href="#7-硬件系统设计" class="headerlink" title="7.硬件系统设计"></a>7.硬件系统设计</h2><h3 id="1-嵌入式硬件系统的结构"><a href="#1-嵌入式硬件系统的结构" class="headerlink" title="1.嵌入式硬件系统的结构"></a>1.嵌入式硬件系统的结构</h3><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221203161059013.png" alt="image-20221203161059013" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221210141504960.png" alt="image-20221210141503201" style="zoom:33%;" /><h3 id="1-S3C44B0芯片概述"><a href="#1-S3C44B0芯片概述" class="headerlink" title="1.S3C44B0芯片概述"></a>1.S3C44B0芯片概述</h3><h4 id="1-1简介"><a href="#1-1简介" class="headerlink" title="1.1简介"></a>1.1简介</h4><p>Samsung公司推出的S3C44B0微处理器是基于16/32位的RISC结构，为手持设备和一般类型的应用提供了高性价比和高性能的解决方案。为了降低成本，S3C44B0提供了丰富的内置资源，包括：</p><ul><li>8KB Cache、</li><li>内部SRAM、LCD控制器、</li><li>带自动握手的2通道UART、</li><li>4通道DMA、</li><li>FP/EDO/SDRAM控制器、</li><li>带PWM功能的5通道定时器、</li><li>RTC、</li><li>8通道的10位ADC、IIC、IIS总线接口、同步SIO接口和PLL倍频器等。</li></ul><ol><li>S3C44B0采用了ARM7TDMI内核，附带0.25um工艺的CMOS标准宏单元和存储编译器。</li><li>它的低功耗和出色的静态设计特别适用于对成本和功耗敏感的场合。</li><li>S3C44B0的杰出特性是它的内部CPU核，由ARM公司设计的ARM7TDMI的RISC处理器，<strong>主频高达66MHz</strong>。</li><li>它集成了Thumb代码压缩器，片上的ICE （In-Circuit Emulator）断点调试支持和一个32位的硬件乘法器。</li></ol><h4 id="1-2特性"><a href="#1-2特性" class="headerlink" title="1.2特性"></a>1.2特性</h4><h5 id="1-2-1体系结构"><a href="#1-2-1体系结构" class="headerlink" title="1.2.1体系结构"></a>1.2.1体系结构</h5><p>● 集成了手持设备和通用嵌入式系统应用的解决方案；<br>● 强大的指令集；<br>● Thumb代码压缩机制，最大化代码密度的同时保持了32位指令的性能；<br>● 基于JTAG的片上集成ICE调试解决方案；<br>● 32位的硬件乘法器；<br>● 实现低功耗的新型总线结构</p><h5 id="1-2-2系统管理"><a href="#1-2-2系统管理" class="headerlink" title="1.2.2系统管理"></a>1.2.2系统管理</h5><p>● 支持大/小端模式；<br>● 寻址空间每bank32M字节，总共达256M字节；<br>● 支持每bank可编程的8/16/32位数据总线宽度；<br>● 7个bank具有固定的bank起始地址和可编程的bank大小；<br>● 1个bank具有可编程的起始地址和大小；<br>● 8个存储器bank，包含6个ROM、SRAM，2个SROM/SDRAM/DRAM存储空间；<br>● 所有的存储bank具有可编程的操作周期；<br>● 支持外部等待信号延长总线周期；<br>● 支持掉电时DRAM/SDRAM的自刷新模式；<br>● 支持均匀/非均匀的DRAM地址。</p><h5 id="1-2-3-Cache和内部SRAM"><a href="#1-2-3-Cache和内部SRAM" class="headerlink" title="1.2.3 Cache和内部SRAM"></a>1.2.3 Cache和内部SRAM</h5><p>● 一体化的8k字节Cache；<br>● 未用的Cache空间可以用做0/4/8k字节的SRAM空间；</p><h5 id="1-2-4时钟和电源管理"><a href="#1-2-4时钟和电源管理" class="headerlink" title="1.2.4时钟和电源管理"></a>1.2.4时钟和电源管理</h5><p>● 低功耗；<br>● 片上PLL使CPU工作频率最大达到66MHz；<br>● 可以通过软件设置各功能模块的输入时钟；<br>● 电源模式包括正常、<br>慢速（不经PLL低频时钟）、<br>空闲（停CPU时钟）、<br>停止模式（停所有时钟）<br>—通过EINT[7：0]或RTC报警中断从停止模式唤醒。</p><h5 id="1-2-5中断控制器"><a href="#1-2-5中断控制器" class="headerlink" title="1.2.5中断控制器"></a>1.2.5中断控制器</h5><p>● 30个中断源（看门狗定时器、6个定时器、6个UART、8个外部中断、4个DMA、2个RTC、1个ADC、1个IIC、1个SIO）；<br>● 采用<strong>向量化的IRQ中断模式，可以减少中断延迟</strong>；<br>● 可选的电平/边沿模式触发外部中断；<br>● 电平/边沿模式具有可编程的优先级；<br>● 支持FIQ为紧急的中断请求进行服务。</p><h4 id="1-3引脚信号描述"><a href="#1-3引脚信号描述" class="headerlink" title="1.3引脚信号描述"></a>1.3引脚信号描述</h4><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/image-20230125123146117.png" alt="image-20230125123146117" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125131839534.png" alt="image-20230125131839534" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125132646155.png" alt="image-20230125132646155" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125133411513.png" alt="image-20230125133411513" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125133811640.png" alt="image-20230125133811640" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125134541013.png" alt="image-20230125134541013" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125135339987.png" alt="image-20230125135339987" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125135457708.png" alt="image-20230125135457708" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125135931987.png" alt="image-20230125135931987" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125140133440.png" alt="image-20230125140133440" style="zoom:33%;" /><h3 id="2-单元电路设计"><a href="#2-单元电路设计" class="headerlink" title="2.单元电路设计"></a>2.单元电路设计</h3><h4 id="2-1电源电路"><a href="#2-1电源电路" class="headerlink" title="2.1电源电路"></a>2.1电源电路</h4><p>在系统中，需要使用5V、3.3V和2.5V的直流稳压电源。为了提高供电的稳定性和可靠性，通常采用集成线性稳压电源对CPU和外围电路供电。 </p><ol><li>CPU内核工作需要供给的**+2.5V电源采用LM1117－2.5**产生 </li><li>CPU 的I/O和外设工作所需要的**+3.3V电源是采用LM1117－3.3** 产生</li><li>其他的外围芯片如串行口接口电路、PS/2键盘接口电路以及93C46IIC接口芯片等需要<strong>5V的直流电源，5V的直流电源由外部直接提供</strong>。</li></ol><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125141408059.png" alt="image-20230125141408059" style="zoom:25%;" /><h4 id="2-2晶振电路"><a href="#2-2晶振电路" class="headerlink" title="2.2晶振电路"></a>2.2晶振电路</h4><p>S3C44B0的时钟源可以用外部晶体（无源晶振）来产生，也可以直接输入外部时钟（有源晶振），这由CPU的OM[3:2]位的状态决定。 OM[3:2]位的状态在nRESET引脚的上升沿由OM3和OM2脚的电平决定：</p><p><strong>OM[3:2]=00时使用无源晶振</strong>，通过内部的振荡电路与外部的电容和无源晶振一起振荡产生CPU所需要的时钟； </p><p><strong>OM[3:2]=01时使用外部有源晶振直接提供时钟</strong>，不需要通过CPU内部的振荡电路产生时钟； </p><p>OM[3:2]=其它时处于测试模式，一般不使用。</p><p>在复位后PLL启动，但在用S/W（软件）设置有效值到PLLCON寄存器之前，PLL的输出（FOUT）不能被使用，这时FOUT直接输出Crystal Clock或外部时钟。晶振电路用于向CPU及其他电路提供工作时钟。 在系统中，S3C44B0可以使用有源晶振，也可以使用无源晶振。</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125141422229.png" alt="image-20230125141422229" style="zoom:25%;" /><h4 id="2-3看门狗与复位电路"><a href="#2-3看门狗与复位电路" class="headerlink" title="2.3看门狗与复位电路"></a>2.3看门狗与复位电路</h4><ul><li>硬件看门狗(WDT, WATCHDOG TIMER)是利用了一个定时器，来监控主程序的运行</li><li>也就是说在主程序的运行过程中，CPU要在定时时间到来之前对定时器进行复位(喂狗)</li><li>如果出现死循环，或者说PC指针不能回来。那么定时时间到达后，如果CPU还没有产生喂狗信号给WDT，WDT就会输出信号使CPU复位。</li></ul><p><strong>嵌入式系统中两类看门狗：</strong></p><p>1、CPU内部自带的看门狗：将一个芯片中的定时器来作为看门狗，通过程序的初始化，写入初值，设定溢出时间，并启动定时器。程序按时对定时器赋初值（或复位），以免其溢出。</p><p><strong>优点：</strong>可以通过程序<strong>改变溢出时间；可以随时禁用</strong><br><strong>缺点：</strong>需要初始化；如果程序在初始化、启动完成前跑飞或在禁用后跑飞，看门狗就无法复位系统，这样看门狗的作用就没有了，系统恢复能力降低。</p><p>2、独立的看门狗芯片：这种看门狗主要有一个用于喂狗的引脚（一般与CPU的GPIO相连）和一个复位引脚（与系统的RESET引脚相连），如果没有在一定时间内改变喂狗脚的电平，复位引脚就会改变状态复位CPU。此类看门狗一上电就开始工作，无法禁用。</p><p><strong>优点：无须配置，上电即用。</strong>系统必须按时喂狗，<strong>系统恢复能力高</strong>。<br><strong>缺点</strong>：无法灵活配置溢出时间，<strong>无法禁用，灵活性降低</strong>。</p><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221207151332982.png" alt="image-20221207151332982" style="zoom:33%;" /><p>硬件看门狗与复位电路中，按键S1是手动复位按键，ADM706TAR芯片的第7脚周期性的按设定的时间间隔检查该引脚的输入信号，如果CPU在规定的时间内没有输入高电平（又称为喂狗），则说明程序跑飞了，ADM706TAR的第6脚便产生一个复位信号，使CPU复位。</p><h4 id="2-4-存储单元电路"><a href="#2-4-存储单元电路" class="headerlink" title="2.4 存储单元电路"></a>2.4 存储单元电路</h4><blockquote><p>一个bank–32M字节，共8个bank，每个bank初地址最高最高位相差2。</p></blockquote><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221207151656687.png" alt="image-20221207151656687" style="zoom:33%;" /><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20221212140103371.png" alt="image-20221212140103371" style="zoom: 33%;" /><ul><li>在程序空间flash ROM 内（在主板上对应2M 字节大小的HY29LV160器件）可以固化一段启动系统并对系统进行初始化的程序——Boot Loader 程序。</li><li>上图中Flash ROM 存储器映射在了系统的bank0 上，也就是说，系统上电时处理器即从Flash ROM 的0x00000000 地址处取得指令开始运行。这个地址上的Boot Loader程序完成了<strong>时钟设置初始化、中断矢量的定义、存储器的参数设置、堆栈地址定义</strong>等工作，这些设置对于系统正常启动是非常重要的。</li><li>由于Flash ROM 是非易失性的存储器，因此程序就算掉电也不会丢失。但是如果由于某个误操作覆盖了Flash ROM 中启动程序的内容，系统就将无法正常启动，这时就需要重新将Boot Loader程序烧写到Flash ROM中</li></ul><h5 id="1-Flash存储器接口电路设计"><a href="#1-Flash存储器接口电路设计" class="headerlink" title="1.Flash存储器接口电路设计"></a>1.Flash存储器接口电路设计</h5><blockquote><p>FLASH的地址线[A19～A0]与S3C44B0的地址总线[ADDR20～ADDR1]相连，这是因为S3C44B0的存储系统在存储代码时需要<strong>半字对齐方式（16位方式）</strong>；</p><ul><li>16位数据总线[DQ15~DQ0]与S3C44B0的低16位数据总线[XDATA15~XDATA0]相连。</li><li>注意此时应将S3C44B0的BWSCON寄存器的<strong>DW0[2:1]位置为“01”</strong>，这两位指示BANK0的数据总线宽度，由OM[1:0]脚上、下拉确定。</li></ul></blockquote><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125145639678.png" alt="image-20230125145639678" style="zoom:33%;" /><h5 id="2-SDRAM存储器接口电路设计"><a href="#2-SDRAM存储器接口电路设计" class="headerlink" title="2.SDRAM存储器接口电路设计"></a>2.SDRAM存储器接口电路设计</h5><blockquote><ul><li>目前常用的SDRAM为8位/16位的数据宽度，工作电压一般为3.3V。</li><li>HY57V641620的BA1、BA0（Bank Address）（选择4个Bank） 接S3C44B0的地址总线ADDR&lt;22&gt;、ADDR&lt;21&gt;； </li><li>HY57V641620的DQ15～DQ0接S3C44B0的数据总线的低 16位XDATA&lt;15&gt;～XDATA&lt;0&gt;； </li><li>HY57V641620的LDQM、UDQM分别接S3C44B0的DQM0 （Pin11）、DQM1（Pin12）(SDRAM数据屏蔽信号)。 </li><li>将总线宽度与等待状态控制寄存器BWSCON的<strong>DW6[25:24]=01b</strong>，这两位确定BANK6的数据总线宽度为16位。</li></ul></blockquote><img src="C:\Users\alleyf\AppData\Roaming\Typora\typora-user-images\image-20230125151037912.png" alt="image-20230125151037912" style="zoom:25%;" /><h5 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h5><p>存储系统的数据总线位宽决定。</p><blockquote><ul><li>位宽为<strong>8</strong>,则S3C44B0的<strong>A0连接存储器的A0</strong></li><li>位宽为<strong>16</strong>，则S3C44B0的<strong>A1连接存储器的A0</strong></li><li>位宽为<strong>32</strong>，则S3C44B0的<strong>A2连接存储器的A0</strong></li></ul></blockquote><h2 id="8-程序设计题模板"><a href="#8-程序设计题模板" class="headerlink" title="8.程序设计题模板"></a>8.程序设计题模板</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asm">     AREA Fctrl,CODE,READONLY ;声明代码段 Fctrl<br>     EXPORT/IMPORT/EXTERN 标号 ;声明或引用全局标号（可以没有）<br>     ENTRY ;标识程序入口<br>     CODE32 ;声明 32 位 ARM 指令<br>START<br>     ;初始化寄存器<br>    <br> ;中间处理程序（包括循环，分支等等）<br>    <br>Stop<br>     B Stop ;文件结束<br>     END<br></code></pre></td></tr></table></figure><h2 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h2><p>向量中断是一种中断方式。<strong>每个外设预先被设置一个中断识别码</strong>,当CPU响应某外设中断请求时,由硬件电路向CPU提供该外设的中断识别码,CPU由此<strong>获得中断服务程序入口地址</strong>,转入中断服务,这种方式称为向量中断。</p><p>中断向量指的是在向量中断方式中,中断服务程序的入口地址。</p><p>两者的区别为:<strong>向量中断是由中断事件自己通过硬件提供中断服务程序的入口地址的中断;非向量中断是中断事件不能直接提供中断服务程序的入口地址的中断</strong></p><h2 id="ARM指令与伪指令的区别"><a href="#ARM指令与伪指令的区别" class="headerlink" title="ARM指令与伪指令的区别"></a>ARM指令与伪指令的区别</h2><p>　　伪指令经过汇编编译后就不存在了，而指令依旧存在。伪操作只是汇编过程中起作用, ,一旦汇编结束 ,伪操作也就随之消失。另外，ARM 伪指令不属于 ARM 指令集中的指令，是为了编程方便而定义的。</p><p>　　<strong>总结：</strong>其实LDR、ADRL、ADR的作用和用法基本类似，主要区别是加载数的范围大小不同，LDR加载范围最大，ADRL次之，ADR最小。另外，使用LDR伪指令时，操作数要带“=”号，ADRL和ADR则不需要。</p>]]></content>
    
    
    <summary type="html">Some knowledge about embedment.</summary>
    
    
    
    <category term="ARM" scheme="https://alleyf.github.io/categories/ARM/"/>
    
    
    <category term="Embeded theory and appliment" scheme="https://alleyf.github.io/tags/Embeded-theory-and-appliment/"/>
    
  </entry>
  
  <entry>
    <title>Professional courses summary</title>
    <link href="https://alleyf.github.io/2022/11/da51d1e3196c.html"/>
    <id>https://alleyf.github.io/2022/11/da51d1e3196c.html</id>
    <published>2022-11-21T08:25:00.000Z</published>
    <updated>2023-07-05T14:55:52.248Z</updated>
    
    <content type="html"><![CDATA[<h1 id="综合问题整理"><a href="#综合问题整理" class="headerlink" title="综合问题整理"></a>综合问题整理</h1><h2 id="数字信号处理"><a href="#数字信号处理" class="headerlink" title="数字信号处理"></a>数字信号处理</h2><h3 id="1-FS，FT，DTFT，DFS，DFT，FFT，Z变换，拉普拉斯变换的区别与联系？"><a href="#1-FS，FT，DTFT，DFS，DFT，FFT，Z变换，拉普拉斯变换的区别与联系？" class="headerlink" title="1.FS，FT，DTFT，DFS，DFT，FFT，Z变换，拉普拉斯变换的区别与联系？"></a>1.FS，FT，DTFT，DFS，DFT，FFT，Z变换，拉普拉斯变换的区别与联系？</h3><h3 id="2-FIR和IIR的区别，有哪些常见的滤波器？"><a href="#2-FIR和IIR的区别，有哪些常见的滤波器？" class="headerlink" title="2.FIR和IIR的区别，有哪些常见的滤波器？"></a>2.FIR和IIR的区别，有哪些常见的滤波器？</h3><ul><li><strong>IIR：h（n）无限长，极点位于z平面任意位置，滤波器阶次低，非线性相位，递归结构，不能FFT计算，可用模拟滤波器设计，用于设计规格化的选频滤波器。常见有巴特沃斯、切比雪夫（I型，Ⅱ型）和椭圆滤波器</strong></li><li><strong>FIR：h（n）有限长，极点固定在原点，滤波器阶次高，可严格的线性相位，一般采用非递归结构，可用FFT计算，设计借助于计算机，可设计各种幅频特性和相频特性的滤波器。常见有横截型、级联型、频率抽样型、快速卷积结构</strong></li></ul><h3 id="3-傅里叶变换的存在条件？"><a href="#3-傅里叶变换的存在条件？" class="headerlink" title="3.傅里叶变换的存在条件？"></a>3.傅里叶变换的存在条件？</h3><h3 id="4-FFT，IIFT加速原理？"><a href="#4-FFT，IIFT加速原理？" class="headerlink" title="4.FFT，IIFT加速原理？"></a>4.FFT，IIFT加速原理？</h3><h4 id="1-他们的蝶形结构？"><a href="#1-他们的蝶形结构？" class="headerlink" title="1.他们的蝶形结构？"></a>1.他们的蝶形结构？</h4><h4 id="2-各自的复杂度？"><a href="#2-各自的复杂度？" class="headerlink" title="2.各自的复杂度？"></a>2.各自的复杂度？</h4><h2 id="通信原理"><a href="#通信原理" class="headerlink" title="通信原理"></a>通信原理</h2><h3 id="1-通信系统的框架？"><a href="#1-通信系统的框架？" class="headerlink" title="1.通信系统的框架？"></a>1.通信系统的框架？</h3><h3 id="2-脉冲成型滤波器用在哪？"><a href="#2-脉冲成型滤波器用在哪？" class="headerlink" title="2.脉冲成型滤波器用在哪？"></a>2.脉冲成型滤波器用在哪？</h3><h3 id="3-FDM和TDM的比较？"><a href="#3-FDM和TDM的比较？" class="headerlink" title="3.FDM和TDM的比较？"></a>3.FDM和TDM的比较？</h3><h3 id="4-奈奎斯特采样定理？"><a href="#4-奈奎斯特采样定理？" class="headerlink" title="4.奈奎斯特采样定理？"></a>4.奈奎斯特采样定理？</h3><h3 id="5-信道容量意义和公式？"><a href="#5-信道容量意义和公式？" class="headerlink" title="5.信道容量意义和公式？"></a>5.信道容量意义和公式？</h3><h3 id="6-随机信号为什么使用功率谱不适用频谱？"><a href="#6-随机信号为什么使用功率谱不适用频谱？" class="headerlink" title="6.随机信号为什么使用功率谱不适用频谱？"></a>6.随机信号为什么使用功率谱不适用频谱？</h3><h3 id="7-什么是平稳信号，平稳随机过程，遍历性？"><a href="#7-什么是平稳信号，平稳随机过程，遍历性？" class="headerlink" title="7.什么是平稳信号，平稳随机过程，遍历性？"></a>7.什么是平稳信号，平稳随机过程，遍历性？</h3><h3 id="8-载波同步的方法？"><a href="#8-载波同步的方法？" class="headerlink" title="8.载波同步的方法？"></a>8.载波同步的方法？</h3><ul><li>自同步（直接法）（平方变换法，平方环法，同相正交环法）</li><li>外同步（插入导频法）</li></ul><h3 id="9-2ASK、2FSK、2PSK，2DPSK带宽和误码率？"><a href="#9-2ASK、2FSK、2PSK，2DPSK带宽和误码率？" class="headerlink" title="9.2ASK、2FSK、2PSK，2DPSK带宽和误码率？"></a>9.2ASK、2FSK、2PSK，2DPSK带宽和误码率？</h3><ol><li>带宽：2ASK：2fs; 2FSK: 2fs+|f1-F2|; 2PSK：2fs ；2DPSK：2fs</li><li>误码率：<img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307052235695.png" alt="image.png|400"></li></ol><h3 id="10-新型调制技术有哪些？"><a href="#10-新型调制技术有哪些？" class="headerlink" title="10.新型调制技术有哪些？"></a>10.新型调制技术有哪些？</h3><p>QAM，MSK，GMSK，OFDM等</p><h3 id="11-QAM星型结构和方形结构区别？"><a href="#11-QAM星型结构和方形结构区别？" class="headerlink" title="11.QAM星型结构和方形结构区别？"></a>11.QAM星型结构和方形结构区别？</h3><p>星形结构振幅环和相位个数都少于方形结构，因此利于实现自动增益控制和载波相位追踪；但产生和接收更为复杂。</p><h3 id="12-QAM-的产生方法？"><a href="#12-QAM-的产生方法？" class="headerlink" title="12.QAM 的产生方法？"></a>12.QAM 的产生方法？</h3><ul><li>正交调幅法：MQAM 信号可由两路载波正交的\sqrt{M}ASK 信号叠加而成 <img src="file:///C:/Users/alleyf/AppData/Roaming/Typora/typora-user-images/image-20230705222131991.png?lastModify=1688567633" alt="image-20230705222131991|400"></li><li>复合相移法：用两路独立的 QPSK 信号叠加，即可形成16QAM 信号 <img src="file:///C:/Users/alleyf/AppData/Roaming/Typora/typora-user-images/image-20230705223012306.png?lastModify=1688567633" alt="image-20230705223012306|400"><h3 id="13-MSK-特点和优势？"><a href="#13-MSK-特点和优势？" class="headerlink" title="13. MSK 特点和优势？"></a>13. MSK 特点和优势？</h3>优势：旁瓣衰减更快，对邻道干扰小<br>特点：包络恒定、相位连续、频差最小， 并且严格正交的2FSK（CPFSK）信号</li></ul><h3 id="14-MSK-的最小频率间隔和载波频率及码元频率要求？"><a href="#14-MSK-的最小频率间隔和载波频率及码元频率要求？" class="headerlink" title="14. MSK 的最小频率间隔和载波频率及码元频率要求？"></a>14. MSK 的最小频率间隔和载波频率及码元频率要求？</h3><p><img src="https://raw.githubusercontent.com/Alleyf/PictureMap/main/web_icons/202307052250282.png" alt="image.png|400"></p><blockquote><p>调制指数h=0.5；</p></blockquote><h2 id="信号与系统"><a href="#信号与系统" class="headerlink" title="信号与系统"></a>信号与系统</h2><h2 id="电路原理"><a href="#电路原理" class="headerlink" title="电路原理"></a>电路原理</h2>]]></content>
    
    
    <summary type="html">Some knowledge about spealized courses.</summary>
    
    
    
    <category term="课程学习" scheme="https://alleyf.github.io/categories/%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Professional courses" scheme="https://alleyf.github.io/tags/Professional-courses/"/>
    
  </entry>
  
</feed>
