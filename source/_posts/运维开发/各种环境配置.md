---
title: 各种环境配置
date: 2023-11-18 14:53:11
tags:
  - java
  - mysql
  - nacos
  - sentinel
sticky: 60
excerpt: 
author: fcs
---
![](https://picsum.photos/800/250)
> 一切安装启动的应用都要开启**防火墙 TCP 端口和云服务商防火墙规则**才能访问。

## Basic
- [ ] to-do
- [/] incomplete
- [x] done
- [-] canceled
- [>] forwarded
- [<] scheduling

## Extras
- [?] question
- [!] important

![image.png](http://qnpicmap.fcsluck.top/pics/202311191414745.png)
# Java
安装 jdk：
```shell
yum install java-1.8.0-openjdk
```
环境变量设置：
```profiles
#set java environment
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.392.b08-2.el7_9.x86_64/jre
export JRE_HOME=$JAVA_HOME/jre
export CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH
export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH
```
刷新系统环境变量配置：
```shell
source /etc/profile
```
# 防火墙
## centos 7
一、防火墙的开启、关闭、禁用命令
> （1）设置开机启用防火墙：`systemctl enable firewalld.service`
> （2）设置开机禁用防火墙：`systemctl disable firewalld.service`
> （3）启动防火墙：`systemctl start firewalld`
> （4）关闭防火墙：`systemctl stop firewalld`
> （5）检查防火墙状态：`systemctl status firewalld` 

二、使用 firewall-cmd 配置端口
> （1）查看防火墙状态：`firewall-cmd --state`
> （2）重新加载配置：`firewall-cmd --reload`
> （3）查看开放的端口：`firewall-cmd --list-ports`
> （4）开启防火墙端口：`firewall-cmd --zone=public --add-port=9200/tcp --permanent`

# Nacos
1. 下载 nacos 压缩包
2. 解压并修改配置文件（单点 or 集群）
3. `sh startup.sh -m standalone` 单点启动

![image.png](http://qnpicmap.fcsluck.top/pics/202311181541807.png)
# Sentinel
1. 下载 [Sentinel](https://github.com/alibaba/Sentinel/releases) 的 jar 包上传至 linux 系统上
2. 使用 _nohup_ 指令持久化后台运行 **jar 包**
3. 后端持久运行 jar 包：
   `nohup java -Xms100m -Xmx100m -jar score-api-0.0.1-SNAPSHOT.jar&`

![image.png](http://qnpicmap.fcsluck.top/pics/202311181541977.png)
# Seata
## 服务端配置
1. 下载 [Seata](https://github.com/seata/seata/releases/) 服务端
2. 新建一个 **namespace** 用于 seata 使用：*seata*
![image.png](http://qnpicmap.fcsluck.top/pics/202311201527195.png)
3. 客户端配置- `application.yml`
```yaml
server:  
  port: 7091  
spring:  
  application:  
    name: seata-server  
logging:  
  config: classpath:logback-spring.xml  
  file:  
    path: ${log.home:${user.home}/logs/seata}  
  extend:  
    logstash-appender:  
      destination: 127.0.0.1:4560  
    kafka-appender:  
      bootstrap-servers: 127.0.0.1:9092  
      topic: logback_to_logstash  
console:  
  user:  
    username: seata  
    password: seata  
seata:  
  config:  
    # support: nacos, consul, apollo, zk, etcd3  
    type: nacos  
    nacos:  
      serverAddr: xxx:8848  
      namespace: 401254cb-2aa6-4be3-bd44-4a139ebdc687 #自定义的命名空间  
      group: SEATA_GROUP  
      username: nacos  
      password: nacos  
      dataId: seata-server.properties  
  registry:  
    # support: nacos, eureka, redis, zk, consul, etcd3, sofa  
    type: nacos  
    nacos:  
      application: seata-server  
      server-addr: xxx:8848  
      namespace: 401254cb-2aa6-4be3-bd44-4a139ebdc687  #自定义的命名空间  
      group: SEATA_GROUP  
      cluster: default  
      username: nacos  
      password: nacos  
  store:  
    # support: file 、 db 、 redis  
    mode: file  
  #  server:  
  #    service-port: 8091 #If not configured, the default is '${server.port} + 1000'  security:  
    secretKey: SeataSecretKey0c382ef121d778043159209298fd40bf3850a017  
    tokenValidityInMilliseconds: 1800000  
    ignore:  
      urls: /,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.jpeg,/**/*.ico,/api/v1/auth/login
```
4. 初始 Mysql 数据库
新建 seata 库->执行 `mysql.sql` 初始化脚本->【Seata 1.x 版本 mysql 脚本】压缩包目录 `seata/script/db/mysql.sql`
![image.png](http://qnpicmap.fcsluck.top/pics/202311201526596.png)
5. 导入初始配置到 nacos
- 修改压缩包目录 `seata/script/config-center/config.txt` 文件中几处内容：
```txt
# 存储模式
store.mode=db
store.db.datasource=druid
store.db.dbType=mysql
# 需要根据mysql的版本调整driverClassName
# mysql8及以上版本对应的driver：com.mysql.cj.jdbc.Driver
# mysql8以下版本的driver：com.mysql.jdbc.Driver
store.db.driverClassName=com.mysql.jdbc.Driver
# 注意根据生产实际情况调整参数host和port
store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&rewriteBatchedStatements=true
# 数据库用户名密码
store.db.user=root
store.db.password=12345678
# 微服务里配置与这里一致,客户端事务组映射配置（要与客户端的application.yml中的配置保持一致）  
service.vgroupMapping.user-service-seata-service-group=default  
service.vgroupMapping.book-service-seata-service-group=default  
service.vgroupMapping.borrow-service-seata-service-group=default
```
> [!WARNING] 特别说明
> 配置事务分组 service.vgroupMapping.dev_tx_group=default  
> dev_tx_group：需要与客户端保持一致，可以自定义 (如上所示自定义) 
> default：需要跟客户端和 application.yml 中的 cluster 保持一致  
> default 必须要等于 registry.conf.cluster = “default”

- 通过压缩包目录 `seatascript/config-center/nacos/nacos-config.sh` 将修改后的 config.txt 发布到 nacos 上
```shell
# 运行指令 ，通过 Git Bash Here
sh nacos-config.sh -h localhost -p 8848 -g SEATA_GROUP -t 891d7906-dd03-4b8c-9fe9-a1f0609b3189
# 具体说明参见：http://seata.io/zh-cn/docs/user/configurations.html
# -h: nacos host，默认localhost
# -p: nacos端口，默认8848
# -g: nacos分组，默认'SEATA_GROUP'.
# -t: 租户信息Tenant information，对应nacos namespace ID，默认''
# -u: nacos用户名，默认''
# -w: nacos用户密码，默认''
```
![image.png](http://qnpicmap.fcsluck.top/pics/202311201533687.png)
6. 启动 seata

根据系统环境启动 seata 服务端：
![image.png|500](http://qnpicmap.fcsluck.top/pics/202311201535684.png)
## 客户端配置
1. 引入 Maven 依赖
```xml
<!--        seata-->  
<dependency>  
    <groupId>com.alibaba.cloud</groupId>  
    <artifactId>spring-cloud-starter-alibaba-seata</artifactId>  
</dependency>
```
2. 修改微服务的 `application.yml`
```yml
spring:  
  application:  
    name: book-service  
  datasource:  
    url: jdbc:mysql://localhost:3306/springcloud?useUnicode=true&characterEncoding=utf8  
    username: root  
    password: 123456  
    driver-class-name: com.mysql.cj.jdbc.Driver  
  cloud:  
    nacos:  
      discovery:  
        # 配置Nacos注册中心地址  
        server-addr: xxx:8848  
      #        namespace: 44a80565-86f1-450f-88ea-6f93801cd08c #设置命名空间为开发环境  
    sentinel:  
      transport:  
        # 添加监控页面地址即可  
        dashboard: 127.0.0.1:8080
seata:  
  tx-service-group: user-service-seata-service-group #必须配置和服务端的service.vgroupMapping.xxx一致  
  # 注册  registry:  
    # 使用 Nacos  
    type: nacos  
    nacos:  
      # 使用 Seata 的命名空间，这样才能正确找到 Seata 服务，由于组使用的是 SEATA_GROUP，配置默认值就是，就不用配了  
      namespace: 401254cb-2aa6-4be3-bd44-4a139ebdc687  
      username: nacos  
      password: nacos  
      server-addr: ${spring.cloud.nacos.discovery.server-addr}  
  # 配置  
  config:  
    type: nacos  
    nacos:  
      namespace: 401254cb-2aa6-4be3-bd44-4a139ebdc687  
      username: nacos  
      password: nacos  
      server-addr: ${spring.cloud.nacos.discovery.server-addr}  
  service:  
    vgroup-mapping:  
      tx-group-mapping: user-service-seata-service-group  #必须配置和服务端的service.vgroupMapping.xxx一致
```
3. 配置完成启动微服务即可

# Windows
## 关闭进程
```shell
taskkill /f /t /im nginx.exe
taskkill /f /pid <查询的PID号>
```
![image.png](http://qnpicmap.fcsluck.top/pics/202311182136214.png)
## 查看端口
```shell
netstat -ano | findstr <端口号>
netstat -ano | find "关键字"
```
# Linux
> **netstat** 参数含义：
> -a (all)显示所有选项，默认不显示 LISTEN 相关
> -t (tcp)仅显示 tcp 相关选项
> -u (udp)仅显示 udp 相关选项
> -n 拒绝显示别名，能显示数字的全部转化成数字。
> -l 仅列出有在 Listen (监听) 的服務状态
> -p 显示建立相关链接的程序名
> -r 显示路由信息，路由表
> -e 显示扩展信息，例如 uid 等
> -s 按各个协议进行统计
> -c 每隔一个固定时间，执行该 netstat 命令。

## 查看端口
```shell
netstat -tuln | grep :<端口号>
netstat -nplt #查看所有端口
```
## 查看程序
```shell
ps -ef | grep java #查询java进程的程序
```
## 关闭进程
```shell
kill -12 pid #安全关闭
kill -9 pid #强制关闭
```
