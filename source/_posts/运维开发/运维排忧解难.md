---
title: è¿ç»´æ’å¿§è§£éš¾
date: 2024-06-28 00:37:11
tags:
  - è¿ç»´
  - DevOps
sticky: 80
excerpt: è¿ç»´æ’é”™è§£å†³é—®é¢˜çš„å¿…æŸ¥æ‰‹å†Œ
author: fcs
index_img: https://picsum.photos/800/250
lang: zh-CN
number headings: auto, first-level 1, max 5, start-at 1, 1.1
---

![](https://picsum.photos/800/250)

# 1 å¸¸ç”¨æŒ‡ä»¤

> [!NOTE] ç¬¦å·è¯´æ˜
> æŒ‡ä»¤ä¸­å°æ‹¬å· `()` å†…ä¸º**é€‰å¡«é¡¹**ï¼Œ`<>` ä¸º**å¡«å……é¡¹**ï¼ˆæ ¹æ®å®é™…å˜é‡è¿›è¡Œå¡«å……ï¼‰ã€‚

## 1.1 Linux æŒ‡ä»¤

[å„ç§ç¯å¢ƒé…ç½®](source/_posts/è¿ç»´å¼€å‘/å„ç§ç¯å¢ƒé…ç½®.md)

### 1.1.1 ç£ç›˜æ‰©å®¹

#### 1.1.1.1 å·²å­˜åœ¨ç£ç›˜ï¼ˆä½¿ç”¨ä½™é‡æ‰©å®¹åˆ†åŒºï¼‰

##### 1.1.1.1.1 **ç¡®è®¤å‰©ä½™ç©ºé—´**

ä½¿ç”¨ `lsblk` æˆ– `fdisk -l` æŸ¥çœ‹æ–°å¢ç£ç›˜çš„è®¾å¤‡åï¼ˆå¦‚ `/dev/sdb`ï¼‰

```bash
sudo fdisk -l
```

1. â€‹**æŸ¥çœ‹ç£ç›˜æ€»å®¹é‡**  
    `/dev/sda`Â æ€»å®¹é‡ä¸º 322.1GBï¼Œå·²åˆ†é…çš„åˆ†åŒºå¦‚ä¸‹ï¼š
    
    - `/dev/sda1`ï¼ˆå¯åŠ¨åˆ†åŒºï¼‰ï¼š1GB
    - `/dev/sda2`ï¼ˆLVM ç‰©ç†å·ï¼‰ï¼š107.4GB
        - `centos-root`ï¼ˆæ ¹åˆ†åŒºï¼‰ï¼š53.7GB
        - `centos-swap`ï¼ˆäº¤æ¢åˆ†åŒºï¼‰ï¼š5.3GB
        - `centos-home`ï¼ˆç”¨æˆ·æ•°æ®åˆ†åŒºï¼‰ï¼š47.3GB
2. â€‹**è®¡ç®—æœªä½¿ç”¨ç©ºé—´**  
    `sda2`Â çš„ç»“æŸæ‰‡åŒºä¸ºÂ `209715199`ï¼Œè€ŒÂ `/dev/sda`Â æ€»æ‰‡åŒºä¸ºÂ `629145600`ï¼Œæœªåˆ†é…ç©ºé—´çº¦ä¸º â€‹**214.7GB**â€‹ï¼ˆ322.1GB - 107.4GBï¼‰

3. **æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿ**

```bash
   lsblk -f
```

##### 1.1.1.1.2 **æ‰©å®¹æ ¹ç›®å½•é€»è¾‘å·**

###### **æ­¥éª¤ 1ï¼šæ‰©å±• Sda2 åˆ†åŒº**

ç”±äºæœªåˆ†é…ç©ºé—´ä½äºÂ `sda2`Â ä¹‹åï¼Œéœ€å…ˆæ‰©å±•Â `sda2`Â åˆ†åŒºä»¥åŒ…å«å…¨éƒ¨ç£ç›˜ç©ºé—´ï¼š

```bash
sudo parted /dev/sda
(parted) resizepart 2 100%  # å°†sda2æ‰©å±•åˆ°ç£ç›˜æœ«å°¾
(parted) quit
```

###### **æ­¥éª¤ 2ï¼šæ‰©å±•ç‰©ç†å·**

å°†æ–°å¢ç©ºé—´åŠ å…¥ LVM ç‰©ç†å·ï¼š

```bash
sudo pvresize /dev/sda2  # è‡ªåŠ¨è¯†åˆ«æ‰©å±•åçš„ç©ºé—´
```

###### â€‹**æ­¥éª¤ 3ï¼šæ‰©å±•é€»è¾‘å·**

1. â€‹**æŸ¥çœ‹å·ç»„ï¼ˆVGï¼‰ä¿¡æ¯**

```bash
sudo vgdisplay centos  # ç¡®è®¤VGåç§°ä¸º"centos"
```

2. â€‹**æ‰©å±•æ ¹é€»è¾‘å·ï¼ˆLVï¼‰â€‹**

```bash
sudo lvextend -l +100%FREE /dev/mapper/centos-root  # å°†å‰©ä½™ç©ºé—´å…¨éƒ¨åˆ†é…ç»™æ ¹ç›®å½•
```

###### **æ­¥éª¤ 4ï¼šè°ƒæ•´æ–‡ä»¶ç³»ç»Ÿ**

æ ¹æ®æ–‡ä»¶ç³»ç»Ÿç±»å‹æ‰§è¡Œæ‰©å®¹ï¼š

- â€‹**ext4 æ–‡ä»¶ç³»ç»Ÿ**ï¼š

```bash
sudo resize2fs /dev/mapper/centos-root
```

- â€‹**xfs æ–‡ä»¶ç³»ç»Ÿ**ï¼š

```bash
sudo xfs_growfs /
```

---

##### 1.1.1.1.3 â€‹**éªŒè¯ç»“æœ**

```bash
df -h /  # æŸ¥çœ‹æ ¹ç›®å½•å®¹é‡æ˜¯å¦å¢åŠ 
lsblk    # ç¡®è®¤é€»è¾‘å·å¤§å°å˜åŒ–
```

---

##### 1.1.1.1.4 â€‹**æ³¨æ„äº‹é¡¹**

1. â€‹**å¤‡ä»½æ•°æ®**  
    æ“ä½œå‰å»ºè®®å¯¹é‡è¦æ•°æ®å¤‡ä»½ï¼Œé¿å…æ‰©å®¹å¤±è´¥å¯¼è‡´æ•°æ®ä¸¢å¤±
2. â€‹**æ–‡ä»¶ç³»ç»Ÿç±»å‹**  
    é€šè¿‡Â `lsblk -f`Â ç¡®è®¤æ ¹ç›®å½•æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆå¦‚ xfs æˆ– ext4ï¼‰ã€‚
3. â€‹**åœ¨çº¿æ‰©å®¹**  
    è‹¥ä½¿ç”¨ xfs æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒåœ¨çº¿æ‰©å®¹ï¼›ext4 éœ€ç¡®ä¿æ–‡ä»¶ç³»ç»ŸæœªæŸåã€‚
---

##### 1.1.1.1.5 â€‹**æ‰©å±•åœºæ™¯ï¼ˆå¯é€‰ï¼‰â€‹**

- â€‹**è°ƒæ•´ home åˆ†åŒºç©ºé—´**  
    è‹¥æ— éœ€ä¿ç•™homeåˆ†åŒºæ•°æ®ï¼Œå¯åˆ é™¤Â `/dev/mapper/centos-home`ï¼Œå°†å…¶ç©ºé—´åˆå¹¶åˆ°æ ¹ç›®å½•ï¼š

1. å¤‡ä»½ home æ•°æ®åå¸è½½ï¼š

```bash
sudo umount /home
sudo lvremove /dev/mapper/centos-home
```

 1. æ‰©å±•æ ¹é€»è¾‘å·ï¼š

```bash
sudo lvextend -l +100%FREE /dev/mapper/centos-root
sudo resize2fs /dev/mapper/centos-root  # æˆ–xfs_growfs
```

---

#### 1.1.1.2 æ–°å¢ç£ç›˜

##### 1.1.1.2.1 VSphere ç»™è™šæ‹ŸæœºåŠ æ–°ç¡¬ç›˜

![image.png](http://img.fcs.cloudns.ch/pics/20250606171759126.png)
æ·»åŠ å®Œæˆç¡¬ç›˜åï¼Œé‡å¯è™šæ‹Ÿæœºä»¥è¯†åˆ«åˆ°æ–°ç¡¬ç›˜ã€‚

##### 1.1.1.2.2 æ–°ç¡¬ç›˜åˆ›å»ºç‰©ç†å·ï¼ˆPVï¼‰

é¦–å…ˆï¼Œä½ éœ€è¦å°† sdb ç£ç›˜è½¬åŒ–ä¸ºç‰©ç†å·ã€‚

```bash
pvcreate /dev/sdb
```

##### 1.1.1.2.3 æ‰©å±•å·ç»„ï¼ˆVGï¼‰

> å°†è¿™ä¸ªæ–°çš„ç‰©ç†å·åŠ å…¥åˆ°ç°æœ‰çš„å·ç»„ä¸­

```bash
vgextend centos /dev/sdb
```

##### 1.1.1.2.4 æ‰©å±•é€»è¾‘å·ï¼ˆLVï¼‰

> ç°åœ¨å¯ä»¥æ‰©å±• / æ ¹ç›®å½•æ‰€åœ¨çš„é€»è¾‘å·äº†ï¼Œä»¥å¢åŠ  100GB ä¸ºä¾‹ï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´å¤§å°ï¼‰

```bash
lvextend -L +100G /dev/centos/root
```

> å¦‚æœä½ æƒ³ä½¿ç”¨ sdb ä¸Šçš„æ‰€æœ‰ç©ºé—´

```bash
lvextend -l +100%FREE /dev/centos/root
```

##### 1.1.1.2.5 æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ

æœ€åä¸€æ­¥æ˜¯æ‰©å±•æ–‡ä»¶ç³»ç»Ÿä»¥ä½¿ç”¨æ–°å¢çš„ç©ºé—´ã€‚è¿™ä¸ªæ­¥éª¤ä¾èµ–äºä½  / æ ¹ç›®å½•ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚

###### å¦‚æœæ˜¯ ext4 æ–‡ä»¶ç³»ç»Ÿ

```bash
resize2fs /dev/rl/root
```

###### å¦‚æœæ˜¯ XFS æ–‡ä»¶ç³»ç»Ÿ

```bash
xfs_growfs /
```


### 1.1.2 æ£€æŸ¥ç£ç›˜ç©ºé—´å¹¶æ¸…ç†

ä½ çš„ç³»ç»Ÿæ ¹åˆ†åŒº `/dev/mapper/centos-root` å·² **100% æ»¡äº†**ï¼ˆ196G å·²ç”¨å®Œï¼Œä»…å‰© 104Kï¼‰ï¼Œå¿…é¡»ç«‹å³æ¸…ç†ï¼Œå¦åˆ™ç³»ç»Ÿå¯èƒ½å´©æºƒã€æœåŠ¡å®•æœºã€æ— æ³•ç™»å½•ã€‚

---

#### 1.1.2.1 ğŸ” ç¬¬ä¸€æ­¥ï¼šå¿«é€Ÿå®šä½å¤§ç›®å½•ï¼ˆæŒ‰å¤§å°æ’åºï¼‰

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ**ä»æ ¹ç›®å½•å¼€å§‹ï¼Œæ‰¾å‡ºå ç”¨ç©ºé—´æœ€å¤§çš„ç›®å½•**ï¼š

```bash
# æŸ¥çœ‹æ ¹ç›®å½•ä¸‹å„å­ç›®å½•å¤§å°ï¼ˆäººç±»å¯è¯»ï¼ŒæŒ‰å¤§å°æ’åºï¼‰
sudo du -h --max-depth=1 / | sort -hr
```

> âœ… è¾“å‡ºç¤ºä¾‹ï¼š
> ```
> 150G    /var
> 30G     /usr
> 10G     /home
> 5G      /opt
> ...
> ```

é‡ç‚¹å…³æ³¨ **`/var`ã€`/tmp`ã€`/home`ã€`/root`ã€`/usr`** ç­‰ç›®å½•ã€‚

---

#### 1.1.2.2 ğŸ§¹ ç¬¬äºŒæ­¥ï¼šé‡ç‚¹æ¸…ç†å¸¸è§â€œä¸´æ—¶/æ—¥å¿—â€ç›®å½•

##### 1.1.2.2.1 **æ¸…ç†ç³»ç»Ÿæ—¥å¿—ï¼ˆé€šå¸¸åœ¨ `/var/log`ï¼‰**
```bash
# æŸ¥çœ‹ /var/log å¤§å°
sudo du -sh /var/log

# æ¸…ç©ºå¤§æ—¥å¿—æ–‡ä»¶ï¼ˆä¸è¦ç›´æ¥åˆ ï¼Œé¿å…æœåŠ¡å¼‚å¸¸ï¼‰
sudo truncate -s 0 /var/log/messages
sudo truncate -s 0 /var/log/secure
sudo truncate -s 0 /var/log/maillog
sudo truncate -s 0 /var/log/cron
sudo truncate -s 0 /var/log/dmesg

# æ¸…ç† journal æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ systemdï¼‰
sudo journalctl --vacuum-size=100M
# æˆ–æ¸…ç©º
sudo journalctl --vacuum-time=1s
```

##### 1.1.2.2.2 **æ¸…ç†ä¸´æ—¶ç›®å½•**
```bash
# æ¸…ç† /tmpï¼ˆé‡å¯ä¼šè‡ªåŠ¨æ¸…ï¼Œä½†å¯æ‰‹åŠ¨åˆ ï¼‰
sudo rm -rf /tmp/*

# æ¸…ç† /var/tmp
sudo rm -rf /var/tmp/*
```

##### 1.1.2.2.3 **æ¸…ç† YUM ç¼“å­˜ï¼ˆå¦‚æœæ˜¯ CentOS/RHELï¼‰**
```bash
# æ¸…ç† yum ç¼“å­˜
sudo yum clean all

# æˆ–ç›´æ¥åˆ ç¼“å­˜ç›®å½•
sudo rm -rf /var/cache/yum
```

##### 1.1.2.2.4 **æ¸…ç† Dockerï¼ˆå¦‚æœä½ ç”¨äº† Dockerï¼‰**
```bash
# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨
docker system df

# æ¸…ç†æ— ç”¨é•œåƒã€å®¹å™¨ã€å·
docker system prune -a -f --volumes
```

##### 1.1.2.2.5 **æ¸…ç†æ—§å†…æ ¸ï¼ˆå¦‚æœ /boot ä¹Ÿæ»¡ï¼Œä½†ä½ è¿™é‡Œ /boot åªç”¨äº† 5%ï¼‰**
```bash
# åˆ—å‡ºå·²å®‰è£…å†…æ ¸
rpm -q kernel

# åˆ é™¤æ—§å†…æ ¸ï¼ˆä¿ç•™æœ€æ–°1-2ä¸ªï¼‰
sudo package-cleanup --oldkernels --count=1
```

---

#### 1.1.2.3 ğŸ” ç¬¬ä¸‰æ­¥ï¼šæŸ¥æ‰¾å¤§æ–‡ä»¶ï¼ˆ>100MBï¼‰

```bash
# æŸ¥æ‰¾å…¨ç³»ç»Ÿå¤§äº 100MB çš„æ–‡ä»¶
sudo find / -type f -size +100M -exec ls -lh {} \; 2>/dev/null | sort -k5 -hr

# æˆ–åªæŸ¥æœ€è¿‘ä¿®æ”¹çš„å¤§æ–‡ä»¶
sudo find / -type f -size +100M -mtime -7 -exec ls -lh {} \; 2>/dev/null
```

å¸¸è§â€œç½ªé­ç¥¸é¦–â€ï¼š
- æ—¥å¿—æ–‡ä»¶ï¼š`*.log`ã€`journal`ã€`catalina.out`ï¼ˆTomcatï¼‰
- æ•°æ®åº“ dump æ–‡ä»¶ï¼š`*.sql`ã€`*.bak`
- ä¸´æ—¶ä¸‹è½½æ–‡ä»¶ï¼š`/root/*.zip`ã€`/tmp/*.tar.gz`
- åº”ç”¨ç¼“å­˜ï¼š`/home/*/.cache`ã€`/var/lib/*`

---

#### 1.1.2.4 ğŸ’¡ ç¬¬å››æ­¥ï¼šç´§æ€¥é‡Šæ”¾ç©ºé—´ï¼ˆå¦‚æœä¸Šè¿°ä¸å¤Ÿï¼‰

##### 1.1.2.4.1 æ–¹æ¡ˆ Aï¼šä¸´æ—¶æ‰©å®¹ï¼ˆå¦‚æœç”¨äº† LVMï¼‰
ä½†ä½ çš„ `df -h` æ˜¾ç¤ºæ˜¯ LVMï¼ˆ`/dev/mapper/centos-root`ï¼‰ï¼Œå¯æ£€æŸ¥æ˜¯å¦æœ‰æœªåˆ†é…ç©ºé—´ï¼š
```bash
sudo vgs    # æŸ¥çœ‹å·ç»„å‰©ä½™ç©ºé—´
sudo lvs    # æŸ¥çœ‹é€»è¾‘å·
```
å¦‚æœæœ‰å‰©ä½™ï¼Œå¯æ‰©å®¹ï¼ˆä½†éœ€å…ˆæ¸…ç†å‡ºä¸€ç‚¹ç©ºé—´æ‰èƒ½æ“ä½œï¼‰ã€‚

##### 1.1.2.4.2 æ–¹æ¡ˆ Bï¼šåˆ é™¤æ— ç”¨å¤§æ–‡ä»¶ï¼ˆè°¨æ…ï¼ï¼‰
```bash
# ç¤ºä¾‹ï¼šåˆ é™¤æŸä¸ªå¤§æ—¥å¿—
sudo rm -f /var/log/your_app_huge.log

# æˆ–æ¸…ç©ºï¼ˆæ›´å®‰å…¨ï¼‰
sudo truncate -s 0 /path/to/huge_file
```

> âš ï¸ **åˆ‡å‹¿åˆ é™¤ä½ ä¸è®¤è¯†çš„æ–‡ä»¶ï¼** å°¤å…¶æ˜¯ `/bin`ã€`/sbin`ã€`/lib` ä¸‹çš„æ–‡ä»¶ã€‚

---

#### 1.1.2.5 âœ… ç¬¬äº”æ­¥ï¼šé¢„é˜²æªæ–½

1. **è®¾ç½® logrotate**ï¼ˆè‡ªåŠ¨è½®è½¬æ—¥å¿—ï¼‰
   ```bash
   sudo vi /etc/logrotate.d/your_app
   ```
2. **ç›‘æ§ç£ç›˜ä½¿ç”¨**
   ```bash
   # å®‰è£…ç›‘æ§å·¥å…·
   sudo yum install -y ncdu
   # äº¤äº’å¼æŸ¥çœ‹ç›®å½•å¤§å°
   sudo ncdu /
   ```
3. **å®šæœŸæ¸…ç†è„šæœ¬**
   ```bash
   # æ·»åŠ  cron ä»»åŠ¡
   echo "0 2 * * 0 /usr/bin/yum clean all" | sudo crontab -
   ```

---

#### 1.1.2.6 ğŸš¨ ç´§æ€¥æ“ä½œå»ºè®®

ä½ ç°åœ¨ **å¿…é¡»ç«‹å³æ¸…ç†è‡³å°‘ 1~2GB ç©ºé—´**ï¼Œå¦åˆ™ï¼š
- `systemd` å¯èƒ½æ— æ³•å†™æ—¥å¿—
- SSH å¯èƒ½æ‹’ç»æ–°è¿æ¥
- æ•°æ®åº“å¯èƒ½ crash

**ä¼˜å…ˆæ‰§è¡Œï¼š**
```bash
# 1. æ¸…ç† journal æ—¥å¿—
sudo journalctl --vacuum-size=50M

# 2. æ¸…ç©ºä¸»è¦æ—¥å¿—
sudo truncate -s 0 /var/log/messages
sudo truncate -s 0 /var/log/secure

# 3. æ¸…ç† yum ç¼“å­˜
sudo yum clean all

# 4. æ£€æŸ¥ /tmp å’Œ /var/tmp
sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*
```

ç„¶åå†æ¬¡è¿è¡Œï¼š
```bash
df -h
```
ç¡®è®¤ `/` åˆ†åŒº **Use% é™åˆ° 95% ä»¥ä¸‹**ã€‚

---

å®Œæˆæ¸…ç†åï¼Œå»ºè®®ç”¨ `ncdu` å·¥å…·æ·±å…¥åˆ†æï¼š
```bash
sudo yum install -y ncdu
sudo ncdu /
```
å®ƒä¼šäº¤äº’å¼æ˜¾ç¤ºç›®å½•å¤§å°ï¼Œæ–¹ä¾¿ä½ ç²¾å‡†å®šä½â€œç©ºé—´åå™¬è€…â€ã€‚

### 1.1.3 Ssh è¿æ¥

-p æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¸å¸¦åˆ™ä¸º 22 ç«¯å£

```sh
ssh -p <port> <username>@<ip/hostname>
```

### 1.1.4 Glusterfs æ–‡ä»¶æŒ‚è½½

```bash
# åˆ›å»ºæŒ‚è½½ç‚¹ç›®å½•ï¼ˆéœ€æŒ‡å®šè·¯å¾„ï¼‰
sudo mkdir -p /mnt/glusterfs

# æŒ‚è½½ GlusterFS å·ï¼ˆä½¿ç”¨ FUSE å®¢æˆ·ç«¯ï¼‰
mount -t glusterfs 192.168.88.170:vol_69994102f7e8a927ebeb3acd3784590c  /mnt/hsas_log
sudo mount -t glusterfs <GlusterFSèŠ‚ç‚¹IPæˆ–ä¸»æœºå>:/<å·å> /mnt/glusterfs
```

> å·åé€šè¿‡ rancher é‡Œæ‰¾åˆ°å¯¹åº”çš„ volume æŸ¥çœ‹ã€‚

### 1.1.5 æ–‡ä»¶ä¼ è¾“

> é€šè¿‡ ssh åè®®ç”¨äºåœ¨æœ¬åœ°è®¡ç®—æœºå’Œè¿œç¨‹è®¡ç®—æœºä¹‹é—´å®‰å…¨åœ°å¤åˆ¶æ–‡ä»¶

1. æœ¬åœ°åˆ°è¿œç¨‹

```sh
scp (-p <port>) </path/to/local/file> <username>@<remote_host/host_name>:</path/to/remote/directory>
```

2. è¿œç¨‹åˆ°æœ¬åœ°

```sh
scp (-p <port>) <username>@<remote_host/host_name>: </path/to/remote/directory> </path/to/local/file> 
```

### 1.1.6 æŸ¥çœ‹è·¯ç”±è¡¨

```sh
yum install net-tools -y
route -n #åˆ—å‡ºæ‰€æœ‰è·¯ç”±
```

### 1.1.7 æŸ¥çœ‹èµ„æº

æŸ¥çœ‹æ‰€æœ‰èµ„æºå ç”¨æƒ…å†µï¼Œé™åºæ’åˆ—ï¼Œ`top` é»˜è®¤ä¼šå®æ—¶æ›´æ–°æ˜¾ç¤ºçš„ä¿¡æ¯ï¼Œé€šå¸¸æ¯ç§’åˆ·æ–°ä¸€æ¬¡ã€‚

```sh
top 
```

1. **æ’åº**ï¼š
    - æŒ‰ CPU ä½¿ç”¨ç‡æ’åºï¼šæŒ‰Â `P`Â é”®ã€‚
    - æŒ‰å†…å­˜ä½¿ç”¨ç‡æ’åºï¼šæŒ‰Â `M`Â é”®ã€‚
    - æŒ‰æ‰§è¡Œæ—¶é—´æ’åºï¼šæŒ‰Â `T`Â é”®ã€‚
2. **æœç´¢è¿›ç¨‹**ï¼š
    - è¾“å…¥Â `u`Â é”®ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åï¼Œå¯ä»¥æ˜¾ç¤ºè¯¥ç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹ã€‚
    - è¾“å…¥Â `p`Â é”®ï¼Œç„¶åè¾“å…¥è¿›ç¨‹ IDï¼ˆPIDï¼‰ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°ç‰¹å®šè¿›ç¨‹ã€‚
3. **è¿‡æ»¤è¿›ç¨‹**ï¼š
    - è¾“å…¥Â `U`Â é”®ï¼Œç„¶åè¾“å…¥ç”¨æˆ·åï¼Œå¯ä»¥è¿‡æ»¤æ˜¾ç¤ºè¯¥ç”¨æˆ·çš„è¿›ç¨‹ã€‚
    - è¾“å…¥Â `P`Â é”®ï¼Œç„¶åè¾“å…¥è¿›ç¨‹ IDï¼ˆPIDï¼‰ï¼Œå¯ä»¥è¿‡æ»¤æ˜¾ç¤ºè¯¥ PID çš„è¿›ç¨‹ã€‚
4. **æ€æ­»è¿›ç¨‹**ï¼š
    - è¾“å…¥Â `k`Â é”®ï¼Œç„¶åè¾“å…¥è¿›ç¨‹ ID å’Œè¦å‘é€çš„ä¿¡å·ï¼ˆé»˜è®¤æ˜¯ SIGTERMï¼Œå³ 15ï¼‰ï¼Œå¯ä»¥æ€æ­»è¿›ç¨‹ã€‚

### 1.1.8 æŸ¥çœ‹è¿›ç¨‹

`ps` å‘½ä»¤åœ¨ Unix-like ç³»ç»Ÿä¸­ç”¨äºæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ã€‚

```sh
ps
```

1. å‚æ•°è¯´æ˜
	- `USER`ï¼šè¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·åã€‚
	- `PID`ï¼šè¿›ç¨‹çš„ IDã€‚
	- `%CPU`ï¼šè¿›ç¨‹å ç”¨çš„ CPU ç™¾åˆ†æ¯”ã€‚
	- `%MEM`ï¼šè¿›ç¨‹å ç”¨çš„å†…å­˜ç™¾åˆ†æ¯”ã€‚
	- `VSZ`ï¼šè™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆVirtual Sizeï¼‰ã€‚
	- `RSS`ï¼šå®é™…å†…å­˜å¤§å°ï¼ˆResident Set Sizeï¼‰ã€‚
	- `TTY`ï¼šè¿›ç¨‹ç»ˆç«¯ç±»å‹ã€‚
	- `STAT`ï¼šè¿›ç¨‹çŠ¶æ€ã€‚
	- `START`ï¼šè¿›ç¨‹å¯åŠ¨æ—¶é—´ã€‚
	- `TIME`ï¼šè¿›ç¨‹å ç”¨ CPU çš„æ—¶é—´ã€‚
	- `COMMAND`ï¼šå¯åŠ¨è¿›ç¨‹çš„å‘½ä»¤ã€‚

2. å¸¸è§ç»„åˆ
	- ps aux (--sort=-%mem/cpu)ï¼š æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹(æŒ‰ç…§å†…å­˜/CPU ä½¿ç”¨ç‡é™åºæ’åˆ—è¿›ç¨‹)
	- ps -efï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„å®Œæ•´ä¿¡æ¯ã€‚
	- ps -p PIDï¼šæ˜¾ç¤ºç‰¹å®šè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚

### 1.1.9 æŸ¥çœ‹å†…å­˜

ä»¥äººç±»å¯è¯»çš„æ–¹å¼å±•ç¤ºå†…å­˜ä½¿ç”¨çŠ¶æ€ã€‚

```sh
free -mh
```

### 1.1.10 æŸ¥çœ‹ç¡¬ç›˜

ä»¥äººç±»å¯è¯»çš„æ–¹å¼å±•ç¤ºç£ç›˜åˆ†é…çŠ¶æ€ã€‚

```sh
df -h
```

### 1.1.11 æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

`journalctl` æ˜¯ `systemd` ç³»ç»ŸæœåŠ¡ç®¡ç†å™¨çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæŸ¥è¯¢å’Œæ˜¾ç¤ºæ—¥å¿—æ¶ˆæ¯ã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯ä¸ç‰¹å®šæœåŠ¡æˆ–å•å…ƒç›¸å…³çš„æ—¥å¿—ã€‚

```sh
sudo journalctl -u <NetworkManager>
```

æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

```sh
cat/vim /var/log/messages
dmesg
```

æŸ¥æ‰¾ cpu ç›¸å…³æ—¥å¿—ï¼š

```sh
grep -r Call -C 10 /var/log/messages*
grep -r Call /var/log/messages*
```

### 1.1.12 æŸ¥çœ‹ç¼–è¾‘æ–‡ä»¶

#### 1.1.12.1 æœç´¢æ–‡ä»¶

æŒ‰ç…§å…³é”®è¯æœç´¢å«æœ‰å…³é”®è¯çš„æ–‡ä»¶

```sh
find . -type f -exec grep -l 'mysql-master' {} \;
```

```sh
grep 'temporary password' /var/log/mysqld.log
```

```bash
sudo find / -type f -name "*.yaml" -exec grep -H 'service-node-port-range' {} \; 2>/dev/null
```

æœç´¢æŒ‡å®šæ–‡ä»¶åçš„æ–‡ä»¶

```bash
sudo find / -name "kube-apiserver.yaml" 2>/dev/null
```

#### 1.1.12.2 æŸ¥çœ‹æ–‡ä»¶æ•°é‡

```sh
find /path/to/directory -type f | wc -l
```

#### 1.1.12.3 æŸ¥çœ‹ç›®å½•

åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹

```sh
ls
```

1. å¸¸è§æ­é…
	- ls -lhï¼šç»„åˆä½¿ç”¨ `-l` å’Œ `-h` é€‰é¡¹ï¼Œä»¥æ˜“è¯»çš„æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚
	- ls -lï¼šä»¥é•¿åˆ—è¡¨æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æƒé™ã€æ‰€æœ‰è€…ã€å¤§å°å’Œæœ€åä¿®æ”¹æ—¶é—´ã€‚
	- ls -ltï¼šä»¥ä¿®æ”¹æ—¶é—´æ’åºï¼Œæœ€æ–°ä¿®æ”¹çš„æ–‡ä»¶æ’åœ¨æœ€å‰é¢ã€‚
	- ls -lSï¼šä»¥æ–‡ä»¶å¤§å°æ’åºã€‚
	- ls -aï¼šæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä»¥ç‚¹ï¼ˆ`.`ï¼‰å¼€å¤´çš„éšè—æ–‡ä»¶ã€‚
	- ls -Rï¼šé€’å½’åœ°åˆ—å‡ºæ‰€æœ‰å­ç›®å½•çš„å†…å®¹ã€‚
	- ls -Fï¼šåœ¨æ¯ä¸ªæ–‡ä»¶ååæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä»¥æŒ‡ç¤ºæ–‡ä»¶ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ`/` è¡¨ç¤ºç›®å½•ï¼Œ`*` è¡¨ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚
	- ls -oï¼šæ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰è€…å’Œç»„ï¼Œä½†ä¸æ˜¾ç¤ºç»„åã€‚
	- ls --colorï¼šä½¿ç”¨é¢œè‰²æ¥åŒºåˆ†ä¸åŒç±»å‹çš„æ–‡ä»¶ã€‚
	- ls \*.txtï¼šåˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ `.txt` æ–‡ä»¶ã€‚

2. å‚æ•°è§£é‡Šï¼š`drwxr-xr-x 10 root root 4.0K Feb 22 21:41 clash`
	- dï¼šç›®å½•/æ–‡ä»¶
	- rwxï¼šæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ï¼Œ`r`Â ä»£è¡¨å¯è¯»ï¼ˆreadï¼‰ï¼Œ`w`Â ä»£è¡¨å¯å†™ï¼ˆwriteï¼‰ï¼Œ`x`Â ä»£è¡¨å¯æ‰§è¡Œï¼ˆexecuteï¼‰
	- r-xï¼šæ–‡ä»¶æ‰€æœ‰è€…åŒç»„çš„ç”¨æˆ·ï¼ˆgroupï¼‰çš„æƒé™ï¼Œå¯è¯»å¯æ‰§è¡Œä½†ä¸å¯å†™
	- r-xï¼šå…¶ä»–ç”¨æˆ·ï¼ˆothersï¼‰çš„æƒé™ï¼Œå¯è¯»å¯æ‰§è¡Œä½†ä¸å¯å†™
	- 10ï¼šç¡¬é“¾æ¥æŒ‡å‘è¿™ä¸ªç›®å½•çš„ä¸ªæ•°ï¼Œç›®å½•è‡³å°‘ä¸º2ï¼ˆä¸€ä¸ªæ˜¯Â `.`Â è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œå¦ä¸€ä¸ªæ˜¯Â `..`Â è¡¨ç¤ºçˆ¶ç›®å½•ï¼‰ï¼ŒåŠ ä¸Šç›®å½•ä¸‹æ–‡ä»¶å’Œå­ç›®å½•çš„æ•°é‡ã€‚
	- root rootï¼šæ–‡ä»¶æ‰€æœ‰è€…å’Œç»„çš„åç§°ã€‚
	- 4.0Kï¼šç›®å½•å ç”¨ç©ºé—´å¤§å°ï¼ˆä¸åŒ…æ‹¬å­æ–‡ä»¶å’Œå­ç›®å½•ï¼‰ã€‚
	- Feb 22 21:41ï¼šç›®å½•æœ€åä¿®æ”¹çš„æ—¥æœŸå’Œæ—¶é—´ã€‚
	- clashï¼šç›®å½•åç§°ã€‚

#### 1.1.12.4 æŸ¥çœ‹å†…å®¹

æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæ‰“å°åœ¨æ§åˆ¶å°

```sh
cat <fileName>
```

#### 1.1.12.5 æ–°å»ºæ–‡ä»¶

æ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ä¸­

```sh
cat > <file.txt>
echo <content> > <file.txt>
touch <file.txt>
```

#### 1.1.12.6 ç¼–è¾‘å†…å®¹

ä½¿ç”¨ Vim ç¼–è¾‘å™¨ç¼–è¾‘æ–‡ä»¶

```sh
vi(m) <fileName>
```

1. å¸¸è§æ“ä½œï¼š
	- iï¼šè¿›å…¥æ’å…¥å†™æ¨¡å¼
	- escï¼šé€€å‡ºå½“å‰æ¨¡å¼
	- ï¼šæŒ‡ä»¤æ¨¡å¼
	- :qï¼šç›´æ¥é€€å‡º
	- :wqï¼šä¿å­˜é€€å‡º

## 1.2 K8s å’Œ Docker ç›¸å…³æŒ‡ä»¤

[å¿«é€Ÿå®‰è£… | Rainbond](https://www.rainbond.com/docs/quick-start/quick-install)

### 1.2.1 K8s

#### 1.2.1.1 é›†ç¾¤

è·å– prod é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯

```sh
# æ­£å¼é›†ç¾¤
kube-prod get nodes
# æµ‹è¯•é›†ç¾¤
kube-test get nodes
```

#### 1.2.1.2 èŠ‚ç‚¹

è·å–æŒ‡å®šå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰ pod

```sh
kube-prod get pod -n <namespace>
```

è·å–æŒ‡å®š pod çš„è¯¦æƒ…ï¼ˆ`å¯æ ¹æ® event æ’æŸ¥ pod çš„é”™è¯¯ä¿¡æ¯`ï¼‰

```sh
kube-prod describe pod <pod-name> -n <namespace>
```

æ¡ä»¶æŸ¥è¯¢æŒ‡å®šå‘½åç©ºé—´ä¸‹æŒ‡å®šçŠ¶æ€çš„ pod å¹¶æ‰¹é‡åˆ é™¤

```sh
kubectl get pods -n etms | grep Evicted | awk '{print $1}' | xargs kubectl delete pods --kubeconfig ./kube_config_cluster.yml -n etms
```

egï¼š

```sh
kube-test get pods -n etms | grep Evicted | awk '{print $1}' | xargs kubectl delete pods --kubeconfig ./test/kube_config_cluster.yml -n etms
```

å¼ºåˆ¶åˆ é™¤ pod

```sh
kubectl delete pod hsas-1721236200-5q59b --grace-period=0 --force -n hsas
```

#### 1.2.1.3 Pod

å¯åŠ¨å®šæ—¶ä»»åŠ¡

```sh
kubectl-prod -n mysql create job --from=cronjob/cweb-mysql-backup cweb-k8s-mysql-master
ç¬¬ä¸€ä¸ªcwebï¼šåç§°ç©ºé—´
ç¬¬äºŒä¸ªcwebï¼šå®šæ—¶ä»»åŠ¡å
ç¬¬ä¸‰ä¸ªcwebï¼šå¯åŠ¨çš„podå
```


#### 1.2.1.4 Deployment

##### 1.2.1.4.1 æŸ¥çœ‹ deployment çš„æ ‡ç­¾

```bash
kube-etms get deploy -n etms etms-web --show-labels
```

##### 1.2.1.4.2 å®æ—¶æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

```bash
kube-etms logs -n etms -l app=etms-web --prefix -f | grep --line-buffered "å…³é”®è¯"
```
#### 1.2.1.5 å¤åˆ¶æ–‡ä»¶

```bash
kubectl cp -n å‘½åç©ºé—´ -c å®¹å™¨å podå:æ–‡ä»¶ç»å¯¹è·¯å¾„ æ–‡ä»¶ç›®æ ‡ä½ç½®

kube-test cp -n tool -c kkfileview kkfileview-644dcccf65-r4kqb:/opt/kkFileView-4.1.0/config/application.properties ./application.properties
```

#### 1.2.1.6 åˆ›å»º Configmap

1. å‘½ä»¤åˆ›å»º

> **é€šè¿‡å‚æ•° `--from-literal` ç›´æ¥æŒ‡å®šé”®å€¼å¯¹ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒé€‚ç”¨äºä¸´æ—¶æµ‹è¯•ä½¿ç”¨ï¼Œè€Œä¸”ä¸é€‚åˆé…ç½®å¾ˆå¤šçš„æƒ…å†µã€‚**

```bash
$ kubectl create configmap config-literal \
--from-literal=pkslow.name=Larry \
--from-literal=pkslow.age=18 \
--from-literal=pkslow.webSite=www.pkslow.com 
```

1. æ–‡ä»¶åˆ›å»º

> é€šè¿‡å‚æ•° `--from-file` æ¥æŒ‡å®šæ–‡ä»¶ã€‚æŸ¥çœ‹å†…å®¹å¦‚ä¸‹ï¼š

```bash
$ kubectl create configmap config-file \
--namespace=tool \
--from-file=application.yaml \
```

### 1.2.2 Docker

#### 1.2.2.1 é…ç½®é•œåƒ

ä¸ºé•œåƒä»“åº“é…ç½®ä¸‹è½½æºï¼ŒæŸ¥çœ‹ `/etc/docker/daemon.json` æ–‡ä»¶æ¥ç¡®å®šå½“å‰é…ç½®çš„é•œåƒæºï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ™é»˜è®¤ä½¿ç”¨ Docker å®˜æ–¹é•œåƒæºã€‚
1. æŸ¥çœ‹é•œåƒæºé…ç½®

```sh
cat /etc/docker/daemon.json
cat ~/.docker/config.json
```

2. ä¿®æ”¹é…ç½®
å¤šä¸ªé•œåƒæºä»¥é€—å·åˆ†éš”

```sh
{
  "registry-mirrors": ["http://hub-mirror.c.163.com"]
}

#ä»…ä¾›ç§äººä½¿ç”¨
{
  "registry-mirrors": [
                        "https://dockerhub.icu",
                        "https://registry.dockermirror.com",
                        "https://docker.m.daocloud.io",
                        "https://docker.fxxk.dedyn.io",
                        "https://dk.csfan.fun"
					],
  "exec-opts": ["native.cgroupdriver=systemd"]
}
```

å¸¸è§é•œåƒæºï¼š
- [public-image-mirror](https://docker.m.daocloud.io)
- [ISCAS å¼€æºé•œåƒç«™](https://mirror.iscas.ac.cn/)
- [docker.rainbond.cc](https://docker.rainbond.cc/)
- [ç½‘æ˜“äº‘é•œåƒæº](http://hub-mirror.c.163.com)
- [icuç´§æ€¥é•œåƒæº](https://dockerhub.icu)
- [é˜¿é‡Œäº‘é•œåƒæº](https://<your_code>.mirror.aliyuncs.com)
- [ä¸Šæµ·äº¤å¤§é•œåƒç«™](https://docker.mirrors.sjtug.sjtu.edu.cn)
- [å—äº¬å¤§å­¦é•œåƒç«™](https://docker.nju.edu.cn)
- [DockerHubå›½å†…é•œåƒæºåˆ—è¡¨-20240618](https://github.com/cmliu/CF-Workers-docker.io/issues/8)
- [ä» Docker Hub æ‹‰å–é•œåƒå—é˜»ï¼Ÿè¿™äº›è§£å†³æ–¹æ¡ˆå¸®ä½ è½»æ¾åº”å¯¹](https://cloud.tencent.com/developer/article/2430473)
- [å›½å†…æ— æ³•æ‹‰å–Dockeré•œåƒäº†ï¼Ÿè¿™äº›æ–¹æ³•æ‹¯æ•‘ä½ çš„Docker-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/2434428)

> æµ‹é€Ÿï¼ˆæµ‹é€Ÿå‰å…ˆç§»é™¤æœ¬åœ°çš„é•œåƒï¼ï¼‰
> docker rmi nginx:latest
> time docker pull nginx:latest

1. é‡å¯æœåŠ¡æ›´æ–°é…ç½®

```sh
systemctl restart docker.service
sudo systemctl daemon-reload
sudo systemctl restart docker
```

#### 1.2.2.2 ä¿å­˜é•œåƒ

å°†æŒ‡å®šæœ¬åœ°é•œåƒä¿å­˜ä¸º tar å‹ç¼©åŒ…

```sh
docker save -o <image.tar> <image>
```

#### 1.2.2.3 åŠ è½½é•œåƒ

æ ¹æ®æŒ‡å®šé•œåƒå‹ç¼©åŒ…åŠ è½½é•œåƒåˆ°æœ¬åœ°

```sh
docker load -i <image.tar>
```

#### 1.2.2.4 åˆ é™¤é•œåƒ

åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼Œå®¹å™¨å’Œå­˜å‚¨å·ã€‚

```sh
docker image prune
docker container prune
docker volume prune
```

#### 1.2.2.5 æ›´æ–°é•œåƒ

å¯¹å·²æœ‰çš„å˜æ›´ç¯å¢ƒè¿›è¡Œä¿å­˜ä»¥ä¾¿äº pod é‡å¯åç»´æŒæœ€æ–°ç¯å¢ƒ

```sh
docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]
docker commit -a 'fcs'(commit msg) c3a6f02ad044(containerId/name) conda:fcs202407080840(newImageName)
```

- `OPTIONS`
	- `-a`Â æˆ–Â `--author`ï¼šè®¾ç½®é•œåƒçš„ä½œè€…å­—æ®µã€‚
	- `-c`Â æˆ–Â `--change`ï¼šåº”ç”¨ Dockerfile æŒ‡ä»¤æ¥åˆ›å»ºé•œåƒã€‚
	- `-m`Â æˆ–Â `--message`ï¼šæäº¤æ—¶çš„è¯´æ˜ä¿¡æ¯ã€‚
	- `-p`Â æˆ–Â `--pause`ï¼šæäº¤æ—¶æš‚åœå®¹å™¨è¿è¡Œï¼ˆé»˜è®¤ä¸º trueï¼‰ã€‚
- `CONTAINER`Â æ˜¯ä½ è¦æäº¤çš„å®¹å™¨çš„ ID æˆ–åç§°ã€‚
- `REPOSITORY`Â æ˜¯æ–°åˆ›å»ºé•œåƒçš„ä»“åº“åç§°ã€‚
- `TAG`Â æ˜¯å¯é€‰çš„ï¼Œç”¨äºç»™é•œåƒæŒ‡å®šä¸€ä¸ªæ ‡ç­¾ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤æ ‡ç­¾æ˜¯Â `latest`ã€‚

## 1.3 MySQL æŒ‡ä»¤

### 1.3.1 æ‰¾åˆ°é…ç½®æ–‡ä»¶ä½ç½®

```mysql
show variables like 'datadir';
```

### 1.3.2 æŸ¥çœ‹æ—¥å¿—æ‰€åœ¨ä½ç½®

```mysql
show variables like 'log_bin';
```

# 2 å¸¸è§é—®é¢˜

> [!warning] Tips
> 1. **é‡å¯ï¼ˆç‰©ç†æœºã€è™šæ‹Ÿæœºã€æœåŠ¡ã€pod ç­‰ï¼‰** å¯èƒ½æ˜¯ `æœ€ç›´æ¥å¸¸è§çš„åŠæ³•`ï¼Œä½† `ä¸æ˜¯æœ€æœ‰æ•ˆ` çš„åŠæ³•ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œé‡åœ¨**æ ¹æ®é—®é¢˜é€æ­¥æœç´¢çš„æ’æŸ¥æ€è·¯ï¼Œè‡ªé¡¶å‘ä¸‹æ’æŸ¥ï¼Œè‡ªåº•å‘ä¸Šè§£å†³**ã€‚
> 2. *é‡åˆ°é—®é¢˜ä¸è¦æ…Œï¼Œä¼—é‡Œå¯»å®ƒå…ˆç™¾åº¦ï¼Œå±æ˜¯ä¸è¡Œå†é—®è·¯ï¼Œå…ˆæ€è€ƒååŠ¨è„‘ï¼Œå¤šå­¦å¤šçœ‹å¤šå®è·µï¼Œèƒ½åŠ›æ—¥ç›ŠèŠ‚èŠ‚é«˜*ã€‚

## 2.1 é•œåƒæ— æ³•æ‹‰å–

1. åŸå› ï¼šç”±äºå›½å†…é˜²ç«å¢™å¯¼è‡´å›½å¤–å®˜æ–¹é•œåƒä»“åº“è¢«å¢™æ— æ³•æ‹‰å–é•œåƒï¼Œæœ¬åœ°é•œåƒåº“ç¼“å­˜å¯¼è‡´æ‹‰å–æ—¶æ²¡æœ‰æ‰¾åˆ°æœ€æ–°é•œåƒï¼Œdocker ç½‘ç»œé—®é¢˜ï¼Œç³»ç»Ÿç½‘ç»œé—®é¢˜
2. åŠæ³•ï¼š
   - å‡ºå›½æ—…æ¸¸ï¼šwindosw å¼€å¯é­”æ³•æ‹‰å–é•œåƒåé€šè¿‡ docker save å’Œ load è½¬ç§»é•œåƒï¼Œå¹¶ push åˆ°æœ¬åœ°ç§æœ‰é•œåƒä»“åº“ç•™å­˜ã€‚
   - å–è€Œä»£ä¹‹ï¼šå¯»æ‰¾å›½å†…é•œåƒæºä»“åº“ï¼Œç›´æ¥æ‹‰å–å›½å†…é•œåƒä»“åº“çš„é•œåƒåˆ°æœ¬åœ°ï¼Œå¹¶æ¨é€åˆ°æœ¬åœ°ç§æœ‰ä»“åº“ç•™å­˜ã€‚ï¼ˆå›½å†…é•œåƒä»“åº“ä¸ç¨³å®šï¼Œå¯èƒ½ä¼šæ¸…é™¤é•œåƒï¼‰
   - é‡å¯ dockerï¼šdocker pull å¡åœ¨ waiting åˆ™å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå°† pod æ‰€åœ¨èŠ‚ç‚¹çš„ docker è¿›è¡Œé‡å¯ã€‚
   - æ£€æŸ¥ hosts æ·»åŠ è®°å½•ï¼š`cat /etc/hosts` è®°å½•æ ¼å¼ï¼šip    domain
   - é‡å¯ç³»ç»Ÿç½‘ç»œï¼š`sudo systemctl restart NetworkManager`

## 2.2 å†…å­˜/ç¡¬ç›˜æ»¡è½½/æº¢å‡º

1. åŸå› ï¼šéšç€æ—¶é—´çš„ç´¯ç§¯å’Œè´Ÿè½½å˜åŒ–ï¼Œå†…å­˜æˆ–ç¡¬ç›˜èµ„æºå¯èƒ½ä¼šä¸å¤Ÿï¼Œè™šæ‹Ÿæœºè´Ÿè½½è¿‡å¤§ï¼Œæ— æ³•æä¾›æ­£å¸¸å“åº”ã€‚
2. åŠæ³•ï¼š
   - å†…å­˜ï¼šæ¸…ç†æ— ç”¨è¿›ç¨‹ï¼ˆkillï¼‰ï¼Œé‡å¯è™šæ‹Ÿæœºï¼ˆrebootï¼‰ï¼Œæ‰©å®¹å†…å­˜ï¼ˆvcenter æ‰©å¤§è™šæ‹Ÿæœºå†…å­˜ï¼‰
   - ç¡¬ç›˜ï¼šæŸ¥çœ‹ç£ç›˜åˆ†åŒºå’ŒæŒ‚è½½æƒ…å†µï¼ˆdf -hï¼‰ï¼Œæ¸…ç†æ— ç”¨æ–‡ä»¶ï¼ˆrm -rfï¼‰ï¼Œè½¬ç§»æ–‡ä»¶ï¼ˆmvï¼‰ï¼Œç¡¬ç›˜æ‰©å®¹ï¼ˆåˆ†é…æ›´å¤šåˆ†å¸ƒå¼å­˜å‚¨å®¹é‡ï¼Œæ·»åŠ ä¸€å—ç£ç›˜å¹¶è¿›è¡Œç£ç›˜åˆ†åŒºï¼‰

## 2.3 æŒ‚è½½å·å­˜å‚¨æ»¡è½½

1. åŸå› ï¼šæŒ‚è½½çš„æ•°æ®å·å­˜å‚¨å®¹é‡æœ‰é™ï¼Œå½“æ»¡è½½åæ— æ³•åœ¨æŒ‚è½½ç›®å½•ä¸‹æ–°å¢ç›®å½•æˆ–æ–‡ä»¶ã€‚
2. åŠæ³•ï¼š
   - æ¸…ç†æŒ‚è½½ç›®å½•ä¸‹æ— ç”¨çš„æ–‡ä»¶ï¼Œè…¾å‡ºå¯ç”¨ç©ºé—´
   - å¯¹æŒ‚è½½å·è¿›è¡Œæ‰©å®¹ï¼Œå¢åŠ å…¶å­˜å‚¨å®¹é‡ã€‚

## 2.4 CPU æ ¸å¿ƒè¿‡å¤šè½¯é”å®š

1. é—®é¢˜æè¿°ï¼š

```sh
   [1539310.375852]NMI watchdog:BUG:soft lockup CPU#20 stuck for 23s![migration/20:111]
[1539310.375856]NMI watchdog:BUG:soft lockup CPU#28 stuck for 23s![kubelet:9779]
```

2. åŸå› ï¼šæ—¥å¿—è¡¨æ˜ç³»ç»Ÿé‡åˆ°äº†ä¸€ä¸ªâ€œè½¯é”å®šâ€ï¼ˆsoft lockupï¼‰çš„æƒ…å†µã€‚è¿™é€šå¸¸æ„å‘³ç€æŸä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åœ¨ CPU ä¸Šè¿è¡Œäº†å¾ˆé•¿æ—¶é—´ï¼Œå¯¼è‡´ç³»ç»Ÿç›‘è§†å™¨è®¤ä¸ºå®ƒå¯èƒ½å·²ç»å†»ç»“æˆ–å¡ä½ã€‚
   - **æ­»é”**ï¼šä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å¯èƒ½é™·å…¥äº†æ­»é”çŠ¶æ€ï¼Œå¯¼è‡´ CPU æ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚
   - **èµ„æºç«äº‰**ï¼šè¿›ç¨‹ä¹‹é—´å¯èƒ½å­˜åœ¨èµ„æºç«äº‰ï¼Œå¯¼è‡´ CPU é•¿æ—¶é—´å ç”¨ã€‚
   - **æ— é™å¾ªç¯**ï¼šä»£ç ä¸­å¯èƒ½å­˜åœ¨æ— é™å¾ªç¯ï¼Œå¯¼è‡´ CPU è¢«æŒç»­å ç”¨ã€‚
   - **å†…æ ¸é—®é¢˜**ï¼šå¯èƒ½æ˜¯å†…æ ¸æœ¬èº«çš„é—®é¢˜ï¼Œæ¯”å¦‚é©±åŠ¨ç¨‹åºæˆ–å†…æ ¸è¡¥ä¸å¼•èµ·çš„é—®é¢˜ã€‚
   - **é«˜è´Ÿè½½**ï¼šç³»ç»Ÿå¯èƒ½ç”±äºé«˜è´Ÿè½½è€Œæ— æ³•åŠæ—¶å“åº”ã€‚

> cpu stuck è½¯é”å®šçš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ä¾›ç”µä¸è¶³ã€è™šæ‹Ÿæœº cpu æ ¸å¿ƒæ•°è¶…è¿‡ç‰©ç†æœºæ ¸å¿ƒæ•°ã€è™šæ‹Ÿæœº/ç‰©ç†æœº cpu å¤ªå¿™æˆ–ç£ç›˜ IO å¤ªé«˜ã€linux å†…æ ¸ bug ç­‰

1. åŠæ³•ï¼š
   - ä½¿ç”¨ `catÂ /var/dmesg`Â æˆ–Â `journalctl`Â æŸ¥çœ‹å†…æ ¸æ—¥å¿—ã€‚
   - æŸ¥çœ‹æ ¸å¿ƒæ•°æ˜¯å¦è¿‡å¤šï¼ˆegï¼š32ï¼‰ï¼Œå…³æœºå‡å°‘æ ¸å¿ƒæ•°ï¼ˆegï¼š12ï¼‰ï¼›æ‰€æœ‰è™šæ‹Ÿæœºçš„è™šæ‹Ÿ cpu åŠ èµ·æ¥å¯èƒ½ä¼šè¶…è¿‡ç‰©ç†æœºå®é™… cpu çº¿ç¨‹æ•°ï¼Œä½†å•ä¸ªè™šæ‹Ÿæœºçš„è™šæ‹Ÿ cpu å¤„ç†å™¨æ•°ä¸èƒ½è¶…è¿‡ç‰©ç†æœºçº¿ç¨‹æ•°ï¼Œ**ä¸€èˆ¬è™šæ‹Ÿ cpu ä¸ªæ•°å’Œç‰©ç†æœº cpu ä¸ªæ•°ä¿æŒä¸€è‡´ï¼Œæ€»å¤„ç†å™¨æ•°è®¾ä¸ºç‰©ç†æœºçš„ä¸€åŠ**ã€‚(å‚è€ƒï¼š[è™šæ‹Ÿæœºå¦‚ä½•é€‰æ‹©å¤„ç†å™¨å’Œå†…æ ¸æ•°é‡ï¼Œå®ç°æœ€ä½³æ€§èƒ½\_è™šæ‹Ÿæœºè®¾ç½®cpuå¤„ç†å™¨åªæœ‰å¤„ç†å†…æ ¸æ•°é‡-CSDNåšå®¢](https://blog.csdn.net/weixin_45603370/article/details/140293255))

## 2.5 å†…å­˜å ç”¨è™šé«˜

[vmwareè™šæ‹Ÿæœºå†…å­˜å¼‚å¸¸å ç”¨é—®é¢˜ä¸€ä¾‹\_esxi8.0å ç”¨å†…å­˜æ€ä¹ˆå¤„ç†](https://blog.csdn.net/vincent0920/article/details/135485154)

## 2.6 MySQL æ•…éšœ

å‚è€ƒï¼š[MySQLå¯åŠ¨æŠ¥é”™[ERROR] InnoDB: Trying to access page number 4294967295 in space 0, space name innodb]( https://www.cnblogs.com/paul8339/p/16880095.html )

### 2.6.1 K8s é›†ç¾¤è¿ä¸ä¸Š

[k8s é›†ç¾¤ kubeletæ—¥å¿—æŠ¥é”™ command failedâ€œ err=â€œfailed to parse kubelet flag: unknown flag: --network-p\_command failed" err="failed to parse kubelet flag](https://blog.csdn.net/qq_45547688/article/details/131325877)
kubelet ç‰ˆæœ¬èŠ‚ç‚¹ä¹‹é—´ä¸ä¸€è‡´

æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—ï¼š

```sh
systemctl status kubelet.service
journalctl -u kubelet -f
```

æŸ¥çœ‹ç‰ˆæœ¬ï¼š

```sh
rpm -qa | grep kube
```

ç‰ˆæœ¬é™çº§ï¼š

```sh
 yum downgrade kubeadm-1.18.0-0.x86_64 kubectl-1.18.0-0.x86_64 kubelet-1.18.0-0.x86_64
```

é‡å¯ kubeletï¼š

```sh
sudo systemctl restart kubelet.service
systemctl daemon-reload
```

## 2.7 Rancher æ•…éšœ

### 2.7.1 Rancher è¿ä¸ä¸Š Apiserver

åŸå› ï¼šcni ä¸Šå±‚çš„ç½‘ç»œç»„ä»¶å‡ºç°äº†é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç½‘ç»œç›¸å…³çš„ podï¼ˆkube-system ç©ºé—´ä¸‹æˆ–è€…ç›´æ¥-A æŸ¥çœ‹æ‰€æœ‰æ¶‰åŠåˆ°ç½‘ç»œç›¸å…³çš„ podï¼‰æŒ‚äº†ï¼Œé‡å¯åæ‹‰ä¸åˆ°é•œåƒå¯¼è‡´ç½‘ç»œä¸å¯ç”¨ã€‚
è§£å†³ï¼šæ’æŸ¥ç½‘ç»œç›¸å…³ç»„ä»¶ pod æ˜¯å¦æ­£å¸¸ï¼Œä¸æ­£å¸¸åˆ™æ ¹æ® event å’Œ status è¿›è¡Œè§£å†³ã€‚

## 2.8 é›†ç¾¤åŸŸåä¿®æ”¹

### 2.8.1 ä¿®æ”¹ 242nginx åŸŸåé…ç½®

ä¿®æ”¹ `admin/nginx` ç›®å½•ä¸‹çš„ nginx åŸŸåé…ç½®ã€‚
å†ä½¿ç”¨ `./config` è„šæœ¬æ›´æ–°é‡å¯ nginx ä»¥ç”Ÿæ•ˆé…ç½®ã€‚

### 2.8.2 æ”¹ 233gitlab é…ç½®æ–‡ä»¶é‡Œçš„åŸŸå

é…ç½®æ–‡ä»¶ä½ç½®ï¼š`/etc/gitlab/gitlab.rb`
ä¿®æ”¹ gitlab é…ç½®åé‡å¯ï¼ŒåŒæ­¥ä¿®æ”¹é›†ç¾¤å†…çš„ gitlab-runner é…ç½®ï¼ˆconfigmapï¼‰é‡Œçš„åŸŸåã€‚
![|600](https://raw.githubusercontent.com/Alleyf/PictureMap/main/blog/20250324223941398.png)

### 2.8.3 æ”¹ 102harbor é…ç½®æ–‡ä»¶é‡Œçš„åŸŸå

é…ç½®æ–‡ä»¶ä½ç½®ï¼š`/opt/harbor_1_7/harbor.cfg`
ä¿®æ”¹ harbor é…ç½®åé‡å¯ï¼ŒåŒæ­¥ä¿®æ”¹é›†ç¾¤å†…çš„æ‰€æœ‰é•œåƒçš„ä»“åº“åœ°å€ï¼ˆåŸºç¡€è®¾æ–½ã€å®šæ—¶ä»»åŠ¡ã€åº”ç”¨æœåŠ¡ç­‰ï¼‰ã€‚

### 2.8.4 ä¿®æ”¹ kubelet çš„é…ç½®ä»“åº“é‰´æƒåŸŸå

é…ç½®æ–‡ä»¶ä½äºï¼š`/var/lib/kubelet/config.json`
ä¿®æ”¹é‡Œé¢çš„ä»“åº“åŸŸåã€‚

## 2.9 Harbor é•œåƒä»“åº“æ¸…ç†

1. **å®šä½æ¸…ç†ç›®æ ‡é¡¹ç›®**ï¼šç™»å½• harbor é•œåƒä»“åº“ï¼ˆregistry.csdcinfo.cnï¼‰ï¼Œè¿›å…¥éœ€è¦æ¸…ç†çš„é¡¹ç›®ã€‚
2. **è¿‡æ»¤å‡ºå¾…åˆ é™¤ä»“åº“é•œåƒ**ï¼šè¿›å…¥éœ€è¦åˆ é™¤çš„ä»“åº“ï¼ŒæŒ‰ç…§æ—¥æœŸå‡åºå¤šé€‰é€‰ä¸­éœ€è¦åˆ é™¤çš„é•œåƒã€‚
   ![|500](http://img.fcs.cloudns.ch/pics/20250407150126574.png)
3. **åˆ é™¤é€‰ä¸­çš„ tag é•œåƒ**ï¼šåœ¨ä»“åº“ä¸­åˆ é™¤å‰é¢é€‰ä¸­çš„ tag é•œåƒã€‚
   ![|500](http://img.fcs.cloudns.ch/pics/20250407150346301.png)
4. **æ¸…ç†ç£ç›˜ç©ºé—´**ï¼šä¸Šè¿°åˆ é™¤ä»…ä¸ºè½¯åˆ é™¤å¹¶æ²¡æœ‰é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œéœ€è¦è¿›å…¥ç³»ç»Ÿç®¡ç†çš„åƒåœ¾æ¸…ç†ç‚¹å‡»ç«‹å³æ¸…ç†åƒåœ¾ï¼Œæ­¤æ—¶ä¼šå°†å‰é¢è½¯åˆ é™¤çš„é•œåƒå®é™…åˆ é™¤é‡Šæ”¾å‡ºå ç”¨çš„ç©ºé—´ã€‚
   ![|500](http://img.fcs.cloudns.ch/pics/20250407150534168.png)

## 2.10 Mongodb å¯åŠ¨å¤±è´¥

> é—®é¢˜ï¼šRollback failed with unrecoverable error: UnrecoverableRollbackError: not willing to roll back more than 86400 seconds of data. Have: 263733 seconds

åŸå› ï¼šåˆ†ç‰‡æŒ‚æ‰æ²¡æœ‰åŠæ—¶å¯åŠ¨ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œæ— æ³•å¯åŠ¨ã€‚

è§£å†³åŠæ³•ï¼š
1. å…³é—­ mongo é›†ç¾¤ï¼Œæ‰¾åˆ°è¿™ä¸ªåˆ†ç‰‡çš„ä¸»åˆ†ç‰‡ï¼ŒæŠŠå®ƒçš„æ•´ä¸ªç›®å½•å¤åˆ¶åˆ°æ— æ³•å¯åŠ¨çš„é‚£å°åˆ†ç‰‡ä¸Š
2. å¢å¤§åŒæ­¥æ—¶é—´é™åˆ¶ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ MONGODB_EXTRA_FLAGS = --setParameter=rollbackTimeLimitSecs=172800ï¼Œé€šè¿‡ä»¥ä¸‹æŒ‡ä»¤éªŒè¯ï¼šmongo -u username -p password --authenticationDatabase admin --eval "db.adminCommand({getParameter: 1, rollbackTimeLimitSecs: 1})"


# 3 å¸¸ç”¨é•œåƒ

## 3.1 åŸºç¡€è®¾æ–½

### 3.1.1 Longhorn

longhornio/csi-attacher:v2.2.1-lh1
longhornio/csi-provisioner:v1.6.0-lh1
`longhornio/csi-resizer:v0.5.1-lh1`
longhornio/csi-snapshotter:v2.1.1-lh1
longhornio/longhorn-engine:v1.1.0
longhornio/longhorn-instance-manager:v1_20201216
longhornio/longhorn-manager:v1.1.0
longhornio/csi-node-driver-registrar:v1.2.0-lh1
longhornio/longhorn-ui:v1.1.0

### 3.1.2 æ•°æ®åº“

#### 3.1.2.1 å…³ç³»å‹

busybox:1.32
registry.csdc.info/publish/mysql:5.7.31
mysql:5.7.31
nacos/nacos-mysql-master:latest
nacos/nacos-mysql-slave:latest
prom/mysqld-exporter

#### 3.1.2.2 éå…³ç³»å‹

##### 3.1.2.2.1 Redis

registry.csdc.info/publish/redis507
registry.csdc.info/publish/redis-exporter135
oliver006/redis_exporter:v1.3.4
registry.csdc.info/publish/redisinsight:latest

##### 3.1.2.2.2 Neo4j

neo4j:3.5

##### 3.1.2.2.3 ELK

registry.csdc.info/publish/elasticsearch-ik-py:7.16.2
registry.csdc.info/publish/elasticsearch-ik:7.9.2
docker.elastic.co/kibana/kibana:7.16.2
registry.csdc.info/elk/logstash/logstash:7.16.2
docker.elastic.co/eck/eck-operator:1.9.1

##### 3.1.2.2.4 Mongodb

registry.csdc.info/publish/mongodb424:latest
registry.csdc.info/publish/mongodb-exporter:latest

#### 3.1.2.3 OSS

minio/minio:RELEASE.2022-03-17T06-34-49Z

### 3.1.3 åå‘ä»£ç†

nginx:stable
nginx:1.7.9
nginx:1.15

### 3.1.4 å¾®æœåŠ¡ä¸­é—´ä»¶

#### 3.1.4.1 Nacos

nacos/nacos-server:0.9.0
registry.csdc.info/publish/nacos/nacos-server:0.9.0
nacos/nacos-server:2.0.3
registry.csdc.info/publish/nacos221:latest

#### 3.1.4.2 RabbitMQ

docker.io/bitnami/rabbitmq:3.11.6-debian-11-r0

#### 3.1.4.3 Seata

docker.io/seataio/seata-server:latest
registry.csdc.info/etms/seata-server:latest

### 3.1.5 Gitlab

registry.csdc.info/publish/docker:stable-dind
gitlab/gitlab-runner:alpine-v13.7.0
gitlab/gitlab-runner-helper:x86_64-943fc252

### 3.1.6 Harbor

harbor.newershoe.com:8443/library/etcd

### 3.1.7 ç›‘æ§çœ‹æ¿

#### 3.1.7.1 Grafana

rancher/grafana-grafana:7.1.5
rancher/prometheus-auth:v0.2.1
grafana/loki:2.4.2
grafana/grafana:8.3.5
grafana/promtail:2.1.0

#### 3.1.7.2 Prometheus

rancher/prom-prometheus:v2.18.2
rancher/coreos-prometheus-config-reloader:v0.39.0
rancher/jimmidyson-configmap-reload:v0.3.0
rancher/mirrored-library-nginx:1.19.9-alpine

### 3.1.8 SSH

registry.csdc.info/publish/panubo-sshd:latest
panubo/sshd

### 3.1.9 å…¶ä»–

registry.csdc.info/publish/dingtalk-chatbot:1.0.3
registry.csdc.info/publish/databasetools:0.0.2
registry.csdc.info/publish/rsync-ssh:latest
rancher/rancher-agent:v2.5.8
rancher/fleet:v0.3.1
rancher/gitjob:v0.1.8
rancher/nginx-ingress-controller-defaultbackend:1.5-rancher1
rancher/nginx-ingress-controller:nginx-0.35.0-rancher1
rancher/calico-kube-controllers:v3.16.1
rancher/calico-cni:v3.16.1
rancher/calico-pod2daemon-flexvol:v3.16.1
rancher/calico-node:v3.16.1
rancher/coreos-flannel:v0.13.0-rancher1
rancher/coredns-coredns:1.7.0
rancher/cluster-proportional-autoscaler:1.8.1
rancher/metrics-server:v0.3.6
rancher/hyperkube:v1.19.3-rancher1
registry.csdc.info/publish/k8s-sidecar:1.15.1
registry.csdc.info/publish/kube-state-metrics:v2.2.4
quay.io/prometheus/alertmanager:v0.23.0
jimmidyson/configmap-reload:v0.5.0
quay.io/prometheus/node-exporter:v1.3.0
prom/pushgateway:v1.4.2
quay.io/prometheus/prometheus:v2.31.1
rancher/rancher-operator:v0.1.3
registry.csdc.info/publish/tomcat:7
registry.csdc.info/elk/filebeat:7.9.2
registry.csdc.info/publish/locust-tasks
registry.csdc.info/publish/kubectl:v1.14

### 3.1.10 Research

conda:fus
centos:latest
nvidia/cuda:10.1-devel-ubuntu18.04
nvidia/cuda:10.1-cudnn7-devel-centos7

# 4 æ•°æ®å¤‡ä»½

## 4.1 å¤‡ä»½æ¸…å•

### 4.1.1 æ•°æ®åº“å¤‡ä»½

åº”ç”¨æ•°æ®åº“å¤‡ä»½ï¼ˆæ¯å¤©ï¼‰ï¼š
1. K8s å†…å¤‡ä»½ï¼š
	- srdb: mysqlï¼Œmongodb
	- smdb: mysql
	- hsas: mysql
	- cwebï¼ˆæ¯æœˆï¼‰ï¼šmysql
2. dbServï¼ˆ220ï¼‰ä¸Šå¤‡ä»½ï¼š
	- cmisï¼šmysql(auth)ï¼Œoracle

### 4.1.2 æ–‡ä»¶å¤‡ä»½

åº”ç”¨æ–‡ä»¶å¤‡ä»½ï¼š
1. K8S å†…å¤‡ä»½ï¼ˆæ¯å¤©ï¼‰ï¼š
	- srdb
	- smdb
	- hsas
	- cmis
	- cwebï¼ˆæ¯æœˆï¼‰

FTP æ–‡ä»¶å¤‡ä»½ï¼š
210 ä¸Šå¤‡ä»½ï¼ˆæ¯æ—©ä¸Š 8 ç‚¹ï¼‰ï¼š`autosync_push.sh`

GitLab ä»£ç å¤‡ä»½ï¼ˆæ¯å‘¨å¤©ï¼‰ï¼š`autobackup.sh`

## 4.2 æ³¨æ„äº‹é¡¹

oracle æ•°æ®åº“å®šæ—¶ä»»åŠ¡æ— æ³•å¤‡ä»½å¦‚ä¸‹æŠ¥é”™ï¼š

> ORA-31634: ä½œä¸šå·²å­˜åœ¨
> ORA-31664: å¦‚æœé‡‡ç”¨é»˜è®¤å€¼, å°†æ— æ³•æ„é€ å”¯ä¸€çš„ä½œä¸šå

å‚è€ƒï¼š[ORA-31634: ä½œä¸šå·²å­˜åœ¨](https://blog.csdn.net/yabingshi_tech/article/details/110822529)
åŸå› ï¼šjob é˜Ÿåˆ—æ»¡äº†ã€‚
è§£å†³ï¼š
	1. å…ˆæŸ¥è¯¢å‡ºæ‰€æœ‰æœªè¿è¡Œçš„ Jobsï¼š`SELECT 'DROP TABLE ' || OWNER_NAME ||'.'|| JOB_NAME ||';' FROM DBA_DATAPUMP_JOBS WHERE   STATE='NOT RUNNING';`
	2. åˆ é™¤æŸ¥è¯¢åˆ°çš„å®šæ—¶ä»»åŠ¡è®¡åˆ’è¡¨ï¼š`DROP TABLE CMIS.SYS_EXPORT_SCHEMA_xx;`

# 5 åº”ç”¨éƒ¨ç½²

## 5.1 æ–°å»ºé¡¹ç›®

### 5.1.1 Gitlab

åœ¨ gitlab æ–°å»ºä¸€ä¸ªè¦å¼€å‘éƒ¨ç½²çš„é¡¹ç›®

### 5.1.2 Harbor

åœ¨ harbor é•œåƒä»“åº“æ–°å»ºä¸€ä¸ªç§æœ‰é¡¹ç›®ï¼Œåç»­è¯¥åº”ç”¨çš„æ‰€æœ‰é•œåƒéƒ½å­˜å‚¨åœ¨è¯¥é•œåƒä»“åº“ï¼Œä¾¿äºåç»­ä¸Šä¼ å’Œæ‹‰å–åº”ç”¨é•œåƒã€‚

> [!NOTE] æ³¨æ„
> harbor ä»¥ docker å®¹å™¨åŒ–éƒ¨ç½²çš„ï¼Œé‡å¯ 102 è™šæ‹Ÿæœºæˆ–è€… docker åéœ€è¦å¯åŠ¨æ‰€æœ‰ç›¸å…³çš„å®¹å™¨æ‰èƒ½æ¢å¤æ­£å¸¸ã€‚



# 6 å®¿ä¸»æœº IP æ›´æ¢

1. å°† ESXi ä¸»æœºç½®äºç»´æŠ¤æ¨¡å¼ã€‚ï¼ˆå¯è·³è¿‡ï¼‰
2. ä½¿ç”¨ ESXi ä¸»æœº UI Client æˆ– KVM æˆ– ssh ç›´æ¥è¿æ¥ã€‚ï¼ˆå¯è·³è¿‡ï¼‰
3. æ›´æ”¹ IP åœ°å€å¹¶æ›´æ–° DNS æœåŠ¡å™¨ã€‚
	```sh
		 cp /etc/vmware/esx.conf.backup /etc/vmware/esx.conf #å¤‡ä»½å®¿ä¸»æœºé…ç½®æ–‡ä»¶
		 esxcli network ip interface ipv4 set -i vmk0 -I 192.168.88.206 -N 255.255.255.0 -t static #ä¿®æ”¹ip
		 esxcli network ip interface ipv4 get #æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ
	```
4. å°† ESXi ä¸»æœºå–æ¶ˆç»´æŠ¤æ¨¡å¼ï¼Œè¿ç§»åŸè™šæ‹Ÿæœºå›æ¥ã€‚ï¼ˆå¯è·³è¿‡ï¼‰
5. ç¼–è¾‘è™šæ‹Ÿæœºç½‘ç»œçŠ¶æ€ä¸ºå·²è¿æ¥ï¼Œå¦åˆ™ ping ä¸é€šã€‚


> [!NOTE] æ³¨æ„
> é‡å¯ harborï¼Œopenrestryã€‚


# 7 RKE è°ƒæ•´é›†ç¾¤èŠ‚ç‚¹

1. åˆ°ç›®æ ‡é›†ç¾¤çš„ etcd0 èŠ‚ç‚¹ä¸Šï¼Œä¸€èˆ¬åœ¨ home/root ç›®å½•æˆ–è€…/home/docker ç›®å½•ä¸‹æœ‰ rke åŠ cluster.yml é…ç½®æ–‡ä»¶ã€‚
2. ä¿®æ”¹ `cluster.yml` é…ç½®æ–‡ä»¶ï¼Œå¯¹èŠ‚ç‚¹æˆ–å…¶ä»–é…ç½®è¿›è¡Œä¿®æ”¹ã€‚
3. é€šè¿‡ `rke up --update-only --config cluster.yml` æŒ‡ä»¤æ›´æ–°é›†ç¾¤é…ç½®ã€‚

> 1. æ³¨æ„æ‰€æœ‰èŠ‚ç‚¹çš„ docker ç‰ˆæœ¬è¦å’Œ rke æ”¯æŒçš„ç‰ˆæœ¬å¯¹åº”ï¼Œâ€‹â€‹**RKE 1.2.1â€‹â€‹ ä»…æ”¯æŒ Docker 1.13.x ~ 19.03.x**ã€‚
â€‹â€‹RKE 1.3.24â€‹â€‹ æ”¯æŒ Docker 20.10.x ~ 26.xï¼Œä¸å¯¹åº”å°±é™ä½ docker ç‰ˆæœ¬ã€‚
> 2. å¦‚æœæ˜¯æ–°å¢èŠ‚ç‚¹æŒ‰ç…§ä¸‹é¢è¯¦ç»†è¿‡ç¨‹é…ç½®æ·»åŠ ï¼Œå¦‚æœæ˜¯ç§»é™¤èŠ‚ç‚¹é‡æ–°æ·»åŠ åˆ™ cluster.yml æ–‡ä»¶å…ˆæ³¨é‡Šæ‰èŠ‚ç‚¹é…ç½®ï¼Œæ›´æ–°é›†ç¾¤ä¸€éåå†å–æ¶ˆæ³¨é‡Šé€æ­¥åŠ  roleï¼ˆå…ˆåŠ  worker å†åŠ  controller æˆ– etcd ç­‰ï¼‰ã€‚

## 7.1 è¯¦ç»†è¿‡ç¨‹

1. æ‰€æœ‰ etcd å’Œ master å’Œ worker èŠ‚ç‚¹çš„ `/etc/hosts` æ·»åŠ ä¸Šæ‰€æœ‰èŠ‚ç‚¹åç§°å’Œ ip å¯¹åº”è§£æã€‚
```bash
192.168.88.129 etcd0 etcd0.linux.csdc
192.168.88.128 etcd1
192.168.88.127 etcd2
192.168.88.126 master0
192.168.88.125 master1
192.168.88.124 master2
192.168.88.123 build0
192.168.88.122 node0
192.168.88.121 node1
192.168.88.120 node2
192.168.88.119 node3
192.168.88.118 node4
192.168.88.117 node5
192.168.88.116 node6
192.168.88.115 node7
192.168.88.190 gpu
192.168.88.192 gpu2 h3cgpu
192.168.88.194 gpu3 h3cgpu2
192.168.88.196 gpu4 h3cgpu3
192.168.88.102 registry.csdcinfo.cn registry.csdc.info
192.168.88.233 gitlab.csdcinfo.cn gitlab.csdc.info
192.168.88.231 rancher.csdcinfo.cn rancher.csdc.info
```

2. `vim /etc/sysctl.conf`
```bash
net.ipv4.ip_forward = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
```
åˆ·æ–°é…ç½®
```bash
modprobe br_netfilter
sysctl -p
```

3. å…³é—­é˜²ç«å¢™

```bash
systemctl stop firewalld
systemctl disable firewalld
firewall-cmd --state
```

4. å…³é—­ selinux

```bash
#æ°¸ä¹…å…³é—­ï¼Œä¸€å®šè¦é‡å¯æ“ä½œç³»ç»Ÿåç”Ÿæ•ˆã€‚
sudo sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config

#ä¸´æ—¶å…³é—­ï¼Œä¸é‡å¯æ“ä½œç³»ç»Ÿï¼Œå³åˆ»ç”Ÿæ•ˆã€‚
sudo setenforce 0
```

5. ä¸»æœº swap åˆ†åŒºè®¾ç½®
```bash
#æ°¸ä¹…å…³é—­ï¼Œéœ€è¦é‡å¯æ“ä½œç³»ç»Ÿç”Ÿæ•ˆã€‚
sudo swapoff -a
# æ³¨é‡Šæ‰ /etc/fstab é‡Œæ‰€æœ‰ swap è¡Œ
sudo sed -i '/swap/s/^/#/' /etc/fstab

# åº”è¯¥æ— è¾“å‡º
swapon --show
free -h              # Swap è¡Œåº”ä¸º 0B

# cat /etc/fstab
Â·Â·Â·
#/dev/mapper/centos_192-swap swap defaults {} {}
#ä¸´æ—¶å…³é—­ï¼Œä¸éœ€è¦é‡å¯æ“ä½œç³»ç»Ÿï¼Œå³åˆ»ç”Ÿæ•ˆã€‚
# swapoff a
```

6. æ—¶é—´åŒæ­¥
```bash
yum -y install ntpdate
crontab -e
0 */1 * * * ntpdate time1.aliyun.com
```

7. æ·»åŠ  rancher ç”¨æˆ·
ä½¿ç”¨ CentOS æ—¶ï¼Œä¸èƒ½ä½¿ç”¨ root è´¦å·ï¼Œå› æ­¤è¦æ·»åŠ ä¸“ç”¨çš„è´¦å·è¿›è¡Œ docker ç›¸å…³æ“ä½œã€‚é‡å¯ç³»ç»Ÿä»¥åæ‰èƒ½ç”Ÿæ•ˆï¼Œåªé‡
çš„ï¼é‡å¯åï¼Œrancher ç”¨æˆ·ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ docker ps å‘½ä»¤
```bash
useradd rancher
usermod -aG docker rancher
echo 123 | passwd --stdin rancher
```
8. å¤åˆ¶ ssh è¯ä¹¦
ä» rke äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ä¸»æœºä¸Šå¤åˆ¶ï¼Œå¦‚æœå·²ç»å¤åˆ¶ï¼Œåˆ™å¯ä¸éœ€è¦é‡å¤æ€§å¤åˆ¶ã€‚
- å¤åˆ¶è¯ä¹¦
```bash
ssh-copy-id rancher@worker02
```
- éªŒè¯ ssh è¯ä¹¦æ˜¯å¦å¯ç”¨
åœ¨ rke äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ä¸»æœºæœºæµ‹è¯•è¿æ¥å…¶å®ƒé›†ç¾¤ä¸»æœºï¼ŒéªŒè¯æ˜¯å¦å¯ä½¿ç”¨ docker ps å‘½ä»¤å³å¯ã€‚
```bash
ssh rancher@worker02
```

---

# 8 ack é›†ç¾¤ arthas è°ƒè¯•æ–¹æ³•

```bash
# è¿›å…¥arthasç›®å½•
cd /opt/arthas/
# ä¸‹è½½jattach
wget https://hub.gitmirror.com/https://github.com/apangin/jattach/releases/download/v2.1/jattach
# æ·»åŠ ç›®å½•æ‰§è¡Œæƒé™
chmod +x /opt/arthas/jattach
# åŠ è½½javaè¿›ç¨‹åˆ°arthas
./jattach 1 load instrument false /opt/arthas/arthas-agent.jar
# å¯åŠ¨arthas
java -jar arthas-client.jar 127.0.0.1 3658
```


# 9 æ‰‹åŠ¨è°ƒæ•´ä¸“ç½‘é»˜è®¤ç¼ºçœè·¯ç”±

```bash
#99æ®µä¼˜å…ˆ
route del default gw 192.168.99.1
route add default gw 192.168.99.1 metric 50
route -n

#88æ®µä¼˜å…ˆ
route del default gw 192.168.99.1
route add default gw 192.168.99.1 metric 101
route -n
```

## 9.1 åˆ›å»º Systemd æœåŠ¡å›ºåŒ–è·¯ç”±é…ç½®

é€‚ç”¨äºä½¿ç”¨ Systemd çš„ç°ä»£ Linux ç³»ç»Ÿï¼ˆCentOS 7+, Ubuntu 16.04+ï¼‰

1. åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo vim /etc/systemd/system/static-routes.service
```

2. å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Static Routes
After=network.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/sbin/ip route add 100.1.1.0/24 via 192.168.99.1
ExecStart=/sbin/ip route add 144.0.0.0/8 via 192.168.99.1

[Install]
WantedBy=multi-user.target
```

3. å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable static-routes.service
sudo systemctl start static-routes.service
```

# 10 Glusterfs å¸¸ç”¨æ“ä½œ

## 10.1 æŸ¥çœ‹å®¹é‡
```bash
heketi-cli node list æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹

heketi-cli node info 1f5074b6a92ff222cc59d71426638c56 æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹

heketi-cli volume list æŸ¥çœ‹æ‰€æœ‰å·

heketi-cli volume list | grep vol_366bbff89824f57eb02ffa290462d39b æŸ¥çœ‹ç‰¹å®šå·

heketi-cli volume delete 366bbff89824f57eb02ffa290462d39b åˆ é™¤å·

mount -t glusterfs 192.168.88.170:vol_69994102f7e8a927ebeb3acd3784590c /mnt/hsas_log/
```

## 10.2 æ‰©å®¹

> åœ¨170ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

```bash
heketi-cli device add --name /dev/sde --node 1f5074b6a92ff222cc59d71426638c56

heketi-cli device add --name /dev/sdf --node 1f5074b6a92ff222cc59d71426638c56

heketi-cli device add --name /dev/sde --node a55452348b59fe6312e34d9801a33e1e

heketi-cli device add --name /dev/sdf --node a55452348b59fe6312e34d9801a33e1e

heketi-cli device add --name /dev/sde --node c69166fd5d586c4354d6c77312467a6a

heketi-cli device add --name /dev/sdf --node c69166fd5d586c4354d6c77312467a6a
```

# 11 å‚è€ƒæ–‡çŒ®

1. [free-programming-books/books/free-programming-books-zh.md](https://github.com/EbookFoundation/free-programming-books/blob/main/books/free-programming-books-zh.md)
2. [èŠ‚ç‚¹å‹åŠ›é©±é€ | Kubernetes](https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/node-pressure-eviction/)
3. [Erroræ’é”™ï¼šThe node was low on resource: ephemeral-storage](https://blog.csdn.net/m0_59267075/article/details/127710880)
4. [è™šæ‹Ÿæœºå¦‚ä½•é€‰æ‹©å¤„ç†å™¨å’Œå†…æ ¸æ•°é‡ï¼Œå®ç°æœ€ä½³æ€§èƒ½\_è™šæ‹Ÿæœºè®¾ç½®cpuå¤„ç†å™¨åªæœ‰å¤„ç†å†…æ ¸æ•°é‡](https://blog.csdn.net/weixin_45603370/article/details/140293255)
5. [æ— æ³•æ‰“å¼€è™šæ‹Ÿæœºï¼Œè·å–è¯¥è™šæ‹Ÿæœºçš„æ‰€æœ‰æƒå¤±è´¥ã€‚ ä¸»æœºä¸Šçš„æŸä¸ªåº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨è¯¥è™šæ‹Ÿæœº](https://www.cnblogs.com/quantoublog/articles/17352359.html)
6. [ã€vSphereã€‘æ›´æ”¹é›†ç¾¤ä¸­ESXiä¸»æœºIPåœ°å€çš„å®‰å…¨æ–¹æ³•\_vsphereæ”¹ip-CSDNåšå®¢](https://blog.csdn.net/Dearggae/article/details/136793788)

