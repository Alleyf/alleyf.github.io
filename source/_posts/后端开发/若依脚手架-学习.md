---
title: 若依脚手架-学习
date: 2023-12-04 16:29:12
tags:
  - ssm
sticky: 60
excerpt: 关于springboot脚手架一些常见知识点。
author: fcs
index_img: https://picsum.photos/800/250
lang: zh-CN
header-left: "![](D:/开发图片/logo32.png)"
---

![](https://picsum.photos/800/250)

# 项目初始化


## 后端

1. 前往 `Gitee` 下载页面([https://gitee.com/y_project/RuoYi-Vue (opens new window)](https://gitee.com/y_project/RuoYi-Vue))下载解压到工作目录
2. 创建数据库（默认使用 ry-vue 数据库，可自己修改），导入 sql 目录下的数据脚本 `ry_2021xxxx.sql`，`quartz.sql`  
3. 修改项目配置文件，如果前面修改了数据库名则需要修改数据库相关配置，位于 ruoyi-admin 模块下的配置文件 `application-druid.yml` 的数据库配置
4. 启动 admin 应用程序即可


## 前端

1. cd 进入 ruiyi-ui，执行 `npm install` 安装项目依赖，如果下载太慢可指定下载源 `npm install --registry=https://registry.npmmirror.com`
2. 安装完依赖后可修改 vue.config.js 设置页面端口默认为 80
3. `npm run dev` 启动项目

![](http://qnpicmap.fcsluck.top/pics/202312041759883.png)

# 结构分析
## 模块结构

![|500](http://qnpicmap.fcsluck.top/pics/202312042034292.png)

1，2，3，4 前四个模块是必须的基本模块，5 和 6 分别是定时任务和代码生成器模块为可选模块，使用 maven 的 package 打包后会在 ruoyi-admin 模块的 target 文件夹下生成 jar 包，可直接部署运行

## 表结构


1. 代码生成器表和系统管理表：

![|500](http://qnpicmap.fcsluck.top/pics/202312042041597.png)


2. 定时任务表：

![|287](http://qnpicmap.fcsluck.top/pics/202312042045126.png)


## 配置结构

ruoyi-admin 的 resources 目录树形结构如下所示：

```java
│  application-druid.yml
│  application.yml
│  banner.txt
│  logback-spring.xml
│
├─i18n
│      messages.properties
│      messages_en.properties
│
├─META-INF
│      spring-devtools.properties
│
├─mybatis
│      mybatis-config.xml
│
└─upload
    └─avatar
        └─2023
            └─12
                └─04
                    wallhaven-1pol63_20231204211235A001.png
```

> 1. `application-druid.yml`：数据库配置文件，使用 druid 数据库连接池，并开启数据库监控
> 2. `application.yml`：管理后台应用程序配置文件
> 3. `banner.txt`：程序启动横幅配置
> 4. `logback-spring.xml` (原本为 logback.xml，修改后可从 yml 文件中读取配置参数用于自定义日志)：日志自定义配置文件（*将原先的 logback.xml 改成 logback-spring.xml。原因是 springboot 先读取 logback.xml，然后加载 yml/properties，再加载 logback-spring.xml*）
> 5. `i18n`：国际化文件夹，messages.properties 和 messages_en.properties 分别为中英文配置
> 6. `spring-devtools.properties`：热启动配置文件
> 7. `mybatis-config.xml`：mybatis 配置文件
> 8. `upload/**`：自己配置的文件上传目录


## 返回值结构

RuoYi 脚手架使用的是前后端分离的版本，后端接口依旧是返回 json 格式数据，一共有 3 中返回值分别为：`TableDatalnfo`（**用于分页列表**）、`void`（**用于导出/下载**）、`AjaxResult`（**用于基本的增删改查**）。

**TableDatalnfo**：

```java
public class TableDataInfo implements Serializable  
{  
    private static final long serialVersionUID = 1L;  
  
    /** 总记录数 */  
    private long total;  
  
    /** 列表数据 */  
    private List<?> rows;  
  
    /** 消息状态码 */  
    private int code;  
  
    /** 消息内容 */  
    private String msg;
}
```


**AjaxResult**：

```java
public class AjaxResult extends HashMap<String, Object>  
{  
    private static final long serialVersionUID = 1L;  
  
    /** 状态码 */  
    public static final String CODE_TAG = "code";  
  
    /** 返回内容 */  
    public static final String MSG_TAG = "msg";  
  
    /** 数据对象 */  
    public static final String DATA_TAG = "data";
}
```

---
# 核心模块刨析


## 1. 解读模块

首先对一个开源项目，需要对各个项目业务模块进行分析理解，充分理解各个业务模块功能和关系之后，才能以此作为基座进行二次开发，一般分析从以下四个方面考虑：

- **业务前提**：了解模块功能，它在做什么，比如岗位 crud
- **技术前提**：了解前后端技术栈，掌握相对应的技术，如 springboot+vue 项目，那么前端 vue 基本操作必须会，以及后端 ssm 必须会
- **开发技巧**：前端会 F12 进入开发者模式进行调试，后端掌握 debug 调试
- **常规项目特点**：了解各种类型项目的特点，例如：管理后台类项目特点先页面、后接口，经典厂字形布局
- **web 项目组件技巧**：
	- ==业务 UI==：
		- 一般以树形结构层级关系布局，无论多复杂的前端页面，都先将整个页面标签收起来，再层层展开剥离分析各个子标签对应的 UI 和功能，由浅入深了解整个 UI 设计
	- ==业务逻辑==：
		1. *主线*：发起请求--->接收请求--->处理请求--->响应请求
		2. *详细*：
			- 客户端发请求（关注：请求 url/请求方式/请求头/请求参数）
			- 接口接收请求（关注：接口定义/参数接收/参数封装/参数校验）
			- 接口处理请求（关注：业务逻辑实现）
			- 接口响应请求（关注：响应数据类型/数据格式/响应头）


---
## 2. 岗位模块

## 2.1 岗位列表

![](http://qnpicmap.fcsluck.top/pics/202312051340012.png)

岗位模块的业务逻辑如下图所示：

![](http://qnpicmap.fcsluck.top/pics/202312051308728.png)

用户请求浏览器进入前端页面，进入过程中前端页面发起请求向后端请求数据，得到返回的 json 数据后将数据渲染在前端页面上呈现给用户。

其后端业务调用链路如下图所示：

![](http://qnpicmap.fcsluck.top/pics/202312051521425.png)


## 2.2 岗位添加/修改

页面设计：依据表中*必须填/选填字段*，根据内容决定选择框架-输入框

前端代码：
```vue
  <!-- 添加或修改岗位对话框 -->  
  <el-dialog :title="title" :visible.sync="open" append-to-body width="500px">  
    <el-form ref="form" :model="form" :rules="rules" label-width="80px">  
      <el-form-item label="岗位名称" prop="postName">  
        <el-input v-model="form.postName" placeholder="请输入岗位名称" />  
      </el-form-item>      <el-form-item label="岗位编码" prop="postCode">  
        <el-input v-model="form.postCode" placeholder="请输入编码名称" />  
      </el-form-item>      <el-form-item label="岗位顺序" prop="postSort">  
        <el-input-number v-model="form.postSort" :min="0" controls-position="right" />  
      </el-form-item>      <el-form-item label="岗位状态" prop="status">  
        <el-radio-group v-model="form.status">  
          <el-radio v-for="dict in dict.type.sys_normal_disable" :key="dict.value" :label="dict.value">{{ dict.label }}  
          </el-radio>  
        </el-radio-group>      </el-form-item>      <el-form-item label="备注" prop="remark">  
        <el-input v-model="form.remark" placeholder="请输入内容" type="textarea" />  
      </el-form-item>    </el-form>    <div slot="footer" class="dialog-footer">  
      <el-button type="primary" @click="submitForm">确 定</el-button>  
      <el-button @click="cancel">取 消</el-button>  
    </div>  </el-dialog></div>

<script>
/** 提交按钮 */  
submitForm: function () {  
  this.$refs["form"].validate(valid => {  
    if (valid) {  
      if (this.form.postId != undefined) {  
        updatePost(this.form).then(response => {  
          this.$modal.msgSuccess("修改成功");  
          this.open = false;  
        });  
      } else {  
        addPost(this.form).then(response => {  
          this.$modal.msgSuccess("新增成功");  
          this.open = false;  
        });  
      }  
      this.getList();  
    }  
  });  
},
</script>

```


后端代码：

```java
/**  
 * 新增岗位  
 */  
@PreAuthorize("@ss.hasPermi('system:post:add')")  
@Log(title = "岗位管理", businessType = BusinessType.INSERT)  
@PostMapping  
//Spring-validate 校验框架  
public AjaxResult add(@Validated @RequestBody SysPost post) {  
    if (!postService.checkPostNameUnique(post)) {  
        return error("新增岗位'" + post.getPostName() + "'失败，岗位名称已存在");  
    } else if (!postService.checkPostCodeUnique(post)) {  
        return error("新增岗位'" + post.getPostName() + "'失败，岗位编码已存在");  
    }  
    post.setCreateBy(getUsername());  
    return toAjax(postService.insertPost(post));  
}  
  
/**  
 * 修改岗位  
 */  
@PreAuthorize("@ss.hasPermi('system:post:edit')")  
@Log(title = "岗位管理", businessType = BusinessType.UPDATE)  
@PutMapping  
public AjaxResult edit(@Validated @RequestBody SysPost post) {  
    if (!postService.checkPostNameUnique(post)) {  
        return error("修改岗位'" + post.getPostName() + "'失败，岗位名称已存在");  
    } else if (!postService.checkPostCodeUnique(post)) {  
        return error("修改岗位'" + post.getPostName() + "'失败，岗位编码已存在");  
    }  
    post.setUpdateBy(getUsername());  
    return toAjax(postService.updatePost(post));  
}
```

> 1. 前端通过 `data` 发送 `json` 数据后端就要用 `@RequestBody` 接收
> 2. 前端通过 `Params` 发送 `xxx-form-url` 编码的参数后端就要用 `@RequestParam` 接收

服务调用链路如下图所示：

![|650](http://qnpicmap.fcsluck.top/pics/202312062220254.png)


## 2.3 岗位删除

![](http://qnpicmap.fcsluck.top/pics/202312062236888.png)

前端代码：

```vue
<script>
/** 删除按钮操作 */  
handleDelete (row) {  
  const postIds = row.postId || this.ids;  
  this.$modal.confirm('是否确认删除岗位编号为"' + postIds + '"的数据项？').then(function () {  
    // 点击确认删除后的操作  
    return delPost(postIds);  
  }).then(() => {  
    // 执行完删除后的操作  
    this.getList();  
    this.$modal.msgSuccess("删除成功");  
  }).catch(() => {  
  });  
},
</script>
```

后端代码：

```java
/**  
 * 删除岗位  
 */  
@PreAuthorize("@ss.hasPermi('system:post:remove')")  
@Log(title = "岗位管理", businessType = BusinessType.DELETE)  
@DeleteMapping("/{postIds}")  
public AjaxResult remove(@PathVariable Long[] postIds) {  
    return toAjax(postService.deletePostByIds(postIds));  
}
```


## 2.4 Excel 导出功能

若依脚手架使用的是POI，但是占用内存大，不适合高并发，但是定制灵活。

- 如果操作 Excel 复杂度高，建议使用 POI，编程灵活。
- 如果操作 Excel 数据量大，对性能有一定要求的情况，建议使用 EasyExcel。
- 如果操作 Excel 数据量小，而且追求编程效率，建议使用 Hutool 的 ExcelUtil。

![](http://qnpicmap.fcsluck.top/pics/202312062241060.png)


前端代码：

```vue
<script>
/** 导出按钮操作 */  
handleExport () {  
  this.download('system/post/export', {  
    ...this.queryParams  
  }, `post_${new Date().getTime()}.xlsx`)  
}
</script>
```

后端代码：

```java
/**  
 * 导出岗位列表  
 */  
@Log(title = "岗位管理", businessType = BusinessType.EXPORT)  
@PreAuthorize("@ss.hasPermi('system:post:export')")  
@PostMapping("/export")  
public void export(HttpServletResponse response, SysPost post) {  
    List<SysPost> list = postService.selectPostList(post); //获取导出数据  
    ExcelUtil<SysPost> util = new ExcelUtil<SysPost>(SysPost.class);//获取导出excel模板  
    util.exportExcel(response, list, "岗位数据");//传入数据和模板导出数据  
}
//实体类需要添加excel字段注解
public class SysPost extends BaseEntity  
{  
    private static final long serialVersionUID = 1L;  
      /** 岗位序号 */  
    @Excel(name = "岗位序号", cellType = ColumnType.NUMERIC)  
    private Long postId;  
      /** 岗位编码 */  
    @Excel(name = "岗位编码")  
    private String postCode;  
      /** 岗位名称 */  
    @Excel(name = "岗位名称")  
    private String postName;  
      /** 岗位排序 */  
    @Excel(name = "岗位排序")  
    private Integer postSort;  
      /** 状态（0正常 1停用） */  
    @Excel(name = "状态", readConverterExp = "0=正常,1=停用")  
    private String status;
}
```



# 扩展自定义模块-客户CURD



























# 参考

1. [若依项目分析二次开发\_哔哩哔哩\_bilibili](https://www.bilibili.com/video/BV1684y1X7tK/?p=9&spm_id_from=pageDriver&vd_source=9c896fa9c3f9023797e8efe7be0c113e)

