/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var $n=Object.create;var me=Object.defineProperty;var Nn=Object.getOwnPropertyDescriptor;var In=Object.getOwnPropertyNames;var Ln=Object.getPrototypeOf,Fn=Object.prototype.hasOwnProperty;var Bn=(n,e,t)=>e in n?me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var fr=(n,e)=>{for(var t in e)me(n,t,{get:e[t],enumerable:!0})},hr=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of In(e))!Fn.call(n,s)&&s!==t&&me(n,s,{get:()=>e[s],enumerable:!(r=Nn(e,s))||r.enumerable});return n};var dr=(n,e,t)=>(t=n!=null?$n(Ln(n)):{},hr(e||!n||!n.__esModule?me(t,"default",{value:n,enumerable:!0}):t,n)),Un=n=>hr(me({},"__esModule",{value:!0}),n);var v=(n,e,t)=>(Bn(n,typeof e!="symbol"?e+"":e,t),t),_n=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var wt=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var Ue=(n,e,t)=>(_n(n,e,"access private method"),t);var so={};fr(so,{default:()=>mt});module.exports=Un(so);var B=require("obsidian");var mr={serverUrl:"http://localhost",serverPort:3e3,autoStartServer:!0,platforms:{},publishHistory:[],defaultPlatforms:[],imageCompression:!0,imageQuality:80,proxyEnabled:!1,proxyUrl:"http://127.0.0.1:7897"},j=[{id:"weixin",name:"\u5FAE\u4FE1\u516C\u4F17\u53F7",icon:"\u{1F4F1}",category:"social",status:"available"},{id:"zhihu",name:"\u77E5\u4E4E",icon:"\u{1F535}",category:"social",status:"available"},{id:"csdn",name:"CSDN",icon:"\u{1F4BB}",category:"tech",status:"available"},{id:"juejin",name:"\u6398\u91D1",icon:"\u{1F48E}",category:"tech",status:"available"},{id:"toutiao",name:"\u4ECA\u65E5\u5934\u6761",icon:"\u{1F4F0}",category:"social",status:"available"},{id:"jianshu",name:"\u7B80\u4E66",icon:"\u{1F4DD}",category:"social",status:"planned"},{id:"cnblog",name:"\u535A\u5BA2\u56ED",icon:"\u{1F310}",category:"tech",status:"planned"},{id:"segmentfault",name:"SegmentFault",icon:"\u{1F527}",category:"tech",status:"planned"}];var k=require("obsidian");var _e=class extends k.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Multi-Platform Publisher \u8BBE\u7F6E"}),this.renderServerSettings(e),this.renderPlatformSettings(e),this.renderPublishSettings(e),this.renderAdvancedSettings(e)}renderServerSettings(e){e.createEl("h3",{text:"\u670D\u52A1\u5668\u8BBE\u7F6E"}),new k.Setting(e).setName("\u670D\u52A1\u5668\u5730\u5740").setDesc("\u672C\u5730\u4EE3\u7406\u670D\u52A1\u5668\u5730\u5740").addText(r=>r.setPlaceholder("http://localhost").setValue(this.plugin.settings.serverUrl).onChange(async s=>{this.plugin.settings.serverUrl=s,await this.plugin.saveSettings()})),new k.Setting(e).setName("\u670D\u52A1\u5668\u7AEF\u53E3").setDesc("\u672C\u5730\u4EE3\u7406\u670D\u52A1\u5668\u7AEF\u53E3").addText(r=>r.setPlaceholder("3000").setValue(this.plugin.settings.serverPort.toString()).onChange(async s=>{let o=parseInt(s);!isNaN(o)&&o>0&&o<65536&&(this.plugin.settings.serverPort=o,await this.plugin.saveSettings())})),new k.Setting(e).setName("\u81EA\u52A8\u542F\u52A8\u670D\u52A1\u5668").setDesc("\u63D2\u4EF6\u52A0\u8F7D\u65F6\u81EA\u52A8\u542F\u52A8\u672C\u5730\u670D\u52A1\u5668\uFF08\u63A8\u8350\u5F00\u542F\uFF09").addToggle(r=>r.setValue(this.plugin.settings.autoStartServer).onChange(async s=>{this.plugin.settings.autoStartServer=s,await this.plugin.saveSettings(),s?new k.Notice("\u2705 \u5DF2\u542F\u7528\u81EA\u52A8\u542F\u52A8\uFF0C\u4E0B\u6B21\u6253\u5F00 Obsidian \u65F6\u4F1A\u81EA\u52A8\u542F\u52A8\u670D\u52A1\u5668"):new k.Notice("\u2139\uFE0F \u5DF2\u7981\u7528\u81EA\u52A8\u542F\u52A8\uFF0C\u9700\u8981\u624B\u52A8\u542F\u52A8\u670D\u52A1\u5668")}));let t=new k.Setting(e).setName("\u670D\u52A1\u5668\u7BA1\u7406").setDesc("\u9996\u6B21\u542F\u52A8\u65F6\u4F1A\u81EA\u52A8\u5B89\u88C5\u4F9D\u8D56\uFF08\u9700\u8981 1-2 \u5206\u949F\uFF09");t.addButton(r=>r.setButtonText("\u542F\u52A8\u670D\u52A1\u5668").setClass("mod-cta").onClick(async()=>{r.setDisabled(!0),r.setButtonText("\u542F\u52A8\u4E2D...");try{new k.Notice("\u23F3 \u6B63\u5728\u542F\u52A8\u670D\u52A1\u5668..."),await this.plugin.serverManager.start()?(t.setDesc("\u2705 \u670D\u52A1\u5668\u8FD0\u884C\u4E2D | http://localhost:3000"),r.setButtonText("\u91CD\u542F\u670D\u52A1\u5668")):(t.setDesc("\u274C \u670D\u52A1\u5668\u542F\u52A8\u5931\u8D25"),r.setButtonText("\u542F\u52A8\u670D\u52A1\u5668"))}catch(s){new k.Notice(`\u274C \u542F\u52A8\u5931\u8D25: ${s.message}`),t.setDesc("\u274C \u670D\u52A1\u5668\u542F\u52A8\u5931\u8D25"),r.setButtonText("\u542F\u52A8\u670D\u52A1\u5668")}finally{r.setDisabled(!1)}})),t.addButton(r=>r.setButtonText("\u505C\u6B62\u670D\u52A1\u5668").onClick(async()=>{r.setDisabled(!0);try{await this.plugin.serverManager.stop(),t.setDesc("\u670D\u52A1\u5668\u5DF2\u505C\u6B62")}catch(s){new k.Notice(`\u505C\u6B62\u5931\u8D25: ${s.message}`)}finally{r.setDisabled(!1)}}))}renderPlatformSettings(e){e.createEl("h3",{text:"\u5E73\u53F0\u7BA1\u7406"}),e.createDiv("platforms-desc").setText("\u914D\u7F6E\u8981\u53D1\u5E03\u7684\u5E73\u53F0\uFF0C\u70B9\u51FB\u5E73\u53F0\u540D\u79F0\u8FDB\u884C\u8BA4\u8BC1\u548C\u8BBE\u7F6E"),Object.entries({social:"\u81EA\u5A92\u4F53\u5E73\u53F0",tech:"\u6280\u672F\u793E\u533A"}).forEach(([s,o])=>{e.createEl("h4",{text:o}),j.filter(a=>a.category===s).forEach(a=>{this.renderPlatformSetting(e,a.id,a.name)})})}renderPlatformSetting(e,t,r){let s=this.plugin.settings.platforms[t]||{enabled:!1,autoPublish:!1,authenticated:!1},o=new k.Setting(e).setName(r).setDesc(s.authenticated?`\u2705 \u5DF2\u8BA4\u8BC1 | \u8D26\u53F7: ${s.accountName||"\u672A\u77E5"}`:"\u672A\u8BA4\u8BC1");o.addToggle(i=>i.setValue(s.enabled).onChange(async a=>{this.plugin.settings.platforms[t]||(this.plugin.settings.platforms[t]={enabled:!1,autoPublish:!1,authenticated:!1}),this.plugin.settings.platforms[t].enabled=a,await this.plugin.saveSettings(),this.display()})),s.enabled&&(o.addButton(i=>i.setButtonText(s.authenticated?"\u91CD\u65B0\u8BA4\u8BC1":"\u8BA4\u8BC1").onClick(async()=>{await this.authenticatePlatform(t,r)})),o.addButton(i=>i.setButtonText("\u6D4B\u8BD5").onClick(async()=>{i.setDisabled(!0);try{await this.plugin.platformManager.testConnection(t)?new k.Notice(`\u2705 ${r} \u8FDE\u63A5\u6210\u529F`):new k.Notice(`\u274C ${r} \u8FDE\u63A5\u5931\u8D25`)}catch(a){new k.Notice(`\u274C ${r} \u8FDE\u63A5\u5931\u8D25: ${a.message}`)}finally{i.setDisabled(!1)}})))}async authenticatePlatform(e,t){new yt(this.app,this.plugin,e,t,()=>{this.display()}).open()}renderPublishSettings(e){if(e.createEl("h3",{text:"\u53D1\u5E03\u8BBE\u7F6E"}),new k.Setting(e).setName("\u9ED8\u8BA4\u53D1\u5E03\u5E73\u53F0").setDesc("\u5FEB\u901F\u53D1\u5E03\u65F6\u4F7F\u7528\u7684\u5E73\u53F0").addDropdown(t=>{t.addOption("","\u9009\u62E9\u5E73\u53F0..."),j.forEach(r=>{let s=this.plugin.settings.platforms[r.id];s!=null&&s.enabled&&(s!=null&&s.authenticated)&&t.addOption(r.id,r.name)}),t.onChange(async r=>{r&&!this.plugin.settings.defaultPlatforms.includes(r)&&(this.plugin.settings.defaultPlatforms.push(r),await this.plugin.saveSettings(),this.display())})}),this.plugin.settings.defaultPlatforms.length>0){let t=e.createDiv("default-platforms");t.createEl("p",{text:"\u5DF2\u9009\u62E9\u7684\u9ED8\u8BA4\u5E73\u53F0:"}),this.plugin.settings.defaultPlatforms.forEach(r=>{let s=j.find(l=>l.id===r),o=(s==null?void 0:s.name)||r;t.createSpan({text:o,cls:"platform-tag"}).createEl("button",{text:"\xD7",cls:"platform-tag-remove"}).addEventListener("click",async()=>{let l=this.plugin.settings.defaultPlatforms.indexOf(r);l!==-1&&(this.plugin.settings.defaultPlatforms.splice(l,1),await this.plugin.saveSettings(),this.display())})})}}renderAdvancedSettings(e){e.createEl("h3",{text:"\u9AD8\u7EA7\u8BBE\u7F6E"}),new k.Setting(e).setName("\u542F\u7528\u4EE3\u7406").setDesc("\u4E0B\u8F7D\u56FE\u7247\u65F6\u4F7F\u7528\u4EE3\u7406\uFF08\u672C\u5730\u5F00\u53D1\u65F6\u542F\u7528\uFF0C\u8FDC\u7A0B\u670D\u52A1\u5668\u7981\u7528\uFF09").addToggle(t=>t.setValue(this.plugin.settings.proxyEnabled||!1).onChange(async r=>{this.plugin.settings.proxyEnabled=r,await this.plugin.saveSettings();try{await this.plugin.platformManager.updateProxyConfig(r,this.plugin.settings.proxyUrl||"http://127.0.0.1:7897"),new k.Notice(r?"\u2705 \u4EE3\u7406\u5DF2\u542F\u7528":"\u2139\uFE0F \u4EE3\u7406\u5DF2\u7981\u7528")}catch(s){console.error("Update proxy config failed:",s)}})),new k.Setting(e).setName("\u4EE3\u7406\u5730\u5740").setDesc("HTTP/HTTPS \u4EE3\u7406\u5730\u5740\uFF0C\u4F8B\u5982: http://127.0.0.1:7897").addText(t=>t.setPlaceholder("http://127.0.0.1:7897").setValue(this.plugin.settings.proxyUrl||"http://127.0.0.1:7897").onChange(async r=>{if(this.plugin.settings.proxyUrl=r,await this.plugin.saveSettings(),this.plugin.settings.proxyEnabled)try{await this.plugin.platformManager.updateProxyConfig(!0,r)}catch(s){console.error("Update proxy config failed:",s)}})),new k.Setting(e).setName("\u56FE\u7247\u538B\u7F29").setDesc("\u4E0A\u4F20\u524D\u538B\u7F29\u56FE\u7247\u4EE5\u51CF\u5C0F\u6587\u4EF6\u5927\u5C0F").addToggle(t=>t.setValue(this.plugin.settings.imageCompression).onChange(async r=>{this.plugin.settings.imageCompression=r,await this.plugin.saveSettings()})),new k.Setting(e).setName("\u56FE\u7247\u8D28\u91CF").setDesc("\u538B\u7F29\u540E\u7684\u56FE\u7247\u8D28\u91CF (1-100)").addSlider(t=>t.setLimits(1,100,1).setValue(this.plugin.settings.imageQuality).setDynamicTooltip().onChange(async r=>{this.plugin.settings.imageQuality=r,await this.plugin.saveSettings()})),new k.Setting(e).setName("\u6E05\u7406\u53D1\u5E03\u5386\u53F2").setDesc("\u5220\u9664\u6240\u6709\u53D1\u5E03\u5386\u53F2\u8BB0\u5F55").addButton(t=>t.setButtonText("\u6E05\u7406").setWarning().onClick(async()=>{confirm("\u786E\u5B9A\u8981\u5220\u9664\u6240\u6709\u53D1\u5E03\u5386\u53F2\u8BB0\u5F55\u5417\uFF1F")&&(this.plugin.settings.publishHistory=[],await this.plugin.saveSettings(),new k.Notice("\u53D1\u5E03\u5386\u53F2\u5DF2\u6E05\u7406"))}))}},yt=class extends k.Modal{constructor(e,t,r,s,o){super(e),this.plugin=t,this.platformId=r,this.platformName=s,this.onSuccess=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:`\u8BA4\u8BC1 ${this.platformName}`}),e.createEl("p",{text:"\u8BF7\u9009\u62E9\u8BA4\u8BC1\u65B9\u5F0F\uFF1A"});let t=e.createDiv("auth-section");t.createEl("h3",{text:"Cookie \u8BA4\u8BC1\uFF08\u63A8\u8350\uFF09"}),t.createEl("p",{text:"\u4ECE\u6D4F\u89C8\u5668\u590D\u5236 Cookie \u5E76\u7C98\u8D34\u5230\u4E0B\u65B9\uFF1A"});let r=t.createEl("textarea",{placeholder:"\u7C98\u8D34 Cookie..."});r.rows=5;let s=t.createEl("button",{text:"\u5BFC\u5165 Cookie",cls:"mod-cta"});s.addEventListener("click",async()=>{let i=r.value.trim();if(!i){new k.Notice("\u8BF7\u8F93\u5165 Cookie");return}s.disabled=!0,s.setText("\u5BFC\u5165\u4E2D...");try{let a=await this.plugin.platformManager.importCookie(this.platformId,i);this.plugin.settings.platforms[this.platformId]||(this.plugin.settings.platforms[this.platformId]={enabled:!0,autoPublish:!1,authenticated:!1}),this.plugin.settings.platforms[this.platformId].authenticated=!0,this.plugin.settings.platforms[this.platformId].lastAuthTime=Date.now(),a&&a.username&&(this.plugin.settings.platforms[this.platformId].accountName=a.username),await this.plugin.saveSettings(),new k.Notice(`\u2705 ${this.platformName} \u8BA4\u8BC1\u6210\u529F`),this.close(),this.onSuccess&&this.onSuccess()}catch(a){console.error(`[Auth] ${this.platformName} authentication failed:`,a),new k.Notice(`\u274C \u8BA4\u8BC1\u5931\u8D25: ${a.message}`)}finally{s.disabled=!1,s.setText("\u5BFC\u5165 Cookie")}});let o=e.createDiv("auth-section");o.createEl("h3",{text:"\u4E8C\u7EF4\u7801\u8BA4\u8BC1"}),o.createEl("p",{text:"\u529F\u80FD\u5F00\u53D1\u4E2D...",cls:"coming-soon"})}onClose(){let{contentEl:e}=this;e.empty()}};var q=require("obsidian");var Me=class extends q.Modal{constructor(t,r,s){super(t);this.isPublishing=!1;this.plugin=r,this.file=s,this.selectedPlatforms=new Set(r.settings.defaultPlatforms),this.options={platforms:[],title:s.basename,isDraft:!1}}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("publisher-modal"),t.createEl("h2",{text:"\u53D1\u5E03\u6587\u7AE0"});let r=t.createDiv("platform-section");r.createEl("h3",{text:"\u9009\u62E9\u53D1\u5E03\u5E73\u53F0"});let s=r.createDiv("platform-grid");Object.entries({social:"\u81EA\u5A92\u4F53\u5E73\u53F0",tech:"\u6280\u672F\u793E\u533A"}).forEach(([c,h])=>{let d=s.createDiv("platform-category");d.createEl("h4",{text:h}),j.filter(f=>f.category===c).forEach(f=>{var D,z;let g=this.plugin.settings.platforms[f.id],m=(D=g==null?void 0:g.enabled)!=null?D:!1,y=(z=g==null?void 0:g.authenticated)!=null?z:!1,T=d.createDiv("platform-item");m||T.addClass("platform-disabled");let P=T.createEl("input",{type:"checkbox",attr:{id:`platform-${f.id}`}});(!m||!y)&&(P.disabled=!0),P.checked=this.selectedPlatforms.has(f.id),P.addEventListener("change",L=>{L.stopPropagation(),P.checked?this.selectedPlatforms.add(f.id):this.selectedPlatforms.delete(f.id)});let R=T.createEl("label",{attr:{for:`platform-${f.id}`}});R.createSpan({text:f.icon,cls:"platform-icon"}),R.createSpan({text:f.name,cls:"platform-name"}),m?y||R.createSpan({text:"(\u672A\u8BA4\u8BC1)",cls:"platform-status"}):R.createSpan({text:"(\u672A\u914D\u7F6E)",cls:"platform-status"})})});let i=t.createDiv("options-section");new q.Setting(i).setName("\u4FDD\u5B58\u4E3A\u8349\u7A3F").setDesc("\u4E0D\u7ACB\u5373\u53D1\u5E03\uFF0C\u4FDD\u5B58\u4E3A\u8349\u7A3F").addToggle(c=>c.setValue(!1).onChange(h=>{this.options.isDraft=h})),this.progressContainer=t.createDiv("progress-container"),this.progressContainer.style.display="none";let a=t.createDiv("button-container");a.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>{this.isPublishing||this.close()}),a.createEl("button",{text:"\u53D1\u5E03",cls:"mod-cta"}).addEventListener("click",()=>{this.publish()})}onClose(){let{contentEl:t}=this;t.empty()}async publish(){if(!this.isPublishing){if(this.selectedPlatforms.size===0){new q.Notice("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5E73\u53F0");return}this.isPublishing=!0;try{this.showProgress();let t=Date.now().toString();this.plugin.platformManager.onPublishProgress(t,i=>{this.updateProgress(i)});let r=await this.plugin.publishToMultiplePlatforms(this.file,Array.from(this.selectedPlatforms),!1);this.plugin.platformManager.offPublishProgress(t);let s=r.filter(i=>i.success).length,o=r.length;s===o?(new q.Notice(`\u2705 \u53D1\u5E03\u6210\u529F\uFF01\u5DF2\u53D1\u5E03\u5230 ${s} \u4E2A\u5E73\u53F0`),this.close()):s>0?(new q.Notice(`\u26A0\uFE0F \u90E8\u5206\u53D1\u5E03\u6210\u529F\uFF1A${s}/${o}`),this.showResults(r)):(new q.Notice("\u274C \u53D1\u5E03\u5931\u8D25"),this.showResults(r))}catch(t){console.error("Publish error:",t),new q.Notice(`\u53D1\u5E03\u5931\u8D25: ${t.message}`)}finally{this.isPublishing=!1}}}showProgress(){this.progressContainer.style.display="block",this.progressContainer.empty(),this.progressContainer.createEl("h3",{text:"\u53D1\u5E03\u8FDB\u5EA6"}),this.options.platforms.forEach(t=>{let r=this.progressContainer.createDiv("platform-progress");r.setAttribute("data-platform",t);let s=j.find(u=>u.id===t),o=(s==null?void 0:s.name)||t;r.createSpan({text:o,cls:"platform-name"}),r.createSpan({cls:"platform-status"}).setText("\u7B49\u5F85\u4E2D...");let l=r.createDiv("progress-bar").createDiv("progress-fill");l.style.width="0%"})}updateProgress(t){let r=this.progressContainer.querySelector(`[data-platform="${t.platform}"]`);if(!r)return;let s=r.querySelector(".platform-status"),o=r.querySelector(".progress-fill");s.setText(t.message),o.style.width=`${t.progress}%`,r.removeClass("status-pending","status-processing","status-success","status-error"),r.addClass(`status-${t.status}`)}showResults(t){this.progressContainer.empty(),this.progressContainer.createEl("h3",{text:"\u53D1\u5E03\u7ED3\u679C"}),t.forEach((r,s)=>{let o=this.options.platforms[s],i=j.find(u=>u.id===o),a=(i==null?void 0:i.name)||o,l=this.progressContainer.createDiv("publish-result");r.success?(l.addClass("result-success"),l.createSpan({text:"\u2705",cls:"result-icon"}),l.createSpan({text:a,cls:"result-platform"}),r.url?l.createEl("a",{text:"\u67E5\u770B\u6587\u7AE0",href:r.url,cls:"result-link"}).setAttribute("target","_blank"):r.draftLink&&l.createEl("a",{text:"\u7F16\u8F91\u8349\u7A3F",href:r.draftLink,cls:"result-link"}).setAttribute("target","_blank")):(l.addClass("result-error"),l.createSpan({text:"\u274C",cls:"result-icon"}),l.createSpan({text:a,cls:"result-platform"}),l.createSpan({text:r.error||"\u672A\u77E5\u9519\u8BEF",cls:"result-error-message"}))})}};var ge=require("obsidian");var se="publisher-history-view",ze=class extends ge.ItemView{constructor(e,t){super(e),this.plugin=t}getViewType(){return se}getDisplayText(){return"\u53D1\u5E03\u5386\u53F2"}getIcon(){return"clock"}async onOpen(){this.render()}async onClose(){}render(){let e=this.containerEl.children[1];e.empty(),e.addClass("publisher-history-view");let t=e.createDiv("history-header");t.createEl("h2",{text:"\u53D1\u5E03\u5386\u53F2"}),t.createEl("button",{text:"\u5237\u65B0",cls:"refresh-button"}).addEventListener("click",()=>{this.render()});let s=e.createDiv("history-list"),o=this.plugin.settings.publishHistory;if(o.length===0){s.createEl("p",{text:"\u6682\u65E0\u53D1\u5E03\u8BB0\u5F55",cls:"empty-message"});return}o.forEach(i=>{this.renderRecord(s,i)})}renderRecord(e,t){let r=e.createDiv("history-record"),s=r.createDiv("record-header");s.createDiv("record-title").createEl("h3",{text:t.noteTitle});let i=s.createDiv("record-time"),a=new Date(t.timestamp);i.setText(this.formatDate(a));let l=r.createDiv("record-platforms");t.platforms.forEach(b=>{let f=t.results[b],g=j.find(T=>T.id===b),m=(g==null?void 0:g.name)||b,y=l.createDiv("platform-item");f!=null&&f.success?(y.addClass("platform-success"),y.createSpan({text:"\u2705",cls:"status-icon"})):(y.addClass("platform-error"),y.createSpan({text:"\u274C",cls:"status-icon"})),y.createSpan({text:m,cls:"platform-name"}),f!=null&&f.url?y.createEl("a",{text:"\u67E5\u770B",href:f.url,cls:"platform-link"}).setAttribute("target","_blank"):f!=null&&f.draftLink&&y.createEl("a",{text:"\u8349\u7A3F",href:f.draftLink,cls:"platform-link"}).setAttribute("target","_blank"),f!=null&&f.error&&y.setAttribute("title",f.error)});let u=r.createDiv("record-actions");u.createEl("button",{text:"\u6253\u5F00\u7B14\u8BB0",cls:"action-button"}).addEventListener("click",async()=>{await this.openNote(t.notePath)}),u.createEl("button",{text:"\u91CD\u65B0\u53D1\u5E03",cls:"action-button"}).addEventListener("click",async()=>{await this.republish(t)}),u.createEl("button",{text:"\u5220\u9664",cls:"action-button delete-button"}).addEventListener("click",async()=>{await this.deleteRecord(t)})}async openNote(e){let t=this.app.vault.getAbstractFileByPath(e);t instanceof ge.TFile&&await this.app.workspace.getLeaf().openFile(t)}async republish(e){let t=this.app.vault.getAbstractFileByPath(e.notePath);t instanceof ge.TFile&&await this.plugin.openPublishModal(t)}async deleteRecord(e){let t=this.plugin.settings.publishHistory.findIndex(r=>r.id===e.id);t!==-1&&(this.plugin.settings.publishHistory.splice(t,1),await this.plugin.saveSettings(),this.render())}formatDate(e){let r=new Date().getTime()-e.getTime();return r<60*1e3?"\u521A\u521A":r<60*60*1e3?`${Math.floor(r/6e4)} \u5206\u949F\u524D`:r<24*60*60*1e3?`${Math.floor(r/36e5)} \u5C0F\u65F6\u524D`:r<7*24*60*60*1e3?`${Math.floor(r/864e5)} \u5929\u524D`:e.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}};function be(n,e){return function(){return n.apply(e,arguments)}}var{toString:Mn}=Object.prototype,{getPrototypeOf:kt}=Object,{iterator:je,toStringTag:br}=Symbol,qe=(n=>e=>{let t=Mn.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),_=n=>(n=n.toLowerCase(),e=>qe(e)===n),Ve=n=>e=>typeof e===n,{isArray:oe}=Array,ie=Ve("undefined");function we(n){return n!==null&&!ie(n)&&n.constructor!==null&&!ie(n.constructor)&&F(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}var wr=_("ArrayBuffer");function zn(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&wr(n.buffer),e}var Hn=Ve("string"),F=Ve("function"),yr=Ve("number"),ye=n=>n!==null&&typeof n=="object",jn=n=>n===!0||n===!1,He=n=>{if(qe(n)!=="object")return!1;let e=kt(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(br in n)&&!(je in n)},qn=n=>{if(!ye(n)||we(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch(e){return!1}},Vn=_("Date"),Wn=_("File"),Jn=_("Blob"),Zn=_("FileList"),Qn=n=>ye(n)&&F(n.pipe),Kn=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||F(n.append)&&((e=qe(n))==="formdata"||e==="object"&&F(n.toString)&&n.toString()==="[object FormData]"))},Gn=_("URLSearchParams"),[Xn,Yn,es,ts]=["ReadableStream","Request","Response","Headers"].map(_),rs=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function xe(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,s;if(typeof n!="object"&&(n=[n]),oe(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{if(we(n))return;let o=t?Object.getOwnPropertyNames(n):Object.keys(n),i=o.length,a;for(r=0;r<i;r++)a=o[r],e.call(null,n[a],a,n)}}function xr(n,e){if(we(n))return null;e=e.toLowerCase();let t=Object.keys(n),r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}var Y=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,kr=n=>!ie(n)&&n!==Y;function xt(){let{caseless:n,skipUndefined:e}=kr(this)&&this||{},t={},r=(s,o)=>{let i=n&&xr(t,o)||o;He(t[i])&&He(s)?t[i]=xt(t[i],s):He(s)?t[i]=xt({},s):oe(s)?t[i]=s.slice():(!e||!ie(s))&&(t[i]=s)};for(let s=0,o=arguments.length;s<o;s++)arguments[s]&&xe(arguments[s],r);return t}var ns=(n,e,t,{allOwnKeys:r}={})=>(xe(e,(s,o)=>{t&&F(s)?n[o]=be(s,t):n[o]=s},{allOwnKeys:r}),n),ss=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),is=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},os=(n,e,t,r)=>{let s,o,i,a={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),o=s.length;o-- >0;)i=s[o],(!r||r(i,n,e))&&!a[i]&&(e[i]=n[i],a[i]=!0);n=t!==!1&&kt(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},as=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;let r=n.indexOf(e,t);return r!==-1&&r===t},ls=n=>{if(!n)return null;if(oe(n))return n;let e=n.length;if(!yr(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},cs=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&kt(Uint8Array)),us=(n,e)=>{let r=(n&&n[je]).call(n),s;for(;(s=r.next())&&!s.done;){let o=s.value;e.call(n,o[0],o[1])}},ps=(n,e)=>{let t,r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},fs=_("HTMLFormElement"),hs=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),gr=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),ds=_("RegExp"),Sr=(n,e)=>{let t=Object.getOwnPropertyDescriptors(n),r={};xe(t,(s,o)=>{let i;(i=e(s,o,n))!==!1&&(r[o]=i||s)}),Object.defineProperties(n,r)},ms=n=>{Sr(n,(e,t)=>{if(F(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let r=n[t];if(F(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},gs=(n,e)=>{let t={},r=s=>{s.forEach(o=>{t[o]=!0})};return oe(n)?r(n):r(String(n).split(e)),t},bs=()=>{},ws=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function ys(n){return!!(n&&F(n.append)&&n[br]==="FormData"&&n[je])}var xs=n=>{let e=new Array(10),t=(r,s)=>{if(ye(r)){if(e.indexOf(r)>=0)return;if(we(r))return r;if(!("toJSON"in r)){e[s]=r;let o=oe(r)?[]:{};return xe(r,(i,a)=>{let l=t(i,s+1);!ie(l)&&(o[a]=l)}),e[s]=void 0,o}}return r};return t(n,0)},ks=_("AsyncFunction"),Ss=n=>n&&(ye(n)||F(n))&&F(n.then)&&F(n.catch),Pr=((n,e)=>n?setImmediate:e?((t,r)=>(Y.addEventListener("message",({source:s,data:o})=>{s===Y&&o===t&&r.length&&r.shift()()},!1),s=>{r.push(s),Y.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",F(Y.postMessage)),Ps=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Y):typeof process!="undefined"&&process.nextTick||Pr,vs=n=>n!=null&&F(n[je]),p={isArray:oe,isArrayBuffer:wr,isBuffer:we,isFormData:Kn,isArrayBufferView:zn,isString:Hn,isNumber:yr,isBoolean:jn,isObject:ye,isPlainObject:He,isEmptyObject:qn,isReadableStream:Xn,isRequest:Yn,isResponse:es,isHeaders:ts,isUndefined:ie,isDate:Vn,isFile:Wn,isBlob:Jn,isRegExp:ds,isFunction:F,isStream:Qn,isURLSearchParams:Gn,isTypedArray:cs,isFileList:Zn,forEach:xe,merge:xt,extend:ns,trim:rs,stripBOM:ss,inherits:is,toFlatObject:os,kindOf:qe,kindOfTest:_,endsWith:as,toArray:ls,forEachEntry:us,matchAll:ps,isHTMLForm:fs,hasOwnProperty:gr,hasOwnProp:gr,reduceDescriptors:Sr,freezeMethods:ms,toObjectSet:gs,toCamelCase:hs,noop:bs,toFiniteNumber:ws,findKey:xr,global:Y,isContextDefined:kr,isSpecCompliantForm:ys,toJSONObject:xs,isAsyncFn:ks,isThenable:Ss,setImmediate:Pr,asap:Ps,isIterable:vs};function ae(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}p.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:p.toJSONObject(this.config),code:this.code,status:this.status}}});var vr=ae.prototype,Tr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Tr[n]={value:n}});Object.defineProperties(ae,Tr);Object.defineProperty(vr,"isAxiosError",{value:!0});ae.from=(n,e,t,r,s,o)=>{let i=Object.create(vr);p.toFlatObject(n,i,function(c){return c!==Error.prototype},u=>u!=="isAxiosError");let a=n&&n.message?n.message:"Error",l=e==null&&n?n.code:e;return ae.call(i,a,l,t,r,s),n&&i.cause==null&&Object.defineProperty(i,"cause",{value:n,configurable:!0}),i.name=n&&n.name||"Error",o&&Object.assign(i,o),i};var w=ae;var We=null;function St(n){return p.isPlainObject(n)||p.isArray(n)}function Rr(n){return p.endsWith(n,"[]")?n.slice(0,-2):n}function Er(n,e,t){return n?n.concat(e).map(function(s,o){return s=Rr(s),!t&&o?"["+s+"]":s}).join(t?".":""):e}function Ts(n){return p.isArray(n)&&!n.some(St)}var Es=p.toFlatObject(p,{},null,function(e){return/^is[A-Z]/.test(e)});function Rs(n,e,t){if(!p.isObject(n))throw new TypeError("target must be an object");e=e||new(We||FormData),t=p.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,m){return!p.isUndefined(m[g])});let r=t.metaTokens,s=t.visitor||c,o=t.dots,i=t.indexes,l=(t.Blob||typeof Blob!="undefined"&&Blob)&&p.isSpecCompliantForm(e);if(!p.isFunction(s))throw new TypeError("visitor must be a function");function u(f){if(f===null)return"";if(p.isDate(f))return f.toISOString();if(p.isBoolean(f))return f.toString();if(!l&&p.isBlob(f))throw new w("Blob is not supported. Use a Buffer instead.");return p.isArrayBuffer(f)||p.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function c(f,g,m){let y=f;if(f&&!m&&typeof f=="object"){if(p.endsWith(g,"{}"))g=r?g:g.slice(0,-2),f=JSON.stringify(f);else if(p.isArray(f)&&Ts(f)||(p.isFileList(f)||p.endsWith(g,"[]"))&&(y=p.toArray(f)))return g=Rr(g),y.forEach(function(P,R){!(p.isUndefined(P)||P===null)&&e.append(i===!0?Er([g],R,o):i===null?g:g+"[]",u(P))}),!1}return St(f)?!0:(e.append(Er(m,g,o),u(f)),!1)}let h=[],d=Object.assign(Es,{defaultVisitor:c,convertValue:u,isVisitable:St});function b(f,g){if(!p.isUndefined(f)){if(h.indexOf(f)!==-1)throw Error("Circular reference detected in "+g.join("."));h.push(f),p.forEach(f,function(y,T){(!(p.isUndefined(y)||y===null)&&s.call(e,y,p.isString(T)?T.trim():T,g,d))===!0&&b(y,g?g.concat(T):[T])}),h.pop()}}if(!p.isObject(n))throw new TypeError("data must be an object");return b(n),e}var G=Rs;function Ar(n){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Cr(n,e){this._pairs=[],n&&G(n,this,e)}var Or=Cr.prototype;Or.append=function(e,t){this._pairs.push([e,t])};Or.toString=function(e){let t=e?function(r){return e.call(this,r,Ar)}:Ar;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};var Je=Cr;function As(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ke(n,e,t){if(!e)return n;let r=t&&t.encode||As;p.isFunction(t)&&(t={serialize:t});let s=t&&t.serialize,o;if(s?o=s(e,t):o=p.isURLSearchParams(e)?e.toString():new Je(e,t).toString(r),o){let i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}var Pt=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){p.forEach(this.handlers,function(r){r!==null&&e(r)})}},vt=Pt;var Ze={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var Dr=typeof URLSearchParams!="undefined"?URLSearchParams:Je;var $r=typeof FormData!="undefined"?FormData:null;var Nr=typeof Blob!="undefined"?Blob:null;var Ir={isBrowser:!0,classes:{URLSearchParams:Dr,FormData:$r,Blob:Nr},protocols:["http","https","file","blob","url","data"]};var Rt={};fr(Rt,{hasBrowserEnv:()=>Et,hasStandardBrowserEnv:()=>Cs,hasStandardBrowserWebWorkerEnv:()=>Os,navigator:()=>Tt,origin:()=>Ds});var Et=typeof window!="undefined"&&typeof document!="undefined",Tt=typeof navigator=="object"&&navigator||void 0,Cs=Et&&(!Tt||["ReactNative","NativeScript","NS"].indexOf(Tt.product)<0),Os=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ds=Et&&window.location.href||"http://localhost";var E={...Rt,...Ir};function At(n,e){return G(n,new E.classes.URLSearchParams,{visitor:function(t,r,s,o){return E.isNode&&p.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...e})}function $s(n){return p.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ns(n){let e={},t=Object.keys(n),r,s=t.length,o;for(r=0;r<s;r++)o=t[r],e[o]=n[o];return e}function Is(n){function e(t,r,s,o){let i=t[o++];if(i==="__proto__")return!0;let a=Number.isFinite(+i),l=o>=t.length;return i=!i&&p.isArray(s)?s.length:i,l?(p.hasOwnProp(s,i)?s[i]=[s[i],r]:s[i]=r,!a):((!s[i]||!p.isObject(s[i]))&&(s[i]=[]),e(t,r,s[i],o)&&p.isArray(s[i])&&(s[i]=Ns(s[i])),!a)}if(p.isFormData(n)&&p.isFunction(n.entries)){let t={};return p.forEachEntry(n,(r,s)=>{e($s(r),s,t,0)}),t}return null}var Qe=Is;function Ls(n,e,t){if(p.isString(n))try{return(e||JSON.parse)(n),p.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Ct={transitional:Ze,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r=t.getContentType()||"",s=r.indexOf("application/json")>-1,o=p.isObject(e);if(o&&p.isHTMLForm(e)&&(e=new FormData(e)),p.isFormData(e))return s?JSON.stringify(Qe(e)):e;if(p.isArrayBuffer(e)||p.isBuffer(e)||p.isStream(e)||p.isFile(e)||p.isBlob(e)||p.isReadableStream(e))return e;if(p.isArrayBufferView(e))return e.buffer;if(p.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return At(e,this.formSerializer).toString();if((a=p.isFileList(e))||r.indexOf("multipart/form-data")>-1){let l=this.env&&this.env.FormData;return G(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||s?(t.setContentType("application/json",!1),Ls(e)):e}],transformResponse:[function(e){let t=this.transitional||Ct.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(p.isResponse(e)||p.isReadableStream(e))return e;if(e&&p.isString(e)&&(r&&!this.responseType||s)){let i=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e,this.parseReviver)}catch(a){if(i)throw a.name==="SyntaxError"?w.from(a,w.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:E.classes.FormData,Blob:E.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};p.forEach(["delete","get","head","post","put","patch"],n=>{Ct.headers[n]={}});var le=Ct;var Fs=p.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Lr=n=>{let e={},t,r,s;return n&&n.split(`
`).forEach(function(i){s=i.indexOf(":"),t=i.substring(0,s).trim().toLowerCase(),r=i.substring(s+1).trim(),!(!t||e[t]&&Fs[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e};var Fr=Symbol("internals");function Se(n){return n&&String(n).trim().toLowerCase()}function Ke(n){return n===!1||n==null?n:p.isArray(n)?n.map(Ke):String(n)}function Bs(n){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}var Us=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Ot(n,e,t,r,s){if(p.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!p.isString(e)){if(p.isString(r))return e.indexOf(r)!==-1;if(p.isRegExp(r))return r.test(e)}}function _s(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Ms(n,e){let t=p.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,o,i){return this[r].call(this,e,s,o,i)},configurable:!0})})}var ce=class{constructor(e){e&&this.set(e)}set(e,t,r){let s=this;function o(a,l,u){let c=Se(l);if(!c)throw new Error("header name must be a non-empty string");let h=p.findKey(s,c);(!h||s[h]===void 0||u===!0||u===void 0&&s[h]!==!1)&&(s[h||l]=Ke(a))}let i=(a,l)=>p.forEach(a,(u,c)=>o(u,c,l));if(p.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(p.isString(e)&&(e=e.trim())&&!Us(e))i(Lr(e),t);else if(p.isObject(e)&&p.isIterable(e)){let a={},l,u;for(let c of e){if(!p.isArray(c))throw TypeError("Object iterator must return a key-value pair");a[u=c[0]]=(l=a[u])?p.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}i(a,t)}else e!=null&&o(t,e,r);return this}get(e,t){if(e=Se(e),e){let r=p.findKey(this,e);if(r){let s=this[r];if(!t)return s;if(t===!0)return Bs(s);if(p.isFunction(t))return t.call(this,s,r);if(p.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Se(e),e){let r=p.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Ot(this,this[r],r,t)))}return!1}delete(e,t){let r=this,s=!1;function o(i){if(i=Se(i),i){let a=p.findKey(r,i);a&&(!t||Ot(r,r[a],a,t))&&(delete r[a],s=!0)}}return p.isArray(e)?e.forEach(o):o(e),s}clear(e){let t=Object.keys(this),r=t.length,s=!1;for(;r--;){let o=t[r];(!e||Ot(this,this[o],o,e,!0))&&(delete this[o],s=!0)}return s}normalize(e){let t=this,r={};return p.forEach(this,(s,o)=>{let i=p.findKey(r,o);if(i){t[i]=Ke(s),delete t[o];return}let a=e?_s(o):String(o).trim();a!==o&&delete t[o],t[a]=Ke(s),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return p.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&p.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){let r=(this[Fr]=this[Fr]={accessors:{}}).accessors,s=this.prototype;function o(i){let a=Se(i);r[a]||(Ms(s,i),r[a]=!0)}return p.isArray(e)?e.forEach(o):o(e),this}};ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);p.reduceDescriptors(ce.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});p.freezeMethods(ce);var O=ce;function Pe(n,e){let t=this||le,r=e||t,s=O.from(r.headers),o=r.data;return p.forEach(n,function(a){o=a.call(t,o,s.normalize(),e?e.status:void 0)}),s.normalize(),o}function ve(n){return!!(n&&n.__CANCEL__)}function Br(n,e,t){w.call(this,n==null?"canceled":n,w.ERR_CANCELED,e,t),this.name="CanceledError"}p.inherits(Br,w,{__CANCEL__:!0});var V=Br;function Te(n,e,t){let r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new w("Request failed with status code "+t.status,[w.ERR_BAD_REQUEST,w.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Dt(n){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function zs(n,e){n=n||10;let t=new Array(n),r=new Array(n),s=0,o=0,i;return e=e!==void 0?e:1e3,function(l){let u=Date.now(),c=r[o];i||(i=u),t[s]=l,r[s]=u;let h=o,d=0;for(;h!==s;)d+=t[h++],h=h%n;if(s=(s+1)%n,s===o&&(o=(o+1)%n),u-i<e)return;let b=c&&u-c;return b?Math.round(d*1e3/b):void 0}}var Ur=zs;function Hs(n,e){let t=0,r=1e3/e,s,o,i=(u,c=Date.now())=>{t=c,s=null,o&&(clearTimeout(o),o=null),n(...u)};return[(...u)=>{let c=Date.now(),h=c-t;h>=r?i(u,c):(s=u,o||(o=setTimeout(()=>{o=null,i(s)},r-h)))},()=>s&&i(s)]}var _r=Hs;var ue=(n,e,t=3)=>{let r=0,s=Ur(50,250);return _r(o=>{let i=o.loaded,a=o.lengthComputable?o.total:void 0,l=i-r,u=s(l),c=i<=a;r=i;let h={loaded:i,total:a,progress:a?i/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-i)/u:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(h)},t)},$t=(n,e)=>{let t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},Nt=n=>(...e)=>p.asap(()=>n(...e));var Mr=E.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,E.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(E.origin),E.navigator&&/(msie|trident)/i.test(E.navigator.userAgent)):()=>!0;var zr=E.hasStandardBrowserEnv?{write(n,e,t,r,s,o,i){if(typeof document=="undefined")return;let a=[`${n}=${encodeURIComponent(e)}`];p.isNumber(t)&&a.push(`expires=${new Date(t).toUTCString()}`),p.isString(r)&&a.push(`path=${r}`),p.isString(s)&&a.push(`domain=${s}`),o===!0&&a.push("secure"),p.isString(i)&&a.push(`SameSite=${i}`),document.cookie=a.join("; ")},read(n){if(typeof document=="undefined")return null;let e=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function It(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Lt(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ee(n,e,t){let r=!It(e);return n&&(r||t==!1)?Lt(n,e):e}var Hr=n=>n instanceof O?{...n}:n;function M(n,e){e=e||{};let t={};function r(u,c,h,d){return p.isPlainObject(u)&&p.isPlainObject(c)?p.merge.call({caseless:d},u,c):p.isPlainObject(c)?p.merge({},c):p.isArray(c)?c.slice():c}function s(u,c,h,d){if(p.isUndefined(c)){if(!p.isUndefined(u))return r(void 0,u,h,d)}else return r(u,c,h,d)}function o(u,c){if(!p.isUndefined(c))return r(void 0,c)}function i(u,c){if(p.isUndefined(c)){if(!p.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function a(u,c,h){if(h in e)return r(u,c);if(h in n)return r(void 0,u)}let l={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(u,c,h)=>s(Hr(u),Hr(c),h,!0)};return p.forEach(Object.keys({...n,...e}),function(c){let h=l[c]||s,d=h(n[c],e[c],c);p.isUndefined(d)&&h!==a||(t[c]=d)}),t}var Ge=n=>{let e=M({},n),{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:o,headers:i,auth:a}=e;if(e.headers=i=O.from(i),e.url=ke(Ee(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&i.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),p.isFormData(t)){if(E.hasStandardBrowserEnv||E.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(p.isFunction(t.getHeaders)){let l=t.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,h])=>{u.includes(c.toLowerCase())&&i.set(c,h)})}}if(E.hasStandardBrowserEnv&&(r&&p.isFunction(r)&&(r=r(e)),r||r!==!1&&Mr(e.url))){let l=s&&o&&zr.read(o);l&&i.set(s,l)}return e};var js=typeof XMLHttpRequest!="undefined",jr=js&&function(n){return new Promise(function(t,r){let s=Ge(n),o=s.data,i=O.from(s.headers).normalize(),{responseType:a,onUploadProgress:l,onDownloadProgress:u}=s,c,h,d,b,f;function g(){b&&b(),f&&f(),s.cancelToken&&s.cancelToken.unsubscribe(c),s.signal&&s.signal.removeEventListener("abort",c)}let m=new XMLHttpRequest;m.open(s.method.toUpperCase(),s.url,!0),m.timeout=s.timeout;function y(){if(!m)return;let P=O.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),D={data:!a||a==="text"||a==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:P,config:n,request:m};Te(function(L){t(L),g()},function(L){r(L),g()},D),m=null}"onloadend"in m?m.onloadend=y:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(y)},m.onabort=function(){m&&(r(new w("Request aborted",w.ECONNABORTED,n,m)),m=null)},m.onerror=function(R){let D=R&&R.message?R.message:"Network Error",z=new w(D,w.ERR_NETWORK,n,m);z.event=R||null,r(z),m=null},m.ontimeout=function(){let R=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded",D=s.transitional||Ze;s.timeoutErrorMessage&&(R=s.timeoutErrorMessage),r(new w(R,D.clarifyTimeoutError?w.ETIMEDOUT:w.ECONNABORTED,n,m)),m=null},o===void 0&&i.setContentType(null),"setRequestHeader"in m&&p.forEach(i.toJSON(),function(R,D){m.setRequestHeader(D,R)}),p.isUndefined(s.withCredentials)||(m.withCredentials=!!s.withCredentials),a&&a!=="json"&&(m.responseType=s.responseType),u&&([d,f]=ue(u,!0),m.addEventListener("progress",d)),l&&m.upload&&([h,b]=ue(l),m.upload.addEventListener("progress",h),m.upload.addEventListener("loadend",b)),(s.cancelToken||s.signal)&&(c=P=>{m&&(r(!P||P.type?new V(null,n,m):P),m.abort(),m=null)},s.cancelToken&&s.cancelToken.subscribe(c),s.signal&&(s.signal.aborted?c():s.signal.addEventListener("abort",c)));let T=Dt(s.url);if(T&&E.protocols.indexOf(T)===-1){r(new w("Unsupported protocol "+T+":",w.ERR_BAD_REQUEST,n));return}m.send(o||null)})};var qs=(n,e)=>{let{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s,o=function(u){if(!s){s=!0,a();let c=u instanceof Error?u:this.reason;r.abort(c instanceof w?c:new V(c instanceof Error?c.message:c))}},i=e&&setTimeout(()=>{i=null,o(new w(`timeout ${e} of ms exceeded`,w.ETIMEDOUT))},e),a=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),n=null)};n.forEach(u=>u.addEventListener("abort",o));let{signal:l}=r;return l.unsubscribe=()=>p.asap(a),l}},qr=qs;var Vs=function*(n,e){let t=n.byteLength;if(!e||t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},Ws=async function*(n,e){for await(let t of Js(n))yield*Vs(t,e)},Js=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}let e=n.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},Ft=(n,e,t,r)=>{let s=Ws(n,e),o=0,i,a=l=>{i||(i=!0,r&&r(l))};return new ReadableStream({async pull(l){try{let{done:u,value:c}=await s.next();if(u){a(),l.close();return}let h=c.byteLength;if(t){let d=o+=h;t(d)}l.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(l){return a(l),s.return()}},{highWaterMark:2})};var Vr=64*1024,{isFunction:Xe}=p,Zs=(({Request:n,Response:e})=>({Request:n,Response:e}))(p.global),{ReadableStream:Wr,TextEncoder:Jr}=p.global,Zr=(n,...e)=>{try{return!!n(...e)}catch(t){return!1}},Qs=n=>{n=p.merge.call({skipUndefined:!0},Zs,n);let{fetch:e,Request:t,Response:r}=n,s=e?Xe(e):typeof fetch=="function",o=Xe(t),i=Xe(r);if(!s)return!1;let a=s&&Xe(Wr),l=s&&(typeof Jr=="function"?(f=>g=>f.encode(g))(new Jr):async f=>new Uint8Array(await new t(f).arrayBuffer())),u=o&&a&&Zr(()=>{let f=!1,g=new t(E.origin,{body:new Wr,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!g}),c=i&&a&&Zr(()=>p.isReadableStream(new r("").body)),h={stream:c&&(f=>f.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!h[f]&&(h[f]=(g,m)=>{let y=g&&g[f];if(y)return y.call(g);throw new w(`Response type '${f}' is not supported`,w.ERR_NOT_SUPPORT,m)})});let d=async f=>{if(f==null)return 0;if(p.isBlob(f))return f.size;if(p.isSpecCompliantForm(f))return(await new t(E.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(p.isArrayBufferView(f)||p.isArrayBuffer(f))return f.byteLength;if(p.isURLSearchParams(f)&&(f=f+""),p.isString(f))return(await l(f)).byteLength},b=async(f,g)=>{let m=p.toFiniteNumber(f.getContentLength());return m==null?d(g):m};return async f=>{let{url:g,method:m,data:y,signal:T,cancelToken:P,timeout:R,onDownloadProgress:D,onUploadProgress:z,responseType:L,headers:gt,withCredentials:Le="same-origin",fetchOptions:or}=Ge(f),ar=e||fetch;L=L?(L+"").toLowerCase():"text";let Fe=qr([T,P&&P.toAbortSignal()],R),de=null,X=Fe&&Fe.unsubscribe&&(()=>{Fe.unsubscribe()}),lr;try{if(z&&u&&m!=="get"&&m!=="head"&&(lr=await b(gt,y))!==0){let K=new t(g,{method:"POST",body:y,duplex:"half"}),ne;if(p.isFormData(y)&&(ne=K.headers.get("content-type"))&&gt.setContentType(ne),K.body){let[bt,Be]=$t(lr,ue(Nt(z)));y=Ft(K.body,Vr,bt,Be)}}p.isString(Le)||(Le=Le?"include":"omit");let H=o&&"credentials"in t.prototype,cr={...or,signal:Fe,method:m.toUpperCase(),headers:gt.normalize().toJSON(),body:y,duplex:"half",credentials:H?Le:void 0};de=o&&new t(g,cr);let Q=await(o?ar(de,or):ar(g,cr)),ur=c&&(L==="stream"||L==="response");if(c&&(D||ur&&X)){let K={};["status","statusText","headers"].forEach(pr=>{K[pr]=Q[pr]});let ne=p.toFiniteNumber(Q.headers.get("content-length")),[bt,Be]=D&&$t(ne,ue(Nt(D),!0))||[];Q=new r(Ft(Q.body,Vr,bt,()=>{Be&&Be(),X&&X()}),K)}L=L||"text";let Dn=await h[p.findKey(h,L)||"text"](Q,f);return!ur&&X&&X(),await new Promise((K,ne)=>{Te(K,ne,{data:Dn,headers:O.from(Q.headers),status:Q.status,statusText:Q.statusText,config:f,request:de})})}catch(H){throw X&&X(),H&&H.name==="TypeError"&&/Load failed|fetch/i.test(H.message)?Object.assign(new w("Network Error",w.ERR_NETWORK,f,de),{cause:H.cause||H}):w.from(H,H&&H.code,f,de)}}},Ks=new Map,Bt=n=>{let e=n&&n.env||{},{fetch:t,Request:r,Response:s}=e,o=[r,s,t],i=o.length,a=i,l,u,c=Ks;for(;a--;)l=o[a],u=c.get(l),u===void 0&&c.set(l,u=a?new Map:Qs(e)),c=u;return u},vl=Bt();var Ut={http:We,xhr:jr,fetch:{get:Bt}};p.forEach(Ut,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});var Qr=n=>`- ${n}`,Xs=n=>p.isFunction(n)||n===null||n===!1;function Ys(n,e){n=p.isArray(n)?n:[n];let{length:t}=n,r,s,o={};for(let i=0;i<t;i++){r=n[i];let a;if(s=r,!Xs(r)&&(s=Ut[(a=String(r)).toLowerCase()],s===void 0))throw new w(`Unknown adapter '${a}'`);if(s&&(p.isFunction(s)||(s=s.get(e))))break;o[a||"#"+i]=s}if(!s){let i=Object.entries(o).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build")),a=t?i.length>1?`since :
`+i.map(Qr).join(`
`):" "+Qr(i[0]):"as no adapter specified";throw new w("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s}var Ye={getAdapter:Ys,adapters:Ut};function _t(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new V(null,n)}function et(n){return _t(n),n.headers=O.from(n.headers),n.data=Pe.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ye.getAdapter(n.adapter||le.adapter,n)(n).then(function(r){return _t(n),r.data=Pe.call(n,n.transformResponse,r),r.headers=O.from(r.headers),r},function(r){return ve(r)||(_t(n),r&&r.response&&(r.response.data=Pe.call(n,n.transformResponse,r.response),r.response.headers=O.from(r.response.headers))),Promise.reject(r)})}var tt="1.13.2";var rt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{rt[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var Kr={};rt.transitional=function(e,t,r){function s(o,i){return"[Axios v"+tt+"] Transitional option '"+o+"'"+i+(r?". "+r:"")}return(o,i,a)=>{if(e===!1)throw new w(s(i," has been removed"+(t?" in "+t:"")),w.ERR_DEPRECATED);return t&&!Kr[i]&&(Kr[i]=!0,console.warn(s(i," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,i,a):!0}};rt.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function ei(n,e,t){if(typeof n!="object")throw new w("options must be an object",w.ERR_BAD_OPTION_VALUE);let r=Object.keys(n),s=r.length;for(;s-- >0;){let o=r[s],i=e[o];if(i){let a=n[o],l=a===void 0||i(a,o,n);if(l!==!0)throw new w("option "+o+" must be "+l,w.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new w("Unknown option "+o,w.ERR_BAD_OPTION)}}var Re={assertOptions:ei,validators:rt};var W=Re.validators,pe=class{constructor(e){this.defaults=e||{},this.interceptors={request:new vt,response:new vt}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;let o=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch(i){}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=M(this.defaults,t);let{transitional:r,paramsSerializer:s,headers:o}=t;r!==void 0&&Re.assertOptions(r,{silentJSONParsing:W.transitional(W.boolean),forcedJSONParsing:W.transitional(W.boolean),clarifyTimeoutError:W.transitional(W.boolean)},!1),s!=null&&(p.isFunction(s)?t.paramsSerializer={serialize:s}:Re.assertOptions(s,{encode:W.function,serialize:W.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Re.assertOptions(t,{baseUrl:W.spelling("baseURL"),withXsrfToken:W.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=o&&p.merge(o.common,o[t.method]);o&&p.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=O.concat(i,o);let a=[],l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(l=l&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});let u=[];this.interceptors.response.forEach(function(g){u.push(g.fulfilled,g.rejected)});let c,h=0,d;if(!l){let f=[et.bind(this),void 0];for(f.unshift(...a),f.push(...u),d=f.length,c=Promise.resolve(t);h<d;)c=c.then(f[h++],f[h++]);return c}d=a.length;let b=t;for(;h<d;){let f=a[h++],g=a[h++];try{b=f(b)}catch(m){g.call(this,m);break}}try{c=et.call(this,b)}catch(f){return Promise.reject(f)}for(h=0,d=u.length;h<d;)c=c.then(u[h++],u[h++]);return c}getUri(e){e=M(this.defaults,e);let t=Ee(e.baseURL,e.url,e.allowAbsoluteUrls);return ke(t,e.params,e.paramsSerializer)}};p.forEach(["delete","get","head","options"],function(e){pe.prototype[e]=function(t,r){return this.request(M(r||{},{method:e,url:t,data:(r||{}).data}))}});p.forEach(["post","put","patch"],function(e){function t(r){return function(o,i,a){return this.request(M(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:i}))}}pe.prototype[e]=t(),pe.prototype[e+"Form"]=t(!0)});var Ae=pe;var Mt=class n{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let r=this;this.promise.then(s=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](s);r._listeners=null}),this.promise.then=s=>{let o,i=new Promise(a=>{r.subscribe(a),o=a}).then(s);return i.cancel=function(){r.unsubscribe(o)},i},e(function(o,i,a){r.reason||(r.reason=new V(o,i,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new n(function(s){e=s}),cancel:e}}},Gr=Mt;function zt(n){return function(t){return n.apply(null,t)}}function Ht(n){return p.isObject(n)&&n.isAxiosError===!0}var jt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(jt).forEach(([n,e])=>{jt[e]=n});var Xr=jt;function Yr(n){let e=new Ae(n),t=be(Ae.prototype.request,e);return p.extend(t,Ae.prototype,e,{allOwnKeys:!0}),p.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Yr(M(n,s))},t}var A=Yr(le);A.Axios=Ae;A.CanceledError=V;A.CancelToken=Gr;A.isCancel=ve;A.VERSION=tt;A.toFormData=G;A.AxiosError=w;A.Cancel=A.CanceledError;A.all=function(e){return Promise.all(e)};A.spread=zt;A.isAxiosError=Ht;A.mergeConfig=M;A.AxiosHeaders=O;A.formToJSON=n=>Qe(p.isHTMLForm(n)?new FormData(n):n);A.getAdapter=Ye.getAdapter;A.HttpStatusCode=Xr;A.default=A;var nt=A;var{Axios:kc,AxiosError:Sc,CanceledError:Pc,isCancel:vc,CancelToken:Tc,VERSION:Ec,all:Rc,Cancel:Ac,isAxiosError:Cc,spread:Oc,toFormData:Dc,AxiosHeaders:$c,HttpStatusCode:Nc,formToJSON:Ic,getAdapter:Lc,mergeConfig:Fc}=nt;var st=class{constructor(e){this.plugin=e,this.publishCallbacks=new Map,this.httpClient=nt.create({timeout:3e4,headers:{"Content-Type":"application/json"}})}async publishToMultiplePlatforms(e,t){let r=[],s=t.platforms.map(async i=>{try{return await this.publishToPlatform(i,e,t)}catch(a){return console.error(`Publish to ${i} failed:`,a),{success:!1,error:a.message,timestamp:Date.now()}}});return(await Promise.allSettled(s)).forEach(i=>{var a;i.status==="fulfilled"?r.push(i.value):r.push({success:!1,error:((a=i.reason)==null?void 0:a.message)||"Unknown error",timestamp:Date.now()})}),r}async publishToPlatform(e,t,r){let s=this.plugin.getServerUrl();this.notifyProgress(e,{platform:e,status:"processing",message:"\u6B63\u5728\u53D1\u5E03...",progress:0});try{if(!(await this.checkAuth(e)).authenticated)throw new Error("\u672A\u8BA4\u8BC1\uFF0C\u8BF7\u5148\u767B\u5F55");this.notifyProgress(e,{platform:e,status:"processing",message:"\u521B\u5EFA\u8349\u7A3F...",progress:20});let i=await this.httpClient.post(`${s}/api/publish/${e}/draft`,{title:r.title,content:t,summary:r.summary,tags:r.tags}),a=i.data.postId;this.notifyProgress(e,{platform:e,status:"processing",message:"\u5904\u7406\u56FE\u7247...",progress:50});let l=e==="toutiao"||i.data.status==="draft";this.notifyProgress(e,{platform:e,status:"processing",message:r.isDraft||l?"\u4FDD\u5B58\u8349\u7A3F...":"\u53D1\u5E03\u4E2D...",progress:90});let u;r.isDraft||l?u=i.data:u=(await this.httpClient.post(`${s}/api/publish/${e}/post/${a}/publish`)).data;let c=r.isDraft||l?"\u8349\u7A3F\u521B\u5EFA\u6210\u529F\uFF01\u8BF7\u5728\u540E\u53F0\u67E5\u770B\u5E76\u53D1\u5E03":"\u53D1\u5E03\u6210\u529F";return this.notifyProgress(e,{platform:e,status:"success",message:c,progress:100}),{success:!0,postId:u.postId,url:u.url,draftLink:u.draftLink,message:u.message||c,timestamp:Date.now()}}catch(o){return console.error(`Publish to ${e} error:`,o),this.notifyProgress(e,{platform:e,status:"error",message:o.message,progress:0}),{success:!1,error:o.message,timestamp:Date.now()}}}async extractAndUploadImages(e,t,r){let s=this.plugin.getServerUrl(),o=[],i=/!\[([^\]]*)\]\(([^\)]+)\)/g,a=[...t.matchAll(i)];for(let l of a){let u=l[0],c=l[2];try{if(!c.startsWith("http://")&&!c.startsWith("https://")){let h=c,d=await this.plugin.contentProcessor.readImageFile(h),b=d;this.plugin.settings.imageCompression&&(b=await this.plugin.contentProcessor.compressImage(d,this.plugin.settings.imageQuality));let f=new FormData,g=new Blob([b]);f.append("image",g,h.split("/").pop()),f.append("postId",r);let y=(await this.httpClient.post(`${s}/api/publish/${e}/upload`,f,{headers:{"Content-Type":"multipart/form-data"}})).data.url;o.push({original:u,uploaded:`![${l[1]}](${y})`})}}catch(h){console.error(`Upload image ${c} failed:`,h)}}return o}async checkAuth(e){let t=this.plugin.getServerUrl();try{return(await this.httpClient.get(`${t}/api/auth/${e}/status`)).data}catch(r){return console.error(`Check auth for ${e} failed:`,r),{authenticated:!1}}}async getUserInfo(e){let t=this.plugin.getServerUrl();try{return(await this.httpClient.get(`${t}/api/auth/${e}/userinfo`)).data}catch(r){throw console.error(`Get user info for ${e} failed:`,r),r}}async importCookie(e,t){var s,o;let r=this.plugin.getServerUrl();try{console.log(`[Auth] Importing cookie for ${e}...`);let i=await this.httpClient.post(`${r}/api/auth/${e}/cookie`,{cookie:t},{timeout:3e4,headers:{"Content-Type":"application/json"}});return console.log(`[Auth] Cookie imported successfully for ${e}`),i.data}catch(i){throw console.error(`[Auth] Import cookie for ${e} failed:`,i),i.response&&(console.error("[Auth] Response status:",i.response.status),console.error("[Auth] Response data:",i.response.data)),new Error(((o=(s=i.response)==null?void 0:s.data)==null?void 0:o.error)||i.message||"\u5BFC\u5165\u5931\u8D25")}}async generateQRCode(e){let t=this.plugin.getServerUrl();try{return(await this.httpClient.post(`${t}/api/auth/${e}/qrcode`)).data}catch(r){throw console.error(`Generate QR code for ${e} failed:`,r),r}}async checkQRCodeStatus(e,t){let r=this.plugin.getServerUrl();try{return(await this.httpClient.get(`${r}/api/auth/${e}/qrcode/${t}`)).data}catch(s){throw console.error(`Check QR code status for ${e} failed:`,s),s}}onPublishProgress(e,t){this.publishCallbacks.set(e,t)}offPublishProgress(e){this.publishCallbacks.delete(e)}notifyProgress(e,t){this.publishCallbacks.forEach(r=>{r(t)})}async getSupportedPlatforms(){let e=this.plugin.getServerUrl();try{return(await this.httpClient.get(`${e}/api/platforms`)).data.platforms}catch(t){return console.error("Get supported platforms failed:",t),[]}}async testConnection(e){try{return(await this.checkAuth(e)).authenticated?(await this.getUserInfo(e),!0):!1}catch(t){return!1}}async updateProxyConfig(e,t){let r=this.plugin.getServerUrl();try{await this.httpClient.post(`${r}/api/config/proxy`,{enabled:e,proxyUrl:t}),console.log("[Proxy] Configuration updated:",{enabled:e,proxyUrl:t})}catch(s){throw console.error("[Proxy] Update configuration failed:",s),s}}};var On=require("obsidian");function Jt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var re=Jt();function on(n){re=n}var an=/[&<>"']/,ti=new RegExp(an.source,"g"),ln=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,ri=new RegExp(ln.source,"g"),ni={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},en=n=>ni[n];function U(n,e){if(e){if(an.test(n))return n.replace(ti,en)}else if(ln.test(n))return n.replace(ri,en);return n}var si=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function ii(n){return n.replace(si,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}var oi=/(^|[^\[])\^/g;function S(n,e){let t=typeof n=="string"?n:n.source;e=e||"";let r={replace:(s,o)=>{let i=typeof o=="string"?o:o.source;return i=i.replace(oi,"$1"),t=t.replace(s,i),r},getRegex:()=>new RegExp(t,e)};return r}function tn(n){try{n=encodeURI(n).replace(/%25/g,"%")}catch(e){return null}return n}var Oe={exec:()=>null};function rn(n,e){let t=n.replace(/\|/g,(o,i,a)=>{let l=!1,u=i;for(;--u>=0&&a[u]==="\\";)l=!l;return l?"|":" |"}),r=t.split(/ \|/),s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function it(n,e,t){let r=n.length;if(r===0)return"";let s=0;for(;s<r;){let o=n.charAt(r-s-1);if(o===e&&!t)s++;else if(o!==e&&t)s++;else break}return n.slice(0,r-s)}function ai(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return-1}function nn(n,e,t,r){let s=e.href,o=e.title?U(e.title):null,i=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){r.state.inLink=!0;let a={type:"link",raw:t,href:s,title:o,text:i,tokens:r.inlineTokens(i)};return r.state.inLink=!1,a}return{type:"image",raw:t,href:s,title:o,text:U(i)}}function li(n,e){let t=n.match(/^(\s+)(?:```)/);if(t===null)return e;let r=t[1];return e.split(`
`).map(s=>{let o=s.match(/^\s+/);if(o===null)return s;let[i]=o;return i.length>=r.length?s.slice(r.length):s}).join(`
`)}var fe=class{constructor(e){v(this,"options");v(this,"rules");v(this,"lexer");this.options=e||re}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let r=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:it(r,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let r=t[0],s=li(r,t[3]||"");return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(/#$/.test(r)){let s=it(r,"#");(this.options.pedantic||!s||/ $/.test(s))&&(r=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let r=it(t[0].replace(/^ *>[ \t]?/gm,""),`
`),s=this.lexer.state.top;this.lexer.state.top=!0;let o=this.lexer.blockTokens(r);return this.lexer.state.top=s,{type:"blockquote",raw:t[0],tokens:o,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),s=r.length>1,o={type:"list",raw:"",ordered:s,start:s?+r.slice(0,-1):"",loose:!1,items:[]};r=s?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=s?r:"[*+-]");let i=new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),a="",l="",u=!1;for(;e;){let c=!1;if(!(t=i.exec(e))||this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let h=t[2].split(`
`,1)[0].replace(/^\t+/,y=>" ".repeat(3*y.length)),d=e.split(`
`,1)[0],b=0;this.options.pedantic?(b=2,l=h.trimStart()):(b=t[2].search(/[^ ]/),b=b>4?1:b,l=h.slice(b),b+=t[1].length);let f=!1;if(!h&&/^ *$/.test(d)&&(a+=d+`
`,e=e.substring(d.length+1),c=!0),!c){let y=new RegExp(`^ {0,${Math.min(3,b-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),T=new RegExp(`^ {0,${Math.min(3,b-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),P=new RegExp(`^ {0,${Math.min(3,b-1)}}(?:\`\`\`|~~~)`),R=new RegExp(`^ {0,${Math.min(3,b-1)}}#`);for(;e;){let D=e.split(`
`,1)[0];if(d=D,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),P.test(d)||R.test(d)||y.test(d)||T.test(e))break;if(d.search(/[^ ]/)>=b||!d.trim())l+=`
`+d.slice(b);else{if(f||h.search(/[^ ]/)>=4||P.test(h)||R.test(h)||T.test(h))break;l+=`
`+d}!f&&!d.trim()&&(f=!0),a+=D+`
`,e=e.substring(D.length+1),h=d.slice(b)}}o.loose||(u?o.loose=!0:/\n *\n *$/.test(a)&&(u=!0));let g=null,m;this.options.gfm&&(g=/^\[[ xX]\] /.exec(l),g&&(m=g[0]!=="[ ] ",l=l.replace(/^\[[ xX]\] +/,""))),o.items.push({type:"list_item",raw:a,task:!!g,checked:m,loose:!1,text:l,tokens:[]}),o.raw+=a}o.items[o.items.length-1].raw=a.trimEnd(),o.items[o.items.length-1].text=l.trimEnd(),o.raw=o.raw.trimEnd();for(let c=0;c<o.items.length;c++)if(this.lexer.state.top=!1,o.items[c].tokens=this.lexer.blockTokens(o.items[c].text,[]),!o.loose){let h=o.items[c].tokens.filter(b=>b.type==="space"),d=h.length>0&&h.some(b=>/\n.*\n/.test(b.raw));o.loose=d}if(o.loose)for(let c=0;c<o.items.length;c++)o.items[c].loose=!0;return o}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let r=t[1].toLowerCase().replace(/\s+/g," "),s=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:s,title:o}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;let r=rn(t[1]),s=t[2].replace(/^\||\| *$/g,"").split("|"),o=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===s.length){for(let a of s)/^ *-+: *$/.test(a)?i.align.push("right"):/^ *:-+: *$/.test(a)?i.align.push("center"):/^ *:-+ *$/.test(a)?i.align.push("left"):i.align.push(null);for(let a of r)i.header.push({text:a,tokens:this.lexer.inline(a)});for(let a of o)i.rows.push(rn(a,i.header.length).map(l=>({text:l,tokens:this.lexer.inline(l)})));return i}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:U(t[1])}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let r=t[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;let i=it(r.slice(0,-1),"\\");if((r.length-i.length)%2===0)return}else{let i=ai(t[2],"()");if(i>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let s=t[2],o="";if(this.options.pedantic){let i=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);i&&(s=i[1],o=i[3])}else o=t[3]?t[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(this.options.pedantic&&!/>$/.test(r)?s=s.slice(1):s=s.slice(1,-1)),nn(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let s=(r[2]||r[1]).replace(/\s+/g," "),o=t[s.toLowerCase()];if(!o){let i=r[0].charAt(0);return{type:"text",raw:i,text:i}}return nn(r,o,r[0],this.lexer)}}emStrong(e,t,r=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&r.match(/[\p{L}\p{N}]/u))return;if(!(s[1]||s[2]||"")||!r||this.rules.inline.punctuation.exec(r)){let i=[...s[0]].length-1,a,l,u=i,c=0,h=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+i);(s=h.exec(t))!=null;){if(a=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!a)continue;if(l=[...a].length,s[3]||s[4]){u+=l;continue}else if((s[5]||s[6])&&i%3&&!((i+l)%3)){c+=l;continue}if(u-=l,u>0)continue;l=Math.min(l,l+u+c);let d=[...s[0]][0].length,b=e.slice(0,i+s.index+d+l);if(Math.min(i,l)%2){let g=b.slice(1,-1);return{type:"em",raw:b,text:g,tokens:this.lexer.inlineTokens(g)}}let f=b.slice(2,-2);return{type:"strong",raw:b,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(/\n/g," "),s=/[^ ]/.test(r),o=/^ /.test(r)&&/ $/.test(r);return s&&o&&(r=r.substring(1,r.length-1)),r=U(r,!0),{type:"codespan",raw:t[0],text:r}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let r,s;return t[2]==="@"?(r=U(t[1]),s="mailto:"+r):(r=U(t[1]),s=r),{type:"link",raw:t[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}url(e){var r,s;let t;if(t=this.rules.inline.url.exec(e)){let o,i;if(t[2]==="@")o=U(t[0]),i="mailto:"+o;else{let a;do a=t[0],t[0]=(s=(r=this.rules.inline._backpedal.exec(t[0]))==null?void 0:r[0])!=null?s:"";while(a!==t[0]);o=U(t[0]),t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:o,href:i,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let r;return this.lexer.state.inRawBlock?r=t[0]:r=U(t[0]),{type:"text",raw:t[0],text:r}}}},ci=/^(?: *(?:\n|$))+/,ui=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,pi=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ne=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,fi=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,cn=/(?:[*+-]|\d{1,9}[.)])/,un=S(/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,cn).getRegex(),Zt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,hi=/^[^\n]+/,Qt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,di=S(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",Qt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),mi=S(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,cn).getRegex(),ct="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Kt=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,gi=S("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",Kt).replace("tag",ct).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),pn=S(Zt).replace("hr",Ne).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ct).getRegex(),bi=S(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",pn).getRegex(),Gt={blockquote:bi,code:ui,def:di,fences:pi,heading:fi,hr:Ne,html:gi,lheading:un,list:mi,newline:ci,paragraph:pn,table:Oe,text:hi},sn=S("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ne).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ct).getRegex(),wi={...Gt,table:sn,paragraph:S(Zt).replace("hr",Ne).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",sn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ct).getRegex()},yi={...Gt,html:S(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Kt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Oe,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:S(Zt).replace("hr",Ne).replace("heading",` *#{1,6} *[^
]`).replace("lheading",un).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},fn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,xi=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,hn=/^( {2,}|\\)\n(?!\s*$)/,ki=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ie="\\p{P}$+<=>`^|~",Si=S(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Ie).getRegex(),Pi=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,vi=S(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Ie).getRegex(),Ti=S("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Ie).getRegex(),Ei=S("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Ie).getRegex(),Ri=S(/\\([punct])/,"gu").replace(/punct/g,Ie).getRegex(),Ai=S(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ci=S(Kt).replace("(?:-->|$)","-->").getRegex(),Oi=S("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ci).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),at=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Di=S(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",at).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),dn=S(/^!?\[(label)\]\[(ref)\]/).replace("label",at).replace("ref",Qt).getRegex(),mn=S(/^!?\[(ref)\](?:\[\])?/).replace("ref",Qt).getRegex(),$i=S("reflink|nolink(?!\\()","g").replace("reflink",dn).replace("nolink",mn).getRegex(),Xt={_backpedal:Oe,anyPunctuation:Ri,autolink:Ai,blockSkip:Pi,br:hn,code:xi,del:Oe,emStrongLDelim:vi,emStrongRDelimAst:Ti,emStrongRDelimUnd:Ei,escape:fn,link:Di,nolink:mn,punctuation:Si,reflink:dn,reflinkSearch:$i,tag:Oi,text:ki,url:Oe},Ni={...Xt,link:S(/^!?\[(label)\]\((.*?)\)/).replace("label",at).getRegex(),reflink:S(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",at).getRegex()},qt={...Xt,escape:S(fn).replace("])","~|])").getRegex(),url:S(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Ii={...qt,br:S(hn).replace("{2,}","*").getRegex(),text:S(qt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ot={normal:Gt,gfm:wi,pedantic:yi},Ce={normal:Xt,gfm:qt,breaks:Ii,pedantic:Ni},J=class n{constructor(e){v(this,"tokens");v(this,"options");v(this,"state");v(this,"tokenizer");v(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||re,this.options.tokenizer=this.options.tokenizer||new fe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={block:ot.normal,inline:Ce.normal};this.options.pedantic?(t.block=ot.pedantic,t.inline=Ce.pedantic):this.options.gfm&&(t.block=ot.gfm,this.options.breaks?t.inline=Ce.breaks:t.inline=Ce.gfm),this.tokenizer.rules=t}static get rules(){return{block:ot,inline:Ce}}static lex(e,t){return new n(t).lex(e)}static lexInline(e,t){return new n(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,u)=>l+"    ".repeat(u.length));let r,s,o,i;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(r=a.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(o=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0,l=e.slice(1),u;this.options.extensions.startBlock.forEach(c=>{u=c.call({lexer:this},l),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(o=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(o))){s=t[t.length-1],i&&s.type==="paragraph"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r),i=o.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&s.type==="text"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(r);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r,s,o,i=e,a,l,u;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)i=i.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,a.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(u=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(r=c.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),s=t[t.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),s=t[t.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(r=this.tokenizer.emStrong(e,i,u)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.autolink(e)){e=e.substring(r.raw.length),t.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e))){e=e.substring(r.raw.length),t.push(r);continue}if(o=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0,h=e.slice(1),d;this.options.extensions.startInline.forEach(b=>{d=b.call({lexer:this},h),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(o=e.substring(0,c+1))}if(r=this.tokenizer.inlineText(o)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(u=r.raw.slice(-1)),l=!0,s=t[t.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):t.push(r);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}},he=class{constructor(e){v(this,"options");this.options=e||re}code(e,t,r){var o;let s=(o=(t||"").match(/^\S*/))==null?void 0:o[0];return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="language-'+U(s)+'">'+(r?e:U(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:U(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,r){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,r){let s=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+e+"</"+s+`>
`}listitem(e,t,r){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){let r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,r){let s=tn(e);if(s===null)return r;e=s;let o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+r+"</a>",o}image(e,t,r){let s=tn(e);if(s===null)return r;e=s;let o=`<img src="${e}" alt="${r}"`;return t&&(o+=` title="${t}"`),o+=">",o}text(e){return e}},De=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,r){return""+r}image(e,t,r){return""+r}br(){return""}},Z=class n{constructor(e){v(this,"options");v(this,"renderer");v(this,"textRenderer");this.options=e||re,this.options.renderer=this.options.renderer||new he,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new De}static parse(e,t){return new n(t).parse(e)}static parseInline(e,t){return new n(t).parseInline(e)}parse(e,t=!0){let r="";for(let s=0;s<e.length;s++){let o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){let i=o,a=this.options.extensions.renderers[i.type].call({parser:this},i);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(i.type)){r+=a||"";continue}}switch(o.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{let i=o;r+=this.renderer.heading(this.parseInline(i.tokens),i.depth,ii(this.parseInline(i.tokens,this.textRenderer)));continue}case"code":{let i=o;r+=this.renderer.code(i.text,i.lang,!!i.escaped);continue}case"table":{let i=o,a="",l="";for(let c=0;c<i.header.length;c++)l+=this.renderer.tablecell(this.parseInline(i.header[c].tokens),{header:!0,align:i.align[c]});a+=this.renderer.tablerow(l);let u="";for(let c=0;c<i.rows.length;c++){let h=i.rows[c];l="";for(let d=0;d<h.length;d++)l+=this.renderer.tablecell(this.parseInline(h[d].tokens),{header:!1,align:i.align[d]});u+=this.renderer.tablerow(l)}r+=this.renderer.table(a,u);continue}case"blockquote":{let i=o,a=this.parse(i.tokens);r+=this.renderer.blockquote(a);continue}case"list":{let i=o,a=i.ordered,l=i.start,u=i.loose,c="";for(let h=0;h<i.items.length;h++){let d=i.items[h],b=d.checked,f=d.task,g="";if(d.task){let m=this.renderer.checkbox(!!b);u?d.tokens.length>0&&d.tokens[0].type==="paragraph"?(d.tokens[0].text=m+" "+d.tokens[0].text,d.tokens[0].tokens&&d.tokens[0].tokens.length>0&&d.tokens[0].tokens[0].type==="text"&&(d.tokens[0].tokens[0].text=m+" "+d.tokens[0].tokens[0].text)):d.tokens.unshift({type:"text",text:m+" "}):g+=m+" "}g+=this.parse(d.tokens,u),c+=this.renderer.listitem(g,f,!!b)}r+=this.renderer.list(c,a,l);continue}case"html":{let i=o;r+=this.renderer.html(i.text,i.block);continue}case"paragraph":{let i=o;r+=this.renderer.paragraph(this.parseInline(i.tokens));continue}case"text":{let i=o,a=i.tokens?this.parseInline(i.tokens):i.text;for(;s+1<e.length&&e[s+1].type==="text";)i=e[++s],a+=`
`+(i.tokens?this.parseInline(i.tokens):i.text);r+=t?this.renderer.paragraph(a):a;continue}default:{let i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return r}parseInline(e,t){t=t||this.renderer;let r="";for(let s=0;s<e.length;s++){let o=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){let i=this.options.extensions.renderers[o.type].call({parser:this},o);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=i||"";continue}}switch(o.type){case"escape":{let i=o;r+=t.text(i.text);break}case"html":{let i=o;r+=t.html(i.text);break}case"link":{let i=o;r+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{let i=o;r+=t.image(i.href,i.title,i.text);break}case"strong":{let i=o;r+=t.strong(this.parseInline(i.tokens,t));break}case"em":{let i=o;r+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{let i=o;r+=t.codespan(i.text);break}case"br":{r+=t.br();break}case"del":{let i=o;r+=t.del(this.parseInline(i.tokens,t));break}case"text":{let i=o;r+=t.text(i.text);break}default:{let i='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return r}},ee=class{constructor(e){v(this,"options");this.options=e||re}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}};v(ee,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var $e,Wt,lt,gn,Vt=class{constructor(...e){wt(this,$e);wt(this,lt);v(this,"defaults",Jt());v(this,"options",this.setOptions);v(this,"parse",Ue(this,$e,Wt).call(this,J.lex,Z.parse));v(this,"parseInline",Ue(this,$e,Wt).call(this,J.lexInline,Z.parseInline));v(this,"Parser",Z);v(this,"Renderer",he);v(this,"TextRenderer",De);v(this,"Lexer",J);v(this,"Tokenizer",fe);v(this,"Hooks",ee);this.use(...e)}walkTokens(e,t){var s,o;let r=[];for(let i of e)switch(r=r.concat(t.call(this,i)),i.type){case"table":{let a=i;for(let l of a.header)r=r.concat(this.walkTokens(l.tokens,t));for(let l of a.rows)for(let u of l)r=r.concat(this.walkTokens(u.tokens,t));break}case"list":{let a=i;r=r.concat(this.walkTokens(a.items,t));break}default:{let a=i;(o=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&o[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{let u=a[l].flat(1/0);r=r.concat(this.walkTokens(u,t))}):a.tokens&&(r=r.concat(this.walkTokens(a.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let s={...r};if(s.async=this.defaults.async||s.async||!1,r.extensions&&(r.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let i=t.renderers[o.name];i?t.renderers[o.name]=function(...a){let l=o.renderer.apply(this,a);return l===!1&&(l=i.apply(this,a)),l}:t.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=t[o.level];i?i.unshift(o.tokenizer):t[o.level]=[o.tokenizer],o.start&&(o.level==="block"?t.startBlock?t.startBlock.push(o.start):t.startBlock=[o.start]:o.level==="inline"&&(t.startInline?t.startInline.push(o.start):t.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(t.childTokens[o.name]=o.childTokens)}),s.extensions=t),r.renderer){let o=this.defaults.renderer||new he(this.defaults);for(let i in r.renderer){if(!(i in o))throw new Error(`renderer '${i}' does not exist`);if(i==="options")continue;let a=i,l=r.renderer[a],u=o[a];o[a]=(...c)=>{let h=l.apply(o,c);return h===!1&&(h=u.apply(o,c)),h||""}}s.renderer=o}if(r.tokenizer){let o=this.defaults.tokenizer||new fe(this.defaults);for(let i in r.tokenizer){if(!(i in o))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let a=i,l=r.tokenizer[a],u=o[a];o[a]=(...c)=>{let h=l.apply(o,c);return h===!1&&(h=u.apply(o,c)),h}}s.tokenizer=o}if(r.hooks){let o=this.defaults.hooks||new ee;for(let i in r.hooks){if(!(i in o))throw new Error(`hook '${i}' does not exist`);if(i==="options")continue;let a=i,l=r.hooks[a],u=o[a];ee.passThroughHooks.has(i)?o[a]=c=>{if(this.defaults.async)return Promise.resolve(l.call(o,c)).then(d=>u.call(o,d));let h=l.call(o,c);return u.call(o,h)}:o[a]=(...c)=>{let h=l.apply(o,c);return h===!1&&(h=u.apply(o,c)),h}}s.hooks=o}if(r.walkTokens){let o=this.defaults.walkTokens,i=r.walkTokens;s.walkTokens=function(a){let l=[];return l.push(i.call(this,a)),o&&(l=l.concat(o.call(this,a))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return J.lex(e,t!=null?t:this.defaults)}parser(e,t){return Z.parse(e,t!=null?t:this.defaults)}};$e=new WeakSet,Wt=function(e,t){return(r,s)=>{let o={...s},i={...this.defaults,...o};this.defaults.async===!0&&o.async===!1&&(i.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),i.async=!0);let a=Ue(this,lt,gn).call(this,!!i.silent,!!i.async);if(typeof r=="undefined"||r===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));if(i.hooks&&(i.hooks.options=i),i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(r):r).then(l=>e(l,i)).then(l=>i.hooks?i.hooks.processAllTokens(l):l).then(l=>i.walkTokens?Promise.all(this.walkTokens(l,i.walkTokens)).then(()=>l):l).then(l=>t(l,i)).then(l=>i.hooks?i.hooks.postprocess(l):l).catch(a);try{i.hooks&&(r=i.hooks.preprocess(r));let l=e(r,i);i.hooks&&(l=i.hooks.processAllTokens(l)),i.walkTokens&&this.walkTokens(l,i.walkTokens);let u=t(l,i);return i.hooks&&(u=i.hooks.postprocess(u)),u}catch(l){return a(l)}}},lt=new WeakSet,gn=function(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let s="<p>An error occurred:</p><pre>"+U(r.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(r);throw r}};var te=new Vt;function x(n,e){return te.parse(n,e)}x.options=x.setOptions=function(n){return te.setOptions(n),x.defaults=te.defaults,on(x.defaults),x};x.getDefaults=Jt;x.defaults=re;x.use=function(...n){return te.use(...n),x.defaults=te.defaults,on(x.defaults),x};x.walkTokens=function(n,e){return te.walkTokens(n,e)};x.parseInline=te.parseInline;x.Parser=Z;x.parser=Z.parse;x.Renderer=he;x.TextRenderer=De;x.Lexer=J;x.lexer=J.lex;x.Tokenizer=fe;x.Hooks=ee;x.parse=x;var zc=x.options,Hc=x.setOptions,jc=x.use,qc=x.walkTokens,Vc=x.parseInline;var Wc=Z.parse,Jc=J.lex;function Li(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])}return n}function rr(n,e){return Array(e+1).join(n)}function yn(n){return n.replace(/^\n*/,"")}function xn(n){for(var e=n.length;e>0&&n[e-1]===`
`;)e--;return n.substring(0,e)}function kn(n){return xn(yn(n))}var Fi=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function nr(n){return sr(n,Fi)}var Sn=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function Pn(n){return sr(n,Sn)}function Bi(n){return Tn(n,Sn)}var vn=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Ui(n){return sr(n,vn)}function _i(n){return Tn(n,vn)}function sr(n,e){return e.indexOf(n.nodeName)>=0}function Tn(n,e){return n.getElementsByTagName&&e.some(function(t){return n.getElementsByTagName(t).length})}var N={};N.paragraph={filter:"p",replacement:function(n){return`

`+n+`

`}};N.lineBreak={filter:"br",replacement:function(n,e,t){return t.br+`
`}};N.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(n,e,t){var r=Number(e.nodeName.charAt(1));if(t.headingStyle==="setext"&&r<3){var s=rr(r===1?"=":"-",n.length);return`

`+n+`
`+s+`

`}else return`

`+rr("#",r)+" "+n+`

`}};N.blockquote={filter:"blockquote",replacement:function(n){return n=kn(n).replace(/^/gm,"> "),`

`+n+`

`}};N.list={filter:["ul","ol"],replacement:function(n,e){var t=e.parentNode;return t.nodeName==="LI"&&t.lastElementChild===e?`
`+n:`

`+n+`

`}};N.listItem={filter:"li",replacement:function(n,e,t){var r=t.bulletListMarker+"   ",s=e.parentNode;if(s.nodeName==="OL"){var o=s.getAttribute("start"),i=Array.prototype.indexOf.call(s.children,e);r=(o?Number(o)+i:i+1)+".  "}var a=/\n$/.test(n);return n=kn(n)+(a?`
`:""),n=n.replace(/\n/gm,`
`+" ".repeat(r.length)),r+n+(e.nextSibling?`
`:"")}};N.indentedCodeBlock={filter:function(n,e){return e.codeBlockStyle==="indented"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,e,t){return`

    `+e.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};N.fencedCodeBlock={filter:function(n,e){return e.codeBlockStyle==="fenced"&&n.nodeName==="PRE"&&n.firstChild&&n.firstChild.nodeName==="CODE"},replacement:function(n,e,t){for(var r=e.firstChild.getAttribute("class")||"",s=(r.match(/language-(\S+)/)||[null,""])[1],o=e.firstChild.textContent,i=t.fence.charAt(0),a=3,l=new RegExp("^"+i+"{3,}","gm"),u;u=l.exec(o);)u[0].length>=a&&(a=u[0].length+1);var c=rr(i,a);return`

`+c+s+`
`+o.replace(/\n$/,"")+`
`+c+`

`}};N.horizontalRule={filter:"hr",replacement:function(n,e,t){return`

`+t.hr+`

`}};N.inlineLink={filter:function(n,e){return e.linkStyle==="inlined"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,e){var t=e.getAttribute("href");t&&(t=t.replace(/([()])/g,"\\$1"));var r=ut(e.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+n+"]("+t+r+")"}};N.referenceLink={filter:function(n,e){return e.linkStyle==="referenced"&&n.nodeName==="A"&&n.getAttribute("href")},replacement:function(n,e,t){var r=e.getAttribute("href"),s=ut(e.getAttribute("title"));s&&(s=' "'+s+'"');var o,i;switch(t.linkReferenceStyle){case"collapsed":o="["+n+"][]",i="["+n+"]: "+r+s;break;case"shortcut":o="["+n+"]",i="["+n+"]: "+r+s;break;default:var a=this.references.length+1;o="["+n+"]["+a+"]",i="["+a+"]: "+r+s}return this.references.push(i),o},references:[],append:function(n){var e="";return this.references.length&&(e=`

`+this.references.join(`
`)+`

`,this.references=[]),e}};N.emphasis={filter:["em","i"],replacement:function(n,e,t){return n.trim()?t.emDelimiter+n+t.emDelimiter:""}};N.strong={filter:["strong","b"],replacement:function(n,e,t){return n.trim()?t.strongDelimiter+n+t.strongDelimiter:""}};N.code={filter:function(n){var e=n.previousSibling||n.nextSibling,t=n.parentNode.nodeName==="PRE"&&!e;return n.nodeName==="CODE"&&!t},replacement:function(n){if(!n)return"";n=n.replace(/\r?\n|\r/g," ");for(var e=/^`|^ .*?[^ ].* $|`$/.test(n)?" ":"",t="`",r=n.match(/`+/gm)||[];r.indexOf(t)!==-1;)t=t+"`";return t+e+n+e+t}};N.image={filter:"img",replacement:function(n,e){var t=ut(e.getAttribute("alt")),r=e.getAttribute("src")||"",s=ut(e.getAttribute("title")),o=s?' "'+s+'"':"";return r?"!["+t+"]("+r+o+")":""}};function ut(n){return n?n.replace(/(\n+\s*)+/g,`
`):""}function En(n){this.options=n,this._keep=[],this._remove=[],this.blankRule={replacement:n.blankReplacement},this.keepReplacement=n.keepReplacement,this.defaultRule={replacement:n.defaultReplacement},this.array=[];for(var e in n.rules)this.array.push(n.rules[e])}En.prototype={add:function(n,e){this.array.unshift(e)},keep:function(n){this._keep.unshift({filter:n,replacement:this.keepReplacement})},remove:function(n){this._remove.unshift({filter:n,replacement:function(){return""}})},forNode:function(n){if(n.isBlank)return this.blankRule;var e;return(e=Yt(this.array,n,this.options))||(e=Yt(this._keep,n,this.options))||(e=Yt(this._remove,n,this.options))?e:this.defaultRule},forEach:function(n){for(var e=0;e<this.array.length;e++)n(this.array[e],e)}};function Yt(n,e,t){for(var r=0;r<n.length;r++){var s=n[r];if(Mi(s,e,t))return s}}function Mi(n,e,t){var r=n.filter;if(typeof r=="string"){if(r===e.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(e.nodeName.toLowerCase())>-1)return!0}else if(typeof r=="function"){if(r.call(n,e,t))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function zi(n){var e=n.element,t=n.isBlock,r=n.isVoid,s=n.isPre||function(h){return h.nodeName==="PRE"};if(!(!e.firstChild||s(e))){for(var o=null,i=!1,a=null,l=bn(a,e,s);l!==e;){if(l.nodeType===3||l.nodeType===4){var u=l.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!i&&u[0]===" "&&(u=u.substr(1)),!u){l=er(l);continue}l.data=u,o=l}else if(l.nodeType===1)t(l)||l.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,i=!1):r(l)||s(l)?(o=null,i=!0):o&&(i=!1);else{l=er(l);continue}var c=bn(a,l,s);a=l,l=c}o&&(o.data=o.data.replace(/ $/,""),o.data||er(o))}}function er(n){var e=n.nextSibling||n.parentNode;return n.parentNode.removeChild(n),e}function bn(n,e,t){return n&&n.parentNode===e||t(e)?e.nextSibling||e.parentNode:e.firstChild||e.nextSibling||e.parentNode}var ir=typeof window!="undefined"?window:{};function Hi(){var n=ir.DOMParser,e=!1;try{new n().parseFromString("","text/html")&&(e=!0)}catch(t){}return e}function ji(){var n=function(){};return qi()?n.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:n.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t},n}function qi(){var n=!1;try{document.implementation.createHTMLDocument("").open()}catch(e){ir.ActiveXObject&&(n=!0)}return n}var Vi=Hi()?ir.DOMParser:ji();function Wi(n,e){var t;if(typeof n=="string"){var r=Ji().parseFromString('<x-turndown id="turndown-root">'+n+"</x-turndown>","text/html");t=r.getElementById("turndown-root")}else t=n.cloneNode(!0);return zi({element:t,isBlock:nr,isVoid:Pn,isPre:e.preformattedCode?Zi:null}),t}var tr;function Ji(){return tr=tr||new Vi,tr}function Zi(n){return n.nodeName==="PRE"||n.nodeName==="CODE"}function Qi(n,e){return n.isBlock=nr(n),n.isCode=n.nodeName==="CODE"||n.parentNode.isCode,n.isBlank=Ki(n),n.flankingWhitespace=Gi(n,e),n}function Ki(n){return!Pn(n)&&!Ui(n)&&/^\s*$/i.test(n.textContent)&&!Bi(n)&&!_i(n)}function Gi(n,e){if(n.isBlock||e.preformattedCode&&n.isCode)return{leading:"",trailing:""};var t=Xi(n.textContent);return t.leadingAscii&&wn("left",n,e)&&(t.leading=t.leadingNonAscii),t.trailingAscii&&wn("right",n,e)&&(t.trailing=t.trailingNonAscii),{leading:t.leading,trailing:t.trailing}}function Xi(n){var e=n.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:e[1],leadingAscii:e[2],leadingNonAscii:e[3],trailing:e[4],trailingNonAscii:e[5],trailingAscii:e[6]}}function wn(n,e,t){var r,s,o;return n==="left"?(r=e.previousSibling,s=/ $/):(r=e.nextSibling,s=/^ /),r&&(r.nodeType===3?o=s.test(r.nodeValue):t.preformattedCode&&r.nodeName==="CODE"?o=!1:r.nodeType===1&&!nr(r)&&(o=s.test(r.textContent))),o}var Yi=Array.prototype.reduce,eo=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function pt(n){if(!(this instanceof pt))return new pt(n);var e={rules:N,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(t,r){return r.isBlock?`

`:""},keepReplacement:function(t,r){return r.isBlock?`

`+r.outerHTML+`

`:r.outerHTML},defaultReplacement:function(t,r){return r.isBlock?`

`+t+`

`:t}};this.options=Li({},e,n),this.rules=new En(this.options)}pt.prototype={turndown:function(n){if(!no(n))throw new TypeError(n+" is not a string, or an element/document/fragment node.");if(n==="")return"";var e=Rn.call(this,new Wi(n,this.options));return to.call(this,e)},use:function(n){if(Array.isArray(n))for(var e=0;e<n.length;e++)this.use(n[e]);else if(typeof n=="function")n(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(n,e){return this.rules.add(n,e),this},keep:function(n){return this.rules.keep(n),this},remove:function(n){return this.rules.remove(n),this},escape:function(n){return eo.reduce(function(e,t){return e.replace(t[0],t[1])},n)}};function Rn(n){var e=this;return Yi.call(n.childNodes,function(t,r){r=new Qi(r,e.options);var s="";return r.nodeType===3?s=r.isCode?r.nodeValue:e.escape(r.nodeValue):r.nodeType===1&&(s=ro.call(e,r)),An(t,s)},"")}function to(n){var e=this;return this.rules.forEach(function(t){typeof t.append=="function"&&(n=An(n,t.append(e.options)))}),n.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function ro(n){var e=this.rules.forNode(n),t=Rn.call(this,n),r=n.flankingWhitespace;return(r.leading||r.trailing)&&(t=t.trim()),r.leading+e.replacement(t,n,this.options)+r.trailing}function An(n,e){var t=xn(n),r=yn(e),s=Math.max(n.length-t.length,e.length-r.length),o=`

`.substring(0,s);return t+o+r}function no(n){return n!=null&&(typeof n=="string"||n.nodeType&&(n.nodeType===1||n.nodeType===9||n.nodeType===11))}var Cn=pt;var ft=class{constructor(e){this.plugin=e,this.app=e.app,this.turndownService=new Cn({headingStyle:"atx",codeBlockStyle:"fenced"})}async processContent(e,t){let r=this.extractTitle(e,t),s=this.extractSummary(e),o=this.extractTags(e),i=e.replace(/^---\n[\s\S]*?\n---\n/,""),{content:a,images:l}=await this.processImages(i,t),u=await this.markdownToHtml(a);return{title:r,content:u,summary:s,tags:o}}extractTitle(e,t){let r=e.match(/^---\n([\s\S]*?)\n---/);if(r){let o=r[1].match(/title:\s*(.+)/);if(o)return o[1].trim().replace(/['"]/g,"")}let s=e.match(/^#\s+(.+)$/m);return s?s[1].trim():t.basename}extractSummary(e){let t=e.replace(/^---\n[\s\S]*?\n---\n/,"");t=t.replace(/^#+\s+.+$/gm,""),t=t.replace(/!\[.*?\]\(.*?\)/g,""),t=t.replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1"),t=t.replace(/```[\s\S]*?```/g,""),t=t.replace(/`[^`]+`/g,"");let r=t.trim().substring(0,200);return r?r+"...":""}extractTags(e){let t=[],r=e.match(/^---\n([\s\S]*?)\n---/);if(r){let o=r[1].match(/tags:\s*\[([^\]]+)\]/);if(o){let i=o[1].split(",").map(a=>a.trim().replace(/['"]/g,""));t.push(...i)}}let s=e.matchAll(/#([^\s#]+)/g);for(let o of s){let i=o[1];t.includes(i)||t.push(i)}return t}async processImages(e,t){let r=[],s=e,o=/!\[([^\]]*)\]\(([^\)]+)\)/g,i=[...e.matchAll(o)];for(let a of i){let l=a[1],u=a[2];if(!u.startsWith("http://")&&!u.startsWith("https://")){let h=this.resolveImagePath(u,t);r.push({src:a[0],alt:l,isLocal:!0,path:h})}else r.push({src:u,alt:l,isLocal:!1})}return{content:s,images:r}}resolveImagePath(e,t){var s;if(e=decodeURIComponent(e),e.startsWith("/"))return e.substring(1);let r=((s=t.parent)==null?void 0:s.path)||"";return r?`${r}/${e}`:e}async markdownToHtml(e){return x.setOptions({gfm:!0,breaks:!0}),await x.parse(e)}htmlToMarkdown(e){return this.turndownService.turndown(e)}async readImageFile(e){let t=this.app.vault.getAbstractFileByPath(e);if(t instanceof On.TFile)return await this.app.vault.readBinary(t);throw new Error(`Image file not found: ${e}`)}async compressImage(e,t=80){return e}cleanHtml(e){return e=e.replace(/\s+style="[^"]*"/g,""),e=e.replace(/\s+class="[^"]*"/g,""),e=e.replace(/\s+id="[^"]*"/g,""),e=e.replace(/<p>\s*<\/p>/g,""),e}adaptForPlatform(e,t){switch(t){case"weixin":return this.adaptForWeixin(e);case"zhihu":return this.adaptForZhihu(e);case"csdn":return this.adaptForCSDN(e);default:return e}}adaptForWeixin(e){return e=e.replace(/<p>/g,'<p style="margin: 1em 0; line-height: 1.75;">'),e=e.replace(/<h1>/g,'<h1 style="font-size: 1.5em; font-weight: bold; margin: 1em 0;">'),e=e.replace(/<h2>/g,'<h2 style="font-size: 1.3em; font-weight: bold; margin: 1em 0;">'),e=e.replace(/<h3>/g,'<h3 style="font-size: 1.1em; font-weight: bold; margin: 1em 0;">'),e=e.replace(/<pre>/g,'<pre style="background: #f5f5f5; padding: 1em; border-radius: 4px; overflow-x: auto;">'),e=e.replace(/<code>/g,'<code style="font-family: monospace; background: #f0f0f0; padding: 0.2em 0.4em; border-radius: 3px;">'),e}adaptForZhihu(e){return e=e.replace(/<pre><code class="language-(\w+)">/g,'<pre><code class="language-$1">'),e}adaptForCSDN(e){return e}extractCoverImage(e){let t=e.match(/^---\n([\s\S]*?)\n---/);if(t){let s=t[1].match(/cover:\s*(.+)/);if(s)return s[1].trim().replace(/['"]/g,"")}let r=e.match(/!\[.*?\]\(([^\)]+)\)/);if(r)return r[1]}};var C=require("obsidian"),ht=require("child_process"),I=dr(require("path")),$=dr(require("fs")),dt=class{constructor(e){this.serverProcess=null;this.serverPort=3e3;this.serverUrl="";this.isStarting=!1;this.plugin=e,this.serverUrl=`http://localhost:${this.serverPort}`}getPluginDir(){let e=this.plugin.app.vault.adapter,t=e.basePath||e.getBasePath(),r=this.plugin.manifest.id,s=I.join(t,".obsidian","plugins",r);return console.log("Plugin directory:",s),s}getNpmCommand(){if(C.Platform.isWin)return"npm.cmd";try{let e=process.execPath,t=I.dirname(e),r=I.join(t,"npm");if($.existsSync(r))return console.log("Found npm at:",r),r}catch(e){console.warn("Failed to find npm from process.execPath:",e)}return"npm"}getNodeCommand(){return C.Platform.isWin?"node.exe":"node"}async findNodeCommand(){try{let t=I.join(process.env.HOME||"",".nvm/versions/node");if($.existsSync(t)){let r=$.readdirSync(t).filter(s=>s.startsWith("v"));if(r.length>0){let s=r.sort().reverse()[0],o=I.join(t,s,"bin/node");if($.existsSync(o))return console.log(`Found node at: ${o}`),o}}}catch(t){}let e=["/usr/local/bin/node","/opt/homebrew/bin/node","/usr/bin/node"];for(let t of e)if($.existsSync(t))return console.log(`Found node at: ${t}`),t;return"node"}async isPortInUse(e){try{let t=new AbortController,r=setTimeout(()=>t.abort(),1e3),s=await fetch(`http://localhost:${e}/api/health`,{method:"GET",signal:t.signal});return clearTimeout(r),s.ok}catch(t){return!1}}async start(){var e,t;if(this.serverProcess)return console.log("Server is already running"),!0;if(this.isStarting)return console.log("Server is starting..."),!1;this.isStarting=!0;try{let r=this.getPluginDir(),s=I.join(r,"server");if(console.log("Looking for server directory at:",s),!$.existsSync(s))return console.error("Server directory not found at:",s),console.log("Plugin directory contents:",$.readdirSync(r)),new C.Notice("\u274C Server directory not found. Please check installation."),this.isStarting=!1,!1;let o=I.join(s,"node_modules"),i=!$.existsSync(o),a=null;if(i){console.log("Dependencies not found, installing..."),a=new C.Notice("\u26A0\uFE0F \u9996\u6B21\u542F\u52A8\uFF1A\u6B63\u5728\u5B89\u88C5\u4F9D\u8D56\uFF0C\u8BF7\u7A0D\u5019...",0);try{await this.installDependencies(s),a&&a.hide(),new C.Notice("\u2705 \u4F9D\u8D56\u5B89\u88C5\u6210\u529F",3e3)}catch(c){console.error("Failed to install dependencies:",c),a&&a.hide();let h=`\u274C \u4F9D\u8D56\u5B89\u88C5\u5931\u8D25

\u8BF7\u624B\u52A8\u5B89\u88C5\uFF1A
1. \u6253\u5F00\u7EC8\u7AEF
2. cd ${s}
3. npm install --production

\u7136\u540E\u91CD\u542F\u63D2\u4EF6`;return new C.Notice(h,0),this.isStarting=!1,!1}}if(await this.isPortInUse(this.serverPort))return console.log(`Port ${this.serverPort} is already in use, server is running`),new C.Notice("\u2705 \u670D\u52A1\u5668\u5DF2\u5728\u8FD0\u884C"),this.isStarting=!1,!0;console.log("Starting server from:",s),console.log("Platform:",C.Platform.isWin?"Windows":C.Platform.isMacOS?"macOS":"Linux");let u=await this.findNodeCommand();return console.log(`Starting server with: ${u}`),this.serverProcess=(0,ht.spawn)(u,["index.js"],{cwd:s,stdio:["ignore","pipe","pipe"],detached:!1,shell:!0,env:{...process.env,NODE_ENV:"production"}}),(e=this.serverProcess.stdout)==null||e.on("data",c=>{console.log(`[Server] ${c.toString()}`)}),(t=this.serverProcess.stderr)==null||t.on("data",c=>{console.error(`[Server Error] ${c.toString()}`)}),this.serverProcess.on("error",c=>{console.error("Failed to start server:",c),new C.Notice(`\u274C Failed to start server: ${c.message}`),this.serverProcess=null,this.isStarting=!1}),this.serverProcess.on("exit",c=>{console.log(`Server exited with code ${c}`),this.serverProcess=null,this.isStarting=!1}),await this.waitForServer(),this.isStarting=!1,i?new C.Notice("\u2705 \u670D\u52A1\u5668\u542F\u52A8\u6210\u529F\uFF08\u4F9D\u8D56\u5DF2\u5B89\u88C5\uFF09",3e3):new C.Notice("\u2705 \u670D\u52A1\u5668\u542F\u52A8\u6210\u529F",3e3),!0}catch(r){return console.error("Error starting server:",r),new C.Notice(`\u274C Error starting server: ${r.message}`),this.isStarting=!1,!1}}async stop(){if(console.log("=== Stopping server ==="),this.serverProcess){console.log("Stopping tracked server process...");try{this.serverProcess.kill("SIGTERM"),await new Promise(t=>setTimeout(t,1e3)),this.serverProcess=null,console.log("\u2713 Server process stopped")}catch(t){console.error("Error stopping server process:",t),this.serverProcess=null}}else console.log("No tracked server process");console.log(`Checking if port ${this.serverPort} is in use...`),await this.isPortInUse(this.serverPort)?(console.log(`\u26A0 Port ${this.serverPort} is still in use, attempting to kill process...`),C.Platform.isWin?console.log("Windows: Cannot kill process by port automatically"):await this.killProcessByPort(this.serverPort),await new Promise(r=>setTimeout(r,500)),await this.isPortInUse(this.serverPort)?console.warn(`\u26A0 Port ${this.serverPort} is still in use after cleanup`):console.log("\u2713 Port is now free")):console.log("\u2713 Port is free"),console.log("=== Server stop completed ===")}async killProcessByPort(e){return new Promise(t=>{var r;try{let{spawn:s}=require("child_process"),o=s("lsof",["-ti",`:${e}`]),i="";(r=o.stdout)==null||r.on("data",a=>{i+=a.toString()}),o.on("close",a=>{if(a===0&&i.trim()){let l=i.trim().split(`
`);console.log(`Found ${l.length} process(es) on port ${e}:`,l),l.forEach(u=>{try{let c=parseInt(u);process.kill(c,"SIGTERM"),console.log(`\u2713 Killed process ${c}`)}catch(c){console.error(`Failed to kill process ${u}:`,c)}})}else console.log("No process found on port",e);t()}),o.on("error",a=>{console.error("lsof command error:",a),t()})}catch(s){console.error("Failed to kill process by port:",s),t()}})}isRunning(){return this.serverProcess!==null&&!this.serverProcess.killed}getServerUrl(){return this.serverUrl}async getServerStatus(){return{running:this.isRunning(),url:this.serverUrl}}async waitForServer(e=30){await new Promise(t=>setTimeout(t,2e3));for(let t=0;t<e;t++){try{let s=new AbortController,o=setTimeout(()=>s.abort(),500),i=await fetch(`${this.serverUrl}/api/health`,{method:"GET",signal:s.signal,cache:"no-store"});if(clearTimeout(o),i.ok){console.log("Server is ready");return}}catch(s){}let r=Math.min(500+t*100,2e3);await new Promise(s=>setTimeout(s,r))}throw new Error("Server failed to start within timeout")}async findNpmCommand(){let e=this.getNpmCommand();if(I.isAbsolute(e))return e;if(process.env.NVM_DIR)try{let r=I.join(process.env.NVM_DIR,"versions/node");if($.existsSync(r)){let s=$.readdirSync(r).filter(o=>o.startsWith("v"));if(s.length>0){let o=s.sort().reverse()[0],i=I.join(r,o,"bin/npm");if($.existsSync(i))return console.log(`Found npm at: ${i} (from NVM_DIR)`),i}}}catch(r){console.warn("Failed to find npm from NVM_DIR:",r)}try{let r=I.join(process.env.HOME||"",".nvm/versions/node");if($.existsSync(r)){let s=$.readdirSync(r).filter(o=>o.startsWith("v"));if(s.length>0){let o=s.sort().reverse()[0],i=I.join(r,o,"bin/npm");if($.existsSync(i))return console.log(`Found npm at: ${i} (from ~/.nvm)`),i}}}catch(r){console.warn("Failed to find npm from ~/.nvm:",r)}let t=["/usr/local/bin/npm","/opt/homebrew/bin/npm","/usr/bin/npm"];for(let r of t)if($.existsSync(r))return console.log(`Found npm at: ${r}`),r;return new Promise(r=>{var a;let s=C.Platform.isWin?"where":"which",o=(0,ht.spawn)(s,[e],{shell:!0,env:{...process.env,PATH:process.env.PATH+":/usr/local/bin:/opt/homebrew/bin"}}),i="";(a=o.stdout)==null||a.on("data",l=>{i+=l.toString()}),o.on("close",l=>{if(l===0&&i.trim()){let u=i.trim().split(`
`)[0];console.log(`Found npm at: ${u}`),r(u)}else console.log(`Using default npm command: ${e}`),r(e)}),o.on("error",()=>{r(e)})})}async installDependencies(e){return console.log(`Installing dependencies in: ${e}`),new Promise((t,r)=>{let s=C.Platform.isWin?`cd "${e}" && npm install --production`:`cd "${e}" && npm install --production`,o=C.Platform.isWin?"cmd.exe":"/bin/bash",i=C.Platform.isWin?["/c",s]:["-l","-c",s];console.log(`Executing: ${o} ${i.join(" ")}`);let a=(0,ht.spawn)(o,i,{stdio:"inherit",env:{...process.env,NODE_ENV:"production"}});a.on("close",l=>{l===0?(console.log("Dependencies installed successfully"),t()):(console.error(`npm install failed with code ${l}`),r(new Error(`npm install failed with code ${l}`)))}),a.on("error",l=>{console.error("npm install error:",l),r(l)})})}};var mt=class extends B.Plugin{async onload(){console.log("Loading Obsidian Publisher plugin"),await this.loadSettings(),this.platformManager=new st(this),this.contentProcessor=new ft(this),this.serverManager=new dt(this),this.registerView(se,t=>new ze(t,this)),this.addRibbonIcon("send","\u53D1\u5E03\u6587\u7AE0",async()=>{await this.openPublishModal()}),this.addCommand({id:"publish-current-note",name:"\u53D1\u5E03\u5F53\u524D\u7B14\u8BB0",checkCallback:t=>this.app.workspace.getActiveFile()?(t||this.openPublishModal(),!0):!1}),this.addCommand({id:"quick-publish",name:"\u5FEB\u901F\u53D1\u5E03\u5230\u9ED8\u8BA4\u5E73\u53F0",checkCallback:t=>{let r=this.app.workspace.getActiveFile();return r?(t||this.quickPublish(r),!0):!1}}),this.addCommand({id:"open-publish-history",name:"\u6253\u5F00\u53D1\u5E03\u5386\u53F2",callback:()=>{this.activateHistoryView()}}),this.addCommand({id:"manage-platforms",name:"\u7BA1\u7406\u5E73\u53F0",callback:()=>{this.app.setting.open(),this.app.setting.openTabById(this.manifest.id)}}),this.registerEvent(this.app.workspace.on("file-menu",(t,r)=>{r instanceof B.TFile&&r.extension==="md"&&(t.addItem(s=>{s.setTitle("\u53D1\u5E03\u5230\u5E73\u53F0").setIcon("send").onClick(async()=>{await this.openPublishModal(r)})}),t.addItem(s=>{s.setTitle("\u5FEB\u901F\u53D1\u5E03").setIcon("zap").onClick(async()=>{await this.quickPublish(r)})}))})),this.addSettingTab(new _e(this.app,this));let e=this.addStatusBarItem();e.setText("\u{1F4E4} Publisher"),e.addClass("publisher-status-bar"),e.onclick=()=>{this.activateHistoryView()},console.log("Obsidian Publisher plugin loaded"),this.settings.autoStartServer?(console.log("Auto-start server is enabled"),setTimeout(async()=>{try{console.log("=== Starting server initialization ==="),console.log("Step 1: Stopping any existing server..."),await this.serverManager.stop(),console.log("Step 2: Waiting for port to be released..."),await new Promise(r=>setTimeout(r,1e3)),console.log("Step 3: Starting new server..."),await this.serverManager.start()?(console.log("=== Server started successfully ==="),new B.Notice("\u2705 \u670D\u52A1\u5668\u5DF2\u542F\u52A8")):console.log("=== Server failed to start ===")}catch(t){console.error("=== Server auto-start error ===",t),new B.Notice("\u26A0\uFE0F \u670D\u52A1\u5668\u81EA\u52A8\u542F\u52A8\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u542F\u52A8")}},1e3)):console.log("Auto-start server is disabled")}async onunload(){console.log("Unloading Obsidian Publisher plugin");try{console.log("Stopping server before unload..."),await this.serverManager.stop(),console.log("Server stopped successfully")}catch(e){console.error("Error stopping server during unload:",e)}this.app.workspace.detachLeavesOfType(se)}async loadSettings(){this.settings=Object.assign({},mr,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async openPublishModal(e){let t=e||this.app.workspace.getActiveFile();if(!t){new B.Notice("\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u7B14\u8BB0");return}new Me(this.app,this,t).open()}async publishToMultiplePlatforms(e,t,r=!0){try{let s=await this.app.vault.read(e),o=await this.contentProcessor.processContent(s,e),i={platforms:t,title:o.title||e.basename,summary:o.summary,tags:o.tags};r&&new B.Notice("\u5F00\u59CB\u53D1\u5E03...");let a=await this.platformManager.publishToMultiplePlatforms(s,i),l=a.filter(c=>c.success).length,u=a.length;return r&&(l===u?new B.Notice(`\u2705 \u53D1\u5E03\u6210\u529F\uFF01\u5DF2\u53D1\u5E03\u5230 ${l} \u4E2A\u5E73\u53F0`):l>0?new B.Notice(`\u26A0\uFE0F \u90E8\u5206\u53D1\u5E03\u6210\u529F\uFF1A${l}/${u}`):new B.Notice("\u274C \u53D1\u5E03\u5931\u8D25")),await this.savePublishRecord(e,i,a),a}catch(s){throw console.error("Publish error:",s),r&&new B.Notice(`\u274C \u53D1\u5E03\u5931\u8D25\uFF1A${s.message}`),s}}async quickPublish(e){if(this.settings.defaultPlatforms.length===0){new B.Notice("\u8BF7\u5148\u5728\u8BBE\u7F6E\u4E2D\u914D\u7F6E\u9ED8\u8BA4\u53D1\u5E03\u5E73\u53F0");return}await this.publishToMultiplePlatforms(e,this.settings.defaultPlatforms)}async activateHistoryView(){let{workspace:e}=this.app,t=e.getLeavesOfType(se)[0];if(!t){let r=e.getRightLeaf(!1);r&&(await r.setViewState({type:se,active:!0}),t=r)}t&&e.revealLeaf(t)}async savePublishRecord(e,t,r){let s={id:Date.now().toString(),noteId:e.path,notePath:e.path,noteTitle:t.title||e.basename,platforms:t.platforms,timestamp:Date.now(),results:{}};r.forEach((o,i)=>{let a=t.platforms[i];s.results[a]=o}),this.settings.publishHistory.unshift(s),this.settings.publishHistory.length>100&&(this.settings.publishHistory=this.settings.publishHistory.slice(0,100)),await this.saveSettings()}getServerUrl(){return`${this.settings.serverUrl}:${this.settings.serverPort}`}};
