/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Is=Object.defineProperty;var El=Object.getOwnPropertyDescriptor;var xl=Object.getOwnPropertyNames;var Al=Object.prototype.hasOwnProperty;var xi=(t,e)=>{for(var r in e)Is(t,r,{get:e[r],enumerable:!0})},Sl=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of xl(e))!Al.call(t,s)&&s!==r&&Is(t,s,{get:()=>e[s],enumerable:!(n=El(e,s))||n.enumerable});return t};var Rl=t=>Sl(Is({},"__esModule",{value:!0}),t);var Hh={};xi(Hh,{default:()=>Ts});module.exports=Rl(Hh);var bl=require("obsidian");var Ut=require("obsidian");var gn=require("obsidian"),Ai=["callout"],Bt=async(t,e)=>{var p;let r=t.workspace.getActiveFile();if(!r)throw new Error("No active file");let n=t.metadataCache,s=t.vault,o=await s.cachedRead(r),i=r.path,a=n.getFileCache(r);if(!a)throw new Error("No cached metadata found");let c=((p=a.sections)==null?void 0:p.filter(d=>Ai.includes(d.type)))||[],l=(a.tags||[]).filter(d=>!c.some(y=>y.position.start.offset<=d.position.start.offset&&d.position.end.offset<=y.position.end.offset));console.debug("tagsInMeta",l);let f=Tl(a),u=e.providers.map(d=>d.tag),h={newChatTags:e.newChatTags,userTags:e.userTags,assistantTags:u,systemTags:e.systemTags};return{appMeta:n,vault:s,fileText:o,filePath:i,tagsInMeta:l,sectionsWithRefer:f,options:h}},Cl=async(t,e)=>{let{appMeta:r,vault:n,filePath:s}=t,{path:o,subpath:i}=(0,gn.parseLinktext)(e);console.debug("path",o,"subpath",i);let a=r.getFirstLinkpathDest(o,s);if(a===null)throw new Error("LinkText broken: "+e.substring(0,20));let c=r.getFileCache(a);if(c===null)throw new Error(`No metadata found: ${o} ${i}`);let l=await n.cachedRead(a);if(i){let f=(0,gn.resolveSubpath)(c,i);if(f===null)throw new Error(`no subpath data found: ${i}`);return l.substring(f.start.offset,f.end?f.end.offset:void 0)}else return l},Si=(t,e,r)=>{let{tagsInMeta:n,sectionsWithRefer:s,options:{userTags:o,assistantTags:i,systemTags:a}}=t,c=n.filter(u=>e<=u.position.start.offset&&u.position.end.offset<=r).map(u=>{let h=u.tag.slice(1).split("/")[0].toLowerCase(),p=o.some(d=>d.toLowerCase()===h)?"user":i.some(d=>d.toLowerCase()===h)?"assistant":a.some(d=>d.toLowerCase()===h)?"system":null;return p!=null?{tag:u.tag,role:p,lowerCaseTag:h,tagRange:[u.position.start.offset,u.position.end.offset],tagLine:u.position.start.line}:null}).filter(u=>u!==null);console.debug("tags",c);let f=c.map((u,h)=>[u.tagRange[0],c[h+1]?c[h+1].tagRange[0]-1:r]).map((u,h)=>({...c[h],contentRange:[c[h].tagRange[1]+2,c[h+1]?c[h+1].tagRange[0]-1:r],sections:s.filter(p=>p.position.end.offset<=u[1]&&(p.position.start.offset<u[0]?p.position.end.offset>u[0]:!0)),line:[c[h].tagLine,c[h+1]?c[h+1].tagLine-1:1/0]}));return console.debug("tagsWithSections",f),f},Ol=async(t,e,r)=>{let{fileText:n}=t,s=e.position.start.offset<=r[0]?r[0]:e.position.start.offset,o=e.position.end.offset,a=(await Promise.all(e.refers.map(async c=>({ref:c,text:await Cl(t,c.link)})))).reduce((c,{ref:l,text:f})=>({endOffset:l.position.end.offset,text:c.text+n.slice(c.endOffset,l.position.start.offset)+f}),{endOffset:s,text:""});return{text:a.text+n.slice(a.endOffset,o),range:[s,o]}},Ri=async(t,e)=>(await Promise.all(e.sections.map(s=>Ol(t,s,e.contentRange)))).map(s=>s.text).join(`

`).trim(),Ci=async(t,e,r)=>{let{tagsInMeta:n,options:{newChatTags:s}}=t,o=n.findLast(l=>s.some(f=>l.tag.slice(1).split("/")[0].toLowerCase()===f.toLowerCase())&&e<=l.position.start.offset&&l.position.end.offset<=r),i=o?o.position.end.offset:e,a=Si(t,i,r);return await Promise.all(a.map(async l=>({...l,content:await Ri(t,l)})))},Oi=(t,e)=>{let r=t.getCursor("to"),n=e.split(`
`),s={line:r.line+n.length-1,ch:n.length===1?r.ch+e.length:n[n.length-1].length};t.replaceRange(e,r),t.setCursor(s),t.scrollIntoView({from:s,to:s})},Tl=t=>{if(!t.sections)return[];let e=[...t.links||[],...t.embeds||[]].sort((n,s)=>n.position.start.offset-s.position.start.offset),r=t.sections.filter(n=>!Ai.includes(n.type)).map(n=>{let s=e.filter(o=>n.position.start.offset<=o.position.start.offset&&o.position.end.offset<=n.position.end.offset);return{...n,refers:s}});return console.debug("sectionsWithRefer",r),r},Ti=async t=>{let{tagsInMeta:e,options:{newChatTags:r}}=t,o=[0,...e.filter(c=>r.some(l=>c.tag.slice(1).split("/")[0].toLowerCase()===l.toLowerCase())).flatMap(c=>[c.position.start.offset-1,c.position.end.offset+1]),1/0],i=o.filter((c,l)=>l%2===0).map((c,l)=>({startOffset:c,endOffset:o[l*2+1]}));return console.debug("ranges",i),(await Promise.all(i.map(async c=>{let l=Si(t,c.startOffset,c.endOffset);return Promise.all(l.map(async u=>({...u,content:await Ri(t,u)})))}))).filter(c=>c.length>0)},Ii=(t,e)=>{let{tagsInMeta:r,sectionsWithRefer:n,options:{systemTags:s,userTags:o,assistantTags:i}}=t,a=[...s,...o,...i],c=r.filter(y=>a.some(g=>y.tag.slice(1).split("/")[0].toLowerCase()===g.toLowerCase()));console.debug("msgTagsInMeta",c);let l=c.findLastIndex(y=>y.position.start.line<=e);if(l<0)return[-1,-1];console.debug("msgTag",c[l]);let f=c[l].position.end.offset+2,u=l+1,h=u<c.length?c[u].position.start.offset:1/0;console.debug("nextTag",c[u]);let p=n.findLast(y=>y.position.end.offset<=h&&y.position.start.line>=e);if(!p)return[-1,-1];let d=p.position.end.offset;return console.debug("startOff",f,"endOffset",d),[f,d]};var Ps={Error:"Error","Export conversations to JSONL":"Export conversations to JSONL","No conversation found":"No conversation found","Exported to the same directory, Obsidian does not display the JSONL format. Please open with another software.":"Exported to the same directory, Obsidian does not display the JSONL format. Please open with another software.","Replace speaker with tag":"Replace speaker with tag","No speaker found":"No speaker found","Replace the names of the two most frequently occurring speakers with tag format.":"Replace the names of the two most frequently occurring speakers with tag format.",Replace:"Replace","Select message at cursor":"Select message at cursor","No message found at cursor":"No message found at cursor","API key is required":"API key is required","API secret is required":"API secret is required","Model is required":"Model is required","API URL is required":"API URL is required","AI assistants":"AI assistants","New AI assistant":"New AI assistant","Select assistant from dropdown and click 'Add'. For those compatible with the OpenAI protocol, you can select OpenAI.":"Select assistant from dropdown and click 'Add'. For those compatible with the OpenAI protocol, you can select OpenAI.",Add:"Add","Message tags":"Message tags","Keywords for tags in the text box are separated by spaces":"Keywords for tags in the text box are separated by spaces","New chat tags":"New chat tags","User message tags":"User message tags","System message tags":"System message tags","At least one tag is required":"At least one tag is required",tag:"tag","Trigger AI generation":"Trigger AI generation","Obtain key from ":"Obtain key from ","Web search":"Web search","Enable web search for AI":"Enable web search for AI","Enter your key":"Enter your key","Refer to the technical documentation":"Refer to the technical documentation","Keyword for tag must not contain #":"Keyword for tag must not contain #","Keyword for tag must not contain space":"Keyword for tag must not contain space","Keyword for tag must be unique":"Keyword for tag must be unique",Model:"Model","Select the model to use":"Select the model to use","Please input API key first":"Please input API key first","Input the model to use":"Input the model to use","Please enter a number":"Please enter a number","Minimum value is 256":"Minimum value is 256","Proxy URL":"Proxy URL","Invalid URL":"Invalid URL","Override input parameters":"Override input parameters",'Developer feature, in JSON format. e.g. {"model": "your model", "baseURL": "your url"}':'Developer feature, in JSON format. e.g. {"model": "your model", "baseURL": "your url"}',"Remove AI assistant":"Remove AI assistant",Remove:"Remove",Endpoint:"Endpoint","API version":"API version","AI generate":"AI generate","Text generated successfully":"Text generated successfully","No text generated":"No text generated","Check the developer console for error details. ":"Check the developer console for error details. ","This is a non-streaming request, please wait...":"This is a non-streaming request, please wait..."};var Pi={Error:"\u5F02\u5E38","Export conversations to JSONL":"\u5BFC\u51FA\u5BF9\u8BDD\u5230 JSONL","No conversation found":"\u6CA1\u6709\u627E\u5230\u5BF9\u8BDD","Exported to the same directory, Obsidian does not display the JSONL format. Please open with another software.":"\u5DF2\u7ECF\u5BFC\u51FA\u5230\u540C\u4E00\u76EE\u5F55\uFF0Cobsidian \u4E0D\u663E\u793A jsonl \u683C\u5F0F\uFF0C\u8BF7\u7528\u5176\u4ED6\u8F6F\u4EF6\u6253\u5F00","Replace speaker with tag":"\u628A\u8BF4\u8BDD\u8005\u66FF\u6362\u4E3A\u6807\u7B7E","No speaker found":"\u6CA1\u6709\u627E\u5230\u8BF4\u8BDD\u8005","Replace the names of the two most frequently occurring speakers with tag format.":"\u7528\u6807\u7B7E\u683C\u5F0F\u66FF\u6362\u4E24\u4E2A\u6700\u5E38\u51FA\u73B0\u7684\u8BF4\u8BDD\u8005\u7684\u540D\u5B57",Replace:"\u66FF\u6362","Select message at cursor":"\u9009\u62E9\u5149\u6807\u5904\u7684\u6D88\u606F","No message found at cursor":"\u5149\u6807\u5904\u6CA1\u6709\u627E\u5230\u6D88\u606F","API key is required":"\u8BF7\u914D\u7F6E\u5BF9\u5E94\u7684 API key","API secret is required":"\u8BF7\u914D\u7F6E\u5BF9\u5E94\u7684 API secret","Model is required":"\u8BF7\u914D\u7F6E\u5BF9\u5E94\u7684\u6A21\u578B","API URL is required":"\u8BF7\u914D\u7F6E\u5BF9\u5E94\u7684 API URL","AI assistants":"AI \u52A9\u624B","New AI assistant":"\u65B0\u7684AI\u52A9\u624B","Select assistant from dropdown and click 'Add'. For those compatible with the OpenAI protocol, you can select OpenAI.":"\u4ECE\u4E0B\u62C9\u6846\u9009\u62E9\u52A9\u624B\u7C7B\u578B\uFF0C\u70B9\u51FB\u65B0\u589E\u6309\u94AE\u3002\u5BF9\u4E8E\u517C\u5BB9OpenAI\u534F\u8BAE\u7684\uFF0C\u53EF\u4EE5\u9009\u62E9OpenAI.",Add:"\u65B0\u589E","Message tags":"\u6D88\u606F\u6807\u7B7E","Keywords for tags in the text box are separated by spaces":"\u5728\u6587\u672C\u6846\u4E2D\u7684\u6807\u7B7E\u5173\u952E\u5B57\u7528\u7A7A\u683C\u5206\u9694","New chat tags":"\u65B0\u5BF9\u8BDD\u7684\u6807\u7B7E","User message tags":"\u7528\u6237\u6D88\u606F\u7684\u6807\u7B7E","System message tags":"\u7CFB\u7EDF\u6D88\u606F\u7684\u6807\u7B7E","At least one tag is required":"\u81F3\u5C11\u9700\u8981\u4E00\u4E2A\u6807\u7B7E",tag:"\u6807\u7B7E","Trigger AI generation":"\u89E6\u53D1AI\u751F\u6210","Obtain key from ":"\u83B7\u53D6 key \u7F51\u7AD9 ","Web search":"\u7F51\u7EDC\u641C\u7D22","Enable web search for AI":"\u4E3A\u5F53\u524D AI \u542F\u7528\u7F51\u7EDC\u641C\u7D22","Enter your key":"\u8F93\u5165\u4F60\u7684 key","Refer to the technical documentation":"\u53C2\u8003\u6280\u672F\u6587\u6863","Keyword for tag must not contain #":"\u6807\u7B7E\u5173\u952E\u5B57\u4E0D\u80FD\u5305\u542B#","Keyword for tag must not contain space":"\u6807\u7B7E\u5173\u952E\u5B57\u4E0D\u80FD\u5305\u542B\u7A7A\u683C","Keyword for tag must be unique":"\u6807\u7B7E\u5173\u952E\u5B57\u5FC5\u987B\u552F\u4E00",Model:"\u6A21\u578B","Select the model to use":"\u9009\u62E9\u8981\u4F7F\u7528\u7684\u6A21\u578B","Please input API key first":"\u8BF7\u5148\u8F93\u5165API key","Input the model to use":"\u8F93\u5165\u8981\u4F7F\u7528\u7684\u6A21\u578B","Please enter a number":"\u8BF7\u8F93\u5165\u4E00\u4E2A\u6570\u5B57","Minimum value is 256":"\u6700\u5C0F\u503C\u662F256","Proxy URL":"\u4EE3\u7406 URL","Invalid URL":"\u65E0\u6548\u7684 URL","Override input parameters":"\u8986\u76D6\u8F93\u5165\u53C2\u6570",'Developer feature, in JSON format. e.g. {"model": "your model", "baseURL": "your url"}':'\u5F00\u53D1\u8005\u529F\u80FD\uFF0C\u4EE5 JSON \u683C\u5F0F\u3002\u4F8B\u5982 {"model": "\u4F60\u60F3\u8981\u7684model", "baseURL": "\u81EA\u5B9A\u4E49\u5730\u5740"}',"Remove AI assistant":"\u79FB\u9664 AI \u52A9\u624B",Remove:"\u79FB\u9664",Endpoint:"\u7EC8\u7ED3\u70B9","API version":"API \u7248\u672C","AI generate":"AI \u751F\u6210","Text generated successfully":"\u6587\u672C\u751F\u6210\u6210\u529F","No text generated":"\u6CA1\u6709\u751F\u6210\u6587\u672C","Check the developer console for error details. ":"\u67E5\u770B\u5F00\u53D1\u8005\u63A7\u5236\u53F0\u4E86\u89E3\u9519\u8BEF. ","This is a non-streaming request, please wait...":"\u8FD9\u662F\u4E00\u4E2A\u975E\u6D41\u5F0F\u8BF7\u6C42\uFF0C\u8BF7\u7A0D\u5019..."};var vi={};var Il={en:Ps,"zh-TW":vi,zh:Pi},Ni=window.localStorage.getItem("language"),vs=Il[Ni||"en"];function b(t){return vs||console.error("Error: locale not found",Ni),vs&&vs[t]||Ps[t]}var ki=(t,e)=>({id:"export-to-jsonl",name:b("Export conversations to JSONL"),callback:async()=>{await Pl(t,e)}}),Pl=async(t,e)=>{var f,u,h;let r=await Bt(t,e),n=await Ti(r);console.debug("conversations",n);let s=[];try{s=n.map(vl)}catch(p){console.error("error",p),new Ut.Notice(`\u{1F534}${b("Error")}: ${p}`,10*1e3);return}if(s.length===0){new Ut.Notice(b("No conversation found"));return}let o=s.map(p=>JSON.stringify(p)).join(`
`),i=(u=(f=t.workspace.getActiveFile())==null?void 0:f.parent)==null?void 0:u.path,a=(h=t.workspace.getActiveFile())==null?void 0:h.basename,c=(0,Ut.normalizePath)(`${i}/${a}.jsonl`),l=t.vault.getFileByPath(c);l?await t.vault.process(l,p=>o):await t.vault.create(c,o),new Ut.Notice(b("Exported to the same directory, Obsidian does not display the JSONL format. Please open with another software."),5*1e3)},vl=t=>{var c,l;let e=t.slice();if(e.length<2)throw new Error("No conversation");let r=null;((c=e.first())==null?void 0:c.role)==="system"&&(r=(l=e.shift())==null?void 0:l.content);let n=[];for(;e.length>0;){let f=e.shift(),u=e.shift();if((f==null?void 0:f.role)!=="user"||(u==null?void 0:u.role)!=="assistant")throw new Error("Invalid message role");if((f==null?void 0:f.content.trim().length)===0||(u==null?void 0:u.content.trim().length)===0)throw new Error("Empty message content");n.push([f.content,u.content])}let s=n.pop();if(!s)throw new Error("No conversation");let[o,i]=s,a={system:r,query:o,response:i,history:n.length>0?n:null};return Object.fromEntries(Object.entries(a).filter(([f,u])=>u!=null))};var ct=require("obsidian");var Mi=t=>({id:"replace-tag",name:b("Replace speaker with tag"),callback:async()=>{let e=t.workspace.getActiveFile();if(!e)return;let r=await t.vault.cachedRead(e),n=Ml(r);if(n.length<1){new ct.Notice(b("No speaker found"));return}console.debug("twoMostFrequentSpeakers",n);let s=n.map(o=>({original:o.name,count:o.count,newTag:Nl(o.name)}));new Ns(t,s,async o=>{await t.vault.process(e,i=>Ll(i,o))}).open()}}),Nl=t=>t.trim().startsWith("#")?t:"#"+t.trim().replace(/\s(?!:)/g,"-"),Ns=class extends ct.Modal{constructor(r,n,s){super(r);this.recommendTags=n,this.onSubmit=s}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:b("Replace speaker with tag")}),r.createEl("p",{text:b("Replace the names of the two most frequently occurring speakers with tag format.")});for(let n of this.recommendTags)new ct.Setting(r).setName(n.original+` (${n.count})`).addText(s=>s.setPlaceholder(n.newTag).setValue(n.newTag).onChange(async o=>{n.newTag=o}));new ct.Setting(r).addButton(n=>n.setButtonText(b("Replace")).setCta().onClick(async()=>{this.close(),await this.onSubmit(this.recommendTags)}))}},kl=t=>t.reduce((e,r)=>(e[r]=(e[r]||0)+1,e),{}),Ml=t=>{let r=t.split(`
`).map(a=>a.match(/^([\u4e00-\u9fa5a-zA-Z0-9# ]+)([:|：]) /g)).flatMap(a=>a||[]);console.debug("allMatches",r);let n=kl(r),s=Object.entries(n).sort((a,c)=>c[1]-a[1]);console.debug("sortedMatchFrequencies",s);let[o,i]=s.slice(0,2);return!o||!i?[]:[{name:o[0],count:o[1]},{name:i[0],count:i[1]}]},Ll=(t,e)=>(e.forEach(({original:r,newTag:n})=>{t=t.replace(new RegExp(`^${r}`,"g"),`${n}`).replace(new RegExp(`
${r}`,"g"),`
${n}`)}),t);var Li=require("obsidian");var Di=(t,e)=>({id:"select-message-at-cursor",name:b("Select message at cursor"),editorCallback:async(r,n)=>{let s=await Bt(t,e),o=r.getCursor("to").line,[i,a]=Ii(s,o);if(i===-1||a===-1){new Li.Notice(b("No message found at cursor"));return}r.setSelection(r.offsetToPos(i),r.offsetToPos(a))}});var k=require("obsidian");var Fi=require("obsidian"),yn=class extends Fi.FuzzySuggestModal{constructor(r,n,s){super(r);this.models=n,this.onChoose=s}getItems(){return this.models}getItemText(r){return r}renderSuggestion(r,n){let s=r.item,o=0,i=n.createEl("div");for(let a of r.match.matches){let c=s.slice(o,a[0]),l=s.slice(a[0],a[0]+a[1]);i.createEl("span",{text:c}),i.createEl("span",{text:l,attr:{style:"font-weight: bold;"}}),o=a[0]+a[1]}i.createEl("span",{text:s.slice(o)})}onChooseItem(r,n){this.onChoose(r)}};var X=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},te={searchParams:"URLSearchParams"in X,iterable:"Symbol"in X&&"iterator"in Symbol,blob:"FileReader"in X&&"Blob"in X&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in X,arrayBuffer:"ArrayBuffer"in X};function Dl(t){return t&&DataView.prototype.isPrototypeOf(t)}te.arrayBuffer&&(Bi=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],$i=ArrayBuffer.isView||function(t){return t&&Bi.indexOf(Object.prototype.toString.call(t))>-1});var Bi,$i;function $t(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function Ms(t){return typeof t!="string"&&(t=String(t)),t}function Ls(t){var e={next:function(){var r=t.shift();return{done:r===void 0,value:r}}};return te.iterable&&(e[Symbol.iterator]=function(){return e}),e}function K(t){this.map={},t instanceof K?t.forEach(function(e,r){this.append(r,e)},this):Array.isArray(t)?t.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}K.prototype.append=function(t,e){t=$t(t),e=Ms(e);var r=this.map[t];this.map[t]=r?r+", "+e:e};K.prototype.delete=function(t){delete this.map[$t(t)]};K.prototype.get=function(t){return t=$t(t),this.has(t)?this.map[t]:null};K.prototype.has=function(t){return this.map.hasOwnProperty($t(t))};K.prototype.set=function(t,e){this.map[$t(t)]=Ms(e)};K.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)};K.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),Ls(t)};K.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),Ls(t)};K.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),Ls(t)};te.iterable&&(K.prototype[Symbol.iterator]=K.prototype.entries);function ks(t){if(!t._noBody){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}}function ji(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function Fl(t){var e=new FileReader,r=ji(e);return e.readAsArrayBuffer(t),r}function Bl(t){var e=new FileReader,r=ji(e),n=/charset=([A-Za-z0-9_-]+)/.exec(t.type),s=n?n[1]:"utf-8";return e.readAsText(t,s),r}function Ul(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}function Ui(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function qi(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:te.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:te.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:te.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():te.arrayBuffer&&te.blob&&Dl(t)?(this._bodyArrayBuffer=Ui(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):te.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||$i(t))?this._bodyArrayBuffer=Ui(t):this._bodyText=t=Object.prototype.toString.call(t):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):te.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},te.blob&&(this.blob=function(){var t=ks(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=ks(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(te.blob)return this.blob().then(Fl);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var t=ks(this);if(t)return t;if(this._bodyBlob)return Bl(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Ul(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},te.formData&&(this.formData=function(){return this.text().then(ql)}),this.json=function(){return this.text().then(JSON.parse)},this}var $l=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function jl(t){var e=t.toUpperCase();return $l.indexOf(e)>-1?e:t}function ut(t,e){if(!(this instanceof ut))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var r=e.body;if(t instanceof ut){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new K(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!r&&t._bodyInit!=null&&(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new K(e.headers)),this.method=jl(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in X){var o=new AbortController;return o.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var n=/([?&])_=[^&]*/;if(n.test(this.url))this.url=this.url.replace(n,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}ut.prototype.clone=function(){return new ut(this,{body:this._bodyInit})};function ql(t){var e=new FormData;return t.trim().split("&").forEach(function(r){if(r){var n=r.split("="),s=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(o))}}),e}function Hl(t){var e=new K,r=t.replace(/\r?\n[\t ]+/g," ");return r.split("\r").map(function(n){return n.indexOf(`
`)===0?n.substr(1,n.length):n}).forEach(function(n){var s=n.split(":"),o=s.shift().trim();if(o){var i=s.join(":").trim();try{e.append(o,i)}catch(a){console.warn("Response "+a.message)}}}),e}qi.call(ut.prototype);function be(t,e){if(!(this instanceof be))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new K(e.headers),this.url=e.url||"",this._initBody(t)}qi.call(be.prototype);be.prototype.clone=function(){return new be(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new K(this.headers),url:this.url})};be.error=function(){var t=new be(null,{status:200,statusText:""});return t.ok=!1,t.status=0,t.type="error",t};var Kl=[301,302,303,307,308];be.redirect=function(t,e){if(Kl.indexOf(e)===-1)throw new RangeError("Invalid status code");return new be(null,{status:e,headers:{location:t}})};var lt=X.DOMException;try{new lt}catch(t){lt=function(e,r){this.message=e,this.name=r;var n=Error(e);this.stack=n.stack},lt.prototype=Object.create(Error.prototype),lt.prototype.constructor=lt}function Hi(t,e){return new Promise(function(r,n){var s=new ut(t,e);if(s.signal&&s.signal.aborted)return n(new lt("Aborted","AbortError"));var o=new XMLHttpRequest;function i(){o.abort()}o.onload=function(){var l={statusText:o.statusText,headers:Hl(o.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(o.status<200||o.status>599)?l.status=200:l.status=o.status,l.url="responseURL"in o?o.responseURL:l.headers.get("X-Request-URL");var f="response"in o?o.response:o.responseText;setTimeout(function(){r(new be(f,l))},0)},o.onerror=function(){setTimeout(function(){n(new TypeError("Network request failed"))},0)},o.ontimeout=function(){setTimeout(function(){n(new TypeError("Network request timed out"))},0)},o.onabort=function(){setTimeout(function(){n(new lt("Aborted","AbortError"))},0)};function a(l){try{return l===""&&X.location.href?X.location.href:l}catch(f){return l}}if(o.open(s.method,a(s.url),!0),s.credentials==="include"?o.withCredentials=!0:s.credentials==="omit"&&(o.withCredentials=!1),"responseType"in o&&(te.blob?o.responseType="blob":te.arrayBuffer&&(o.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof K||X.Headers&&e.headers instanceof X.Headers)){var c=[];Object.getOwnPropertyNames(e.headers).forEach(function(l){c.push($t(l)),o.setRequestHeader(l,Ms(e.headers[l]))}),s.headers.forEach(function(l,f){c.indexOf(f)===-1&&o.setRequestHeader(f,l)})}else s.headers.forEach(function(l,f){o.setRequestHeader(f,l)});s.signal&&(s.signal.addEventListener("abort",i),o.onreadystatechange=function(){o.readyState===4&&s.signal.removeEventListener("abort",i)}),o.send(typeof s._bodyInit=="undefined"?null:s._bodyInit)})}Hi.polyfill=!0;X.fetch||(X.fetch=Hi,X.Headers=K,X.Request=ut,X.Response=be);var Wl="0.5.13",Wi="11434",Ji=`http://127.0.0.1:${Wi}`,Jl=Object.defineProperty,Vl=(t,e,r)=>e in t?Jl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ds=(t,e,r)=>(Vl(t,typeof e!="symbol"?e+"":e,r),r),Ir=class extends Error{constructor(e,r){super(e),this.error=e,this.status_code=r,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,Ir)}},Bs=class{constructor(e,r,n){Ds(this,"abortController"),Ds(this,"itr"),Ds(this,"doneCallback"),this.abortController=e,this.itr=r,this.doneCallback=n}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},Us=async t=>{var n;if(t.ok)return;let e=`Error ${t.status}: ${t.statusText}`,r=null;if((n=t.headers.get("content-type"))!=null&&n.includes("application/json"))try{r=await t.json(),e=r.error||e}catch(s){console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await t.text()||e}catch(s){console.log("Failed to get text from error response")}throw new Ir(e,t.status)};function Gl(){return typeof window!="undefined"&&window.navigator?`${window.navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:typeof process!="undefined"?`${process.arch} ${process.platform} Node.js/${process.version}`:""}var $s=async(t,e,r={})=>{let n={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Wl} (${Gl()})`};r.headers||(r.headers={});let s=Object.fromEntries(Object.entries(r.headers).filter(([o])=>!Object.keys(n).some(i=>i.toLowerCase()===o.toLowerCase())));return r.headers={...n,...s},t(e,r)},Ki=async(t,e,r)=>{let n=await $s(t,e,{headers:r==null?void 0:r.headers});return await Us(n),n},jt=async(t,e,r,n)=>{let o=(a=>a!==null&&typeof a=="object"&&!Array.isArray(a))(r)?JSON.stringify(r):r,i=await $s(t,e,{method:"POST",body:o,signal:n==null?void 0:n.signal,headers:n==null?void 0:n.headers});return await Us(i),i},zl=async(t,e,r,n)=>{let s=await $s(t,e,{method:"DELETE",body:JSON.stringify(r),headers:n==null?void 0:n.headers});return await Us(s),s},Xl=async function*(t){var s;let e=new TextDecoder("utf-8"),r="",n=t.getReader();for(;;){let{done:o,value:i}=await n.read();if(o)break;r+=e.decode(i);let a=r.split(`
`);r=(s=a.pop())!=null?s:"";for(let c of a)try{yield JSON.parse(c)}catch(l){console.warn("invalid json: ",c)}}for(let o of r.split(`
`).filter(i=>i!==""))try{yield JSON.parse(o)}catch(i){console.warn("invalid json: ",o)}},Yl=t=>{if(!t)return Ji;let e=t.includes("://");t.startsWith(":")&&(t=`http://127.0.0.1${t}`,e=!0),e||(t=`http://${t}`);let r=new URL(t),n=r.port;n||(e?n=r.protocol==="https:"?"443":"80":n=Wi);let s=`${r.protocol}//${r.hostname}:${n}${r.pathname}`;return s.endsWith("/")&&(s=s.slice(0,-1)),s},Ql=Object.defineProperty,Zl=(t,e,r)=>e in t?Ql(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fs=(t,e,r)=>(Zl(t,typeof e!="symbol"?e+"":e,r),r),js=class{constructor(e){var r,n;Fs(this,"config"),Fs(this,"fetch"),Fs(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=Yl((r=e==null?void 0:e.host)!=null?r:Ji)),this.fetch=(n=e==null?void 0:e.fetch)!=null?n:fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,r){var o;r.stream=(o=r.stream)!=null?o:!1;let n=`${this.config.host}/api/${e}`;if(r.stream){let i=new AbortController,a=await jt(this.fetch,n,r,{signal:i.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");let c=Xl(a.body),l=new Bs(i,c,()=>{let f=this.ongoingStreamedRequests.indexOf(l);f>-1&&this.ongoingStreamedRequests.splice(f,1)});return this.ongoingStreamedRequests.push(l),l}return await(await jt(this.fetch,n,r,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let r=new Uint8Array(e),n="",s=r.byteLength;for(let o=0;o<s;o++)n+=String.fromCharCode(r[o]);return btoa(n)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let r of e.messages)r.images&&(r.images=await Promise.all(r.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await zl(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await jt(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await Ki(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await jt(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await jt(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await jt(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await Ki(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},Ip=new js;var eu=t=>async function*(e){let{parameters:r,...n}=t,s={...n,...r},{baseURL:o,model:i,...a}=s,l=await new js({host:o}).chat({model:i,messages:e,stream:!0,...a});for await(let f of l)yield f.message.content},wn={name:"Ollama",defaultOptions:{apiKey:"",baseURL:"http://127.0.0.1:11434",model:"llama3.1",parameters:{}},sendRequestFunc:eu,models:[],websiteToObtainKey:"https://ollama.com"};var va=require("obsidian");var bn="RFC3986",_n={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},Vi="RFC1738";var tu=Array.isArray,_e=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();var qs=1024,Gi=(t,e,r,n,s)=>{if(t.length===0)return t;let o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let i="";for(let a=0;a<o.length;a+=qs){let c=o.length>=qs?o.slice(a,a+qs):o,l=[];for(let f=0;f<c.length;++f){let u=c.charCodeAt(f);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===Vi&&(u===40||u===41)){l[l.length]=c.charAt(f);continue}if(u<128){l[l.length]=_e[u];continue}if(u<2048){l[l.length]=_e[192|u>>6]+_e[128|u&63];continue}if(u<55296||u>=57344){l[l.length]=_e[224|u>>12]+_e[128|u>>6&63]+_e[128|u&63];continue}f+=1,u=65536+((u&1023)<<10|c.charCodeAt(f)&1023),l[l.length]=_e[240|u>>18]+_e[128|u>>12&63]+_e[128|u>>6&63]+_e[128|u&63]}i+=l.join("")}return i};function zi(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Hs(t,e){if(tu(t)){let r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}var ru=Object.prototype.hasOwnProperty,Xi={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Ee=Array.isArray,nu=Array.prototype.push,Yi=function(t,e){nu.apply(t,Ee(e)?e:[e])},su=Date.prototype.toISOString,W={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Gi,encodeValuesOnly:!1,format:bn,formatter:_n[bn],indices:!1,serializeDate(t){return su.call(t)},skipNulls:!1,strictNullHandling:!1};function ou(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var Ks={};function Qi(t,e,r,n,s,o,i,a,c,l,f,u,h,p,d,y,g,_){let w=t,S=_,v=0,x=!1;for(;(S=S.get(Ks))!==void 0&&!x;){let M=S.get(t);if(v+=1,typeof M!="undefined"){if(M===v)throw new RangeError("Cyclic object value");x=!0}typeof S.get(Ks)=="undefined"&&(v=0)}if(typeof l=="function"?w=l(e,w):w instanceof Date?w=h==null?void 0:h(w):r==="comma"&&Ee(w)&&(w=Hs(w,function(M){return M instanceof Date?h==null?void 0:h(M):M})),w===null){if(o)return c&&!y?c(e,W.encoder,g,"key",p):e;w=""}if(ou(w)||zi(w)){if(c){let M=y?e:c(e,W.encoder,g,"key",p);return[(d==null?void 0:d(M))+"="+(d==null?void 0:d(c(w,W.encoder,g,"value",p)))]}return[(d==null?void 0:d(e))+"="+(d==null?void 0:d(String(w)))]}let T=[];if(typeof w=="undefined")return T;let P;if(r==="comma"&&Ee(w))y&&c&&(w=Hs(w,c)),P=[{value:w.length>0?w.join(",")||null:void 0}];else if(Ee(l))P=l;else{let M=Object.keys(w);P=f?M.sort(f):M}let N=a?String(e).replace(/\./g,"%2E"):String(e),I=n&&Ee(w)&&w.length===1?N+"[]":N;if(s&&Ee(w)&&w.length===0)return I+"[]";for(let M=0;M<P.length;++M){let B=P[M],D=typeof B=="object"&&typeof B.value!="undefined"?B.value:w[B];if(i&&D===null)continue;let fe=u&&a?B.replace(/\./g,"%2E"):B,Ne=Ee(w)?typeof r=="function"?r(I,fe):I:I+(u?"."+fe:"["+fe+"]");_.set(t,v);let oe=new WeakMap;oe.set(Ks,_),Yi(T,Qi(D,Ne,r,n,s,o,i,a,r==="comma"&&y&&Ee(w)?null:c,l,f,u,h,p,d,y,g,oe))}return T}function iu(t=W){if(typeof t.allowEmptyArrays!="undefined"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys!="undefined"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder!="undefined"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||W.charset;if(typeof t.charset!="undefined"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=bn;if(typeof t.format!="undefined"){if(!ru.call(_n,t.format))throw new TypeError("Unknown format option provided.");r=t.format}let n=_n[r],s=W.filter;(typeof t.filter=="function"||Ee(t.filter))&&(s=t.filter);let o;if(t.arrayFormat&&t.arrayFormat in Xi?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=W.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof t.allowDots=="undefined"?t.encodeDotInKeys?!0:W.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:W.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:W.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:W.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter=="undefined"?W.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:W.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:W.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:W.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:W.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:W.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:W.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:W.strictNullHandling}}function Ws(t,e={}){let r=t,n=iu(e),s,o;typeof n.filter=="function"?(o=n.filter,r=o("",r)):Ee(n.filter)&&(o=n.filter,s=o);let i=[];if(typeof r!="object"||r===null)return"";let a=Xi[n.arrayFormat],c=a==="comma"&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);let l=new WeakMap;for(let h=0;h<s.length;++h){let p=s[h];n.skipNulls&&r[p]===null||Yi(i,Qi(r[p],p,a,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let f=i.join(n.delimiter),u=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),f.length>0?u+f:""}var ft="4.85.0";var Zi=!1,dt,Js,cu,lu,uu,Vs,fu,En,Gs,zs,Xs,xn,Ys;function ea(t,e={auto:!1}){if(Zi)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(dt)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${dt}'\``);Zi=e.auto,dt=t.kind,Js=t.fetch,cu=t.Request,lu=t.Response,uu=t.Headers,Vs=t.FormData,fu=t.Blob,En=t.File,Gs=t.ReadableStream,zs=t.getMultipartRequestOptions,Xs=t.getDefaultAgent,xn=t.fileFromPath,Ys=t.isFsReadStream}var An=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function ta({manuallyImported:t}={}){let e=t?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",r,n,s,o;try{r=fetch,n=Request,s=Response,o=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:r,Request:n,Response:s,Headers:o,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,a)=>({...a,body:new An(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}dt||ea(ta(),{auto:!0});var R=class extends Error{},q=class extends R{constructor(e,r,n,s){super(`${q.makeMessage(e,r,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=r;let o=r;this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(e,r,n){let s=r!=null&&r.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,r,n,s){if(!e||!s)return new He({message:n,cause:Sn(r)});let o=r==null?void 0:r.error;return e===400?new Pr(e,o,n,s):e===401?new vr(e,o,n,s):e===403?new Nr(e,o,n,s):e===404?new kr(e,o,n,s):e===409?new Mr(e,o,n,s):e===422?new Lr(e,o,n,s):e===429?new Dr(e,o,n,s):e>=500?new Fr(e,o,n,s):new q(e,o,n,s)}},G=class extends q{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},He=class extends q{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),r&&(this.cause=r)}},Ke=class extends He{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Pr=class extends q{},vr=class extends q{},Nr=class extends q{},kr=class extends q{},Mr=class extends q{},Lr=class extends q{},Dr=class extends q{},Fr=class extends q{},qt=class extends R{constructor(){super("Could not parse response content as the length limit was reached")}},Ht=class extends R{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Rn=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},ht=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},ie,pt=class{constructor(){ie.set(this,void 0),this.buffer=new Uint8Array,Rn(this,ie,null,"f")}decode(e){if(e==null)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,n=new Uint8Array(this.buffer.length+r.length);n.set(this.buffer),n.set(r,this.buffer.length),this.buffer=n;let s=[],o;for(;(o=pu(this.buffer,ht(this,ie,"f")))!=null;){if(o.carriage&&ht(this,ie,"f")==null){Rn(this,ie,o.index,"f");continue}if(ht(this,ie,"f")!=null&&(o.index!==ht(this,ie,"f")+1||o.carriage)){s.push(this.decodeText(this.buffer.slice(0,ht(this,ie,"f")-1))),this.buffer=this.buffer.slice(ht(this,ie,"f")),Rn(this,ie,null,"f");continue}let i=ht(this,ie,"f")!==null?o.preceding-1:o.preceding,a=this.decodeText(this.buffer.slice(0,i));s.push(a),this.buffer=this.buffer.slice(o.index),Rn(this,ie,null,"f")}return s}decodeText(e){var r;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new R(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(r=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new R(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new R("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};ie=new WeakMap;pt.NEWLINE_CHARS=new Set([`
`,"\r"]);pt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function pu(t,e){for(let s=e!=null?e:0;s<t.length;s++){if(t[s]===10)return{preceding:s,index:s+1,carriage:!1};if(t[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Qs(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r!=null&&r.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var re=class{constructor(e,r){this.iterator=e,this.controller=r}static fromSSEResponse(e,r){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(let i of mu(e,r))if(!o){if(i.data.startsWith("[DONE]")){o=!0;continue}if(i.event===null){let a;try{a=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(a&&a.error)throw new q(void 0,a.error,void 0,void 0);yield a}else{let a;try{a=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new q(void 0,a.error,a.message,void 0);yield{event:i.event,data:a}}}o=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{o||r.abort()}}return new re(s,r)}static fromReadableStream(e,r){let n=!1;async function*s(){let i=new pt,a=Qs(e);for await(let c of a)for(let l of i.decode(c))yield l;for(let c of i.flush())yield c}async function*o(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of s())i||a&&(yield JSON.parse(a));i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||r.abort()}}return new re(o,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],r=[],n=this.iterator(),s=o=>({next:()=>{if(o.length===0){let i=n.next();e.push(i),r.push(i)}return o.shift()}});return[new re(()=>s(e),this.controller),new re(()=>s(r),this.controller)]}toReadableStream(){let e=this,r,n=new TextEncoder;return new Gs({async start(){r=e[Symbol.asyncIterator]()},async pull(s){try{let{value:o,done:i}=await r.next();if(i)return s.close();let a=n.encode(JSON.stringify(o)+`
`);s.enqueue(a)}catch(o){s.error(o)}},async cancel(){var s;await((s=r.return)==null?void 0:s.call(r))}})}};async function*mu(t,e){if(!t.body)throw e.abort(),new R("Attempted to iterate over a response with no body");let r=new Zs,n=new pt,s=Qs(t.body);for await(let o of gu(s))for(let i of n.decode(o)){let a=r.decode(i);a&&(yield a)}for(let o of n.flush()){let i=r.decode(o);i&&(yield i)}}async function*gu(t){let e=new Uint8Array;for await(let r of t){if(r==null)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?new TextEncoder().encode(r):r,s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let o;for(;(o=yu(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}function yu(t){for(let n=0;n<t.length-2;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}var Zs=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,s]=wu(e,":");return s.startsWith(" ")&&(s=s.substring(1)),r==="event"?this.event=s:r==="data"&&this.data.push(s),null}};function wu(t,e){let r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}var ra=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",na=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Br(t),Br=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",bu=t=>na(t)||ra(t)||Ys(t);async function ro(t,e,r){var s,o,i;if(t=await t,na(t))return t;if(ra(t)){let a=await t.blob();e||(e=(s=new URL(t.url).pathname.split(/[\\/]/).pop())!=null?s:"unknown_file");let c=Br(a)?[await a.arrayBuffer()]:[a];return new En(c,e,r)}let n=await _u(t);if(e||(e=(o=xu(t))!=null?o:"unknown_file"),!(r!=null&&r.type)){let a=(i=n[0])==null?void 0:i.type;typeof a=="string"&&(r={...r,type:a})}return new En(n,e,r)}async function _u(t){var r;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Br(t))e.push(await t.arrayBuffer());else if(Au(t))for await(let n of t)e.push(n);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(r=t==null?void 0:t.constructor)==null?void 0:r.name}; props: ${Eu(t)}`);return e}function Eu(t){return`[${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}function xu(t){var e;return eo(t.name)||eo(t.filename)||((e=eo(t.path))==null?void 0:e.split(/[\\/]/).pop())}var eo=t=>{if(typeof t=="string")return t;if(typeof Buffer!="undefined"&&t instanceof Buffer)return String(t)},Au=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",no=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody";var de=async t=>{let e=await sa(t.body);return zs(e,t)},sa=async t=>{let e=new Vs;return await Promise.all(Object.entries(t||{}).map(([r,n])=>to(e,r,n))),e};var to=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(bu(r)){let n=await ro(r);t.append(e,n)}else if(Array.isArray(r))await Promise.all(r.map(n=>to(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,s])=>to(t,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var Ru=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},Cu=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Cn;async function la(t){let{response:e}=t;if(t.options.stream)return Kt("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):re.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let r=e.headers.get("content-type");if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.includes("application/vnd.api+json"))){let o=await e.json();return Kt("response",e.status,e.url,e.headers,o),ua(o,e)}let s=await e.text();return Kt("response",e.status,e.url,e.headers,s),s}function ua(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Wt=class extends Promise{constructor(e,r=la){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new Wt(this.responsePromise,async r=>ua(e(await this.parseResponse(r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},In=class{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:s,fetch:o}){this.baseURL=e,this.maxRetries=so("maxRetries",r),this.timeout=so("timeout",n),this.httpAgent=s,this.fetch=o!=null?o:Js}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...vu(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${Lu()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async s=>{let o=s&&Br(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:r,...s,body:o}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:r=0}={}){var d,y,g,_,w,S;e={...e};let{method:n,path:s,query:o,headers:i={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:no(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(a),l=this.buildURL(s,o);"timeout"in e&&so("timeout",e.timeout),e.timeout=(d=e.timeout)!=null?d:this.timeout;let f=(g=(y=e.httpAgent)!=null?y:this.httpAgent)!=null?g:Xs(l),u=e.timeout+1e3;typeof((_=f==null?void 0:f.options)==null?void 0:_.timeout)=="number"&&u>((w=f.options.timeout)!=null?w:0)&&(f.options.timeout=u),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let h=this.buildHeaders({options:e,headers:i,contentLength:c,retryCount:r});return{req:{method:n,...a&&{body:a},headers:h,...f&&{agent:f},signal:(S=e.signal)!=null?S:null},url:l,timeout:e.timeout}}buildHeaders({options:e,headers:r,contentLength:n,retryCount:s}){let o={};n&&(o["content-length"]=n);let i=this.defaultHeaders(e);return aa(o,i),aa(o,r),no(e.body)&&dt!=="node"&&delete o["content-type"],Tn(i,"x-stainless-retry-count")===void 0&&Tn(r,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(s)),Tn(i,"x-stainless-timeout")===void 0&&Tn(r,"x-stainless-timeout")===void 0&&e.timeout&&(o["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(o,r),o}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,s){return q.generate(e,r,n,s)}request(e,r=null){return new Wt(this.makeRequest(e,r))}async makeRequest(e,r){var u,h,p;let n=await e,s=(u=n.maxRetries)!=null?u:this.maxRetries;r==null&&(r=s),await this.prepareOptions(n);let{req:o,url:i,timeout:a}=this.buildRequest(n,{retryCount:s-r});if(await this.prepareRequest(o,{url:i,options:n}),Kt("request",i,n,o.headers),(h=n.signal)!=null&&h.aborted)throw new G;let c=new AbortController,l=await this.fetchWithTimeout(i,o,a,c).catch(Sn);if(l instanceof Error){if((p=n.signal)!=null&&p.aborted)throw new G;if(r)return this.retryRequest(n,r);throw l.name==="AbortError"?new Ke:new He({cause:l})}let f=Ou(l.headers);if(!l.ok){if(r&&this.shouldRetry(l)){let S=`retrying, ${r} attempts remaining`;return Kt(`response (error; ${S})`,l.status,i,f),this.retryRequest(n,r,f)}let d=await l.text().catch(S=>Sn(S).message),y=Nu(d),g=y?void 0:d;throw Kt(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,f,g),this.makeStatusError(l.status,y,g,f)}return{response:l,options:n,controller:c}}requestAPIList(e,r){let n=this.makeRequest(r,null);return new oo(this,n,e)}buildURL(e,r){let n=Mu(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return fa(s)||(r={...s,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n!="undefined").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new R(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,s){let{signal:o,...i}=r||{};o&&o.addEventListener("abort",()=>s.abort());let a=setTimeout(()=>s.abort(),n),c={signal:s.signal,...i};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(a)})}shouldRetry(e){let r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){var a;let s,o=n==null?void 0:n["retry-after-ms"];if(o){let c=parseFloat(o);Number.isNaN(c)||(s=c)}let i=n==null?void 0:n["retry-after"];if(i&&!s){let c=parseFloat(i);Number.isNaN(c)?s=Date.parse(i)-Date.now():s=c*1e3}if(!(s&&0<=s&&s<60*1e3)){let c=(a=e.maxRetries)!=null?a:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,c)}return await ke(s),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){let o=r-e,i=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return i*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ft}`}},Ur=class{constructor(e,r,n,s){Cn.set(this,void 0),Ru(this,Cn,e,"f"),this.options=s,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){let n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(let[s,o]of n)e.url.searchParams.set(s,o);r.query=void 0,r.path=e.url.toString()}return await Cu(this,Cn,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Cn=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}},oo=class extends Wt{constructor(e,r,n){super(r,async s=>new n(e,s.response,await la(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}},Ou=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){let n=r.toString();return e[n.toLowerCase()]||e[n]}}),Tu={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},L=t=>typeof t=="object"&&t!==null&&!fa(t)&&Object.keys(t).every(e=>da(Tu,e)),Iu=()=>{var e,r;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":ia(Deno.build.os),"X-Stainless-Arch":oa(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(r=(e=Deno.version)==null?void 0:e.deno)!=null?r:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":ia(process.platform),"X-Stainless-Arch":oa(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let t=Pu();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Pu(){if(typeof navigator=="undefined"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let s=n[1]||0,o=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${o}.${i}`}}}return null}var oa=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",ia=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),On,vu=()=>On!=null?On:On=Iu(),Nu=t=>{try{return JSON.parse(t)}catch(e){return}},ku=/^[a-z][a-z0-9+.-]*:/i,Mu=t=>ku.test(t),ke=t=>new Promise(e=>setTimeout(e,t)),so=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${t} must be an integer`);if(e<0)throw new R(`${t} must be a positive integer`);return e},Sn=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch(e){}return new Error(t)};var We=t=>{var e,r,n,s,o,i;if(typeof process!="undefined")return(n=(r=(e=process.env)==null?void 0:e[t])==null?void 0:r.trim())!=null?n:void 0;if(typeof Deno!="undefined")return(i=(o=(s=Deno.env)==null?void 0:s.get)==null?void 0:o.call(s,t))==null?void 0:i.trim()};function fa(t){if(!t)return!0;for(let e in t)return!1;return!0}function da(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function aa(t,e){for(let r in e){if(!da(e,r))continue;let n=r.toLowerCase();if(!n)continue;let s=e[r];s===null?delete t[n]:s!==void 0&&(t[n]=s)}}var ca=new Set(["authorization","api-key"]);function Kt(t,...e){var r;if(typeof process!="undefined"&&((r=process==null?void 0:process.env)==null?void 0:r.DEBUG)==="true"){let n=e.map(s=>{if(!s)return s;if(s.headers){let i={...s,headers:{...s.headers}};for(let a in s.headers)ca.has(a.toLowerCase())&&(i.headers[a]="REDACTED");return i}let o=null;for(let i in s)ca.has(i.toLowerCase())&&(o!=null||(o={...s}),o[i]="REDACTED");return o!=null?o:s});console.log(`OpenAI:DEBUG:${t}`,...n)}}var Lu=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),ha=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",Du=t=>typeof(t==null?void 0:t.get)=="function";var Tn=(t,e)=>{var n;let r=e.toLowerCase();if(Du(t)){let s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(o,i,a)=>i+a.toUpperCase());for(let o of[e,r,e.toUpperCase(),s]){let i=t.get(o);if(i)return i}}for(let[s,o]of Object.entries(t))if(s.toLowerCase()===r)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${e} header, using the first entry.`),o[0]):o};function Jt(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}var Pn=class extends Ur{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},U=class extends Ur{constructor(e,r,n,s){super(e,r,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let r=Object.fromEntries(e.url.searchParams);return Object.keys(r).length?r:null}nextPageInfo(){var n;let e=this.getPaginatedItems();if(!e.length)return null;let r=(n=e[e.length-1])==null?void 0:n.id;return r?{params:{after:r}}:null}};var E=class{constructor(e){this._client=e}};var Vt=class extends E{list(e,r={},n){return L(r)?this.list(e,{},r):this._client.getAPIList(`/chat/completions/${e}/messages`,vn,{query:r,...n})}};var Je=class extends E{constructor(){super(...arguments),this.messages=new Vt(this._client)}create(e,r){var n;return this._client.post("/chat/completions",{body:e,...r,stream:(n=e.stream)!=null?n:!1})}retrieve(e,r){return this._client.get(`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return L(e)?this.list({},e):this._client.getAPIList("/chat/completions",Ve,{query:e,...r})}del(e,r){return this._client.delete(`/chat/completions/${e}`,r)}},Ve=class extends U{},vn=class extends U{};Je.ChatCompletionsPage=Ve;Je.Messages=Vt;var Me=class extends E{constructor(){super(...arguments),this.completions=new Je(this._client)}};Me.Completions=Je;Me.ChatCompletionsPage=Ve;var Gt=class extends E{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:{Accept:"application/octet-stream",...r==null?void 0:r.headers},__binaryResponse:!0})}};var zt=class extends E{create(e,r){return this._client.post("/audio/transcriptions",de({body:e,...r,__metadata:{model:e.model}}))}};var Xt=class extends E{create(e,r){return this._client.post("/audio/translations",de({body:e,...r,__metadata:{model:e.model}}))}};var xe=class extends E{constructor(){super(...arguments),this.transcriptions=new zt(this._client),this.translations=new Xt(this._client),this.speech=new Gt(this._client)}};xe.Transcriptions=zt;xe.Translations=Xt;xe.Speech=Gt;var Ge=class extends E{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(`/batches/${e}`,r)}list(e={},r){return L(e)?this.list({},e):this._client.getAPIList("/batches",gt,{query:e,...r})}cancel(e,r){return this._client.post(`/batches/${e}/cancel`,r)}},gt=class extends U{};Ge.BatchesPage=gt;var yt=class extends E{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/assistants/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},r){return L(e)?this.list({},e):this._client.getAPIList("/assistants",Yt,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,r){return this._client.delete(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},Yt=class extends U{};yt.AssistantsPage=Yt;function io(t){return typeof t.parse=="function"}var ze=t=>(t==null?void 0:t.role)==="assistant",ao=t=>(t==null?void 0:t.role)==="function",co=t=>(t==null?void 0:t.role)==="tool";var pe=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},$=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},lo,Nn,kn,$r,jr,Mn,qr,Le,Hr,Ln,Dn,Qt,pa,Zt=class{constructor(){lo.add(this),this.controller=new AbortController,Nn.set(this,void 0),kn.set(this,()=>{}),$r.set(this,()=>{}),jr.set(this,void 0),Mn.set(this,()=>{}),qr.set(this,()=>{}),Le.set(this,{}),Hr.set(this,!1),Ln.set(this,!1),Dn.set(this,!1),Qt.set(this,!1),pe(this,Nn,new Promise((e,r)=>{pe(this,kn,e,"f"),pe(this,$r,r,"f")}),"f"),pe(this,jr,new Promise((e,r)=>{pe(this,Mn,e,"f"),pe(this,qr,r,"f")}),"f"),$(this,Nn,"f").catch(()=>{}),$(this,jr,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},$(this,lo,"m",pa).bind(this))},0)}_connected(){this.ended||($(this,kn,"f").call(this),this._emit("connect"))}get ended(){return $(this,Hr,"f")}get errored(){return $(this,Ln,"f")}get aborted(){return $(this,Dn,"f")}abort(){this.controller.abort()}on(e,r){return($(this,Le,"f")[e]||($(this,Le,"f")[e]=[])).push({listener:r}),this}off(e,r){let n=$(this,Le,"f")[e];if(!n)return this;let s=n.findIndex(o=>o.listener===r);return s>=0&&n.splice(s,1),this}once(e,r){return($(this,Le,"f")[e]||($(this,Le,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{pe(this,Qt,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){pe(this,Qt,!0,"f"),await $(this,jr,"f")}_emit(e,...r){if($(this,Hr,"f"))return;e==="end"&&(pe(this,Hr,!0,"f"),$(this,Mn,"f").call(this));let n=$(this,Le,"f")[e];if(n&&($(this,Le,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...r))),e==="abort"){let s=r[0];!$(this,Qt,"f")&&!(n!=null&&n.length)&&Promise.reject(s),$(this,$r,"f").call(this,s),$(this,qr,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=r[0];!$(this,Qt,"f")&&!(n!=null&&n.length)&&Promise.reject(s),$(this,$r,"f").call(this,s),$(this,qr,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Nn=new WeakMap,kn=new WeakMap,$r=new WeakMap,jr=new WeakMap,Mn=new WeakMap,qr=new WeakMap,Le=new WeakMap,Hr=new WeakMap,Ln=new WeakMap,Dn=new WeakMap,Qt=new WeakMap,lo=new WeakSet,pa=function(e){if(pe(this,Ln,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new G),e instanceof G)return pe(this,Dn,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){let r=new R(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new R(String(e)))};function uo(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function wt(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function ma(t,e){return!e||!fo(e)?{...t,choices:t.choices.map(r=>{var n;return{...r,message:{...r.message,parsed:null,tool_calls:(n=r.message.tool_calls)!=null?n:[]}}})}:Kr(t,e)}function Kr(t,e){let r=t.choices.map(n=>{var s,o;if(n.finish_reason==="length")throw new qt;if(n.finish_reason==="content_filter")throw new Ht;return{...n,message:{...n.message,tool_calls:(o=(s=n.message.tool_calls)==null?void 0:s.map(i=>Ku(e,i)))!=null?o:[],parsed:n.message.content&&!n.message.refusal?Hu(e,n.message.content):null}}});return{...t,choices:r}}function Hu(t,e){var r,n;return((r=t.response_format)==null?void 0:r.type)!=="json_schema"?null:((n=t.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function Ku(t,e){var n;let r=(n=t.tools)==null?void 0:n.find(s=>{var o;return((o=s.function)==null?void 0:o.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:wt(r)?r.$parseRaw(e.function.arguments):r!=null&&r.function.strict?JSON.parse(e.function.arguments):null}}}function ga(t,e){var n;if(!t)return!1;let r=(n=t.tools)==null?void 0:n.find(s=>{var o;return((o=s.function)==null?void 0:o.name)===e.function.name});return wt(r)||(r==null?void 0:r.function.strict)||!1}function fo(t){var e,r;return uo(t.response_format)?!0:(r=(e=t.tools)==null?void 0:e.some(n=>wt(n)||n.type==="function"&&n.function.strict===!0))!=null?r:!1}function ya(t){for(let e of t!=null?t:[]){if(e.type!=="function")throw new R(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new R(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var se=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Z,ho,Fn,po,mo,go,ba,yo,wa=10,er=class extends Zt{constructor(){super(...arguments),Z.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);let r=(n=e.choices[0])==null?void 0:n.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),(ao(e)||co(e))&&e.content)this._emit("functionCallResult",e.content);else if(ze(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ze(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new R("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),se(this,Z,"m",ho).call(this)}async finalMessage(){return await this.done(),se(this,Z,"m",Fn).call(this)}async finalFunctionCall(){return await this.done(),se(this,Z,"m",po).call(this)}async finalFunctionCallResult(){return await this.done(),se(this,Z,"m",mo).call(this)}async totalUsage(){return await this.done(),se(this,Z,"m",go).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let r=se(this,Z,"m",Fn).call(this);r&&this._emit("finalMessage",r);let n=se(this,Z,"m",ho).call(this);n&&this._emit("finalContent",n);let s=se(this,Z,"m",po).call(this);s&&this._emit("finalFunctionCall",s);let o=se(this,Z,"m",mo).call(this);o!=null&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",se(this,Z,"m",go).call(this))}async _createChatCompletion(e,r,n){let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),se(this,Z,"m",ba).call(this,r);let o=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Kr(o,r))}async _runChatCompletion(e,r,n){for(let s of r.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,r,n)}async _runFunctions(e,r,n){var h;let s="function",{function_call:o="auto",stream:i,...a}=r,c=typeof o!="string"&&(o==null?void 0:o.name),{maxChatCompletions:l=wa}=n||{},f={};for(let p of r.functions)f[p.name||p.function.name]=p;let u=r.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of r.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let y=(h=(await this._createChatCompletion(e,{...a,function_call:o,functions:u,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!y)throw new R("missing message in ChatCompletion response");if(!y.function_call)return;let{name:g,arguments:_}=y.function_call,w=f[g];if(w){if(c&&c!==g){let T=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:g,content:T});continue}}else{let T=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${u.map(P=>JSON.stringify(P.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:T});continue}let S;try{S=io(w)?await w.parse(_):_}catch(T){this._addMessage({role:s,name:g,content:T instanceof Error?T.message:String(T)});continue}let v=await w.function(S,this),x=se(this,Z,"m",yo).call(this,v);if(this._addMessage({role:s,name:g,content:x}),c)return}}async _runTools(e,r,n){var p,d,y;let s="tool",{tool_choice:o="auto",stream:i,...a}=r,c=typeof o!="string"&&((p=o==null?void 0:o.function)==null?void 0:p.name),{maxChatCompletions:l=wa}=n||{},f=r.tools.map(g=>{if(wt(g)){if(!g.$callback)throw new R("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),u={};for(let g of f)g.type==="function"&&(u[g.function.name||g.function.function.name]=g.function);let h="tools"in r?f.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(let g of r.messages)this._addMessage(g,!1);for(let g=0;g<l;++g){let w=(d=(await this._createChatCompletion(e,{...a,tool_choice:o,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:d.message;if(!w)throw new R("missing message in ChatCompletion response");if(!((y=w.tool_calls)!=null&&y.length))return;for(let S of w.tool_calls){if(S.type!=="function")continue;let v=S.id,{name:x,arguments:T}=S.function,P=u[x];if(P){if(c&&c!==x){let B=`Invalid tool_call: ${JSON.stringify(x)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:v,content:B});continue}}else{let B=`Invalid tool_call: ${JSON.stringify(x)}. Available options are: ${Object.keys(u).map(D=>JSON.stringify(D)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:v,content:B});continue}let N;try{N=io(P)?await P.parse(T):T}catch(B){let D=B instanceof Error?B.message:String(B);this._addMessage({role:s,tool_call_id:v,content:D});continue}let I=await P.function(N,this),M=se(this,Z,"m",yo).call(this,I);if(this._addMessage({role:s,tool_call_id:v,content:M}),c)return}}}};Z=new WeakSet,ho=function(){var e;return(e=se(this,Z,"m",Fn).call(this).content)!=null?e:null},Fn=function(){var r,n;let e=this.messages.length;for(;e-- >0;){let s=this.messages[e];if(ze(s)){let{function_call:o,...i}=s,a={...i,content:(r=s.content)!=null?r:null,refusal:(n=s.refusal)!=null?n:null};return o&&(a.function_call=o),a}}throw new R("stream ended without producing a ChatCompletionMessage with role=assistant")},po=function(){var e,r;for(let n=this.messages.length-1;n>=0;n--){let s=this.messages[n];if(ze(s)&&(s!=null&&s.function_call))return s.function_call;if(ze(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(r=s.tool_calls.at(-1))==null?void 0:r.function}},mo=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(ao(r)&&r.content!=null||co(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(o=>o.type==="function"&&o.id===r.tool_call_id))}))return r.content}},go=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},ba=function(e){if(e.n!=null&&e.n>1)throw new R("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},yo=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Xe=class extends er{static runFunctions(e,r,n){let s=new Xe,o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,r,o)),s}static runTools(e,r,n){let s=new Xe,o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,o)),s}_addMessage(e,r=!0){super._addMessage(e,r),ze(e)&&e.content&&this._emit("content",e.content)}};var z={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},wo=class extends Error{},bo=class extends Error{};function Wu(t,e=z.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return Ju(t.trim(),e)}var Ju=(t,e)=>{let r=t.length,n=0,s=h=>{throw new wo(`${h} at position ${n}`)},o=h=>{throw new bo(`${h} at position ${n}`)},i=()=>(u(),n>=r&&s("Unexpected end of input"),t[n]==='"'?a():t[n]==="{"?c():t[n]==="["?l():t.substring(n,n+4)==="null"||z.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||z.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||z.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||z.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||z.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||z.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):f()),a=()=>{let h=n,p=!1;for(n++;n<r&&(t[n]!=='"'||p&&t[n-1]==="\\");)p=t[n]==="\\"?!p:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(h,++n-Number(p)))}catch(d){o(String(d))}else if(z.STR&e)try{return JSON.parse(t.substring(h,n-Number(p))+'"')}catch(d){return JSON.parse(t.substring(h,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{n++,u();let h={};try{for(;t[n]!=="}";){if(u(),n>=r&&z.OBJ&e)return h;let p=a();u(),n++;try{let d=i();Object.defineProperty(h,p,{value:d,writable:!0,enumerable:!0,configurable:!0})}catch(d){if(z.OBJ&e)return h;throw d}u(),t[n]===","&&n++}}catch(p){if(z.OBJ&e)return h;s("Expected '}' at end of object")}return n++,h},l=()=>{n++;let h=[];try{for(;t[n]!=="]";)h.push(i()),u(),t[n]===","&&n++}catch(p){if(z.ARR&e)return h;s("Expected ']' at end of array")}return n++,h},f=()=>{if(n===0){t==="-"&&z.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(p){if(z.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch(d){}o(String(p))}}let h=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(z.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(h,n))}catch(p){t.substring(h,n)==="-"&&z.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(h,t.lastIndexOf("e")))}catch(d){o(String(d))}}},u=()=>{for(;n<r&&` 
\r	`.includes(t[n]);)n++};return i()},_o=t=>Wu(t,z.ALL^z.NUM);var tr=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},F=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},J,De,rr,Ye,Eo,Bn,xo,Ao,So,Un,Ro,_a,Fe=class extends er{constructor(e){super(),J.add(this),De.set(this,void 0),rr.set(this,void 0),Ye.set(this,void 0),tr(this,De,e,"f"),tr(this,rr,[],"f")}get currentChatCompletionSnapshot(){return F(this,Ye,"f")}static fromReadableStream(e){let r=new Fe(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let s=new Fe(r);return s._run(()=>s._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,r,n){var i;super._createChatCompletion;let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),F(this,J,"m",Eo).call(this);let o=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of o)F(this,J,"m",xo).call(this,a);if((i=o.controller.signal)!=null&&i.aborted)throw new G;return this._addChatCompletion(F(this,J,"m",Un).call(this))}async _fromReadableStream(e,r){var i;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),F(this,J,"m",Eo).call(this),this._connected();let s=re.fromReadableStream(e,this.controller),o;for await(let a of s)o&&o!==a.id&&this._addChatCompletion(F(this,J,"m",Un).call(this)),F(this,J,"m",xo).call(this,a),o=a.id;if((i=s.controller.signal)!=null&&i.aborted)throw new G;return this._addChatCompletion(F(this,J,"m",Un).call(this))}[(De=new WeakMap,rr=new WeakMap,Ye=new WeakMap,J=new WeakSet,Eo=function(){this.ended||tr(this,Ye,void 0,"f")},Bn=function(r){let n=F(this,rr,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},F(this,rr,"f")[r.index]=n,n)},xo=function(r){var s,o,i,a,c,l,f,u,h,p,d,y,g,_,w,S,v,x,T,P;if(this.ended)return;let n=F(this,J,"m",_a).call(this,r);this._emit("chunk",r,n);for(let N of r.choices){let I=n.choices[N.index];N.delta.content!=null&&((s=I.message)==null?void 0:s.role)==="assistant"&&((o=I.message)!=null&&o.content)&&(this._emit("content",N.delta.content,I.message.content),this._emit("content.delta",{delta:N.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),N.delta.refusal!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((a=I.message)!=null&&a.refusal)&&this._emit("refusal.delta",{delta:N.delta.refusal,snapshot:I.message.refusal}),((c=N.logprobs)==null?void 0:c.content)!=null&&((l=I.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=N.logprobs)==null?void 0:f.content,snapshot:(h=(u=I.logprobs)==null?void 0:u.content)!=null?h:[]}),((p=N.logprobs)==null?void 0:p.refusal)!=null&&((d=I.message)==null?void 0:d.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(y=N.logprobs)==null?void 0:y.refusal,snapshot:(_=(g=I.logprobs)==null?void 0:g.refusal)!=null?_:[]});let M=F(this,J,"m",Bn).call(this,I);I.finish_reason&&(F(this,J,"m",So).call(this,I),M.current_tool_call_index!=null&&F(this,J,"m",Ao).call(this,I,M.current_tool_call_index));for(let B of(w=N.delta.tool_calls)!=null?w:[])M.current_tool_call_index!==B.index&&(F(this,J,"m",So).call(this,I),M.current_tool_call_index!=null&&F(this,J,"m",Ao).call(this,I,M.current_tool_call_index)),M.current_tool_call_index=B.index;for(let B of(S=N.delta.tool_calls)!=null?S:[]){let D=(v=I.message.tool_calls)==null?void 0:v[B.index];D!=null&&D.type&&((D==null?void 0:D.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(x=D.function)==null?void 0:x.name,index:B.index,arguments:D.function.arguments,parsed_arguments:D.function.parsed_arguments,arguments_delta:(P=(T=B.function)==null?void 0:T.arguments)!=null?P:""}):(D==null||D.type,void 0))}}},Ao=function(r,n){var i,a,c;if(F(this,J,"m",Bn).call(this,r).done_tool_calls.has(n))return;let o=(i=r.message.tool_calls)==null?void 0:i[n];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){let l=(c=(a=F(this,De,"f"))==null?void 0:a.tools)==null?void 0:c.find(f=>f.type==="function"&&f.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:n,arguments:o.function.arguments,parsed_arguments:wt(l)?l.$parseRaw(o.function.arguments):l!=null&&l.function.strict?JSON.parse(o.function.arguments):null})}else o.type},So=function(r){var s,o;let n=F(this,J,"m",Bn).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let i=F(this,J,"m",Ro).call(this);this._emit("content.done",{content:r.message.content,parsed:i?i.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),(s=r.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),(o=r.logprobs)!=null&&o.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},Un=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");let r=F(this,Ye,"f");if(!r)throw new R("request ended without sending any chunks");return tr(this,Ye,void 0,"f"),tr(this,rr,[],"f"),Vu(r,F(this,De,"f"))},Ro=function(){var n;let r=(n=F(this,De,"f"))==null?void 0:n.response_format;return uo(r)?r:null},_a=function(r){var f,u,h,p,d,y;var n,s,o,i;let a=F(this,Ye,"f"),{choices:c,...l}=r;a?Object.assign(a,l):a=tr(this,Ye,{...l,choices:[]},"f");for(let{delta:g,finish_reason:_,index:w,logprobs:S=null,...v}of r.choices){let x=a.choices[w];if(x||(x=a.choices[w]={finish_reason:_,index:w,message:{},logprobs:S,...v}),S)if(!x.logprobs)x.logprobs=Object.assign({},S);else{let{content:D,refusal:fe,...Ne}=S;Object.assign(x.logprobs,Ne),D&&((f=(n=x.logprobs).content)!=null||(n.content=[]),x.logprobs.content.push(...D)),fe&&((u=(s=x.logprobs).refusal)!=null||(s.refusal=[]),x.logprobs.refusal.push(...fe))}if(_&&(x.finish_reason=_,F(this,De,"f")&&fo(F(this,De,"f")))){if(_==="length")throw new qt;if(_==="content_filter")throw new Ht}if(Object.assign(x,v),!g)continue;let{content:T,refusal:P,function_call:N,role:I,tool_calls:M,...B}=g;if(Object.assign(x.message,B),P&&(x.message.refusal=(x.message.refusal||"")+P),I&&(x.message.role=I),N&&(x.message.function_call?(N.name&&(x.message.function_call.name=N.name),N.arguments&&((h=(o=x.message.function_call).arguments)!=null||(o.arguments=""),x.message.function_call.arguments+=N.arguments)):x.message.function_call=N),T&&(x.message.content=(x.message.content||"")+T,!x.message.refusal&&F(this,J,"m",Ro).call(this)&&(x.message.parsed=_o(x.message.content))),M){x.message.tool_calls||(x.message.tool_calls=[]);for(let{index:D,id:fe,type:Ne,function:oe,..._l}of M){let we=(p=(i=x.message.tool_calls)[D])!=null?p:i[D]={};Object.assign(we,_l),fe&&(we.id=fe),Ne&&(we.type=Ne),oe&&((y=we.function)!=null||(we.function={name:(d=oe.name)!=null?d:"",arguments:""})),oe!=null&&oe.name&&(we.function.name=oe.name),oe!=null&&oe.arguments&&(we.function.arguments+=oe.arguments,ga(F(this,De,"f"),we)&&(we.function.parsed_arguments=_o(we.function.arguments)))}}}return a},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",s=>{let o=r.shift();o?o.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let o of r)o.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let o of r)o.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,i)=>r.push({resolve:o,reject:i})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Vu(t,e){let{id:r,choices:n,created:s,model:o,system_fingerprint:i,...a}=t,c={...a,id:r,choices:n.map(({message:l,finish_reason:f,index:u,logprobs:h,...p})=>{var S,v,x;if(!f)throw new R(`missing finish_reason for choice ${u}`);let{content:d=null,function_call:y,tool_calls:g,..._}=l,w=l.role;if(!w)throw new R(`missing role for choice ${u}`);if(y){let{arguments:T,name:P}=y;if(T==null)throw new R(`missing function_call.arguments for choice ${u}`);if(!P)throw new R(`missing function_call.name for choice ${u}`);return{...p,message:{content:d,function_call:{arguments:T,name:P},role:w,refusal:(S=l.refusal)!=null?S:null},finish_reason:f,index:u,logprobs:h}}return g?{...p,index:u,finish_reason:f,logprobs:h,message:{..._,role:w,content:d,refusal:(v=l.refusal)!=null?v:null,tool_calls:g.map((T,P)=>{let{function:N,type:I,id:M,...B}=T,{arguments:D,name:fe,...Ne}=N||{};if(M==null)throw new R(`missing choices[${u}].tool_calls[${P}].id
${$n(t)}`);if(I==null)throw new R(`missing choices[${u}].tool_calls[${P}].type
${$n(t)}`);if(fe==null)throw new R(`missing choices[${u}].tool_calls[${P}].function.name
${$n(t)}`);if(D==null)throw new R(`missing choices[${u}].tool_calls[${P}].function.arguments
${$n(t)}`);return{...B,id:M,type:I,function:{...Ne,name:fe,arguments:D}}})}}:{...p,message:{..._,content:d,role:w,refusal:(x=l.refusal)!=null?x:null},finish_reason:f,index:u,logprobs:h}}),created:s,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return ma(c,e)}function $n(t){return JSON.stringify(t)}var Be=class extends Fe{static fromReadableStream(e){let r=new Be(null);return r._run(()=>r._fromReadableStream(e)),r}static runFunctions(e,r,n){let s=new Be(null),o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,r,o)),s}static runTools(e,r,n){let s=new Be(r),o={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,r,o)),s}};var Wr=class extends E{parse(e,r){return ya(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Kr(n,e))}runFunctions(e,r){return e.stream?Be.runFunctions(this._client,e,r):Xe.runFunctions(this._client,e,r)}runTools(e,r){return e.stream?Be.runTools(this._client,e,r):Xe.runTools(this._client,e,r)}stream(e,r){return Fe.createChatCompletion(this._client,e,r)}};var nr=class extends E{constructor(){super(...arguments),this.completions=new Wr(this._client)}};(function(t){t.Completions=Wr})(nr||(nr={}));var sr=class extends E{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}};var bt=class extends E{constructor(){super(...arguments),this.sessions=new sr(this._client)}};bt.Sessions=sr;var A=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},ae=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},Y,Co,Ae,jn,me,Et,or,_t,Kn,ce,qn,Hn,Gr,Jr,Vr,Ea,xa,Aa,Sa,Ra,Ca,Oa,ne=class extends Zt{constructor(){super(...arguments),Y.add(this),Co.set(this,[]),Ae.set(this,{}),jn.set(this,{}),me.set(this,void 0),Et.set(this,void 0),or.set(this,void 0),_t.set(this,void 0),Kn.set(this,void 0),ce.set(this,void 0),qn.set(this,void 0),Hn.set(this,void 0),Gr.set(this,void 0)}[(Co=new WeakMap,Ae=new WeakMap,jn=new WeakMap,me=new WeakMap,Et=new WeakMap,or=new WeakMap,_t=new WeakMap,Kn=new WeakMap,ce=new WeakMap,qn=new WeakMap,Hn=new WeakMap,Gr=new WeakMap,Y=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",s=>{let o=r.shift();o?o.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of r)s.resolve(void 0);r.length=0}),this.on("abort",s=>{n=!0;for(let o of r)o.reject(s);r.length=0}),this.on("error",s=>{n=!0;for(let o of r)o.reject(s);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,i)=>r.push({resolve:o,reject:i})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new ne;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){var o;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=re.fromReadableStream(e,this.controller);for await(let i of s)A(this,Y,"m",Jr).call(this,i);if((o=s.controller.signal)!=null&&o.aborted)throw new G;return this._addRun(A(this,Y,"m",Vr).call(this))}toReadableStream(){return new re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,s,o){let i=new ne;return i._run(()=>i._runToolAssistantStream(e,r,n,s,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,r,n,s,o){var l;let i=o==null?void 0:o.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},c=await e.submitToolOutputs(r,n,a,{...o,signal:this.controller.signal});this._connected();for await(let f of c)A(this,Y,"m",Jr).call(this,f);if((l=c.controller.signal)!=null&&l.aborted)throw new G;return this._addRun(A(this,Y,"m",Vr).call(this))}static createThreadAssistantStream(e,r,n){let s=new ne;return s._run(()=>s._threadAssistantStream(e,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,r,n,s){let o=new ne;return o._run(()=>o._runAssistantStream(e,r,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return A(this,qn,"f")}currentRun(){return A(this,Hn,"f")}currentMessageSnapshot(){return A(this,me,"f")}currentRunStepSnapshot(){return A(this,Gr,"f")}async finalRunSteps(){return await this.done(),Object.values(A(this,Ae,"f"))}async finalMessages(){return await this.done(),Object.values(A(this,jn,"f"))}async finalRun(){if(await this.done(),!A(this,Et,"f"))throw Error("Final run was not received.");return A(this,Et,"f")}async _createThreadAssistantStream(e,r,n){var a;let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o={...r,stream:!0},i=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(let c of i)A(this,Y,"m",Jr).call(this,c);if((a=i.controller.signal)!=null&&a.aborted)throw new G;return this._addRun(A(this,Y,"m",Vr).call(this))}async _createAssistantStream(e,r,n,s){var c;let o=s==null?void 0:s.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await e.create(r,i,{...s,signal:this.controller.signal});this._connected();for await(let l of a)A(this,Y,"m",Jr).call(this,l);if((c=a.controller.signal)!=null&&c.aborted)throw new G;return this._addRun(A(this,Y,"m",Vr).call(this))}static accumulateDelta(e,r){for(let[n,s]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let o=e[n];if(o==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof o=="string"&&typeof s=="string")o+=s;else if(typeof o=="number"&&typeof s=="number")o+=s;else if(Jt(o)&&Jt(s))o=this.accumulateDelta(o,s);else if(Array.isArray(o)&&Array.isArray(s)){if(o.every(i=>typeof i=="string"||typeof i=="number")){o.push(...s);continue}for(let i of s){if(!Jt(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let a=i.index;if(a==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);let c=o[a];c==null?o.push(i):o[a]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${o}`);e[n]=o}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,s){return await this._createAssistantStream(r,e,n,s)}async _runToolAssistantStream(e,r,n,s,o){return await this._createToolAssistantStream(n,e,r,s,o)}};Jr=function(e){if(!this.ended)switch(ae(this,qn,e,"f"),A(this,Y,"m",Aa).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":A(this,Y,"m",Oa).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":A(this,Y,"m",xa).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":A(this,Y,"m",Ea).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Vr=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");if(!A(this,Et,"f"))throw Error("Final run has not been received");return A(this,Et,"f")},Ea=function(e){let[r,n]=A(this,Y,"m",Ra).call(this,e,A(this,me,"f"));ae(this,me,r,"f"),A(this,jn,"f")[r.id]=r;for(let s of n){let o=r.content[s.index];(o==null?void 0:o.type)=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let o=s.text,i=r.content[s.index];if(i&&i.type=="text")this._emit("textDelta",o,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=A(this,or,"f")){if(A(this,_t,"f"))switch(A(this,_t,"f").type){case"text":this._emit("textDone",A(this,_t,"f").text,A(this,me,"f"));break;case"image_file":this._emit("imageFileDone",A(this,_t,"f").image_file,A(this,me,"f"));break}ae(this,or,s.index,"f")}ae(this,_t,r.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(A(this,or,"f")!==void 0){let s=e.data.content[A(this,or,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,A(this,me,"f"));break;case"text":this._emit("textDone",s.text,A(this,me,"f"));break}}A(this,me,"f")&&this._emit("messageDone",e.data),ae(this,me,void 0,"f")}},xa=function(e){let r=A(this,Y,"m",Sa).call(this,e);switch(ae(this,Gr,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let o of n.step_details.tool_calls)o.index==A(this,Kn,"f")?this._emit("toolCallDelta",o,r.step_details.tool_calls[o.index]):(A(this,ce,"f")&&this._emit("toolCallDone",A(this,ce,"f")),ae(this,Kn,o.index,"f"),ae(this,ce,r.step_details.tool_calls[o.index],"f"),A(this,ce,"f")&&this._emit("toolCallCreated",A(this,ce,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ae(this,Gr,void 0,"f"),e.data.step_details.type=="tool_calls"&&A(this,ce,"f")&&(this._emit("toolCallDone",A(this,ce,"f")),ae(this,ce,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},Aa=function(e){A(this,Co,"f").push(e),this._emit("event",e)},Sa=function(e){switch(e.event){case"thread.run.step.created":return A(this,Ae,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=A(this,Ae,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=ne.accumulateDelta(r,n.delta);A(this,Ae,"f")[e.data.id]=s}return A(this,Ae,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":A(this,Ae,"f")[e.data.id]=e.data;break}if(A(this,Ae,"f")[e.data.id])return A(this,Ae,"f")[e.data.id];throw new Error("No snapshot available")},Ra=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let o of s.delta.content)if(o.index in r.content){let i=r.content[o.index];r.content[o.index]=A(this,Y,"m",Ca).call(this,o,i)}else r.content[o.index]=o,n.push(o);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ca=function(e,r){return ne.accumulateDelta(r,e)},Oa=function(e){switch(ae(this,Hn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ae(this,Et,e.data,"f"),A(this,ce,"f")&&(this._emit("toolCallDone",A(this,ce,"f")),ae(this,ce,void 0,"f"));break;case"thread.run.cancelling":break}};var xt=class extends E{create(e,r,n){return this._client.post(`/threads/${e}/messages`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,s){return this._client.post(`/threads/${e}/messages/${r}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,r={},n){return L(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/messages`,ir,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r,n){return this._client.delete(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},ir=class extends U{};xt.MessagesPage=ir;var At=class extends E{retrieve(e,r,n,s={},o){return L(s)?this.retrieve(e,r,n,{},s):this._client.get(`/threads/${e}/runs/${r}/steps/${n}`,{query:s,...o,headers:{"OpenAI-Beta":"assistants=v2",...o==null?void 0:o.headers}})}list(e,r,n={},s){return L(n)?this.list(e,r,{},n):this._client.getAPIList(`/threads/${e}/runs/${r}/steps`,ar,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}},ar=class extends U{};At.RunStepsPage=ar;var Ue=class extends E{constructor(){super(...arguments),this.steps=new At(this._client)}create(e,r,n){var i;let{include:s,...o}=r;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:o,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:(i=r.stream)!=null?i:!1})}retrieve(e,r,n){return this._client.get(`/threads/${e}/runs/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,s){return this._client.post(`/threads/${e}/runs/${r}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,r={},n){return L(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/runs`,cr,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,r,n){return this._client.post(`/threads/${e}/runs/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}createAndStream(e,r,n){return ne.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:o,response:i}=await this.retrieve(e,r,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(n!=null&&n.pollIntervalMs)a=n.pollIntervalMs;else{let c=i.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await ke(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,r,n){return ne.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n,s){var o;return this._client.post(`/threads/${e}/runs/${r}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:(o=n.stream)!=null?o:!1})}async submitToolOutputsAndPoll(e,r,n,s){let o=await this.submitToolOutputs(e,r,n,s);return await this.poll(e,o.id,s)}submitToolOutputsStream(e,r,n,s){return ne.createToolAssistantStream(e,r,this._client.beta.threads.runs,n,s)}},cr=class extends U{};Ue.RunsPage=cr;Ue.Steps=At;Ue.RunStepsPage=ar;var Se=class extends E{constructor(){super(...arguments),this.runs=new Ue(this._client),this.messages=new xt(this._client)}create(e={},r){return L(e)?this.create({},e):this._client.post("/threads",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/threads/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r){return this._client.delete(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}createAndRun(e,r){var n;return this._client.post("/threads/runs",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:(n=e.stream)!=null?n:!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.thread_id,n.id,r)}createAndRunStream(e,r){return ne.createThreadAssistantStream(e,this._client.beta.threads,r)}};Se.Runs=Ue;Se.RunsPage=cr;Se.Messages=xt;Se.MessagesPage=ir;var Ta=async t=>{let e=await Promise.allSettled(t),r=e.filter(s=>s.status==="rejected");if(r.length){for(let s of r)console.error(s.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n};var St=class extends E{create(e,r,n){return this._client.post(`/vector_stores/${e}/files`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,r={},n){return L(r)?this.list(e,{},r):this._client.getAPIList(`/vector_stores/${e}/files`,Qe,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r,n){return this._client.delete(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r,n);return await this.poll(e,s.id,n)}async poll(e,r,n){let s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let o=await this.retrieve(e,r,{...n,headers:s}).withResponse(),i=o.data;switch(i.status){case"in_progress":let a=5e3;if(n!=null&&n.pollIntervalMs)a=n.pollIntervalMs;else{let c=o.response.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await ke(a);break;case"failed":case"completed":return i}}}async upload(e,r,n){let s=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,r,n){let s=await this.upload(e,r,n);return await this.poll(e,s.id,n)}},Qe=class extends U{};St.VectorStoreFilesPage=Qe;var lr=class extends E{create(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/file_batches/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){let s=await this.create(e,r);return await this.poll(e,s.id,n)}listFiles(e,r,n={},s){return L(n)?this.listFiles(e,r,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${r}/files`,Qe,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,r,n){let s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:o,response:i}=await this.retrieve(e,r,{...n,headers:s}).withResponse();switch(o.status){case"in_progress":let a=5e3;if(n!=null&&n.pollIntervalMs)a=n.pollIntervalMs;else{let c=i.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await ke(a);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},s){var h;if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let o=(h=s==null?void 0:s.maxConcurrency)!=null?h:5,i=Math.min(o,r.length),a=this._client,c=r.values(),l=[...n];async function f(p){for(let d of p){let y=await a.files.create({file:d,purpose:"assistants"},s);l.push(y.id)}}let u=Array(i).fill(c).map(f);return await Ta(u),await this.createAndPoll(e,{file_ids:l})}};var Re=class extends E{constructor(){super(...arguments),this.files=new St(this._client),this.fileBatches=new lr(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/vector_stores/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},r){return L(e)?this.list({},e):this._client.getAPIList("/vector_stores",ur,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,r){return this._client.delete(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},ur=class extends U{};Re.VectorStoresPage=ur;Re.Files=St;Re.VectorStoreFilesPage=Qe;Re.FileBatches=lr;var le=class extends E{constructor(){super(...arguments),this.realtime=new bt(this._client),this.vectorStores=new Re(this._client),this.chat=new nr(this._client),this.assistants=new yt(this._client),this.threads=new Se(this._client)}};le.Realtime=bt;le.VectorStores=Re;le.VectorStoresPage=ur;le.Assistants=yt;le.AssistantsPage=Yt;le.Threads=Se;var Rt=class extends E{create(e,r){var n;return this._client.post("/completions",{body:e,...r,stream:(n=e.stream)!=null?n:!1})}};var Ct=class extends E{create(e,r){return this._client.post("/embeddings",{body:e,...r})}};var Ze=class extends E{create(e,r){return this._client.post("/files",de({body:e,...r}))}retrieve(e,r){return this._client.get(`/files/${e}`,r)}list(e={},r){return L(e)?this.list({},e):this._client.getAPIList("/files",Ot,{query:e,...r})}del(e,r){return this._client.delete(`/files/${e}`,r)}content(e,r){return this._client.get(`/files/${e}/content`,{...r,headers:{Accept:"application/binary",...r==null?void 0:r.headers},__binaryResponse:!0})}retrieveContent(e,r){return this._client.get(`/files/${e}/content`,r)}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),o=Date.now(),i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await ke(r),i=await this.retrieve(e),Date.now()-o>n)throw new Ke({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}},Ot=class extends U{};Ze.FileObjectsPage=Ot;var Tt=class extends E{list(e,r={},n){return L(r)?this.list(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,fr,{query:r,...n})}},fr=class extends U{};Tt.FineTuningJobCheckpointsPage=fr;var Ce=class extends E{constructor(){super(...arguments),this.checkpoints=new Tt(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(`/fine_tuning/jobs/${e}`,r)}list(e={},r){return L(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",dr,{query:e,...r})}cancel(e,r){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return L(r)?this.listEvents(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,hr,{query:r,...n})}},dr=class extends U{},hr=class extends U{};Ce.FineTuningJobsPage=dr;Ce.FineTuningJobEventsPage=hr;Ce.Checkpoints=Tt;Ce.FineTuningJobCheckpointsPage=fr;var Oe=class extends E{constructor(){super(...arguments),this.jobs=new Ce(this._client)}};Oe.Jobs=Ce;Oe.FineTuningJobsPage=dr;Oe.FineTuningJobEventsPage=hr;var It=class extends E{createVariation(e,r){return this._client.post("/images/variations",de({body:e,...r}))}edit(e,r){return this._client.post("/images/edits",de({body:e,...r}))}generate(e,r){return this._client.post("/images/generations",{body:e,...r})}};var et=class extends E{retrieve(e,r){return this._client.get(`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Pt,e)}del(e,r){return this._client.delete(`/models/${e}`,r)}},Pt=class extends Pn{};et.ModelsPage=Pt;var vt=class extends E{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var pr=class extends E{create(e,r,n){return this._client.post(`/uploads/${e}/parts`,de({body:r,...n}))}};var tt=class extends E{constructor(){super(...arguments),this.parts=new pr(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(`/uploads/${e}/complete`,{body:r,...n})}};tt.Parts=pr;var Pa,O=class extends In{constructor({baseURL:e=We("OPENAI_BASE_URL"),apiKey:r=We("OPENAI_API_KEY"),organization:n=(i=>(i=We("OPENAI_ORG_ID"))!=null?i:null)(),project:s=(a=>(a=We("OPENAI_PROJECT_ID"))!=null?a:null)(),...o}={}){var l;if(r===void 0)throw new R("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let c={apiKey:r,organization:n,project:s,...o,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&ha())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:(l=c.timeout)!=null?l:6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new Rt(this),this.chat=new Me(this),this.embeddings=new Ct(this),this.files=new Ze(this),this.images=new It(this),this.audio=new xe(this),this.moderations=new vt(this),this.models=new et(this),this.fineTuning=new Oe(this),this.beta=new le(this),this.batches=new Ge(this),this.uploads=new tt(this),this._options=c,this.apiKey=r,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Ws(e,{arrayFormat:"brackets"})}};Pa=O;O.OpenAI=Pa;O.DEFAULT_TIMEOUT=6e5;O.OpenAIError=R;O.APIError=q;O.APIConnectionError=He;O.APIConnectionTimeoutError=Ke;O.APIUserAbortError=G;O.NotFoundError=kr;O.ConflictError=Mr;O.RateLimitError=Dr;O.BadRequestError=Pr;O.AuthenticationError=vr;O.InternalServerError=Fr;O.PermissionDeniedError=Nr;O.UnprocessableEntityError=Lr;O.toFile=ro;O.fileFromPath=xn;O.Completions=Rt;O.Chat=Me;O.ChatCompletionsPage=Ve;O.Embeddings=Ct;O.Files=Ze;O.FileObjectsPage=Ot;O.Images=It;O.Audio=xe;O.Moderations=vt;O.Models=et;O.ModelsPage=Pt;O.FineTuning=Oe;O.Beta=le;O.Batches=Ge;O.BatchesPage=gt;O.Uploads=tt;var Wn=class extends O{constructor({baseURL:e=We("OPENAI_BASE_URL"),apiKey:r=We("AZURE_OPENAI_API_KEY"),apiVersion:n=We("OPENAI_API_VERSION"),endpoint:s,deployment:o,azureADTokenProvider:i,dangerouslyAllowBrowser:a,...c}={}){if(!n)throw new R("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof i=="function"&&(a=!0),!i&&!r)throw new R("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(i&&r)throw new R("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(r!=null||(r=Ia),c.defaultQuery={...c.defaultQuery,"api-version":n},e){if(s)throw new R("baseURL and endpoint are mutually exclusive")}else{if(s||(s=process.env.AZURE_OPENAI_ENDPOINT),!s)throw new R("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${s}/openai`}super({apiKey:r,baseURL:e,...c,...a!==void 0?{dangerouslyAllowBrowser:a}:{}}),this.apiVersion="",this._azureADTokenProvider=i,this.apiVersion=n,this.deploymentName=o}buildRequest(e,r={}){var n;if(uf.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!Jt(e.body))throw new Error("Expected request body to be an object");let s=this.deploymentName||e.body.model||((n=e.__metadata)==null?void 0:n.model);s!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${s}${e.path}`)}return super.buildRequest(e,r)}async _getAzureADToken(){if(typeof this._azureADTokenProvider=="function"){let e=await this._azureADTokenProvider();if(!e||typeof e!="string")throw new R(`Expected 'azureADTokenProvider' argument to return a string but it returned ${e}`);return e}}authHeaders(e){return{}}async prepareOptions(e){var n,s;if((n=e.headers)!=null&&n["api-key"])return super.prepareOptions(e);let r=await this._getAzureADToken();if((s=e.headers)!=null||(e.headers={}),r)e.headers.Authorization=`Bearer ${r}`;else if(this.apiKey!==Ia)e.headers["api-key"]=this.apiKey;else throw new R("Unable to handle auth");return super.prepareOptions(e)}},uf=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]),Ia="<Missing Key>",Te=O;var ff=`

> [!quote]-  
> `,df=`

`,hf=t=>async function*(e){var h;let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,...c}=s;if(!o)throw new Error(b("API key is required"));let f=await new Te({apiKey:o,baseURL:i,dangerouslyAllowBrowser:!0}).chat.completions.create({model:a,messages:e,stream:!0,...c}),u=!1;for await(let p of f){let d=(h=p.choices[0])==null?void 0:h.delta,y=d==null?void 0:d.reasoning_content;if(y)yield(u?"":(u=!0,ff))+y.replace(/\n/g,`
> `);else{let g=u?(u=!1,df):"";d!=null&&d.content&&(yield g+(d==null?void 0:d.content))}}},Jn={name:"SiliconFlow",defaultOptions:{apiKey:"",baseURL:"https://api.siliconflow.cn/v1",model:"",parameters:{}},sendRequestFunc:hf,models:[],websiteToObtainKey:"https://siliconflow.cn"},Na=async t=>(await(0,va.requestUrl)({url:"https://api.siliconflow.cn/v1/models?type=text&sub_type=chat",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json.data.map(n=>n.id);var mr=crypto,Vn=t=>t instanceof CryptoKey;var $e=new TextEncoder,zr=new TextDecoder,_w=2**32;function ka(...t){let e=t.reduce((s,{length:o})=>s+o,0),r=new Uint8Array(e),n=0;for(let s of t)r.set(s,n),n+=s.length;return r}var pf=t=>{let e=t;typeof e=="string"&&(e=$e.encode(e));let r=32768,n=[];for(let s=0;s<e.length;s+=r)n.push(String.fromCharCode.apply(null,e.subarray(s,s+r)));return btoa(n.join(""))},Gn=t=>pf(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),mf=t=>{let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r},zn=t=>{let e=t;e instanceof Uint8Array&&(e=zr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return mf(e)}catch(r){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Q=class extends Error{constructor(e,r){var n;super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(n=Error.captureStackTrace)==null||n.call(Error,this,this.constructor)}};Q.code="ERR_JOSE_GENERIC";var Oo=class extends Q{constructor(e,r,n="unspecified",s="unspecified"){super(e,{cause:{claim:n,reason:s,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=s,this.payload=r}};Oo.code="ERR_JWT_CLAIM_VALIDATION_FAILED";var To=class extends Q{constructor(e,r,n="unspecified",s="unspecified"){super(e,{cause:{claim:n,reason:s,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=s,this.payload=r}};To.code="ERR_JWT_EXPIRED";var Io=class extends Q{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}};Io.code="ERR_JOSE_ALG_NOT_ALLOWED";var he=class extends Q{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}};he.code="ERR_JOSE_NOT_SUPPORTED";var Po=class extends Q{constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}};Po.code="ERR_JWE_DECRYPTION_FAILED";var vo=class extends Q{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}};vo.code="ERR_JWE_INVALID";var je=class extends Q{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}};je.code="ERR_JWS_INVALID";var Xr=class extends Q{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}};Xr.code="ERR_JWT_INVALID";var No=class extends Q{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}};No.code="ERR_JWK_INVALID";var ko=class extends Q{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}};ko.code="ERR_JWKS_INVALID";var Mo=class extends Q{constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}};Mo.code="ERR_JWKS_NO_MATCHING_KEY";var Lo=class extends Q{constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}};Lo.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";var Do=class extends Q{constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}};Do.code="ERR_JWKS_TIMEOUT";var Fo=class extends Q{constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};Fo.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function qe(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function Xn(t,e){return t.name===e}function Bo(t){return parseInt(t.name.slice(4),10)}function gf(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function yf(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Ma(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!Xn(t.algorithm,"HMAC"))throw qe("HMAC");let n=parseInt(e.slice(2),10);if(Bo(t.algorithm.hash)!==n)throw qe(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Xn(t.algorithm,"RSASSA-PKCS1-v1_5"))throw qe("RSASSA-PKCS1-v1_5");let n=parseInt(e.slice(2),10);if(Bo(t.algorithm.hash)!==n)throw qe(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Xn(t.algorithm,"RSA-PSS"))throw qe("RSA-PSS");let n=parseInt(e.slice(2),10);if(Bo(t.algorithm.hash)!==n)throw qe(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw qe("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Xn(t.algorithm,"ECDSA"))throw qe("ECDSA");let n=gf(e);if(t.algorithm.namedCurve!==n)throw qe(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}yf(t,r)}function La(t,e,...r){var n;if(r=r.filter(Boolean),r.length>2){let s=r.pop();t+=`one of type ${r.join(", ")}, or ${s}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(n=e.constructor)!=null&&n.name&&(t+=` Received an instance of ${e.constructor.name}`),t}var Uo=(t,...e)=>La("Key must be ",t,...e);function $o(t,e,...r){return La(`Key for the ${t} algorithm must be `,e,...r)}var jo=t=>Vn(t)?!0:(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",gr=["CryptoKey"];var wf=(...t)=>{let e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(let n of e){let s=Object.keys(n);if(!r||r.size===0){r=new Set(s);continue}for(let o of s){if(r.has(o))return!1;r.add(o)}}return!0},Da=wf;function bf(t){return typeof t=="object"&&t!==null}function Yr(t){if(!bf(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}var Fa=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function Nt(t){return Yr(t)&&typeof t.kty=="string"}function Ba(t){return t.kty!=="oct"&&typeof t.d=="string"}function Ua(t){return t.kty!=="oct"&&typeof t.d=="undefined"}function $a(t){return Nt(t)&&t.kty==="oct"&&typeof t.k=="string"}function Ef(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new he('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new he('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"EdDSA":e={name:t.crv},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new he('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new he('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}var xf=async t=>{var o,i;if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:e,keyUsages:r}=Ef(t),n=[e,(o=t.ext)!=null?o:!1,(i=t.key_ops)!=null?i:r],s={...t};return delete s.alg,delete s.use,mr.subtle.importKey("jwk",s,...n)},ja=xf;var qa=t=>zn(t),yr,wr,Ha=t=>(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",Yn=async(t,e,r,n,s=!1)=>{let o=t.get(e);if(o!=null&&o[n])return o[n];let i=await ja({...r,alg:n});return s&&Object.freeze(e),o?o[n]=i:t.set(e,{[n]:i}),i},Af=(t,e)=>{if(Ha(t)){let r=t.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?qa(r.k):(wr||(wr=new WeakMap),Yn(wr,t,r,e))}return Nt(t)?t.k?zn(t.k):(wr||(wr=new WeakMap),Yn(wr,t,t,e,!0)):t},Sf=(t,e)=>{if(Ha(t)){let r=t.export({format:"jwk"});return r.k?qa(r.k):(yr||(yr=new WeakMap),Yn(yr,t,r,e))}return Nt(t)?t.k?zn(t.k):(yr||(yr=new WeakMap),Yn(yr,t,t,e,!0)):t},qo={normalizePublicKey:Af,normalizePrivateKey:Sf};var br=t=>t==null?void 0:t[Symbol.toStringTag],Ho=(t,e,r)=>{var n,s;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((s=(n=e.key_ops).includes)==null?void 0:s.call(n,r))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0},Rf=(t,e,r,n)=>{if(!(e instanceof Uint8Array)){if(n&&Nt(e)){if($a(e)&&Ho(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!jo(e))throw new TypeError($o(t,e,...gr,"Uint8Array",n?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${br(e)} instances for symmetric algorithms must be of type "secret"`)}},Cf=(t,e,r,n)=>{if(n&&Nt(e))switch(r){case"sign":if(Ba(e)&&Ho(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Ua(e)&&Ho(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!jo(e))throw new TypeError($o(t,e,...gr,n?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${br(e)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${br(e)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${br(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${br(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${br(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Ka(t,e,r,n){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Rf(e,r,n,t):Cf(e,r,n,t)}var qw=Ka.bind(void 0,!1),Wa=Ka.bind(void 0,!0);function Of(t,e,r,n,s){if(s.crit!==void 0&&(n==null?void 0:n.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(i=>typeof i!="string"||i.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let o;r!==void 0?o=new Map([...Object.entries(r),...e.entries()]):o=e;for(let i of n.crit){if(!o.has(i))throw new he(`Extension Header Parameter "${i}" is not recognized`);if(s[i]===void 0)throw new t(`Extension Header Parameter "${i}" is missing`);if(o.get(i)&&n[i]===void 0)throw new t(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(n.crit)}var Ja=Of;function Ko(t,e){let r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new he(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}async function Wo(t,e,r){if(r==="sign"&&(e=await qo.normalizePrivateKey(e,t)),r==="verify"&&(e=await qo.normalizePublicKey(e,t)),Vn(e))return Ma(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Uo(e,...gr));return mr.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(Uo(e,...gr,"Uint8Array","JSON Web Key"))}var rt=t=>Math.floor(t.getTime()/1e3);var Tf=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Qn=t=>{let e=Tf.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let r=parseFloat(e[2]),n=e[3].toLowerCase(),s;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(r*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(r*3600);break;case"day":case"days":case"d":s=Math.round(r*86400);break;case"week":case"weeks":case"w":s=Math.round(r*604800);break;default:s=Math.round(r*31557600);break}return e[1]==="-"||e[4]==="ago"?-s:s};var If=async(t,e,r)=>{let n=await Wo(t,e,"sign");Fa(t,n);let s=await mr.subtle.sign(Ko(t,n.algorithm),n,r);return new Uint8Array(s)},Va=If;var Zn=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new je("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Da(this._protectedHeader,this._unprotectedHeader))throw new je("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},s=Ja(je,new Map([["b64",!0]]),r==null?void 0:r.crit,this._protectedHeader,n),o=!0;if(s.has("b64")&&(o=this._protectedHeader.b64,typeof o!="boolean"))throw new je('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:i}=n;if(typeof i!="string"||!i)throw new je('JWS "alg" (Algorithm) Header Parameter missing or invalid');Wa(i,e,"sign");let a=this._payload;o&&(a=$e.encode(Gn(a)));let c;this._protectedHeader?c=$e.encode(Gn(JSON.stringify(this._protectedHeader))):c=$e.encode("");let l=ka(c,$e.encode("."),a),f=await Va(i,e,l),u={signature:Gn(f),payload:""};return o&&(u.payload=zr.decode(a)),this._unprotectedHeader&&(u.header=this._unprotectedHeader),this._protectedHeader&&(u.protected=zr.decode(c)),u}};var es=class{constructor(e){this._flattened=new Zn(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){let n=await this._flattened.sign(e,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}};function kt(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}var ts=class{constructor(e={}){if(!Yr(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:kt("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:kt("setNotBefore",rt(e))}:this._payload={...this._payload,nbf:rt(new Date)+Qn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:kt("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:kt("setExpirationTime",rt(e))}:this._payload={...this._payload,exp:rt(new Date)+Qn(e)},this}setIssuedAt(e){return typeof e=="undefined"?this._payload={...this._payload,iat:rt(new Date)}:e instanceof Date?this._payload={...this._payload,iat:kt("setIssuedAt",rt(e))}:typeof e=="string"?this._payload={...this._payload,iat:kt("setIssuedAt",rt(new Date)+Qn(e))}:this._payload={...this._payload,iat:kt("setIssuedAt",e)},this}};var Qr=class extends ts{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var s;let n=new es($e.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray((s=this._protectedHeader)==null?void 0:s.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Xr("JWTs MUST NOT use unencoded payload");return n.sign(e,r)}};var vf=t=>async function*(e){var g,_;let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,token:c,tokenExpireInMinutes:l,enableWebSearch:f,...u}=s;if(!o)throw new Error(b("API key is required"));console.debug("zhipu options",{baseURL:i,apiKey:o,model:a,currentToken:c,tokenExpireInMinutes:l,enableWebSearch:f});let{token:h}=await kf(c,o,l);t.token=h;let p=new Te({apiKey:h.id,baseURL:i,dangerouslyAllowBrowser:!0}),d=f?[{type:"web_search",web_search:{enable:!0}}]:[],y=await p.chat.completions.create({model:a,messages:e,stream:!0,tools:d,...u});for await(let w of y){let S=(_=(g=w.choices[0])==null?void 0:g.delta)==null?void 0:_.content;S&&(yield S)}},Nf=async(t,e)=>{let[r,n]=t.split(".");if(!r||!n)throw new Error('Invalid API key secret, must be in the format "apiKey.apiSecret"');let s=Date.now(),o={api_key:r,exp:s+e*60*1e3,timestamp:s};return{id:await new Qr({...o}).setProtectedHeader({alg:"HS256",sign_type:"SIGN"}).sign(new TextEncoder().encode(n)),exp:o.exp,apiKeySecret:t}},kf=async(t,e,r)=>{let n=Date.now();if(t&&t.apiKeySecret===e&&t.exp>n+3*60*1e3)return{isValid:!0,token:t};let s=await Nf(e,r);return console.debug("create new token",s),{isValid:!1,token:s}},Ga=["glm-4-plus","glm-4-air","glm-4-airx","glm-4-long","glm-4-flash","glm-4-flashx"],rs={name:"Zhipu",defaultOptions:{apiKey:"",baseURL:"https://open.bigmodel.cn/api/paas/v4/",model:Ga[0],tokenExpireInMinutes:60*24,enableWebSearch:!1,parameters:{}},sendRequestFunc:vf,models:Ga,websiteToObtainKey:"https://open.bigmodel.cn/"};var Mf=`

> [!quote]-  
> `,Lf="",Df=t=>async function*(e){var y,g;let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,model:i,endpoint:a,apiVersion:c,...l}=s;if(!o)throw new Error(b("API key is required"));let f=new Wn({endpoint:a,apiKey:o,apiVersion:c,deployment:i,dangerouslyAllowBrowser:!0});e=[{role:"system",content:`Initiate your response with "<think>
\u55EF" at the beginning of every output.`},...e];let u=await f.chat.completions.create({model:i,messages:e,stream:!0,...l}),h=!1,p=!1,d=!1;for await(let _ of u){_.usage&&_.usage.prompt_tokens&&_.usage.completion_tokens&&console.debug(`Prompt tokens: ${_.usage.prompt_tokens}, completion tokens: ${_.usage.completion_tokens}`);let w=(g=(y=_.choices[0])==null?void 0:y.delta)==null?void 0:g.content;if(w){if(w==="<think>"){if(p)continue;h=!0,p=!0,yield Mf;continue}if(w==="</think>"){if(d)continue;h=!1,d=!0,yield Lf;continue}yield h?w.replace(/\n/g,`
> `):w}}},za=["o3-mini","deepseek-r1","phi-4","o1","o1-mini","gpt-4o","gpt-4o-mini"],Xa={name:"Azure",defaultOptions:{apiKey:"",baseURL:"",model:za[0],endpoint:"",apiVersion:"",parameters:{}},sendRequestFunc:Df,models:za,websiteToObtainKey:"https://portal.azure.com"};function Zr(t,e){return function(){return t.apply(e,arguments)}}var{toString:Ff}=Object.prototype,{getPrototypeOf:Go}=Object,ss=(t=>e=>{let r=Ff.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),ge=t=>(t=t.toLowerCase(),e=>ss(e)===t),os=t=>e=>typeof e===t,{isArray:_r}=Array,en=os("undefined");function Bf(t){return t!==null&&!en(t)&&t.constructor!==null&&!en(t.constructor)&&ue(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}var Za=ge("ArrayBuffer");function Uf(t){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Za(t.buffer),e}var $f=os("string"),ue=os("function"),ec=os("number"),is=t=>t!==null&&typeof t=="object",jf=t=>t===!0||t===!1,ns=t=>{if(ss(t)!=="object")return!1;let e=Go(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},qf=ge("Date"),Hf=ge("File"),Kf=ge("Blob"),Wf=ge("FileList"),Jf=t=>is(t)&&ue(t.pipe),Vf=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ue(t.append)&&((e=ss(t))==="formdata"||e==="object"&&ue(t.toString)&&t.toString()==="[object FormData]"))},Gf=ge("URLSearchParams"),[zf,Xf,Yf,Qf]=["ReadableStream","Request","Response","Headers"].map(ge),Zf=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function tn(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t=="undefined")return;let n,s;if(typeof t!="object"&&(t=[t]),_r(t))for(n=0,s=t.length;n<s;n++)e.call(null,t[n],n,t);else{let o=r?Object.getOwnPropertyNames(t):Object.keys(t),i=o.length,a;for(n=0;n<i;n++)a=o[n],e.call(null,t[a],a,t)}}function tc(t,e){e=e.toLowerCase();let r=Object.keys(t),n=r.length,s;for(;n-- >0;)if(s=r[n],e===s.toLowerCase())return s;return null}var Mt=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),rc=t=>!en(t)&&t!==Mt;function Vo(){let{caseless:t}=rc(this)&&this||{},e={},r=(n,s)=>{let o=t&&tc(e,s)||s;ns(e[o])&&ns(n)?e[o]=Vo(e[o],n):ns(n)?e[o]=Vo({},n):_r(n)?e[o]=n.slice():e[o]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&tn(arguments[n],r);return e}var ed=(t,e,r,{allOwnKeys:n}={})=>(tn(e,(s,o)=>{r&&ue(s)?t[o]=Zr(s,r):t[o]=s},{allOwnKeys:n}),t),td=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),rd=(t,e,r,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},nd=(t,e,r,n)=>{let s,o,i,a={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),o=s.length;o-- >0;)i=s[o],(!n||n(i,t,e))&&!a[i]&&(e[i]=t[i],a[i]=!0);t=r!==!1&&Go(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},sd=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;let n=t.indexOf(e,r);return n!==-1&&n===r},od=t=>{if(!t)return null;if(_r(t))return t;let e=t.length;if(!ec(e))return null;let r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},id=(t=>e=>t&&e instanceof t)(typeof Uint8Array!="undefined"&&Go(Uint8Array)),ad=(t,e)=>{let n=(t&&t[Symbol.iterator]).call(t),s;for(;(s=n.next())&&!s.done;){let o=s.value;e.call(t,o[0],o[1])}},cd=(t,e)=>{let r,n=[];for(;(r=t.exec(e))!==null;)n.push(r);return n},ld=ge("HTMLFormElement"),ud=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,s){return n.toUpperCase()+s}),Ya=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),fd=ge("RegExp"),nc=(t,e)=>{let r=Object.getOwnPropertyDescriptors(t),n={};tn(r,(s,o)=>{let i;(i=e(s,o,t))!==!1&&(n[o]=i||s)}),Object.defineProperties(t,n)},dd=t=>{nc(t,(e,r)=>{if(ue(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let n=t[r];if(ue(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},hd=(t,e)=>{let r={},n=s=>{s.forEach(o=>{r[o]=!0})};return _r(t)?n(t):n(String(t).split(e)),r},pd=()=>{},md=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,Jo="abcdefghijklmnopqrstuvwxyz",Qa="0123456789",sc={DIGIT:Qa,ALPHA:Jo,ALPHA_DIGIT:Jo+Jo.toUpperCase()+Qa},gd=(t=16,e=sc.ALPHA_DIGIT)=>{let r="",{length:n}=e;for(;t--;)r+=e[Math.random()*n|0];return r};function yd(t){return!!(t&&ue(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}var wd=t=>{let e=new Array(10),r=(n,s)=>{if(is(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[s]=n;let o=_r(n)?[]:{};return tn(n,(i,a)=>{let c=r(i,s+1);!en(c)&&(o[a]=c)}),e[s]=void 0,o}}return n};return r(t,0)},bd=ge("AsyncFunction"),_d=t=>t&&(is(t)||ue(t))&&ue(t.then)&&ue(t.catch),oc=((t,e)=>t?setImmediate:e?((r,n)=>(Mt.addEventListener("message",({source:s,data:o})=>{s===Mt&&o===r&&n.length&&n.shift()()},!1),s=>{n.push(s),Mt.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ue(Mt.postMessage)),Ed=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Mt):typeof process!="undefined"&&process.nextTick||oc,m={isArray:_r,isArrayBuffer:Za,isBuffer:Bf,isFormData:Vf,isArrayBufferView:Uf,isString:$f,isNumber:ec,isBoolean:jf,isObject:is,isPlainObject:ns,isReadableStream:zf,isRequest:Xf,isResponse:Yf,isHeaders:Qf,isUndefined:en,isDate:qf,isFile:Hf,isBlob:Kf,isRegExp:fd,isFunction:ue,isStream:Jf,isURLSearchParams:Gf,isTypedArray:id,isFileList:Wf,forEach:tn,merge:Vo,extend:ed,trim:Zf,stripBOM:td,inherits:rd,toFlatObject:nd,kindOf:ss,kindOfTest:ge,endsWith:sd,toArray:od,forEachEntry:ad,matchAll:cd,isHTMLForm:ld,hasOwnProperty:Ya,hasOwnProp:Ya,reduceDescriptors:nc,freezeMethods:dd,toObjectSet:hd,toCamelCase:ud,noop:pd,toFiniteNumber:md,findKey:tc,global:Mt,isContextDefined:rc,ALPHABET:sc,generateString:gd,isSpecCompliantForm:yd,toJSONObject:wd,isAsyncFn:bd,isThenable:_d,setImmediate:oc,asap:Ed};function Er(t,e,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}m.inherits(Er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});var ic=Er.prototype,ac={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{ac[t]={value:t}});Object.defineProperties(Er,ac);Object.defineProperty(ic,"isAxiosError",{value:!0});Er.from=(t,e,r,n,s,o)=>{let i=Object.create(ic);return m.toFlatObject(t,i,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Er.call(i,t.message,e,r,n,s),i.cause=t,i.name=t.name,o&&Object.assign(i,o),i};var C=Er;var as=null;function zo(t){return m.isPlainObject(t)||m.isArray(t)}function lc(t){return m.endsWith(t,"[]")?t.slice(0,-2):t}function cc(t,e,r){return t?t.concat(e).map(function(s,o){return s=lc(s),!r&&o?"["+s+"]":s}).join(r?".":""):e}function xd(t){return m.isArray(t)&&!t.some(zo)}var Ad=m.toFlatObject(m,{},null,function(e){return/^is[A-Z]/.test(e)});function Sd(t,e,r){if(!m.isObject(t))throw new TypeError("target must be an object");e=e||new(as||FormData),r=m.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,g){return!m.isUndefined(g[y])});let n=r.metaTokens,s=r.visitor||f,o=r.dots,i=r.indexes,c=(r.Blob||typeof Blob!="undefined"&&Blob)&&m.isSpecCompliantForm(e);if(!m.isFunction(s))throw new TypeError("visitor must be a function");function l(d){if(d===null)return"";if(m.isDate(d))return d.toISOString();if(!c&&m.isBlob(d))throw new C("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(d)||m.isTypedArray(d)?c&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function f(d,y,g){let _=d;if(d&&!g&&typeof d=="object"){if(m.endsWith(y,"{}"))y=n?y:y.slice(0,-2),d=JSON.stringify(d);else if(m.isArray(d)&&xd(d)||(m.isFileList(d)||m.endsWith(y,"[]"))&&(_=m.toArray(d)))return y=lc(y),_.forEach(function(S,v){!(m.isUndefined(S)||S===null)&&e.append(i===!0?cc([y],v,o):i===null?y:y+"[]",l(S))}),!1}return zo(d)?!0:(e.append(cc(g,y,o),l(d)),!1)}let u=[],h=Object.assign(Ad,{defaultVisitor:f,convertValue:l,isVisitable:zo});function p(d,y){if(!m.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+y.join("."));u.push(d),m.forEach(d,function(_,w){(!(m.isUndefined(_)||_===null)&&s.call(e,_,m.isString(w)?w.trim():w,y,h))===!0&&p(_,y?y.concat(w):[w])}),u.pop()}}if(!m.isObject(t))throw new TypeError("data must be an object");return p(t),e}var nt=Sd;function uc(t){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function fc(t,e){this._pairs=[],t&&nt(t,this,e)}var dc=fc.prototype;dc.append=function(e,r){this._pairs.push([e,r])};dc.toString=function(e){let r=e?function(n){return e.call(this,n,uc)}:uc;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var cs=fc;function Rd(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function rn(t,e,r){if(!e)return t;let n=r&&r.encode||Rd;m.isFunction(r)&&(r={serialize:r});let s=r&&r.serialize,o;if(s?o=s(e,r):o=m.isURLSearchParams(e)?e.toString():new cs(e,r).toString(n),o){let i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}var Xo=class{constructor(){this.handlers=[]}use(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){m.forEach(this.handlers,function(n){n!==null&&e(n)})}},Yo=Xo;var ls={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var hc=typeof URLSearchParams!="undefined"?URLSearchParams:cs;var pc=typeof FormData!="undefined"?FormData:null;var mc=typeof Blob!="undefined"?Blob:null;var gc={isBrowser:!0,classes:{URLSearchParams:hc,FormData:pc,Blob:mc},protocols:["http","https","file","blob","url","data"]};var ei={};xi(ei,{hasBrowserEnv:()=>Zo,hasStandardBrowserEnv:()=>Cd,hasStandardBrowserWebWorkerEnv:()=>Od,navigator:()=>Qo,origin:()=>Td});var Zo=typeof window!="undefined"&&typeof document!="undefined",Qo=typeof navigator=="object"&&navigator||void 0,Cd=Zo&&(!Qo||["ReactNative","NativeScript","NS"].indexOf(Qo.product)<0),Od=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Td=Zo&&window.location.href||"http://localhost";var j={...ei,...gc};function ti(t,e){return nt(t,new j.classes.URLSearchParams,Object.assign({visitor:function(r,n,s,o){return j.isNode&&m.isBuffer(r)?(this.append(n,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Id(t){return m.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Pd(t){let e={},r=Object.keys(t),n,s=r.length,o;for(n=0;n<s;n++)o=r[n],e[o]=t[o];return e}function vd(t){function e(r,n,s,o){let i=r[o++];if(i==="__proto__")return!0;let a=Number.isFinite(+i),c=o>=r.length;return i=!i&&m.isArray(s)?s.length:i,c?(m.hasOwnProp(s,i)?s[i]=[s[i],n]:s[i]=n,!a):((!s[i]||!m.isObject(s[i]))&&(s[i]=[]),e(r,n,s[i],o)&&m.isArray(s[i])&&(s[i]=Pd(s[i])),!a)}if(m.isFormData(t)&&m.isFunction(t.entries)){let r={};return m.forEachEntry(t,(n,s)=>{e(Id(n),s,r,0)}),r}return null}var us=vd;function Nd(t,e,r){if(m.isString(t))try{return(e||JSON.parse)(t),m.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var ri={transitional:ls,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){let n=r.getContentType()||"",s=n.indexOf("application/json")>-1,o=m.isObject(e);if(o&&m.isHTMLForm(e)&&(e=new FormData(e)),m.isFormData(e))return s?JSON.stringify(us(e)):e;if(m.isArrayBuffer(e)||m.isBuffer(e)||m.isStream(e)||m.isFile(e)||m.isBlob(e)||m.isReadableStream(e))return e;if(m.isArrayBufferView(e))return e.buffer;if(m.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ti(e,this.formSerializer).toString();if((a=m.isFileList(e))||n.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return nt(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||s?(r.setContentType("application/json",!1),Nd(e)):e}],transformResponse:[function(e){let r=this.transitional||ri.transitional,n=r&&r.forcedJSONParsing,s=this.responseType==="json";if(m.isResponse(e)||m.isReadableStream(e))return e;if(e&&m.isString(e)&&(n&&!this.responseType||s)){let i=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?C.from(a,C.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:j.classes.FormData,Blob:j.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],t=>{ri.headers[t]={}});var xr=ri;var kd=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yc=t=>{let e={},r,n,s;return t&&t.split(`
`).forEach(function(i){s=i.indexOf(":"),r=i.substring(0,s).trim().toLowerCase(),n=i.substring(s+1).trim(),!(!r||e[r]&&kd[r])&&(r==="set-cookie"?e[r]?e[r].push(n):e[r]=[n]:e[r]=e[r]?e[r]+", "+n:n)}),e};var wc=Symbol("internals");function nn(t){return t&&String(t).trim().toLowerCase()}function fs(t){return t===!1||t==null?t:m.isArray(t)?t.map(fs):String(t)}function Md(t){let e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=r.exec(t);)e[n[1]]=n[2];return e}var Ld=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ni(t,e,r,n,s){if(m.isFunction(n))return n.call(this,e,r);if(s&&(e=r),!!m.isString(e)){if(m.isString(n))return e.indexOf(n)!==-1;if(m.isRegExp(n))return n.test(e)}}function Dd(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,n)=>r.toUpperCase()+n)}function Fd(t,e){let r=m.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+r,{value:function(s,o,i){return this[n].call(this,e,s,o,i)},configurable:!0})})}var Ar=class{constructor(e){e&&this.set(e)}set(e,r,n){let s=this;function o(a,c,l){let f=nn(c);if(!f)throw new Error("header name must be a non-empty string");let u=m.findKey(s,f);(!u||s[u]===void 0||l===!0||l===void 0&&s[u]!==!1)&&(s[u||c]=fs(a))}let i=(a,c)=>m.forEach(a,(l,f)=>o(l,f,c));if(m.isPlainObject(e)||e instanceof this.constructor)i(e,r);else if(m.isString(e)&&(e=e.trim())&&!Ld(e))i(yc(e),r);else if(m.isHeaders(e))for(let[a,c]of e.entries())o(c,a,n);else e!=null&&o(r,e,n);return this}get(e,r){if(e=nn(e),e){let n=m.findKey(this,e);if(n){let s=this[n];if(!r)return s;if(r===!0)return Md(s);if(m.isFunction(r))return r.call(this,s,n);if(m.isRegExp(r))return r.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=nn(e),e){let n=m.findKey(this,e);return!!(n&&this[n]!==void 0&&(!r||ni(this,this[n],n,r)))}return!1}delete(e,r){let n=this,s=!1;function o(i){if(i=nn(i),i){let a=m.findKey(n,i);a&&(!r||ni(n,n[a],a,r))&&(delete n[a],s=!0)}}return m.isArray(e)?e.forEach(o):o(e),s}clear(e){let r=Object.keys(this),n=r.length,s=!1;for(;n--;){let o=r[n];(!e||ni(this,this[o],o,e,!0))&&(delete this[o],s=!0)}return s}normalize(e){let r=this,n={};return m.forEach(this,(s,o)=>{let i=m.findKey(n,o);if(i){r[i]=fs(s),delete r[o];return}let a=e?Dd(o):String(o).trim();a!==o&&delete r[o],r[a]=fs(s),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let r=Object.create(null);return m.forEach(this,(n,s)=>{n!=null&&n!==!1&&(r[s]=e&&m.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){let n=new this(e);return r.forEach(s=>n.set(s)),n}static accessor(e){let n=(this[wc]=this[wc]={accessors:{}}).accessors,s=this.prototype;function o(i){let a=nn(i);n[a]||(Fd(s,i),n[a]=!0)}return m.isArray(e)?e.forEach(o):o(e),this}};Ar.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(Ar.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[r]=n}}});m.freezeMethods(Ar);var V=Ar;function sn(t,e){let r=this||xr,n=e||r,s=V.from(n.headers),o=n.data;return m.forEach(t,function(a){o=a.call(r,o,s.normalize(),e?e.status:void 0)}),s.normalize(),o}function on(t){return!!(t&&t.__CANCEL__)}function bc(t,e,r){C.call(this,t==null?"canceled":t,C.ERR_CANCELED,e,r),this.name="CanceledError"}m.inherits(bc,C,{__CANCEL__:!0});var Ie=bc;function an(t,e,r){let n=r.config.validateStatus;!r.status||!n||n(r.status)?t(r):e(new C("Request failed with status code "+r.status,[C.ERR_BAD_REQUEST,C.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function si(t){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Bd(t,e){t=t||10;let r=new Array(t),n=new Array(t),s=0,o=0,i;return e=e!==void 0?e:1e3,function(c){let l=Date.now(),f=n[o];i||(i=l),r[s]=c,n[s]=l;let u=o,h=0;for(;u!==s;)h+=r[u++],u=u%t;if(s=(s+1)%t,s===o&&(o=(o+1)%t),l-i<e)return;let p=f&&l-f;return p?Math.round(h*1e3/p):void 0}}var _c=Bd;function Ud(t,e){let r=0,n=1e3/e,s,o,i=(l,f=Date.now())=>{r=f,s=null,o&&(clearTimeout(o),o=null),t.apply(null,l)};return[(...l)=>{let f=Date.now(),u=f-r;u>=n?i(l,f):(s=l,o||(o=setTimeout(()=>{o=null,i(s)},n-u)))},()=>s&&i(s)]}var Ec=Ud;var Sr=(t,e,r=3)=>{let n=0,s=_c(50,250);return Ec(o=>{let i=o.loaded,a=o.lengthComputable?o.total:void 0,c=i-n,l=s(c),f=i<=a;n=i;let u={loaded:i,total:a,progress:a?i/a:void 0,bytes:c,rate:l||void 0,estimated:l&&a&&f?(a-i)/l:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(u)},r)},oi=(t,e)=>{let r=t!=null;return[n=>e[0]({lengthComputable:r,total:t,loaded:n}),e[1]]},ii=t=>(...e)=>m.asap(()=>t(...e));var xc=j.hasStandardBrowserEnv?((t,e)=>r=>(r=new URL(r,j.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new URL(j.origin),j.navigator&&/(msie|trident)/i.test(j.navigator.userAgent)):()=>!0;var Ac=j.hasStandardBrowserEnv?{write(t,e,r,n,s,o){let i=[t+"="+encodeURIComponent(e)];m.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),m.isString(n)&&i.push("path="+n),m.isString(s)&&i.push("domain="+s),o===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){let e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ai(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function ci(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function cn(t,e){return t&&!ai(e)?ci(t,e):e}var Sc=t=>t instanceof V?{...t}:t;function ye(t,e){e=e||{};let r={};function n(l,f,u,h){return m.isPlainObject(l)&&m.isPlainObject(f)?m.merge.call({caseless:h},l,f):m.isPlainObject(f)?m.merge({},f):m.isArray(f)?f.slice():f}function s(l,f,u,h){if(m.isUndefined(f)){if(!m.isUndefined(l))return n(void 0,l,u,h)}else return n(l,f,u,h)}function o(l,f){if(!m.isUndefined(f))return n(void 0,f)}function i(l,f){if(m.isUndefined(f)){if(!m.isUndefined(l))return n(void 0,l)}else return n(void 0,f)}function a(l,f,u){if(u in e)return n(l,f);if(u in t)return n(void 0,l)}let c={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(l,f,u)=>s(Sc(l),Sc(f),u,!0)};return m.forEach(Object.keys(Object.assign({},t,e)),function(f){let u=c[f]||s,h=u(t[f],e[f],f);m.isUndefined(h)&&u!==a||(r[f]=h)}),r}var ds=t=>{let e=ye({},t),{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:o,headers:i,auth:a}=e;e.headers=i=V.from(i),e.url=rn(cn(e.baseURL,e.url),t.params,t.paramsSerializer),a&&i.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(m.isFormData(r)){if(j.hasStandardBrowserEnv||j.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((c=i.getContentType())!==!1){let[l,...f]=c?c.split(";").map(u=>u.trim()).filter(Boolean):[];i.setContentType([l||"multipart/form-data",...f].join("; "))}}if(j.hasStandardBrowserEnv&&(n&&m.isFunction(n)&&(n=n(e)),n||n!==!1&&xc(e.url))){let l=s&&o&&Ac.read(o);l&&i.set(s,l)}return e};var $d=typeof XMLHttpRequest!="undefined",Rc=$d&&function(t){return new Promise(function(r,n){let s=ds(t),o=s.data,i=V.from(s.headers).normalize(),{responseType:a,onUploadProgress:c,onDownloadProgress:l}=s,f,u,h,p,d;function y(){p&&p(),d&&d(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let g=new XMLHttpRequest;g.open(s.method.toUpperCase(),s.url,!0),g.timeout=s.timeout;function _(){if(!g)return;let S=V.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),x={data:!a||a==="text"||a==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:S,config:t,request:g};an(function(P){r(P),y()},function(P){n(P),y()},x),g=null}"onloadend"in g?g.onloadend=_:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(_)},g.onabort=function(){g&&(n(new C("Request aborted",C.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new C("Network Error",C.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let v=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded",x=s.transitional||ls;s.timeoutErrorMessage&&(v=s.timeoutErrorMessage),n(new C(v,x.clarifyTimeoutError?C.ETIMEDOUT:C.ECONNABORTED,t,g)),g=null},o===void 0&&i.setContentType(null),"setRequestHeader"in g&&m.forEach(i.toJSON(),function(v,x){g.setRequestHeader(x,v)}),m.isUndefined(s.withCredentials)||(g.withCredentials=!!s.withCredentials),a&&a!=="json"&&(g.responseType=s.responseType),l&&([h,d]=Sr(l,!0),g.addEventListener("progress",h)),c&&g.upload&&([u,p]=Sr(c),g.upload.addEventListener("progress",u),g.upload.addEventListener("loadend",p)),(s.cancelToken||s.signal)&&(f=S=>{g&&(n(!S||S.type?new Ie(null,t,g):S),g.abort(),g=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));let w=si(s.url);if(w&&j.protocols.indexOf(w)===-1){n(new C("Unsupported protocol "+w+":",C.ERR_BAD_REQUEST,t));return}g.send(o||null)})};var jd=(t,e)=>{let{length:r}=t=t?t.filter(Boolean):[];if(e||r){let n=new AbortController,s,o=function(l){if(!s){s=!0,a();let f=l instanceof Error?l:this.reason;n.abort(f instanceof C?f:new Ie(f instanceof Error?f.message:f))}},i=e&&setTimeout(()=>{i=null,o(new C(`timeout ${e} of ms exceeded`,C.ETIMEDOUT))},e),a=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(l=>{l.unsubscribe?l.unsubscribe(o):l.removeEventListener("abort",o)}),t=null)};t.forEach(l=>l.addEventListener("abort",o));let{signal:c}=n;return c.unsubscribe=()=>m.asap(a),c}},Cc=jd;var qd=function*(t,e){let r=t.byteLength;if(!e||r<e){yield t;return}let n=0,s;for(;n<r;)s=n+e,yield t.slice(n,s),n=s},Hd=async function*(t,e){for await(let r of Kd(t))yield*qd(r,e)},Kd=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}let e=t.getReader();try{for(;;){let{done:r,value:n}=await e.read();if(r)break;yield n}}finally{await e.cancel()}},li=(t,e,r,n)=>{let s=Hd(t,e),o=0,i,a=c=>{i||(i=!0,n&&n(c))};return new ReadableStream({async pull(c){try{let{done:l,value:f}=await s.next();if(l){a(),c.close();return}let u=f.byteLength;if(r){let h=o+=u;r(h)}c.enqueue(new Uint8Array(f))}catch(l){throw a(l),l}},cancel(c){return a(c),s.return()}},{highWaterMark:2})};var ps=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Tc=ps&&typeof ReadableStream=="function",Wd=ps&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Ic=(t,...e)=>{try{return!!t(...e)}catch(r){return!1}},Jd=Tc&&Ic(()=>{let t=!1,e=new Request(j.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Oc=64*1024,ui=Tc&&Ic(()=>m.isReadableStream(new Response("").body)),hs={stream:ui&&(t=>t.body)};ps&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!hs[e]&&(hs[e]=m.isFunction(t[e])?r=>r[e]():(r,n)=>{throw new C(`Response type '${e}' is not supported`,C.ERR_NOT_SUPPORT,n)})})})(new Response);var Vd=async t=>{if(t==null)return 0;if(m.isBlob(t))return t.size;if(m.isSpecCompliantForm(t))return(await new Request(j.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(m.isArrayBufferView(t)||m.isArrayBuffer(t))return t.byteLength;if(m.isURLSearchParams(t)&&(t=t+""),m.isString(t))return(await Wd(t)).byteLength},Gd=async(t,e)=>{let r=m.toFiniteNumber(t.getContentLength());return r==null?Vd(e):r},Pc=ps&&(async t=>{let{url:e,method:r,data:n,signal:s,cancelToken:o,timeout:i,onDownloadProgress:a,onUploadProgress:c,responseType:l,headers:f,withCredentials:u="same-origin",fetchOptions:h}=ds(t);l=l?(l+"").toLowerCase():"text";let p=Cc([s,o&&o.toAbortSignal()],i),d,y=p&&p.unsubscribe&&(()=>{p.unsubscribe()}),g;try{if(c&&Jd&&r!=="get"&&r!=="head"&&(g=await Gd(f,n))!==0){let x=new Request(e,{method:"POST",body:n,duplex:"half"}),T;if(m.isFormData(n)&&(T=x.headers.get("content-type"))&&f.setContentType(T),x.body){let[P,N]=oi(g,Sr(ii(c)));n=li(x.body,Oc,P,N)}}m.isString(u)||(u=u?"include":"omit");let _="credentials"in Request.prototype;d=new Request(e,{...h,signal:p,method:r.toUpperCase(),headers:f.normalize().toJSON(),body:n,duplex:"half",credentials:_?u:void 0});let w=await fetch(d),S=ui&&(l==="stream"||l==="response");if(ui&&(a||S&&y)){let x={};["status","statusText","headers"].forEach(I=>{x[I]=w[I]});let T=m.toFiniteNumber(w.headers.get("content-length")),[P,N]=a&&oi(T,Sr(ii(a),!0))||[];w=new Response(li(w.body,Oc,P,()=>{N&&N(),y&&y()}),x)}l=l||"text";let v=await hs[m.findKey(hs,l)||"text"](w,t);return!S&&y&&y(),await new Promise((x,T)=>{an(x,T,{data:v,headers:V.from(w.headers),status:w.status,statusText:w.statusText,config:t,request:d})})}catch(_){throw y&&y(),_&&_.name==="TypeError"&&/fetch/i.test(_.message)?Object.assign(new C("Network Error",C.ERR_NETWORK,t,d),{cause:_.cause||_}):C.from(_,_&&_.code,t,d)}});var fi={http:as,xhr:Rc,fetch:Pc};m.forEach(fi,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(r){}Object.defineProperty(t,"adapterName",{value:e})}});var vc=t=>`- ${t}`,zd=t=>m.isFunction(t)||t===null||t===!1,ms={getAdapter:t=>{t=m.isArray(t)?t:[t];let{length:e}=t,r,n,s={};for(let o=0;o<e;o++){r=t[o];let i;if(n=r,!zd(r)&&(n=fi[(i=String(r)).toLowerCase()],n===void 0))throw new C(`Unknown adapter '${i}'`);if(n)break;s[i||"#"+o]=n}if(!n){let o=Object.entries(s).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build")),i=e?o.length>1?`since :
`+o.map(vc).join(`
`):" "+vc(o[0]):"as no adapter specified";throw new C("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n},adapters:fi};function di(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ie(null,t)}function gs(t){return di(t),t.headers=V.from(t.headers),t.data=sn.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),ms.getAdapter(t.adapter||xr.adapter)(t).then(function(n){return di(t),n.data=sn.call(t,t.transformResponse,n),n.headers=V.from(n.headers),n},function(n){return on(n)||(di(t),n&&n.response&&(n.response.data=sn.call(t,t.transformResponse,n.response),n.response.headers=V.from(n.response.headers))),Promise.reject(n)})}var ys="1.7.9";var ws={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ws[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var Nc={};ws.transitional=function(e,r,n){function s(o,i){return"[Axios v"+ys+"] Transitional option '"+o+"'"+i+(n?". "+n:"")}return(o,i,a)=>{if(e===!1)throw new C(s(i," has been removed"+(r?" in "+r:"")),C.ERR_DEPRECATED);return r&&!Nc[i]&&(Nc[i]=!0,console.warn(s(i," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(o,i,a):!0}};ws.spelling=function(e){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function Xd(t,e,r){if(typeof t!="object")throw new C("options must be an object",C.ERR_BAD_OPTION_VALUE);let n=Object.keys(t),s=n.length;for(;s-- >0;){let o=n[s],i=e[o];if(i){let a=t[o],c=a===void 0||i(a,o,t);if(c!==!0)throw new C("option "+o+" must be "+c,C.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new C("Unknown option "+o,C.ERR_BAD_OPTION)}}var ln={assertOptions:Xd,validators:ws};var Pe=ln.validators,Rr=class{constructor(e){this.defaults=e,this.interceptors={request:new Yo,response:new Yo}}async request(e,r){try{return await this._request(e,r)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;let o=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch(i){}}throw n}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=ye(this.defaults,r);let{transitional:n,paramsSerializer:s,headers:o}=r;n!==void 0&&ln.assertOptions(n,{silentJSONParsing:Pe.transitional(Pe.boolean),forcedJSONParsing:Pe.transitional(Pe.boolean),clarifyTimeoutError:Pe.transitional(Pe.boolean)},!1),s!=null&&(m.isFunction(s)?r.paramsSerializer={serialize:s}:ln.assertOptions(s,{encode:Pe.function,serialize:Pe.function},!0)),ln.assertOptions(r,{baseUrl:Pe.spelling("baseURL"),withXsrfToken:Pe.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let i=o&&m.merge(o.common,o[r.method]);o&&m.forEach(["delete","get","head","post","put","patch","common"],d=>{delete o[d]}),r.headers=V.concat(i,o);let a=[],c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(r)===!1||(c=c&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});let l=[];this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let f,u=0,h;if(!c){let d=[gs.bind(this),void 0];for(d.unshift.apply(d,a),d.push.apply(d,l),h=d.length,f=Promise.resolve(r);u<h;)f=f.then(d[u++],d[u++]);return f}h=a.length;let p=r;for(u=0;u<h;){let d=a[u++],y=a[u++];try{p=d(p)}catch(g){y.call(this,g);break}}try{f=gs.call(this,p)}catch(d){return Promise.reject(d)}for(u=0,h=l.length;u<h;)f=f.then(l[u++],l[u++]);return f}getUri(e){e=ye(this.defaults,e);let r=cn(e.baseURL,e.url);return rn(r,e.params,e.paramsSerializer)}};m.forEach(["delete","get","head","options"],function(e){Rr.prototype[e]=function(r,n){return this.request(ye(n||{},{method:e,url:r,data:(n||{}).data}))}});m.forEach(["post","put","patch"],function(e){function r(n){return function(o,i,a){return this.request(ye(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:i}))}}Rr.prototype[e]=r(),Rr.prototype[e+"Form"]=r(!0)});var un=Rr;var fn=class{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});let n=this;this.promise.then(s=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](s);n._listeners=null}),this.promise.then=s=>{let o,i=new Promise(a=>{n.subscribe(a),o=a}).then(s);return i.cancel=function(){n.unsubscribe(o)},i},e(function(o,i,a){n.reason||(n.reason=new Ie(o,i,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){let e=new AbortController,r=n=>{e.abort(n)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new fn(function(s){e=s}),cancel:e}}},kc=fn;function hi(t){return function(r){return t.apply(null,r)}}function pi(t){return m.isObject(t)&&t.isAxiosError===!0}var mi={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mi).forEach(([t,e])=>{mi[e]=t});var Mc=mi;function Lc(t){let e=new un(t),r=Zr(un.prototype.request,e);return m.extend(r,un.prototype,e,{allOwnKeys:!0}),m.extend(r,e,null,{allOwnKeys:!0}),r.create=function(s){return Lc(ye(t,s))},r}var H=Lc(xr);H.Axios=un;H.CanceledError=Ie;H.CancelToken=kc;H.isCancel=on;H.VERSION=ys;H.toFormData=nt;H.AxiosError=C;H.Cancel=H.CanceledError;H.all=function(e){return Promise.all(e)};H.spread=hi;H.isAxiosError=pi;H.mergeConfig=ye;H.AxiosHeaders=V;H.formToJSON=t=>us(m.isHTMLForm(t)?new FormData(t):t);H.getAdapter=ms.getAdapter;H.HttpStatusCode=Mc;H.default=H;var st=H;var{Axios:Mx,AxiosError:Lx,CanceledError:Dx,isCancel:Fx,CancelToken:Bx,VERSION:Ux,all:$x,Cancel:jx,isAxiosError:qx,spread:Hx,toFormData:Kx,AxiosHeaders:Wx,HttpStatusCode:Jx,formToJSON:Vx,getAdapter:Gx,mergeConfig:zx}=st;var Yd=t=>async function*(e){let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,max_tokens:c}=s;if(!o)throw new Error(b("API key is required"));let[l,f]=e[0].role==="system"?[e[0],e.slice(1)]:[null,e],u={"Content-Type":"application/json","anthropic-version":"2023-06-01","X-Api-Key":o,"anthropic-dangerous-direct-browser-access":"true"},h={model:a,system:l==null?void 0:l.content,max_tokens:c,messages:f,stream:!0},p=await st.post(i,h,{headers:u,adapter:"fetch",responseType:"stream",withCredentials:!1}),d=ot.fromSSEResponse(p,new AbortController);for await(let y of d)if(y.type==="content_block_delta"&&y.delta.type==="text_delta")yield y.delta.text;else if(y.type==="message_delta"&&y.delta.stop_reason!=="end_turn")throw new Error(`Unexpected stop reason: ${y.delta.stop_reason}`)},Dc=["claude-3-5-sonnet-latest","claude-3-opus-latest","claude-3-5-haiku-latest"],Fc={name:"Claude",defaultOptions:{apiKey:"",baseURL:"https://api.anthropic.com/v1/messages",model:Dc[0],max_tokens:8192,parameters:{}},sendRequestFunc:Yd,models:Dc,websiteToObtainKey:"https://console.anthropic.com"},ot=class{constructor(e,r){this.iterator=e;this.controller=r}static fromSSEResponse(e,r){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(let i of Qd(e,r)){if(i.event==="completion")try{yield JSON.parse(i.data)}catch(a){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),a}if(i.event==="message_start"||i.event==="message_delta"||i.event==="message_stop"||i.event==="content_block_start"||i.event==="content_block_delta"||i.event==="content_block_stop")try{yield JSON.parse(i.data)}catch(a){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),a}if(i.event!=="ping"&&i.event==="error"){console.error("Error event from server:",i.data);let a=i.data,l=JSON.parse(a)?void 0:a;throw new Error(l)}}o=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{o||r.abort()}}return new ot(s,r)}static fromReadableStream(e,r){let n=!1;async function*s(){let i=new Cr,a=Bc(e);for await(let c of a)for(let l of i.decode(c))yield l;for(let c of i.flush())yield c}async function*o(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of s())i||a&&(yield JSON.parse(a));i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||r.abort()}}return new ot(o,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],r=[],n=this.iterator(),s=o=>({next:()=>{if(o.length===0){let i=n.next();e.push(i),r.push(i)}return o.shift()}});return[new ot(()=>s(e),this.controller),new ot(()=>s(r),this.controller)]}toReadableStream(){let e=this,r,n=new TextEncoder;return new ReadableStream({async start(){r=e[Symbol.asyncIterator]()},async pull(s){try{let{value:o,done:i}=await r.next();if(i)return s.close();let a=n.encode(JSON.stringify(o)+`
`);s.enqueue(a)}catch(o){s.error(o)}},async cancel(){var s;await((s=r.return)==null?void 0:s.call(r))}})}};async function*Qd(t,e){if(!t.data)throw e.abort(),new Error("Attempted to iterate over a response with no data");let r=new gi,n=new Cr,s=Bc(t.data);for await(let o of Zd(s))for(let i of n.decode(o)){let a=r.decode(i);a&&(yield a)}for(let o of n.flush()){if(o.startsWith('{"type":"error"'))throw new Error(o);let i=r.decode(o);i&&(yield i)}}async function*Zd(t){let e=new Uint8Array;for await(let r of t){if(r==null)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?new TextEncoder().encode(r):r,s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let o;for(;(o=eh(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}function eh(t){for(let n=0;n<t.length-2;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}var gi=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,s]=th(e,":"),o=s.startsWith(" ")?s.substring(1):s;return r==="event"?this.event=o:r==="data"&&this.data.push(o),null}},bs=class{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let r=this.decodeText(e);if(this.trailingCR&&(r="\r"+r,this.trailingCR=!1),r.endsWith("\r")&&(this.trailingCR=!0,r=r.slice(0,-1)),!r)return[];let n=bs.NEWLINE_CHARS.has(r[r.length-1]||""),s=r.split(bs.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){var r;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Error(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(r=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Error(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Error("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}},Cr=bs;Cr.NEWLINE_CHARS=new Set([`
`,"\r"]),Cr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function th(t,e){let r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}function Bc(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r!=null&&r.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var rh=`

> [!quote]-  
> `,nh=`

`,sh=t=>async function*(e){var h;let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,...c}=s;if(!o)throw new Error(b("API key is required"));let f=await new Te({apiKey:o,baseURL:i,dangerouslyAllowBrowser:!0}).chat.completions.create({model:a,messages:e,stream:!0,...c}),u=!1;for await(let p of f){p.usage&&p.usage.prompt_tokens&&p.usage.completion_tokens&&console.debug(`Prompt tokens: ${p.usage.prompt_tokens}, completion tokens: ${p.usage.completion_tokens}`);let d=(h=p.choices[0])==null?void 0:h.delta,y=d==null?void 0:d.reasoning_content;if(y)yield(u?"":(u=!0,rh))+y.replace(/\n/g,`
> `);else{let g=u?(u=!1,nh):"";d!=null&&d.content&&(yield g+(d==null?void 0:d.content))}}},Uc=["deepseek-chat","deepseek-coder","deepseek-reasoner"],$c={name:"DeepSeek",defaultOptions:{apiKey:"",baseURL:"https://api.deepseek.com",model:Uc[0],parameters:{}},sendRequestFunc:sh,models:Uc,websiteToObtainKey:"https://platform.deepseek.com"};var _s=require("obsidian");var oh=t=>async function*(e){let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,...c}=s;if(!o)throw new Error(b("API key is required"));if(!a)throw new Error(b("Model is required"));let l={model:a,messages:e,stream:!1,...c};new _s.Notice(b("This is a non-streaming request, please wait..."),5*1e3),yield(await(0,_s.requestUrl)({url:i,method:"POST",body:JSON.stringify(l),headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}})).json.choices[0].message.content},jc={name:"Doubao",defaultOptions:{apiKey:"",baseURL:"https://ark.cn-beijing.volces.com/api/v3/chat/completions",model:"",parameters:{}},sendRequestFunc:oh,models:[],websiteToObtainKey:"https://www.volcengine.com"};var qc;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(qc||(qc={}));var Hc;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Hc||(Hc={}));var Kc;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Kc||(Kc={}));var Wc=["user","model","function","system"],Jc;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Jc||(Jc={}));var Vc;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Vc||(Vc={}));var Gc;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Gc||(Gc={}));var zc;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(zc||(zc={}));var dn;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})(dn||(dn={}));var Xc;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(Xc||(Xc={}));var Yc;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Yc||(Yc={}));var Qc;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Qc||(Qc={}));var ee=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},it=class extends ee{constructor(e,r){super(e),this.response=r}},xs=class extends ee{constructor(e,r,n,s){super(e),this.status=r,this.statusText=n,this.errorDetails=s}},ve=class extends ee{};var ih="https://generativelanguage.googleapis.com",ah="v1beta",ch="0.21.0",lh="genai-js",Lt;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Lt||(Lt={}));var yi=class{constructor(e,r,n,s,o){this.model=e,this.task=r,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,r;let n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||ah,o=`${((r=this.requestOptions)===null||r===void 0?void 0:r.baseUrl)||ih}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}};function uh(t){let e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${lh}/${ch}`),e.join(" ")}async function fh(t){var e;let r=new Headers;r.append("Content-Type","application/json"),r.append("x-goog-api-client",uh(t.requestOptions)),r.append("x-goog-api-key",t.apiKey);let n=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(s){throw new ve(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${s.message}`)}for(let[s,o]of n.entries()){if(s==="x-goog-api-key")throw new ve(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new ve(`Header name ${s} can only be set using the apiClient field`);r.append(s,o)}}return r}async function dh(t,e,r,n,s,o){let i=new yi(t,e,r,n,o);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},gh(o)),{method:"POST",headers:await fh(i),body:s})}}async function mn(t,e,r,n,s,o={},i=fetch){let{url:a,fetchOptions:c}=await dh(t,e,r,n,s,o);return hh(a,c,i)}async function hh(t,e,r=fetch){let n;try{n=await r(t,e)}catch(s){ph(s,t)}return n.ok||await mh(n,t),n}function ph(t,e){let r=t;throw t instanceof xs||t instanceof ve||(r=new ee(`Error fetching from ${e.toString()}: ${t.message}`),r.stack=t.stack),r}async function mh(t,e){let r="",n;try{let s=await t.json();r=s.error.message,s.error.details&&(r+=` ${JSON.stringify(s.error.details)}`,n=s.error.details)}catch(s){}throw new xs(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${r}`,t.status,t.statusText,n)}function gh(t){let e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){let r=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>r.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{r.abort()}),e.signal=r.signal}return e}function bi(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Es(t.candidates[0]))throw new it(`${at(t)}`,t);return yh(t)}else if(t.promptFeedback)throw new it(`Text not available. ${at(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Es(t.candidates[0]))throw new it(`${at(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Zc(t)[0]}else if(t.promptFeedback)throw new it(`Function call not available. ${at(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Es(t.candidates[0]))throw new it(`${at(t)}`,t);return Zc(t)}else if(t.promptFeedback)throw new it(`Function call not available. ${at(t)}`,t)},t}function yh(t){var e,r,n,s;let o=[];if(!((r=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||r===void 0)&&r.parts)for(let i of(s=(n=t.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0?void 0:s.parts)i.text&&o.push(i.text),i.executableCode&&o.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&o.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function Zc(t){var e,r,n,s;let o=[];if(!((r=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||r===void 0)&&r.parts)for(let i of(s=(n=t.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0?void 0:s.parts)i.functionCall&&o.push(i.functionCall);if(o.length>0)return o}var wh=[dn.RECITATION,dn.SAFETY,dn.LANGUAGE];function Es(t){return!!t.finishReason&&wh.includes(t.finishReason)}function at(t){var e,r,n;let s="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)s+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${t.promptFeedback.blockReason}`),!((r=t.promptFeedback)===null||r===void 0)&&r.blockReasonMessage&&(s+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((n=t.candidates)===null||n===void 0)&&n[0]){let o=t.candidates[0];Es(o)&&(s+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(s+=`: ${o.finishMessage}`))}return s}function hn(t){return this instanceof hn?(this.v=t,this):new hn(t)}function bh(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),s,o=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(h){n[h]&&(s[h]=function(p){return new Promise(function(d,y){o.push([h,p,d,y])>1||a(h,p)})})}function a(h,p){try{c(n[h](p))}catch(d){u(o[0][3],d)}}function c(h){h.value instanceof hn?Promise.resolve(h.value.v).then(l,f):u(o[0][2],h)}function l(h){a("next",h)}function f(h){a("throw",h)}function u(h,p){h(p),o.shift(),o.length&&a(o[0][0],o[0][1])}}var el=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function _h(t){let e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),r=Ah(e),[n,s]=r.tee();return{stream:xh(n),response:Eh(s)}}async function Eh(t){let e=[],r=t.getReader();for(;;){let{done:n,value:s}=await r.read();if(n)return bi(Sh(e));e.push(s)}}function xh(t){return bh(this,arguments,function*(){let r=t.getReader();for(;;){let{value:n,done:s}=yield hn(r.read());if(s)break;yield yield hn(bi(n))}})}function Ah(t){let e=t.getReader();return new ReadableStream({start(n){let s="";return o();function o(){return e.read().then(({value:i,done:a})=>{if(a){if(s.trim()){n.error(new ee("Failed to parse stream"));return}n.close();return}s+=i;let c=s.match(el),l;for(;c;){try{l=JSON.parse(c[1])}catch(f){n.error(new ee(`Error parsing JSON response: "${c[1]}"`));return}n.enqueue(l),s=s.substring(c[0].length),c=s.match(el)}return o()})}}})}function Sh(t){let e=t[t.length-1],r={promptFeedback:e==null?void 0:e.promptFeedback};for(let n of t){if(n.candidates)for(let s of n.candidates){let o=s.index;if(r.candidates||(r.candidates=[]),r.candidates[o]||(r.candidates[o]={index:s.index}),r.candidates[o].citationMetadata=s.citationMetadata,r.candidates[o].groundingMetadata=s.groundingMetadata,r.candidates[o].finishReason=s.finishReason,r.candidates[o].finishMessage=s.finishMessage,r.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){r.candidates[o].content||(r.candidates[o].content={role:s.content.role||"user",parts:[]});let i={};for(let a of s.content.parts)a.text&&(i.text=a.text),a.functionCall&&(i.functionCall=a.functionCall),a.executableCode&&(i.executableCode=a.executableCode),a.codeExecutionResult&&(i.codeExecutionResult=a.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),r.candidates[o].content.parts.push(i)}}n.usageMetadata&&(r.usageMetadata=n.usageMetadata)}return r}async function sl(t,e,r,n){let s=await mn(e,Lt.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(r),n);return _h(s)}async function ol(t,e,r,n){let o=await(await mn(e,Lt.GENERATE_CONTENT,t,!1,JSON.stringify(r),n)).json();return{response:bi(o)}}function il(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function pn(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(let r of t)typeof r=="string"?e.push({text:r}):e.push(r);return Rh(e)}function Rh(t){let e={role:"user",parts:[]},r={role:"function",parts:[]},n=!1,s=!1;for(let o of t)"functionResponse"in o?(r.parts.push(o),s=!0):(e.parts.push(o),n=!0);if(n&&s)throw new ee("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!s)throw new ee("No content is provided for sending chat message.");return n?e:r}function Ch(t,e){var r;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(r=e==null?void 0:e.cachedContent)===null||r===void 0?void 0:r.name,contents:[]},s=t.generateContentRequest!=null;if(t.contents){if(s)throw new ve("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=t.contents}else if(s)n=Object.assign(Object.assign({},n),t.generateContentRequest);else{let o=pn(t);n.contents=[o]}return{generateContentRequest:n}}function tl(t){let e;return t.contents?e=t:e={contents:[pn(t)]},t.systemInstruction&&(e.systemInstruction=il(t.systemInstruction)),e}function Oh(t){return typeof t=="string"||Array.isArray(t)?{content:pn(t)}:t}var rl=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Th={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Ih(t){let e=!1;for(let r of t){let{role:n,parts:s}=r;if(!e&&n!=="user")throw new ee(`First content should be with role 'user', got ${n}`);if(!Wc.includes(n))throw new ee(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(Wc)}`);if(!Array.isArray(s))throw new ee("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new ee("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of s)for(let c of rl)c in a&&(o[c]+=1);let i=Th[n];for(let a of rl)if(!i.includes(a)&&o[a]>0)throw new ee(`Content with role '${n}' can't contain '${a}' part`);e=!0}}var nl="SILENT_ERROR",wi=class{constructor(e,r,n,s={}){this.model=r,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(Ih(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,r={}){var n,s,o,i,a,c;await this._sendPromise;let l=pn(e),f={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),r),h;return this._sendPromise=this._sendPromise.then(()=>ol(this._apiKey,this.model,f,u)).then(p=>{var d;if(p.response.candidates&&p.response.candidates.length>0){this._history.push(l);let y=Object.assign({parts:[],role:"model"},(d=p.response.candidates)===null||d===void 0?void 0:d[0].content);this._history.push(y)}else{let y=at(p.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}h=p}),await this._sendPromise,h}async sendMessageStream(e,r={}){var n,s,o,i,a,c;await this._sendPromise;let l=pn(e),f={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),r),h=sl(this._apiKey,this.model,f,u);return this._sendPromise=this._sendPromise.then(()=>h).catch(p=>{throw new Error(nl)}).then(p=>p.response).then(p=>{if(p.candidates&&p.candidates.length>0){this._history.push(l);let d=Object.assign({},p.candidates[0].content);d.role||(d.role="model"),this._history.push(d)}else{let d=at(p);d&&console.warn(`sendMessageStream() was unsuccessful. ${d}. Inspect response object for details.`)}}).catch(p=>{p.message!==nl&&console.error(p)}),h}};async function Ph(t,e,r,n){return(await mn(e,Lt.COUNT_TOKENS,t,!1,JSON.stringify(r),n)).json()}async function vh(t,e,r,n){return(await mn(e,Lt.EMBED_CONTENT,t,!1,JSON.stringify(r),n)).json()}async function Nh(t,e,r,n){let s=r.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await mn(e,Lt.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:s}),n)).json()}var As=class{constructor(e,r,n={}){this.apiKey=e,this._requestOptions=n,r.model.includes("/")?this.model=r.model:this.model=`models/${r.model}`,this.generationConfig=r.generationConfig||{},this.safetySettings=r.safetySettings||[],this.tools=r.tools,this.toolConfig=r.toolConfig,this.systemInstruction=il(r.systemInstruction),this.cachedContent=r.cachedContent}async generateContent(e,r={}){var n;let s=tl(e),o=Object.assign(Object.assign({},this._requestOptions),r);return ol(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},s),o)}async generateContentStream(e,r={}){var n;let s=tl(e),o=Object.assign(Object.assign({},this._requestOptions),r);return sl(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},s),o)}startChat(e){var r;return new wi(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},e),this._requestOptions)}async countTokens(e,r={}){let n=Ch(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),r);return Ph(this.apiKey,this.model,n,s)}async embedContent(e,r={}){let n=Oh(e),s=Object.assign(Object.assign({},this._requestOptions),r);return vh(this.apiKey,this.model,n,s)}async batchEmbedContents(e,r={}){let n=Object.assign(Object.assign({},this._requestOptions),r);return Nh(this.apiKey,this.model,e,n)}};var Ss=class{constructor(e){this.apiKey=e}getGenerativeModel(e,r){if(!e.model)throw new ee("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new As(this.apiKey,e,r)}getGenerativeModelFromCachedContent(e,r,n){if(!e.name)throw new ve("Cached content must contain a `name` field.");if(!e.model)throw new ve("Cached content must contain a `model` field.");let s=["model","systemInstruction"];for(let i of s)if(r!=null&&r[i]&&e[i]&&(r==null?void 0:r[i])!==e[i]){if(i==="model"){let a=r.model.startsWith("models/")?r.model.replace("models/",""):r.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===c)continue}throw new ve(`Different value for "${i}" specified in modelParams (${r[i]}) and cachedContent (${e[i]})`)}let o=Object.assign(Object.assign({},r),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new As(this.apiKey,o,n)}};var kh=t=>async function*(e){let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a}=s;if(!o)throw new Error(b("API key is required"));let[c,l,f]=e[0].role==="system"?[e[0],e.slice(1,-1),e[e.length-1]]:[null,e.slice(0,-1),e[e.length-1]],u=c==null?void 0:c.content,h=l.map(_=>({role:_.role==="assistant"?"model":_.role,parts:[{text:_.content}]})),g=await new Ss(o).getGenerativeModel({model:a,systemInstruction:u},{baseUrl:i}).startChat({history:h}).sendMessageStream(f.content);for await(let _ of g.stream)yield _.text()},al={name:"Gemini",defaultOptions:{apiKey:"",baseURL:"https://generativelanguage.googleapis.com",model:"gemini-1.5-flash",parameters:{}},sendRequestFunc:kh,models:[],websiteToObtainKey:"https://makersuite.google.com/app/apikey"};var Mh=t=>async function*(e){let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,...c}=s;if(!o)throw new Error(b("API key is required"));if(!a)throw new Error(b("Model is required"));let l={model:a,messages:e,stream:!0,...c},u=(await st.post(i,l,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},adapter:"fetch",responseType:"stream",withCredentials:!1})).data.pipeThrough(new TextDecoderStream).getReader(),h=!0;for(;h;){let{done:p,value:d}=await u.read();if(p){h=!1;break}let y=d.split(`
`);for(let g of y){if(g.includes("data: [DONE]")){h=!1;break}let _=g.replace(/^data: /,"").trim();if(_){let w=JSON.parse(_);w.choices&&w.choices[0].delta&&w.choices[0].delta.content&&(yield w.choices[0].delta.content)}}}},cl=["moonshot-v1-128k","moonshot-v1-32k","moonshot-v1-8k"],ll={name:"Kimi",defaultOptions:{apiKey:"",baseURL:"https://api.moonshot.cn/v1/chat/completions",model:cl[0],parameters:{}},sendRequestFunc:Mh,models:cl,websiteToObtainKey:"https://www.moonshot.cn"};var Lh=t=>async function*(e){var u,h;let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,...c}=s;if(!o)throw new Error(b("API key is required"));let f=await new Te({apiKey:o,baseURL:i,dangerouslyAllowBrowser:!0}).chat.completions.create({model:a,messages:e,stream:!0,...c});for await(let p of f){let d=(h=(u=p.choices[0])==null?void 0:u.delta)==null?void 0:h.content;d&&(yield d)}},ul={name:"OpenAI",defaultOptions:{apiKey:"",baseURL:"https://api.openai.com/v1",model:"gpt-4",parameters:{}},sendRequestFunc:Lh,models:[],websiteToObtainKey:"https://platform.openai.com/api-keys"};var Dt=require("obsidian");var Dh=async(t,e)=>{if(!t||!e)throw new Error("Invalid API key secret");let r={grant_type:"client_credentials",client_id:t,client_secret:e},n=new URLSearchParams(r).toString(),o=(await(0,Dt.requestUrl)(`https://aip.baidubce.com/oauth/2.0/token?${n}`)).json;return{accessToken:o.access_token,exp:Date.now()+o.expires_in,apiKey:t,apiSecret:e}},Fh=async(t,e,r)=>{let n=Date.now();if(t&&t.apiKey===e&&t.apiSecret===r&&t.exp>n+3*60*1e3)return{isValid:!0,token:t};let s=await Dh(e,r);return console.debug("create new token",s),{isValid:!1,token:s}},Bh=(t,e)=>{let r=e.endsWith(`
`)||e.endsWith("\r"),n=e.split(/\r\n|[\n\r]/g);return n.length===1&&!r?(t.push(n[0]),[]):(t.length>0&&(n=[t.join("")+n[0],...n.slice(1)],t=[]),r||(t=[n.pop()||""]),n)},Uh=t=>async function*(e){let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,apiSecret:i,baseURL:a,model:c,token:l,...f}=s;if(!o)throw new Error(b("API key is required"));if(!i)throw new Error(b("API secret is required"));if(!c)throw new Error(b("Model is required"));let{token:u}=await Fh(l,o,i);if(t.token=u,Dt.Platform.isDesktopApp){let h={messages:e,stream:!0,...f},p=await st.post(a+`/${c}?access_token=${u.accessToken}`,h,{headers:{"Content-Type":"application/json"},adapter:"fetch",responseType:"stream",withCredentials:!1}),d=[],y=new TextDecoder("utf-8");for await(let g of p.data){let _=y.decode(Buffer.from(g)),w=Bh(d,_);for(let S of w)if(S.startsWith("data: ")){let v=S.slice(6),T=JSON.parse(v).result;T&&(yield T)}}}else{let h={messages:e,stream:!1,...f};new Dt.Notice(b("This is a non-streaming request, please wait..."),5*1e3);let p=await(0,Dt.requestUrl)({url:a+`/${c}?access_token=${u.accessToken}`,method:"POST",body:JSON.stringify(h),headers:{"Content-Type":"application/json"}});console.debug("response",p.json),yield p.json.result}},fl=["ernie-4.0-8k-latest","ernie-4.0-turbo-8k","ernie-3.5-128k","ernie_speed","ernie-speed-128k","gemma_7b_it","yi_34b_chat","mixtral_8x7b_instruct","llama_2_70b"],dl={name:"QianFan",defaultOptions:{apiKey:"",apiSecret:"",baseURL:"https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat",model:fl[0],parameters:{}},sendRequestFunc:Uh,models:fl,websiteToObtainKey:"https://qianfan.cloud.baidu.com"};var $h=t=>async function*(e){var u,h;let{parameters:r,...n}=t,s={...n,...r},{apiKey:o,baseURL:i,model:a,...c}=s;if(!o)throw new Error(b("API key is required"));let f=await new Te({apiKey:o,baseURL:i,dangerouslyAllowBrowser:!0}).chat.completions.create({model:a,messages:e,stream:!0,...c});for await(let p of f){let d=(h=(u=p.choices[0])==null?void 0:u.delta)==null?void 0:h.content;d&&(yield d)}},hl=["qwen-turbo","qwen-plus","qwen-max","qwen-max-longcontext"],pl={name:"Qwen",defaultOptions:{apiKey:"",baseURL:"https://dashscope.aliyuncs.com/compatible-mode/v1",model:hl[0],parameters:{}},sendRequestFunc:$h,models:hl,websiteToObtainKey:"https://dashscope.console.aliyun.com"};var Or={providers:[],systemTags:["System","\u7CFB\u7EDF"],newChatTags:["NewChat","\u65B0\u5BF9\u8BDD"],userTags:["User","\u6211"]},Tr=[ul,Xa,Fc,$c,jc,al,ll,wn,dl,pl,Jn,rs];var Rs=class extends k.PluginSettingTab{constructor(r,n){super(r,n);this.createProviderSetting=(r,n,s=!1)=>{let o=Tr.find(c=>c.name===n.vendor);if(!o)throw new Error("No vendor found "+n.vendor);let{containerEl:i}=this,a=i.createEl("details");a.createEl("summary",{text:ml(n.tag,o.name),cls:"tars-setting-h4"}),a.open=s,this.addTagSection(a,n,r,o.name),o.name!==wn.name&&this.addAPIkeySection(a,n.options,o.websiteToObtainKey?b("Obtain key from ")+o.websiteToObtainKey:""),"apiSecret"in n.options&&this.addAPISecretOptional(a,n.options),o.name===Jn.name?new k.Setting(a).setName(b("Model")).setDesc(b("Select the model to use")).addButton(c=>{c.setButtonText(n.options.model?n.options.model:b("Select the model to use")).onClick(async()=>{if(!n.options.apiKey){new k.Notice(b("Please input API key first"));return}try{let l=await Na(n.options.apiKey),f=async u=>{n.options.model=u,await this.plugin.saveSettings(),c.setButtonText(u)};new yn(this.app,l,f).open()}catch(l){new k.Notice("\u{1F534}"+l)}})}):o.models.length>0?this.addModelDropDownSection(a,n.options,o.models,r):this.addModelTextSection(a,n.options,r),o.name===rs.name&&new k.Setting(a).setName(b("Web search")).setDesc(b("Enable web search for AI")).addToggle(c=>c.setValue(n.options.enableWebSearch).onChange(async l=>{n.options.enableWebSearch=l,await this.plugin.saveSettings()})),this.addBaseURLSection(a,n.options,"e.g. "+o.defaultOptions.baseURL),"max_tokens"in n.options&&this.addMaxTokensOptional(a,n.options),"endpoint"in n.options&&this.addEndpointOptional(a,n.options),"apiVersion"in n.options&&this.addApiVersionOptional(a,n.options),this.addParametersSection(a,n.options),new k.Setting(a).setName(b("Remove")+" "+o.name).addButton(c=>{c.setWarning().setButtonText(b("Remove")).onClick(async()=>{this.plugin.settings.providers.splice(r,1),await this.plugin.saveSettings(),this.display()})})};this.addTagSection=(r,n,s,o)=>new k.Setting(r).setName(b("tag")).setDesc(b("Trigger AI generation")).addText(i=>i.setPlaceholder(o).setValue(n.tag).onChange(async a=>{let c=a.trim();if(c.length===0||!gl(c))return;if(this.plugin.settings.providers.filter((u,h)=>h!==s).map(u=>u.tag.toLowerCase()).includes(c.toLowerCase())){new k.Notice(b("Keyword for tag must be unique"));return}n.tag=c;let f=r.querySelector("summary");f!=null&&(f.textContent=ml(n.tag,o)),await this.plugin.saveSettings()}));this.addBaseURLSection=(r,n,s="")=>new k.Setting(r).setName("baseURL").setDesc(s).addText(o=>o.setValue(n.baseURL).onChange(async i=>{n.baseURL=i,await this.plugin.saveSettings()}));this.addAPIkeySection=(r,n,s="")=>new k.Setting(r).setName("API key").setDesc(s).addText(o=>o.setPlaceholder(b("Enter your key")).setValue(n.apiKey).onChange(async i=>{n.apiKey=i,await this.plugin.saveSettings()}));this.addAPISecretOptional=(r,n,s="")=>new k.Setting(r).setName("API Secret").setDesc(s).addText(o=>o.setPlaceholder("").setValue(n.apiSecret).onChange(async i=>{n.apiSecret=i,await this.plugin.saveSettings()}));this.addModelDropDownSection=(r,n,s,o)=>new k.Setting(r).setName(b("Model")).setDesc(b("Select the model to use")).addDropdown(i=>i.addOptions(s.reduce((a,c)=>(a[c]=c,a),{})).setValue(n.model).onChange(async a=>{n.model=a,await this.plugin.saveSettings()}));this.addModelTextSection=(r,n,s)=>new k.Setting(r).setName(b("Model")).setDesc(b("Input the model to use")).addText(o=>o.setPlaceholder("").setValue(n.model).onChange(async i=>{n.model=i,await this.plugin.saveSettings()}));this.addMaxTokensOptional=(r,n)=>new k.Setting(r).setName("Max tokens").setDesc(b("Refer to the technical documentation")).addText(s=>s.setPlaceholder("").setValue(n.max_tokens.toString()).onChange(async o=>{let i=parseInt(o);if(isNaN(i)){new k.Notice(b("Please enter a number"));return}if(i<256){new k.Notice(b("Minimum value is 256"));return}n.max_tokens=i,await this.plugin.saveSettings()}));this.addEndpointOptional=(r,n)=>new k.Setting(r).setName(b("Endpoint")).setDesc("e.g. https://docs-test-001.openai.azure.com/").addText(s=>s.setPlaceholder("").setValue(n.endpoint).onChange(async o=>{let i=o.trim();if(i.length===0)n.endpoint="",await this.plugin.saveSettings();else if(jh(i))n.endpoint=i,await this.plugin.saveSettings();else{new k.Notice(b("Invalid URL"));return}}));this.addApiVersionOptional=(r,n)=>new k.Setting(r).setName(b("API version")).setDesc("e.g. 2024-xx-xx-preview").addText(s=>s.setPlaceholder("").setValue(n.apiVersion).onChange(async o=>{n.apiVersion=o,await this.plugin.saveSettings()}));this.addParametersSection=(r,n)=>new k.Setting(r).setName(b("Override input parameters")).setDesc(b('Developer feature, in JSON format. e.g. {"model": "your model", "baseURL": "your url"}')).addTextArea(s=>s.setPlaceholder("{}").setValue(JSON.stringify(n.parameters)).onChange(async o=>{try{n.parameters=JSON.parse(o),await this.plugin.saveSettings()}catch(i){return}}));this.plugin=n}display(r=!1){let{containerEl:n}=this;n.empty();let s=Tr.map(i=>i.name),o=s[0];new k.Setting(n).setName(b("AI assistants")).setHeading(),new k.Setting(n).setName(b("New AI assistant")).setDesc(b("Select assistant from dropdown and click 'Add'. For those compatible with the OpenAI protocol, you can select OpenAI.")).addDropdown(i=>i.addOptions(s.reduce((a,c)=>(a[c]=c,a),{})).setValue(s[0]).onChange(async a=>{o=a})).addButton(i=>{i.setButtonText(b("Add")).onClick(async()=>{var u;let a=(u=Tr.find(h=>h.name===o))==null?void 0:u.defaultOptions;if(!a)throw new Error("No default options found for "+o);let l=this.plugin.settings.providers.map(h=>h.tag).includes(o)?"":o,f=JSON.parse(JSON.stringify(a));this.plugin.settings.providers.push({tag:l,vendor:o,options:f}),await this.plugin.saveSettings(),this.display(!0)})});for(let[i,a]of this.plugin.settings.providers.entries()){let c=i===this.plugin.settings.providers.length-1;this.createProviderSetting(i,a,c&&r)}n.createEl("br"),new k.Setting(n).setName(b("Message tags")).setDesc(b("Keywords for tags in the text box are separated by spaces")).setHeading(),new k.Setting(n).setName(b("New chat tags")).addText(i=>i.setPlaceholder(Or.newChatTags.join(" ")).setValue(this.plugin.settings.newChatTags.join(" ")).onChange(async a=>{let c=a.split(" ").filter(l=>l.length>0);_i(c)&&(this.plugin.settings.newChatTags=c,await this.plugin.saveSettings())})),new k.Setting(n).setName(b("User message tags")).addText(i=>i.setPlaceholder(Or.userTags.join(" ")).setValue(this.plugin.settings.userTags.join(" ")).onChange(async a=>{let c=a.split(" ").filter(l=>l.length>0);_i(c)&&(this.plugin.settings.userTags=c,await this.plugin.saveSettings())})),new k.Setting(n).setName(b("System message tags")).addText(i=>i.setPlaceholder(Or.systemTags.join(" ")).setValue(this.plugin.settings.systemTags.join(" ")).onChange(async a=>{let c=a.split(" ").filter(l=>l.length>0);_i(c)&&(this.plugin.settings.systemTags=c,await this.plugin.saveSettings())}))}},ml=(t,e)=>t===e?e:t+" ("+e+")",gl=t=>t.includes("#")?(new k.Notice(b("Keyword for tag must not contain #")),!1):t.includes(" ")?(new k.Notice(b("Keyword for tag must not contain space")),!1):!0,_i=t=>{if(t.length===0)return new k.Notice(b("At least one tag is required")),!1;for(let e of t)if(!gl(e))return!1;return!0},jh=t=>{try{return new URL(t),!0}catch(e){return!1}};var Ft=require("obsidian");var Ei=t=>`#${t} : `,yl=t=>`#${t} `,Cs=t=>[t.toLowerCase(),`#${t.toLowerCase()} `,`#${t.toLowerCase()} :`,`#${t.toLowerCase()} \uFF1A`],wl=t=>`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`,qh=t=>`${(t/1e3).toFixed(2)}s`,Os=class extends Ft.EditorSuggest{constructor(r,n){super(r);this.app=r,this.settings=n}onTrigger(r,n,s){if(r.line>=1&&n.getLine(r.line-1).trim())return null;let o=0,i=n.getLine(r.line),a=this.settings.newChatTags.map(yl);for(let p of a)if(i.startsWith(p)){o=p.length;break}let c=i.slice(o,r.ch),l=c.search(/\S/);if(l===-1)return null;o+=l,c=i.slice(o,r.ch);let f=c.toLowerCase(),u={start:{line:r.line,ch:o},end:{line:r.line,ch:r.ch}};for(let p of this.settings.newChatTags)if(Cs(p).includes(f))return{...u,query:JSON.stringify({type:"newChat",tag:p,replacement:yl(p)})};for(let p of this.settings.userTags)if(Cs(p).includes(f))return{...u,query:JSON.stringify({type:"user",tag:p,replacement:Ei(p)})};let h=this.settings.providers.map(p=>p.tag);for(let p of h)if(Cs(p).includes(f))return{...u,query:JSON.stringify({type:"assistant",tag:p,replacement:Ei(p)})};for(let p of this.settings.systemTags)if(Cs(p).includes(f))return{...u,query:JSON.stringify({type:"system",tag:p,replacement:Ei(p)})};return null}async getSuggestions(r){return[JSON.parse(r.query)]}renderSuggestion(r,n){switch(r.type){case"assistant":{n.createSpan({text:r.replacement+"  \u2728 "+b("AI generate")+" \u2728  "});break}default:n.createSpan({text:r.replacement})}}async selectSuggestion(r,n){if(!this.context)return;let s=this.context.editor;if(s.replaceRange(r.replacement,this.context.start,this.context.end),r.type==="assistant"){try{let o=await Bt(this.app,this.settings),a=(await Ci(o,0,s.posToOffset(this.context.start))).map(d=>({role:d.role,content:d.content}));console.debug("messages",a),console.debug("generate text: "),console.debug("element",r);let c=this.settings.providers.find(d=>d.tag===r.tag);if(!c)throw new Error("No provider found "+r.tag);let l=Tr.find(d=>d.name===c.vendor);if(!l)throw new Error("No vendor found "+c.vendor);let f=l.sendRequestFunc(c.options),u=new Date;console.debug("\u{1F680} Begin : ",wl(u));let h="";for await(let d of f(a))Oi(s,d),h+=d;let p=new Date;if(console.debug("\u{1F3C1} Finish: ",wl(p)),console.debug("\u231B Total : ",qh(p.getTime()-u.getTime())),h.length===0)throw new Error(b("No text generated"));console.debug("\u2728 "+b("AI generate")+" \u2728 ",h),new Ft.Notice(b("Text generated successfully"))}catch(o){console.error("error",o),new Ft.Notice(`\u{1F534} ${Ft.Platform.isDesktopApp?b("Check the developer console for error details. "):""}${o}`,10*1e3)}this.close()}}};var Ts=class extends bl.Plugin{async onload(){await this.loadSettings(),console.debug("loading Tars plugin..."),this.registerEditorSuggest(new Os(this.app,this.settings)),this.addCommand(Mi(this.app)),this.addCommand(ki(this.app,this.settings)),this.addCommand(Di(this.app,this.settings)),this.addSettingTab(new Rs(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},Or,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/

/* nosourcemap */